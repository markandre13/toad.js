{"version":3,"file":"main.js","sources":["../src/Signal.ts","../src/model/Model.ts","../src/model/GenericModel.ts","../src/model/BooleanModel.ts","../src/model/NumberModel.ts","../src/model/TextModel.ts","../src/model/HtmlModel.ts","../src/model/Action.ts","../src/controller/Controller.ts","../src/util/dom.ts","../src/controller/Template.ts","../src/controller/globalController.ts","../node_modules/bind-decorator/index.js","../src/util/animation.ts","../src/jsx-runtime.ts","../src/view/View.ts","../src/view/GenericView.ts","../src/view/GenericTool.ts","../src/view/ActionView.ts","../src/view/SlotView.ts","../src/view/ButtonView.ts","../src/view/ToolButton.ts","../src/view/CheckboxView.ts","../src/view/SliderView.ts","../src/view/TextView.ts","../src/view/textAreaStyle.ts","../src/view/TextTool.tsx","../src/view/TextArea.ts","../src/view/ToadIf.ts","../src/menu/menuStyle.ts","../src/menu/MenuState.ts","../src/menu/MenuButtonContainer.ts","../src/menu/PopupMenu.ts","../src/menu/MenuButton.ts","../src/menu/MenuNode.ts","../src/menu/MenuHelper.ts","../src/menu/Menu.ts","../src/menu/MenuSpacer.ts","../src/scrollIntoView.ts","../src/table/TableEditMode.ts","../src/table/TableEventType.ts","../src/table/TableModel.ts","../src/table/TablePos.ts","../src/table/SelectionModel.ts","../src/table/TypedTableModel.ts","../src/table/TableAdapter.ts","../src/table/private/tableStyle.ts","../src/table/private/InputOverlay.ts","../src/table/private/RemoveRowAnimation.tsx","../src/table/TableView.tsx","../src/table/private/InsertRowAnimation.tsx","../src/table/TableEvent.ts","../src/table/ArrayTableModel.ts","../src/table/TableTool.tsx","../src/table/TypedTableAdapter.ts","../src/table/TreeModel.ts","../src/table/TreeAdapter.tsx","../src/table/TreeNodeModel.ts","../src/table/ArrayModel.ts","../src/table/ArrayAdapter.ts","main.ts"],"sourcesContent":["/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport class SignalLink {\n  callback: (data?: any) => void\n  id?: any\n  constructor(callback: (data?: any) => void, id?: any) {\n    this.callback = callback\n    this.id = id\n  }\n}\n\n// TODO: specify the callback argument via generic\nexport class Signal<T = void> {\n  locked?: boolean\n  triggered?: any\n  callbacks?: Array<SignalLink>\n\n  add(callback: (data: T) => void): void\n  add(callback: (data: T) => void, id: any): void\n  add(callback: (data: T) => void, id?: any) {\n    if (!this.callbacks)\n      this.callbacks = new Array<SignalLink>()\n    this.callbacks.push(new SignalLink(callback, id))\n  }\n\n  remove(id: any) {\n    if (!this.callbacks)\n      return\n    for(let i=this.callbacks.length-1; i>=0; --i) {\n      if (this.callbacks[i].id === id)\n        this.callbacks.splice(i, 1)\n    }\n  }\n  \n  count(): number {\n    if (!this.callbacks)\n      return 0\n    return this.callbacks.length\n  }\n  \n  lock(): void {\n    this.locked = true\n  }\n  \n  unlock(): void {\n    this.locked = undefined\n    if (this.triggered) {\n      let data = this.triggered.data\n      this.triggered = undefined\n      this.trigger(data)\n    }\n  }\n\n  trigger(data: T): void {\n    if (this.locked) {\n      this.triggered = { data: data }\n      return\n    }\n    if (!this.callbacks)\n      return\n\n    for(let i=0; i<this.callbacks.length; ++i)\n      this.callbacks[i].callback(data)\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Signal } from \"../Signal\"\n\nexport abstract class Model<T = void> {\n  modified: Signal<T>\n\n  constructor() {\n    this.modified = new Signal<T>()\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"./Model\"\n\nexport class GenericModel<T> extends Model {\n  protected _value: T\n\n  constructor(value: T) {\n    super()\n    this._value = value\n  }\n\n  set value(value: T) {\n    if (this._value == value)\n      return\n    this._value = value\n    this.modified.trigger()\n  }\n\n  get value(): T {\n    return this._value\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { GenericModel } from \"./GenericModel\"\n\nexport class BooleanModel extends GenericModel<boolean> {\n  constructor(value: boolean) {\n    super(value)\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { GenericModel } from \"./GenericModel\"\n\nexport interface NumberModelOptions {\n  min?: number\n  max?: number\n  step?: number\n}\n\nexport class NumberModel extends GenericModel<number> {\n  min?: number\n  max?: number\n  step?: number\n\n  constructor(value: number, options?: NumberModelOptions) {\n    super(value)\n    if (options) {\n      this.min = options.min\n      this.max = options.max\n      this.step = options.step\n    }\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"./Model\"\n\nexport class TextModel extends Model {\n  _value: string | Function\n\n  constructor(value: string) {\n    super()\n    this._value = value\n  }\n\n  set promise(promise: Function) {\n    this._value = promise\n    this.modified.trigger()\n  }\n\n  get promise(): Function {\n    if (typeof this._value === \"string\") {\n      return () => {\n        return this._value\n      }\n    }\n    return this._value\n  }\n\n  set value(value: string) {\n    if (this._value === value)\n      return\n    if (typeof value !== \"string\") {\n      console.trace(`TextModel.set value(value: string): ${typeof value} is not type string`)\n      return\n    }\n    this._value = value\n    this.modified.trigger()\n  }\n\n  get value(): string {\n    switch(typeof this._value) {\n      case \"number\":\n      case \"string\":\n        this._value = `${this._value}`\n        break\n      case \"function\":\n        this._value = this._value()\n        break\n    }\n    return this._value as string\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TextModel } from \"./TextModel\"\n\nexport class HtmlModel extends TextModel {\n  constructor(value: string) {\n    super(value)\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"./Model\"\nimport { Signal } from \"../Signal\"\n\nexport class Action extends Model {\n  signal: Signal\n  title: string\n  \n  _enabled: boolean\n\n  constructor(parent: HTMLElement | undefined, title: string) {\n    super()\n    this.signal = new Signal()\n    this.title = title\n    this._enabled = true\n  }\n  \n  set value(placeHolder: any) {\n    throw Error(\"Action.value can not be assigned a value\")\n  }\n\n  get value(): any {\n    throw Error(\"Action.value can not return a value\")\n  }\n\n  set enabled(enabled: boolean) {\n    if (this._enabled == enabled)\n      return\n    this._enabled = enabled\n    this.modified.trigger()\n  }\n  \n  get enabled(): boolean {\n    return this._enabled\n  }\n  \n  trigger(data?: any): void {\n    if (!this._enabled)\n      return\n    this.signal.trigger(data)\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { BooleanModel } from \"../model/BooleanModel\"\nimport { NumberModel } from \"../model/NumberModel\"\nimport { HtmlModel } from \"../model/HtmlModel\"\nimport { TextModel } from \"../model/TextModel\"\nimport { Model } from \"../model/Model\"\nimport { View } from \"../view/View\"\nimport { Action } from \"../model/Action\"\nimport { Signal } from \"../Signal\"\n\nexport class Controller {\n  modelId2Models: Map<string, Set<Model>>\n  modelId2Views: Map<string, Set<View>>\n  view2ModelIds: Map<View, Set<string>>\n\n  sigChanged: Signal\n\n  constructor() {\n    this.modelId2Models = new Map<string, Set<Model>>()\n    this.modelId2Views = new Map<string, Set<View>>()\n    this.view2ModelIds = new Map<View, Set<string>>()\n    this.sigChanged = new Signal()\n  }\n\n  registerAction(actionId: string, callback: () => void): Action {\n    // console.log(`registerAction(\"${actionId}\", <callback>)`)\n    let action = new Action(undefined, actionId)\n    action.signal.add(callback)\n    this._registerModel(\"A:\" + actionId, action)\n    return action\n  }\n\n  registerModel(modelId: string, model: Model): void {\n    this._registerModel(\"M:\" + modelId, model)\n  }\n\n  _registerModel(modelId: string, model: Model): void {\n    let modelsForModelId = this.modelId2Models.get(modelId)\n    if (!modelsForModelId) {\n      modelsForModelId = new Set<Model>()\n      this.modelId2Models.set(modelId, modelsForModelId)\n    }\n\n    modelsForModelId.add(model)\n\n    let viewsForModelId = this.modelId2Views.get(modelId)\n    if (!viewsForModelId)\n      return\n\n    for (let view of viewsForModelId) {\n      view.setModel(model)\n    }\n  }\n\n  registerView(modelId: string, view: View): void {\n    if (view.controller && view.controller !== this) {\n      console.log(\"error: attempt to register view more than once at different controllers\")\n      return\n    }\n    view.controller = this\n\n    let modelIdsForView = this.view2ModelIds.get(view)\n    if (!modelIdsForView) {\n      modelIdsForView = new Set<string>()\n      this.view2ModelIds.set(view, modelIdsForView)\n    }\n    modelIdsForView.add(modelId)\n\n    let viewsForModelId = this.modelId2Views.get(modelId)\n    if (!viewsForModelId) {\n      viewsForModelId = new Set<View>()\n      this.modelId2Views.set(modelId, viewsForModelId)\n    }\n    viewsForModelId.add(view)\n\n    let modelsForView = this.modelId2Models.get(modelId)\n    if (!modelsForView)\n      return\n\n    for (let model of modelsForView) {\n      view.setModel(model)\n    }\n  }\n\n  unregisterView(view: View): void {\n    if (!view.controller)\n      return\n    if (view.controller !== this)\n      throw Error(\"attempt to unregister view from wrong controller\")\n\n    let modelIds = this.view2ModelIds.get(view)\n    if (!modelIds)\n      return\n\n    for (let modelId of modelIds) {\n      let views = this.modelId2Views.get(modelId)\n      if (!views)\n        continue\n      views.delete(view)\n      if (views.size === 0) {\n        this.modelId2Views.delete(modelId)\n      }\n      view.setModel(undefined)\n    }\n  }\n\n  clear(): void {\n    for (let entry of this.view2ModelIds) {\n      entry[0].setModel(undefined)\n    }\n    this.modelId2Models.clear()\n    this.modelId2Views.clear()\n    this.view2ModelIds.clear()\n  }\n\n  bind<T>(modelId: string, model: Model<T>): void {\n    this.registerModel(modelId, model as any)\n  }\n\n  action(actionId: string, callback: () => void): Action {\n    return this.registerAction(actionId, callback)\n  }\n\n  text(modelId: string, value: string): TextModel {\n    let model = new TextModel(value)\n    this.bind(modelId, model)\n    return model\n  }\n\n  html(modelId: string, value: string): HtmlModel {\n    let model = new HtmlModel(value)\n    this.bind(modelId, model)\n    return model\n  }\n\n  boolean(modelId: string, value: boolean): BooleanModel {\n    let model = new BooleanModel(value)\n    this.bind(modelId, model)\n    return model\n  }\n\n  number(modelId: string, value: number, options: any): NumberModel {\n    let model = new NumberModel(value, options)\n    this.bind(modelId, model)\n    return model\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\n/**\n *\n * Utility functions to work with the DOM.\n *\n */\n\nexport function instantiateTemplate(name: string): DocumentFragment {\n  return tmpl(name);\n}\n\nexport function tmpl(name: string): DocumentFragment {\n  let t = document.querySelector('template[id=\"'+name+'\"]');\n  if (!t) {\n    throw new Error(\"failed to find template '\"+name+\"'\");\n  }\n  let x = t as HTMLTemplateElement;\n  let z: DocumentFragment = x.content;\n  let y = document.importNode(z, true);\n  return y;\n}\n\nexport function find(node: Element|DocumentFragment, selector: string): Element|null {\n  return node.querySelector(selector);\n}\n\nexport function tag(name: string): HTMLElement { return document.createElement(name); } // FIXME: stupid idea with TypeScript\nexport function txt(txt: string): Text { return document.createTextNode(txt); } // FIXME: stupid idea with TypeScript\nexport function img(src: string): HTMLImageElement {\n  let img = document.createElement(\"img\") as HTMLImageElement\n  img.src = src\n  return img\n}\n\nexport function add(n0: Node, n1: Node): void { n0.appendChild(n1); }\nexport function remove(n: Node): void { \n  if (!n.parentNode)\n    throw Error(\"element has no parent\");\n  n.parentNode.removeChild(n);\n}\nexport function erase(n: Element): void { \n  // if ('replaceChildren' in n && typeof n[\"replaceChildren\"] === \"function\")\n  //   (n as any).replaceChildren()\n  // else\n    while(n.firstChild) n.removeChild(n.firstChild);\n}\n\nexport function hasFocus(element: Element): boolean {\n  if (!document.hasFocus())\n    return false\n  let active = document.activeElement\n  while(active !== null) {\n    if (active === element) {\n      return true\n    }\n    if (active.shadowRoot === null)\n      break\n    active = active.shadowRoot.activeElement         \n  }\n  return false\n}\n\nexport function grabMouse(event: MouseEvent) {\n  let target = event.target as HTMLElement\n//  console.log(event)\n    \n  let documentMouseMove = (event: MouseEvent) => {\n//  console.log(\"document.moveMove\", target)\n    target.dispatchEvent(new MouseEvent(\"mousemove\", event))\n    // srcElement, target, toElement, offsetX, offsetY, ...?\n//    target.onmousemove(event)\n    event.stopPropagation()\n  }\n\n  let documentMouseUp = (event: MouseEvent) => {\n//  console.log(\"document.mouseUp\", target)\n    target.dispatchEvent(new MouseEvent(\"mouseup\", event))\n//    target.onmouseup(event)\n    document.removeEventListener(\"mousemove\", documentMouseMove, {capture: true})\n    document.removeEventListener(\"mouseup\", documentMouseUp, {capture: true})\n    document.body.style.pointerEvents = \"auto\"\n    event.stopPropagation()\n  }\n\n  document.addEventListener(\"mousemove\", documentMouseMove, {capture: true})\n  document.addEventListener(\"mouseup\", documentMouseUp, {capture: true})\n  document.body.style.pointerEvents = \"none\"\n  event.preventDefault()\n  event.stopPropagation()\n}\n\nexport function attribute(element: Element, name: string): string {\n  let attribute = element.getAttribute(name)\n  if (attribute === null) {\n    console.log(\"missing attribute '\"+name+\"' in \", element)\n    throw Error(\"missing attribute '\"+name+\"' in \"+element.nodeName)\n  }\n  return attribute\n}\n\nexport function attributeOrUndefined(element: Element, name: string): string|undefined {\n  let attribute = element.getAttribute(name)\n  return attribute === null ? undefined : attribute\n}\n\n// return true when first appears before second within the dom hierachy\nexport function isNodeBeforeNode(first: Node, second: Node): boolean {\n  \n  let node: Node|null\n  \n  // get all parents of the first node\n  let firstPrevious = first\n  node = first\n  let parentsOfFirstNode = new Map<Node, Node>() // parent to child\n  while(true) {\n    firstPrevious = node\n    node = node.parentNode\n    if (!node)\n      break\n    parentsOfFirstNode.set(node, firstPrevious)\n  }\n\n  // find a parent of the second node which is also a parent of the first node\n  let secondPrevious = second\n  node = second\n  while(node) {\n    secondPrevious = node\n    node = node.parentNode\n    if (!node) {\n      throw Error(`isNodeBeforeNode(first, second): nodes have no common parent`)\n    }\n    let lookup = parentsOfFirstNode.get(node)\n    if (lookup) {\n      firstPrevious = lookup\n      break\n    }\n  }\n  \n  for(let child of node!.childNodes) {\n    if (child === firstPrevious)\n      return true\n    if (child === secondPrevious)\n      return false\n  }\n  throw Error(\"isNodeBeforeNode(first, second): couldn't determine order of nodes\")\n}\n\nexport function pixelToNumber(pixel: string): number {\n  if (pixel === \"\")\n      return 0\n  if (pixel.substr(pixel.length - 2) !== \"px\")\n    throw Error(`TableView.pixelToNumber('${pixel}') expected 'px' suffix`)\n  return Number.parseFloat(pixel.substr(0, pixel.length - 2))\n}\n\nexport function getPropertyValue(element: HTMLElement, propertyName: string): number {\n  let elementStyle = window.getComputedStyle(element, undefined)\n  let property = elementStyle.getPropertyValue(propertyName)\n  return pixelToNumber(property)\n}\n\nexport function horizontalPadding(element: HTMLElement): number {\n  return getPropertyValue(element, \"padding-left\") + getPropertyValue(element, \"padding-right\")\n}\n\nexport function verticalPadding(element: HTMLElement): number {\n  return getPropertyValue(element, \"padding-top\") + getPropertyValue(element, \"padding-bottom\")\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"../util/dom\"\nimport { View } from \"../view/View\"\nimport { Controller } from \"./Controller\"\n\nexport class Template extends Controller {\n  root: DocumentFragment\n\n  constructor(template: string) {\n    super()\n    this.root = dom.instantiateTemplate(template)\n    this.registerViews()\n  }\n\n  registerViews() {\n    let views = this.root.querySelectorAll(\"[model]\")\n    for (let element of views) {\n      //if (element.nodeName.toUpperCase().substring(0,4)!==\"TOAD-\")\n      //  continue\n      let view = element as View\n      if (!view)\n        continue\n      try {\n        this.registerView(view.getModelId(), view)\n      }\n      catch (e) {\n      }\n    }\n\n    views = this.root.querySelectorAll(\"[action]\")\n    for (let element of views) {\n      //if (element.nodeName.toUpperCase().substring(0,4)!==\"TOAD-\")\n      //  continue\n      let view = element as View\n      if (!view)\n        continue\n      //      view.controller = this\n      try {\n        this.registerView(view.getActionId(), view)\n      }\n      catch (e) {\n      }\n    }\n\n  }\n\n  openHref(href: string) {\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { BooleanModel } from \"../model/BooleanModel\"\nimport { TextModel } from \"../model/TextModel\"\nimport { Model } from \"../model/Model\"\nimport { Action } from \"../model/Action\"\nimport { Controller } from \"./Controller\"\n\nexport let globalController = new Controller()\n\nexport function bind<T>(modelId: string, model: Model<T>): void {\n  globalController.bind(modelId, model)\n}\n\nexport function action(actionId: string, action: () => void): Action { // FIXME: deprecated\n  return globalController.registerAction(actionId, action)\n}\n\nexport function unbind() {\n  globalController.clear()\n}\n\nexport function text(modelId: string, value: string): TextModel {\n  return globalController.text(modelId, value)\n}\n\nexport function boolean(modelId: string, value: boolean): BooleanModel {\n  return globalController.boolean(modelId, value)\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar constants;\n(function (constants) {\n    constants.typeOfFunction = 'function';\n    constants.boolTrue = true;\n})(constants || (constants = {}));\nfunction bind(target, propertyKey, descriptor) {\n    if (!descriptor || (typeof descriptor.value !== constants.typeOfFunction)) {\n        throw new TypeError(\"Only methods can be decorated with @bind. <\" + propertyKey + \"> is not a method!\");\n    }\n    return {\n        configurable: constants.boolTrue,\n        get: function () {\n            var bound = descriptor.value.bind(this);\n            // Credits to https://github.com/andreypopp/autobind-decorator for memoizing the result of bind against a symbol on the instance.\n            Object.defineProperty(this, propertyKey, {\n                value: bound,\n                configurable: constants.boolTrue,\n                writable: constants.boolTrue\n            });\n            return bound;\n        }\n    };\n}\nexports.bind = bind;\nexports.default = bind;\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport bind from 'bind-decorator'\n\n// TODO: look into cancelAnimationFrame during refactoring\nexport class AnimationBase {\n    static animationFrameCount = 468\n\n    start() {\n        this.prepare()\n        if (this._stop === true)\n            return\n        this.requestAnimationFrame(this._firstFrame)\n    }\n\n    stop() {\n        this._stop = true\n        if (this.animator?.current === this)\n            this.animator.current = undefined\n    }\n\n    replace(animation: AnimationBase) {\n        this.next = animation\n        this.animationFrame(1)\n        this.lastFrame()\n        animation.prepare()\n    }\n\n    prepare() { }\n    firstFrame() { }\n    animationFrame(value: number) { }\n    lastFrame() { }\n\n    protected _stop = false\n    protected startTime!: number\n    protected next?: AnimationBase\n    animator?: Animator\n\n    protected requestAnimationFrame(callback: FrameRequestCallback): void {\n        window.requestAnimationFrame(callback)\n    }\n\n    @bind protected _firstFrame(time: number) {\n        this.startTime = time\n        this.firstFrame()\n        if (this._stop)\n            return\n        this.animationFrame(0)\n        this.requestAnimationFrame(this._animationFrame)\n    }\n\n    @bind protected _animationFrame(time: number) {\n        if (this.next) {\n            this.next._firstFrame(time)\n            return\n        }\n\n        let elapsed = AnimationBase.animationFrameCount > 0 ? (time - this.startTime) / AnimationBase.animationFrameCount : 1\n\n        elapsed = elapsed > 1 ? 1 : elapsed\n\n        const value = this.ease(elapsed)\n\n        this.animationFrame(value)\n        if (this._stop) {\n            return\n        }\n\n        if (value < 1.0) {\n            this.requestAnimationFrame(this._animationFrame.bind(this))\n        } else {\n            this.lastFrame()\n            if (this.animator?.current === this)\n                this.animator.current = undefined\n        }\n    }\n\n    protected ease(k: number): number {\n        return 0.5 * (1 - Math.cos(Math.PI * k))\n    }\n}\n\n// FIXME: no tests\nexport class Animator {\n    current?: AnimationBase\n    run(animation: AnimationBase) {\n        const current = this.current\n        this.current = animation\n        animation.animator = this\n        if (current) {\n            current.animator = undefined\n            current.replace(animation)\n        } else {\n            animation.start()\n        }\n    }\n}","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport * as CSS from \"csstype\"\n\nimport { Action } from \"@toad/model/Action\"\nimport { NumberModel } from \"@toad/model/NumberModel\"\nimport { TextModel } from \"@toad/model/TextModel\"\nimport { TableModel } from \"@toad/table/TableModel\"\n\nexport namespace JSX {\n\n    export interface ToadButtonProps extends HTMLElementProps {\n        model?: string | TextModel\n        action?: string | Action\n    }\n    export interface ToadSliderProps extends HTMLElementProps {\n        model?: string | NumberModel\n    }\n    export interface ToadTextProps extends HTMLElementProps {\n        model?: string | TextModel | NumberModel\n    }\n    export interface ToadTableProps extends HTMLElementProps {\n        model?: string | TableModel\n    }\n\n    type SVGPreserveAspectRatioAlign = \"none\" | \"xMinYMin\" | \"xMidYMin\" | \"xMaxYMin\" | \"xMinYMid\" | \"xMidYMid\" | \"xMaxYMid\" | \"xMinYMax\" | \"xMidYMax\" | \"xMaxYMax\"\n    type SVGPreserveAspectRatioMeetOrSlice = \" meet\" | \" slice\" | \"\"\n    type SVGPreserveAspectRatio = `${SVGPreserveAspectRatioAlign}${SVGPreserveAspectRatioMeetOrSlice}`\n\n    export interface SVGProps extends HTMLElementProps {\n        viewBox?: string\n        width?: string | number\n        height?: string | number\n        preserveAspectRatio?: SVGPreserveAspectRatio\n        transform?: string\n    }\n\n    interface ToadProps {\n        set?: Reference<any> // FIXME: we might be able to specify the exact type here\n    }\n\n    // use csstype's nice CSS definitons and comments for VSCode's Intellisense\n    export interface CSSProperties extends CSS.Properties<string | number> { }\n\n    // copy'n pasted Aria definitions from DefinitelyTyped/types/react/index.d.ts\n\n    // All the WAI-ARIA 1.1 attributes from https://www.w3.org/TR/wai-aria-1.1/\n    interface AriaAttributes {\n        /** Identifies the currently active element when DOM focus is on a composite widget, textbox, group, or application. */\n        'aria-activedescendant'?: string\n        /** Indicates whether assistive technologies will present all, or only parts of, the changed region based on the change notifications defined by the aria-relevant attribute. */\n        'aria-atomic'?: boolean | 'false' | 'true'\n        /**\n         * Indicates whether inputting text could trigger display of one or more predictions of the user's intended value for an input and specifies how predictions would be\n         * presented if they are made.\n         */\n        'aria-autocomplete'?: 'none' | 'inline' | 'list' | 'both'\n        /** Indicates an element is being modified and that assistive technologies MAY want to wait until the modifications are complete before exposing them to the user. */\n        'aria-busy'?: boolean | 'false' | 'true'\n        /**\n         * Indicates the current \"checked\" state of checkboxes, radio buttons, and other widgets.\n         * @see aria-pressed @see aria-selected.\n         */\n        'aria-checked'?: boolean | 'false' | 'mixed' | 'true'\n        /**\n         * Defines the total number of columns in a table, grid, or treegrid.\n         * @see aria-colindex.\n         */\n        'aria-colcount'?: number\n        /**\n         * Defines an element's column index or position with respect to the total number of columns within a table, grid, or treegrid.\n         * @see aria-colcount @see aria-colspan.\n         */\n        'aria-colindex'?: number\n        /**\n         * Defines the number of columns spanned by a cell or gridcell within a table, grid, or treegrid.\n         * @see aria-colindex @see aria-rowspan.\n         */\n        'aria-colspan'?: number\n        /**\n         * Identifies the element (or elements) whose contents or presence are controlled by the current element.\n         * @see aria-owns.\n         */\n        'aria-controls'?: string\n        /** Indicates the element that represents the current item within a container or set of related elements. */\n        'aria-current'?: boolean | 'false' | 'true' | 'page' | 'step' | 'location' | 'date' | 'time'\n        /**\n         * Identifies the element (or elements) that describes the object.\n         * @see aria-labelledby\n         */\n        'aria-describedby'?: string\n        /**\n         * Identifies the element that provides a detailed, extended description for the object.\n         * @see aria-describedby.\n         */\n        'aria-details'?: string\n        /**\n         * Indicates that the element is perceivable but disabled, so it is not editable or otherwise operable.\n         * @see aria-hidden @see aria-readonly.\n         */\n        'aria-disabled'?: boolean | 'false' | 'true'\n        /**\n         * Indicates what functions can be performed when a dragged object is released on the drop target.\n         * @deprecated in ARIA 1.1\n         */\n        'aria-dropeffect'?: 'none' | 'copy' | 'execute' | 'link' | 'move' | 'popup'\n        /**\n         * Identifies the element that provides an error message for the object.\n         * @see aria-invalid @see aria-describedby.\n         */\n        'aria-errormessage'?: string\n        /** Indicates whether the element, or another grouping element it controls, is currently expanded or collapsed. */\n        'aria-expanded'?: boolean | 'false' | 'true'\n        /**\n         * Identifies the next element (or elements) in an alternate reading order of content which, at the user's discretion,\n         * allows assistive technology to override the general default of reading in document source order.\n         */\n        'aria-flowto'?: string\n        /**\n         * Indicates an element's \"grabbed\" state in a drag-and-drop operation.\n         * @deprecated in ARIA 1.1\n         */\n        'aria-grabbed'?: boolean | 'false' | 'true'\n        /** Indicates the availability and type of interactive popup element, such as menu or dialog, that can be triggered by an element. */\n        'aria-haspopup'?: boolean | 'false' | 'true' | 'menu' | 'listbox' | 'tree' | 'grid' | 'dialog'\n        /**\n         * Indicates whether the element is exposed to an accessibility API.\n         * @see aria-disabled.\n         */\n        'aria-hidden'?: boolean | 'false' | 'true'\n        /**\n         * Indicates the entered value does not conform to the format expected by the application.\n         * @see aria-errormessage.\n         */\n        'aria-invalid'?: boolean | 'false' | 'true' | 'grammar' | 'spelling'\n        /** Indicates keyboard shortcuts that an author has implemented to activate or give focus to an element. */\n        'aria-keyshortcuts'?: string\n        /**\n         * Defines a string value that labels the current element.\n         * @see aria-labelledby.\n         */\n        'aria-label'?: string\n        /**\n         * Identifies the element (or elements) that labels the current element.\n         * @see aria-describedby.\n         */\n        'aria-labelledby'?: string\n        /** Defines the hierarchical level of an element within a structure. */\n        'aria-level'?: number\n        /** Indicates that an element will be updated, and describes the types of updates the user agents, assistive technologies, and user can expect from the live region. */\n        'aria-live'?: 'off' | 'assertive' | 'polite'\n        /** Indicates whether an element is modal when displayed. */\n        'aria-modal'?: boolean | 'false' | 'true'\n        /** Indicates whether a text box accepts multiple lines of input or only a single line. */\n        'aria-multiline'?: boolean | 'false' | 'true'\n        /** Indicates that the user may select more than one item from the current selectable descendants. */\n        'aria-multiselectable'?: boolean | 'false' | 'true'\n        /** Indicates whether the element's orientation is horizontal, vertical, or unknown/ambiguous. */\n        'aria-orientation'?: 'horizontal' | 'vertical'\n        /**\n         * Identifies an element (or elements) in order to define a visual, functional, or contextual parent/child relationship\n         * between DOM elements where the DOM hierarchy cannot be used to represent the relationship.\n         * @see aria-controls.\n         */\n        'aria-owns'?: string\n        /**\n         * Defines a short hint (a word or short phrase) intended to aid the user with data entry when the control has no value.\n         * A hint could be a sample value or a brief description of the expected format.\n         */\n        'aria-placeholder'?: string\n        /**\n         * Defines an element's number or position in the current set of listitems or treeitems. Not required if all elements in the set are present in the DOM.\n         * @see aria-setsize.\n         */\n        'aria-posinset'?: number\n        /**\n         * Indicates the current \"pressed\" state of toggle buttons.\n         * @see aria-checked @see aria-selected.\n         */\n        'aria-pressed'?: boolean | 'false' | 'mixed' | 'true'\n        /**\n         * Indicates that the element is not editable, but is otherwise operable.\n         * @see aria-disabled.\n         */\n        'aria-readonly'?: boolean | 'false' | 'true'\n        /**\n         * Indicates what notifications the user agent will trigger when the accessibility tree within a live region is modified.\n         * @see aria-atomic.\n         */\n        'aria-relevant'?: 'additions' | 'additions removals' | 'additions text' | 'all' | 'removals' | 'removals additions' | 'removals text' | 'text' | 'text additions' | 'text removals'\n        /** Indicates that user input is required on the element before a form may be submitted. */\n        'aria-required'?: boolean | 'false' | 'true'\n        /** Defines a human-readable, author-localized description for the role of an element. */\n        'aria-roledescription'?: string\n        /**\n         * Defines the total number of rows in a table, grid, or treegrid.\n         * @see aria-rowindex.\n         */\n        'aria-rowcount'?: number\n        /**\n         * Defines an element's row index or position with respect to the total number of rows within a table, grid, or treegrid.\n         * @see aria-rowcount @see aria-rowspan.\n         */\n        'aria-rowindex'?: number\n        /**\n         * Defines the number of rows spanned by a cell or gridcell within a table, grid, or treegrid.\n         * @see aria-rowindex @see aria-colspan.\n         */\n        'aria-rowspan'?: number\n        /**\n         * Indicates the current \"selected\" state of various widgets.\n         * @see aria-checked @see aria-pressed.\n         */\n        'aria-selected'?: boolean | 'false' | 'true'\n        /**\n         * Defines the number of items in the current set of listitems or treeitems. Not required if all elements in the set are present in the DOM.\n         * @see aria-posinset.\n         */\n        'aria-setsize'?: number\n        /** Indicates if items in a table or grid are sorted in ascending or descending order. */\n        'aria-sort'?: 'none' | 'ascending' | 'descending' | 'other'\n        /** Defines the maximum allowed value for a range widget. */\n        'aria-valuemax'?: number\n        /** Defines the minimum allowed value for a range widget. */\n        'aria-valuemin'?: number\n        /**\n         * Defines the current value for a range widget.\n         * @see aria-valuetext.\n         */\n        'aria-valuenow'?: number\n        /** Defines the human readable text alternative of aria-valuenow for a range widget. */\n        'aria-valuetext'?: string\n    }\n\n    // All the WAI-ARIA 1.1 role attribute values from https://www.w3.org/TR/wai-aria-1.1/#role_definitions\n    type AriaRole =\n        | 'alert'\n        | 'alertdialog'\n        | 'application'\n        | 'article'\n        | 'banner'\n        | 'button'\n        | 'cell'\n        | 'checkbox'\n        | 'columnheader'\n        | 'combobox'\n        | 'complementary'\n        | 'contentinfo'\n        | 'definition'\n        | 'dialog'\n        | 'directory'\n        | 'document'\n        | 'feed'\n        | 'figure'\n        | 'form'\n        | 'grid'\n        | 'gridcell'\n        | 'group'\n        | 'heading'\n        | 'img'\n        | 'link'\n        | 'list'\n        | 'listbox'\n        | 'listitem'\n        | 'log'\n        | 'main'\n        | 'marquee'\n        | 'math'\n        | 'menu'\n        | 'menubar'\n        | 'menuitem'\n        | 'menuitemcheckbox'\n        | 'menuitemradio'\n        | 'navigation'\n        | 'none'\n        | 'note'\n        | 'option'\n        | 'presentation'\n        | 'progressbar'\n        | 'radio'\n        | 'radiogroup'\n        | 'region'\n        | 'row'\n        | 'rowgroup'\n        | 'rowheader'\n        | 'scrollbar'\n        | 'search'\n        | 'searchbox'\n        | 'separator'\n        | 'slider'\n        | 'spinbutton'\n        | 'status'\n        | 'switch'\n        | 'tab'\n        | 'table'\n        | 'tablist'\n        | 'tabpanel'\n        | 'term'\n        | 'textbox'\n        | 'timer'\n        | 'toolbar'\n        | 'tooltip'\n        | 'tree'\n        | 'treegrid'\n        | 'treeitem'\n        | (string & {})\n\n    type HTMLAttributeReferrerPolicy =\n        | \"\"\n        | \"no-referrer\"\n        | \"no-referrer-when-downgrade\"\n        | \"origin\"\n        | \"origin-when-cross-origin\"\n        | \"same-origin\"\n        | \"strict-origin\"\n        | \"strict-origin-when-cross-origin\"\n        | \"unsafe-url\"\n\n    // 4.9 Element\n    interface ElementProps extends ToadProps {\n        id?: string\n        class?: string\n        // classList\n        slot?: string\n\n        // dataset\n    }\n\n    // 3.2.2 Elements in the DOM\n    export interface HTMLElementProps extends ElementProps, AriaAttributes {\n        // metadata attributes\n        title?: string\n        lang?: string\n        translate?: boolean\n        dir?: string\n\n        // user interaction\n        hidden?: boolean\n        accessKey?: string\n        accessKeyLabel?: string\n        draggable?: boolean\n        spellcheck?: boolean\n        autocapitalize?: string\n\n        // FIXME: 3.2.6 Global Attributes missing\n        autofocus?: boolean\n        contentEditable?: boolean | \"inherit\"\n        enterkeyhint?: \"enter\" | \"done\" | \"go\" | \"next\" | \"previous\" | \"search\" | \"send\"\n        /**\n        * Hints at the type of data that might be entered by the user while editing the element or its contents\n        * @see https://html.spec.whatwg.org/multipage/interaction.html#input-modalities:-the-inputmode-attribute\n        */\n        inputMode?: \"none\" | \"text\" | \"tel\" | \"url\" | \"email\" | \"numeric\" | \"decimal\" | \"search\"\n        is?: string\n        itemID?: string\n        itemRef?: string\n        itemScope?: string\n        itemtype?: string\n        // nonce\n        style?: CSSProperties\n        tabIndex?: number\n\n        // WAI-ARIA\n        role?: AriaRole\n\n        // RDFa Attributes\n        about?: string\n        datatype?: string\n        inlist?: any\n        prefix?: string\n        property?: string\n        resource?: string\n        typeof?: string\n        vocab?: string\n    }\n\n    interface HTMLBaseElementProps extends HTMLElementProps {\n        href?: string\n        target?: string\n    }\n\n    interface HTMLLinkElementProps extends HTMLElementProps {\n        href?: string\n        crossOrigin?: string\n        rel?: string\n        as?: string\n        // relList\n        media?: string\n        integrity?: string\n        hreflang?: string\n        type?: string\n        // sizes\n        imageSrcset?: string\n        imageSizes?: string\n        referrerPolicy?: HTMLAttributeReferrerPolicy\n        disabled?: boolean\n    }\n\n    interface HTMLMetaElementProps extends HTMLElementProps {\n        name?: string\n        // http-equiv\n        httpEquiv?: \"content-languagle\" | \"content-type\" | \"default-style\" | \"refresh\" | \"set-cookie\" | \"x-ua-compatible\" | \"content-security-policy\"\n        content?: string\n        charset?: string // not part of the DOM?\n    }\n\n    interface HTMLStyleElementProps extends HTMLElementProps {\n        media?: string\n        // sheet from the LinkStyle interface?\n    }\n\n    interface HTMLOListElementProps extends HTMLElementProps {\n        reversed?: boolean\n        start?: number\n        type?: \"1\" | \"a\" | \"A\" | \"i\" | \"I\"\n    }\n\n    interface HTMLLIElementProps extends HTMLElementProps {\n        value?: number\n    }\n\n    interface HTMLAnchorElementProps extends HTMLElementProps {\n        target?: string\n        download?: string // any?\n        ping?: string\n        rel?: string\n        hrefLang?: string\n        type?: string\n        text?: string\n        referrerPolicy?: HTMLAttributeReferrerPolicy\n    }\n\n    interface HTMLQuoteElementProps extends HTMLElementProps {\n        quote?: string\n    }\n\n    interface HTMLDataElementProps extends HTMLElementProps {\n        value?: string\n    }\n\n    interface HTMLTimeElementProps extends HTMLElementProps {\n        dateTime?: string\n    }\n\n    interface HTMLModElementProps extends HTMLElementProps {\n        cite?: string\n        dateTime?: string\n    }\n\n    interface HTMLSourceElementProps extends HTMLElementProps {\n        src?: string\n        type?: string\n        srcset?: string\n        sizes?: string\n        media?: string\n        width?: number\n        height?: number\n    }\n\n    interface HTMLImageElementProps extends HTMLElementProps {\n        alt?: string\n        src?: string\n        secset?: string\n        sizes?: string\n        crossOrigin?: \"anonymous\" | \"use-credentials\" | \"\"\n        useMap?: string\n        isMap?: boolean\n        width?: number\n        height?: number\n        // naturalWidth?: number\n        // naturalHeight?: number\n        // complete?: boolean\n        // currentSrc?: string\n        referrerPolicy?: HTMLAttributeReferrerPolicy\n        decoding?: \"async\" | \"auto\" | \"sync\"\n        loading?: \"lazy\" | \"eager\"\n    }\n\n    interface HTMLIFrameElementProps extends HTMLElementProps {\n        src?: string\n        srcdoc?: string\n        name?: string\n        // sandbox\n        allow?: string\n        allowFullscreen?: boolean\n        width?: string\n        height?: string\n        referrerPolicy?: HTMLAttributeReferrerPolicy\n        loading?: string\n    }\n\n    interface HTMLEmbedElementProps extends HTMLElementProps {\n        src?: string\n        type?: string\n        width?: string\n        height?: string\n    }\n\n    interface HTMLObjectElementProps extends HTMLElementProps {\n        data?: string\n        type?: string\n        name?: string\n        // form\n        width?: string\n        height?: string\n    }\n\n    interface HTMLParamElementProps extends HTMLElementProps {\n        name?: string\n        value?: string\n    }\n\n    interface HTMLMediaElementProps extends HTMLElementProps {\n        src?: string\n        // srcObject\n        crossOrigin?: string\n        preload?: string\n        currentTime?: number\n        autoplay?: boolean\n        loop?: boolean\n        volume?: number\n        muted?: boolean\n    }\n\n    interface HTMLVideoElementProps extends HTMLMediaElementProps {\n        width?: number\n        height?: number\n        poster?: string\n        playsInline?: boolean\n    }\n\n    interface HTMLTrackElementProps extends HTMLElementProps {\n        kind?: string\n        src?: string\n        srclang?: string\n        label?: string\n        default?: boolean\n    }\n\n    interface HTMLMapElementProps extends HTMLElementProps {\n        name?: string\n    }\n\n    interface HTMLAreaElementProps extends HTMLElementProps {\n        alt?: string\n        coords?: string\n        shape?: string\n        target?: string\n        download?: string\n        ping?: string\n        rel?: string\n        referrerPolicy?: HTMLAttributeReferrerPolicy\n    }\n\n    interface HTMLTableColElementProps extends HTMLElementProps {\n        span?: number\n    }\n\n    interface HTMLTableCellElementProps extends HTMLElementProps {\n        colSpan?: number\n        rowSpan?: number\n        headers?: string\n        scope?: string\n        abbr?: string\n    }\n\n    interface HTMLFormElementProps extends HTMLElementProps {\n        acceptCharset?: string\n        action?: string\n        autocomplete?: string\n        enctype?: string\n        encoding?: string\n        method?: string\n        name?: string\n        noValidate?: boolean\n        target?: string\n        rel?: string\n    }\n\n    interface HTMLLabelElementProps extends HTMLElementProps {\n        htmlFor?: string\n    }\n\n    interface HTMLInputElementProps extends HTMLElementProps {\n        accept?: string\n        alt?: string\n        autocomplete?: string\n        defaultChecked?: boolean\n        checked?: boolean\n        dirName?: string\n        disabled?: boolean// files\n        formAction?: string\n        formEnctype?: string\n        formMethod?: string\n        formTarget?: string\n        height?: number\n        indeterminate?: boolean\n        max?: string\n        maxLength?: string\n        min?: string\n        minLength?: string\n        multiple?: boolean\n        name?: string\n        pattern?: string\n        placeholder?: string\n        readOnly?: boolean\n        required?: boolean\n        size?: number\n        src?: string\n        step?: string\n        type?: \"button\" | \"checkbox\" | \"image\" | \"radio\" | \"color\" | \"date\" | \"datetime\" | \"datetime-local\" | \"email\" | \"file\"\n        | \"hidden\" | \"month\" | \"number\" | \"password\" | \"range\" | \"research\" | \"search\" | \"submit\" | \"tel\" | \"text\" | \"url\" | \"week\"\n        defaultValue?: string\n        value?: string\n        // valueAsDate\n        // valueAsNumber\n        width?: number\n        // stepUp\n        // stepDown\n        // selectionStart\n        // selectionEnd\n        // selectionDirection\n    }\n\n    interface HTMLOptGroupElementProps extends HTMLElementProps {\n        disabled?: boolean\n        label?: string\n    }\n\n    interface HTMLOptionElementProps extends HTMLElementProps {\n        disabled?: boolean\n        label?: string\n        defaultSelected?: boolean\n        selected?: boolean\n        value?: string\n        text?: string\n    }\n\n    interface HTMLTextAreaElementProps extends HTMLElementProps {\n        autocomplete?: string\n        cols?: number\n        dirName?: string\n        disabled?: boolean\n        maxLength?: number\n        minLength?: number\n        name?: string\n        placeholder?: string\n        readonly?: boolean\n        required?: boolean\n        rows?: number\n        wrap?: string\n        defaultValue?: string\n        value?: string\n        selectionStart?: number\n        selectionEnd?: number\n        selectionDirection?: string\n    }\n\n    interface HTMLOutputElementProps extends HTMLElementProps {\n        name?: string\n        defaultValue?: string\n        value?: string\n        willValidate?: boolean\n        // validity\n        validationMessage?: string\n    }\n\n    interface HTMLProgressElementProps extends HTMLElementProps {\n        value?: number\n        max?: number\n    }\n\n    interface HTMLMeterElementProps extends HTMLElementProps {\n        value?: number\n        min?: number\n        max?: number\n        low?: number\n        high?: number\n        optimum?: number\n    }\n\n    interface HTMLFieldSetElementProps extends HTMLElementProps {\n        disabled?: number\n        name?: string\n    }\n\n    interface HTMLButtonElementProps extends HTMLElementProps {\n        disabled?: boolean\n        formAction?: string\n        formEnctype?: string\n        formMethod?: string\n        formNoValidate?: boolean\n        formTarget?: string\n        name?: string\n        type?: \"submit\" | \"reset\" | \"button\"\n        value?: string\n    }\n\n    interface HTMLSelectElementProps extends HTMLElementProps {\n        autocomplete?: boolean\n        disabled?: boolean\n        multiple?: boolean\n        name?: string\n        required?: boolean\n        size?: number\n        length?: number\n        selectedIndex?: number\n        value?: string\n    }\n\n    interface HTMLDetailsElementProps extends HTMLElementProps {\n        open?: boolean\n    }\n\n    interface HTMLDialogElementProps extends HTMLElementProps {\n        open?: boolean\n        returnValue?: string\n    }\n\n    interface HTMLScriptElementProps extends HTMLElementProps {\n        src?: string\n        type?: string\n        noModule?: boolean\n        async?: boolean\n        defer?: boolean\n        crossOrigin?: string\n        text?: string\n        integrity?: string\n        referrerPolicy?: HTMLAttributeReferrerPolicy\n    }\n\n    interface HTMLSlotElementProps extends HTMLElementProps {\n        name?: string\n    }\n\n    interface HTMLCanvasElementProps extends HTMLElementProps {\n        width?: string | number\n        height?: string | number\n    }\n\n    // export type Element = Element | Fragment\n\n    export interface IntrinsicElements {\n        // 4.1 The document element\n        html: HTMLElementProps\n\n        // 4.2 Document metadata\n        head: HTMLElementProps\n        title: HTMLElementProps\n        base: HTMLBaseElementProps\n        link: HTMLLinkElementProps\n        meta: HTMLMetaElementProps\n        style: HTMLStyleElementProps\n\n        // 4.3 Sections\n        body: HTMLElementProps\n        article: HTMLElementProps\n        section: HTMLElementProps\n        nav: HTMLElementProps\n        aside: HTMLElementProps\n        h1: HTMLElementProps\n        h2: HTMLElementProps\n        h3: HTMLElementProps\n        h4: HTMLElementProps\n        h5: HTMLElementProps\n        h6: HTMLElementProps\n        hgroup: HTMLElementProps\n        header: HTMLElementProps\n        address: HTMLElementProps\n\n        // 4.4 Grouping content\n        p: HTMLElementProps\n        hr: HTMLElementProps\n        pre: HTMLElementProps\n        blockquote: HTMLQuoteElementProps\n        ol: HTMLOListElementProps\n        ul: HTMLElementProps\n        menu: HTMLElementProps\n        li: HTMLLIElementProps\n        dl: HTMLElementProps\n        dt: HTMLElementProps\n        figure: HTMLElementProps\n        figurecaption: HTMLElementProps\n        main: HTMLElementProps\n        /**\n         * The `div` element has no special meaning at all. It represents its children.\n         * \n         * It can be used with the `class`, `lang`, and `title` attributes to mark up semantics\n         * common to a group of consecutive elements.\n         * \n         * It can also be used in a `dl` element, wrapping groups of `dt` and `dd` elements.\n         * \n         * **NOTE**: Authors are strongly encouraged to view the `div` element as an element of last\n         * resort, for when no other element is suitable. Use of more appropriate elements\n         * instead of the `div` element leads to better accessibility for readers and easier\n         * maintainability for authors.\n         */\n        div: HTMLElementProps\n\n        // 4.5 Text-level semantics\n        a: HTMLAnchorElementProps\n        em: HTMLElementProps\n        strong: HTMLElementProps\n        small: HTMLElementProps\n        s: HTMLElementProps\n        cite: HTMLElementProps\n        q: HTMLQuoteElementProps\n        dfn: HTMLElementProps\n        abbr: HTMLElementProps\n        ruby: HTMLElementProps\n        rt: HTMLElementProps\n        rp: HTMLElementProps\n        data: HTMLDataElementProps\n        time: HTMLTimeElementProps\n        code: HTMLElementProps\n        var: HTMLElementProps\n        samp: HTMLElementProps\n        kbd: HTMLElementProps\n        sub: HTMLElementProps\n        sup: HTMLElementProps\n        i: HTMLElementProps\n        b: HTMLElementProps\n        u: HTMLElementProps\n        mark: HTMLElementProps\n        bdi: HTMLElementProps\n        bdo: HTMLElementProps\n        span: HTMLElementProps\n        br: HTMLElementProps\n        wbr: HTMLElementProps\n\n        // 4.6 Links\n        // doesn't specify own tags\n\n        // 4.7 Edits\n        ins: HTMLModElementProps\n        del: HTMLModElementProps\n\n        // 4.8 Embedded content\n        picture: HTMLElementProps\n        source: HTMLSourceElementProps\n        img: HTMLImageElementProps\n        iframe: HTMLIFrameElementProps\n        embed: HTMLEmbedElementProps\n        object: HTMLObjectElementProps\n        param: HTMLParamElementProps\n        video: HTMLVideoElementProps\n        audio: HTMLMediaElementProps\n        track: HTMLTrackElementProps\n        map: HTMLMapElementProps\n        area: HTMLAreaElementProps\n\n        // 4.9 Tabular data\n        table: HTMLElementProps\n        caption: HTMLElementProps\n        colgroup: HTMLTableColElementProps\n        col: HTMLTableColElementProps\n        tbody: HTMLElementProps\n        thead: HTMLElementProps\n        tfoot: HTMLElementProps\n        tr: HTMLElementProps\n        td: HTMLTableCellElementProps\n        th: HTMLTableCellElementProps\n\n        // 4.10 Forms\n        form: HTMLFormElementProps\n        label: HTMLLabelElementProps\n        input: HTMLInputElementProps\n        button: HTMLButtonElementProps\n        select: HTMLSelectElementProps\n        datalist: HTMLInputElementProps\n        optgroup: HTMLOptGroupElementProps\n        option: HTMLOptionElementProps\n        textarea: HTMLTextAreaElementProps\n        output: HTMLOutputElementProps\n        progress: HTMLProgressElementProps\n        meter: HTMLMeterElementProps\n        fieldset: HTMLFieldSetElementProps\n        legend: HTMLElementProps\n\n        // 4.11 Interactive elements\n        details: HTMLDetailsElementProps\n        summary: HTMLElementProps\n        dialog: HTMLDialogElementProps\n\n        // 4.12 Scripting\n        script: HTMLScriptElementProps\n        noscript: HTMLElementProps\n        template: HTMLElementProps\n        slot: HTMLSlotElementProps\n        canvas: HTMLCanvasElementProps\n\n        strike: HTMLElementProps\n\n        // SVG\n\n        svg: SVGProps\n        line: {\n            // SVG 5.12.2\n            id?: string\n\n            // stroke properties\n            stroke?: string\n            strokeWidth?: string // length percentage\n            strokeLinecap?: \"butt\" | \"round\" | \"square\"\n            strokeLinejoin?: \"miter\" | \"miter-clip\" | \"round\" | \"bevel\" | \"arcs\"\n            strokeMiterlimit?: number\n            // strokeDasharray?:\n            strokeDashoffset?: string // length percentage\n\n            cursor?: string\n            class?: string\n\n\n            // line\n            x1: string | number\n            y1: string | number\n            x2: string | number\n            y2: string | number\n            // pathLength\n        }\n        rect: {\n            x: string | number\n            y: string | number\n            width: string | number\n            height: string | number\n            rx?: string | number\n            ry?: string | number\n            stroke?: string\n            fill?: string\n            cursor?: string\n            class?: string\n        }\n        circle: {\n            cx: string | number\n            cy: string | number\n            r: string | number\n            stroke?: string\n            fill?: string\n            cursor?: string\n            class?: string\n        }\n        text: {\n            x: string | number\n            y: string | number\n            stroke?: string\n            fill?: string\n            cursor?: string\n            class?: string\n        }\n\n        // split these off\n\n        \"toad-button\": ToadButtonProps\n        \"toad-text\": ToadTextProps\n        \"toad-slider\": ToadSliderProps\n        \"toad-table\": ToadTableProps\n        \"toad-treenodecell\": HTMLElementProps\n    }\n}\n\nexport class Reference<T> {\n    object: Object\n    attribute: string\n    constructor(object: Object, attribute: keyof T) {\n        this.object = object\n        this.attribute = attribute.toString()\n    }\n\n    get(): any {\n        return (this.object as any)[this.attribute]\n    }\n    set(value: any) {\n        Object.defineProperty(this.object, this.attribute, { value: value })\n    }\n\n    toString(): string {\n        return `${(this.object as any)[this.attribute]}`\n    }\n    fromString(value: string) {\n        const type = typeof (this.object as any)[this.attribute]\n        let outValue\n        switch(type) {\n            case \"string\":\n                outValue = value\n                break\n            case \"number\":\n                outValue = Number.parseFloat(value)\n                break\n            default:\n                throw Error(`Reference.fromString() isn't yet supported for type ${type}`)\n        }\n        Object.defineProperty(this.object, this.attribute, { value: outValue })\n    }\n}\n\nexport function ref<T>(object: T, attribute: keyof T): Reference<T> {\n    return new Reference<T>(object, attribute)\n}\n\nexport function refs<T>(object: T, ...attributes: (keyof T)[]): Reference<T>[] {\n    return attributes.map(a => new Reference<T>(object, a))\n}\n\nexport class Fragment extends Array<Element> {\n    constructor(props: any) {\n        super(...props?.children)\n    }\n    replaceIn(element: Element | ShadowRoot) {\n        while (element.childNodes.length > 0) {\n            element.removeChild(element.childNodes[element.childNodes.length - 1])\n        }\n        this.appendTo(element)\n    }\n    appendTo(element: Element | ShadowRoot) {\n        for (let child of this) {\n            element.appendChild(child)\n        }\n    }\n}\n\n// https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html\nexport function jsx(nameOrConstructor: string | { new(...args: any[]): any }, props: any, key?: string) {\n    if (props !== undefined && props.children !== undefined) {\n        props.children = [props.children]\n    }\n    return jsxs(nameOrConstructor, props)\n}\n\nexport function jsxs(nameOrConstructor: string | { new(...args: any[]): any }, props: any, key?: string) {\n    let namespace\n\n    if (typeof nameOrConstructor !== 'string') {\n        return new nameOrConstructor(props)\n    }\n\n    const name = nameOrConstructor as string\n\n    switch (name) {\n        case 'svg':\n        case 'line':\n        case 'rect':\n        case 'text':\n            namespace = \"http://www.w3.org/2000/svg\"\n            break\n        default:\n            namespace = \"http://www.w3.org/1999/xhtml\"\n    }\n    const tag = document.createElementNS(namespace, name) as HTMLElement | SVGSVGElement\n    if (props !== null) {\n        for (let [key, value] of Object.entries(props)) {\n            switch (key) {\n                case 'model':\n                case 'action':\n                    (tag as any).setModel(value)\n                    break\n                case 'class':\n                    tag.classList.add(value as string) // FIXME: value is whitespace separated list\n                    break\n                case 'style':\n                    for (let [skey, svalue] of Object.entries(value as string)) {\n                        const regex = /[A-Z]/g\n                        skey = skey.replace(regex, (upperCase) => \"-\" + upperCase.toLowerCase())\n                        tag.style.setProperty(skey, svalue as string)\n                    }\n                    break\n                case 'set':\n                    Object.defineProperty(props.set!.object, props.set!.attribute, { value: tag })\n                    break\n                default:\n                    if (namespace === \"http://www.w3.org/2000/svg\") {\n                        const regex = /[A-Z]/g\n                        key = key.replace(regex, (upperCase) => \"-\" + upperCase.toLowerCase())\n                    }\n                    tag.setAttributeNS(null, key, value as string)\n            }\n        }\n        if (props.children !== undefined) {\n            for (let child of props.children) {\n                if (typeof child === \"string\") {\n                    tag.appendChild(document.createTextNode(child))\n                } else {\n                    tag.appendChild(child)\n                }\n            }\n        }\n    }\n    return tag\n\n}\n\n// the FunctionConstructor is a hack for <></>\n// actually it would be nice if we could support value objects too, eg. <TableView> instead of <toad-table>\n// export function createElement(name: string, props: JSX.HTMLElementProps, ...children: any): Element\n// export function createElement(name: FunctionConstructor, props: JSX.HTMLElementProps, ...children: any): Fragment\n// export function createElement(name: string | FunctionConstructor, props: JSX.HTMLElementProps, ...children: any): Element | Fragment {\n// }\n// backward compability\nexport function createElement(nameOrConstructor: string | { new(...args: any[]): any }, props: any, ...children: any) {\n    // console.log(`createElement(${nameOrConstructor}, ${JSON.stringify(props)}, ${children}`)\n\n    // props: remove 'key', add 'children'\n    let key\n    if (props !== null) {\n        if ('key' in props) {\n            key = props.key\n            delete props.key\n        }\n        if (children !== undefined) {\n            props.children = children\n        }\n    } else {\n        if (children !== undefined)\n            props = { children }\n    }\n    return jsxs(nameOrConstructor, props, key)\n}\n\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"../model/Model\"\nimport { globalController } from \"../controller/globalController\"\nimport { Controller } from \"../controller/Controller\"\n\n// TODO: do we use this directly or is GenericView it's only subclass?\nexport abstract class View extends HTMLElement {\n  controller?: Controller\n\n  abstract setModel(model?: Model): void\n\n  getModelId(): string {\n    if (!this.hasAttribute(\"model\"))\n      throw Error(\"no 'model' attribute\")\n    let modelId = this.getAttribute(\"model\") // FIXME: both hasAttribute & getAttribute? really?\n    if (!modelId)\n      throw Error(\"no model id\")\n    return \"M:\" + modelId\n  }\n\n  getActionId(): string {\n    if (!this.hasAttribute(\"action\"))\n      throw Error(\"no 'action' attribute\")\n    let actionId = this.getAttribute(\"action\") // FIXME: both hasAttribute & getAttribute? really?\n    if (!actionId)\n      throw Error(\"no action id\")\n    return \"A:\" + actionId\n  }\n\n  connectedCallback() {\n    if (this.controller)\n      return\n    let modelId = \"\"\n    try {\n      modelId = this.getModelId()\n    } catch (error) {\n    }\n    if (modelId != \"\")\n      globalController.registerView(modelId, this)\n  }\n\n  disconnectedCallback() {\n    if (this.controller)\n      this.controller.unregisterView(this)\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"../model/Model\"\nimport { View } from \"./View\"\n\nexport abstract class GenericView<T extends Model> extends View {\n  model?: T\n\n  constructor() {\n    super()\n  }\n\n  abstract updateModel(): void\n  abstract updateView(): void\n\n  setModel(model?: T): void {\n    if (model === this.model)\n      return\n\n    const view = this\n\n    if (this.model)\n      this.model.modified.remove(view)\n\n    if (model)\n      model.modified.add(() => view.updateView(), view)\n\n    this.model = model\n    this.updateView()\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"../model/Model\"\nimport { View } from \"./View\"\n\n// TODO: GenericTool<T> doesn't use T yet, the is to activate not just the tool for the view with the focus, but all tools with those view's model\nexport abstract class GenericTool<T extends Model> extends View {\n    static allTools = new Set<GenericTool<any>>()\n    static activeTool: GenericTool<any> | undefined\n    static activeView: View | undefined\n\n    abstract canHandle(view: View): boolean\n    abstract activate(): void\n    abstract deactivate(): void\n\n    setModel(model?: Model): void { }\n\n    static focusIn(view: View) {\n        // console.log(`GenericView.focusIn(${view.nodeName})`)\n        const viewParents = new Map<Element, number>()\n        for(let parent = view.parentElement, distance=0; parent !== null; parent = parent.parentElement, ++distance) {\n            viewParents.set(parent, distance)\n        }\n\n        // find view's closest parent that has tool children\n        let closestToolDistance = Number.MAX_SAFE_INTEGER\n        let closestParent: Element | undefined\n        let closestToolList = new Array<GenericTool<any>>()\n        for(const tool of this.allTools.values()) {\n            if (!tool.canHandle(view))\n                continue\n            for(let toolParent = tool.parentElement, depth=0; toolParent !== null; toolParent = toolParent.parentElement, ++depth) {\n                const toolDistance = viewParents.get(toolParent)\n                // console.log(`focusIn: view has a tool parent ${toolParent.nodeName} at ${toolDistance}`)\n                if (toolDistance === undefined)\n                    continue\n                if (closestToolDistance < toolDistance)\n                    continue\n                if (closestToolDistance > toolDistance) {\n                    closestToolList.length = 0\n                }\n                // console.log(`update tool distance to ${toolDistance}`)\n                closestToolDistance = toolDistance\n                closestParent = toolParent\n                closestToolList.push(tool)\n            } \n        }\n        if (!closestParent) {\n            console.log(`GenericView.focusIn(${view.nodeName}): couldn't find a parent with GenericTool children`)\n            return\n        }\n\n        // within that parent find the tool which follows after the view\n        let closestTool: GenericTool<any> | undefined\n        const viewIndex = GenericTool.getIndex(view, closestParent)\n        // console.log(`view has index ${viewIndex}`)\n        let closestNextSiblingIndex = Number.MIN_SAFE_INTEGER\n        for(let tool of closestToolList) {\n            const toolIndex = GenericTool.getIndex(tool, closestParent!)\n            // console.log(`tool ${tool?.nodeName} ${tool?.id} has index ${toolIndex}`)\n            if (toolIndex < viewIndex && toolIndex > closestNextSiblingIndex) {\n                closestNextSiblingIndex = toolIndex\n                closestTool = tool\n            }\n        }\n\n        // console.log(`found closest tool ${closestTool?.nodeName} ${closestTool?.id} out of ${closestToolList.length}`)\n        this.setActive(closestTool, view)\n    }\n\n    static getIndex(view: Element, parent: Element): number {\n        if (parent === undefined) {\n            console.trace(`GenericTool.getIndex(${view}, ${parent})`)\n        }\n\n        let element = view\n        while(element.parentElement !== parent)\n            element = element.parentElement!\n        return Array.from(parent.childNodes).indexOf(element)\n    }\n\n    static setActive(tool?: GenericTool<any>, view?: View) {\n        if (this.activeTool)\n            this.activeTool.deactivate()\n        this.activeTool = tool\n        this.activeView = view\n        // console.log(`setActiveTool`)\n        // console.log(tool)\n        if (tool)\n            tool.activate()\n    }\n\n    static focusOut(view: View) {\n        if (this.activeView === view) {\n            this.setActive(undefined, undefined)\n        }\n    }\n\n    override connectedCallback() {\n        super.connectedCallback()\n        // console.log(\"GenericTool: connected\")\n        GenericTool.allTools.add(this)\n    }\n\n    override disconnectedCallback() {\n        if (GenericTool.activeTool === this) {\n            GenericTool.setActive(undefined, undefined)\n        }\n        GenericTool.allTools.delete(this)\n        super.disconnectedCallback()\n        // console.log(\"GenericTool: disconnected\")\n    }\n}\n\nwindow.addEventListener(\"focusin\", (event: FocusEvent) => {\n    if (event.target instanceof GenericTool)\n        return\n    \n    if (event.relatedTarget instanceof View) {\n        GenericTool.focusOut(event.relatedTarget)\n    }\n    if (event.target instanceof View) {\n        GenericTool.focusIn(event.target)\n    }\n})","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TextModel } from \"../model/TextModel\"\nimport { Model } from \"../model/Model\"\nimport { globalController } from \"../controller/globalController\"\nimport { Action } from \"../model/Action\"\nimport { GenericView } from \"./GenericView\"\n\n// FIXME: ActionView should also be a template instead of having a fixed TextModel\n\nexport abstract class ActionView extends GenericView<TextModel> {\n  action?: Action\n\n  constructor() {\n    super()\n  }\n\n  override connectedCallback() {\n    if (this.controller) {\n      this.updateView()\n      return\n    }\n\n    try {\n      globalController.registerView(this.getActionId(), this) // FIXME: don't register always on globalController\n    }\n    catch (e) {\n    }\n\n    try {\n      globalController.registerView(this.getModelId(), this) // FIXME: don't register always on globalController\n    }\n    catch (e) {\n    }\n\n    this.updateView()\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback()\n    if (this.controller)\n      this.controller.unregisterView(this)\n  }\n\n  override setModel(model?: Model): void {\n    if (!model) {\n      if (this.model)\n        this.model.modified.remove(this)\n      if (this.action)\n        this.action.modified.remove(this)\n      this.model = undefined\n      this.action = undefined\n      this.updateView()\n      return\n    }\n\n    if (model instanceof Action) {\n      // FIXME: what if this.action is already set?\n      this.action = model\n      this.action.modified.add(() => {\n        this.updateView()\n      }, this)\n    }\n    else if (model instanceof TextModel) {\n      // FIXME: what if this.model is already set?\n      this.model = model\n      this.model.modified.add(() => {\n        this.updateView()\n      }, this)\n    } else {\n      throw Error(\"unexpected model of type \" + model.constructor.name)\n    }\n\n    this.updateView()\n  }\n\n  isEnabled(): boolean {\n    return this.action !== undefined && this.action.enabled\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { HtmlModel } from \"../model/HtmlModel\"\nimport { TextModel } from \"../model/TextModel\"\nimport { GenericView } from \"./GenericView\"\n\nexport class SlotView extends GenericView<TextModel> {\n  constructor() { super() }\n  updateModel() { }\n  updateView() {\n    if (!this.model)\n      return\n\n    let value = this.model.value === undefined ? \"\" : this.model.value\n    if (this.model instanceof HtmlModel)\n      this.innerHTML = value\n\n    else\n      this.innerText = value\n  }\n}\nwindow.customElements.define(\"toad-slot\", SlotView)","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { HtmlModel } from \"../model/HtmlModel\"\nimport { ActionView } from \"./ActionView\"\n\nlet buttonStyle = document.createElement(\"style\")\nbuttonStyle.textContent=`\n  button {\n    border: none;\n    background-color: var(--toad-primary-color, #0052cc);\n    color: #ffffff;\n    border-radius: 3px;\n    font-size: 14px;\n    font-weight: bold;\n    height: 32px;\n    line-height: 32px;\n    min-width: 24px;\n    text-shadow: none;\n    padding: 0 10px;\n    margin-right: 4px;\n  }\n  \n  button:hover {\n    background-color: #0065ff;\n  }\n  \n  button:hover:active {\n    background-color: #0049b0;\n  }\n  \n  button:disabled, button:disabled:active {\n    background-color: #888;\n  }\n`\n\nexport class ButtonView extends ActionView {\n  button: HTMLButtonElement\n  _observer?: MutationObserver\n  _timer?: number\n\n  constructor() {\n    super()\n    this.button = document.createElement(\"button\") as HTMLButtonElement\n    this.button.onclick = () => {\n      if (this.action)\n        this.action.trigger()\n    }\n    this.button.disabled = true\n    \n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(buttonStyle, true))\n    this.shadowRoot!.appendChild(this.button)\n  }\n\n  override connectedCallback() {\n    super.connectedCallback()\n    if (this.children.length===0) {\n      // Chrome, Opera invoke connectedCallback() before the children are conected\n      this._observer = new MutationObserver((record: MutationRecord[], observer: MutationObserver) => {\n        if (this._timer !== undefined)\n          clearTimeout(this._timer)\n        this._timer = window.setTimeout( () => {\n          this._timer = undefined\n          this.updateView()\n        }, 100)\n      })\n      this._observer.observe(this, {\n        childList: true,\n        subtree: true,\n        characterData: true\n      })\n    }\n  }\n\n\n  updateModel() {\n  }\n\n  updateView() {\n    if (this.model && this.model.value) { // FIXME: use updateView only for Model stuff\n      if (this.model instanceof HtmlModel)\n        this.button.innerHTML = this.model.value\n      else\n        this.button.innerText = this.model.value\n    } else {\n      this.button.innerHTML = this.innerHTML\n    }\n\n    this.button.disabled = !this.isEnabled()\n    // FIXME: set \"disabled\" property of this\n  }\n}\nwindow.customElements.define(\"toad-button\", ButtonView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { OptionModelBase } from \"../model/OptionModelBase\"\nimport { GenericView } from \"./GenericView\"\n\nlet toolbuttonStyle = document.createElement(\"style\")\ntoolbuttonStyle.textContent=`\ndiv {\n    border: 1px solid #e3dbdb;\n    border-radius: 5px;\n    background: #e3dbdb;\n    width: 32px;\n    height: 32px;\n    padding: 3px;\n}\n\n:host([selected]) div {\n    background: #ac9393;\n}\n\n:host([disabled]) div {\n    opacity: 0.5;\n}\n\n:host([disabled]) div img {\n    opacity: 0.5;\n}\n\n:host([checked][disabled]) div {\n}\n`\n\nexport class ToolButton extends GenericView<OptionModelBase> {\n    constructor() {\n        super()\n        \n        let button = document.createElement(\"div\")\n        // button.setAttribute(\"tabindex\", \"0\")\n        button.onmousedown = (event) => {\n            if (this.hasAttribute(\"disabled\"))\n                return\n            button.focus()\n            event.preventDefault()\n            if (this.model !== undefined)\n                this.model.stringValue = this.getValue()\n        }\n\n        let img = document.createElement(\"img\")\n        if (this.hasAttribute(\"img\")) {\n            img.src = this.getAttribute(\"img\")!\n        }\n        button.appendChild(img)\n\n        this.attachShadow({mode: 'open'})\n        this.shadowRoot!.appendChild(document.importNode(toolbuttonStyle, true))\n        this.shadowRoot!.appendChild(button)\n    }\n\n    getValue(): string {\n        let value = this.getAttribute(\"value\")\n        if (value === null)\n            throw Error(\"no value\")\n        return value\n    }\n\n    override connectedCallback() {\n        super.connectedCallback()\n        if (this.model === undefined)\n            this.setAttribute(\"disabled\", \"\")\n    }\n    \n    updateModel() {\n    }\n    \n    updateView() {\n        if (this.model === undefined) {\n            this.setAttribute(\"disabled\", \"\")\n            this.removeAttribute(\"selected\")\n            return\n        }\n        let value = this.getValue()\n        if (this.model.isValidStringValue(value)) {\n            this.removeAttribute(\"disabled\")\n        } else {\n            this.setAttribute(\"disabled\", \"\")\n        }\n        if (this.model.stringValue === value) {\n            this.setAttribute(\"selected\", \"\")\n        } else {\n            this.removeAttribute(\"selected\")\n        }\n    }\n}\nwindow.customElements.define(\"toad-toolbutton\", ToolButton)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { BooleanModel } from \"../model/BooleanModel\"\nimport { GenericView } from \"./GenericView\"\n\n/* Safari & Chrome can do this and we want this */\n// declare global {\n//   interface SVGElement extends Element {}\n// }\n\n/*\nthe checkbox can be customized like this (color names are not final yet)\n\n      :root {\n        --toad-neutral-color: #000;\n        --toad-dark-color: #000;\n        --toad-light-color: #fff;\n        --toad-primary-color: #000;\n      }\n\n      toad-checkbox {\n        --border-color: #000;\n        --background-color: none;\n        --marker-color: none;\n        --checked-border-color: #000;\n        --checked-background-color: none;\n        --checked-marker-color: #000;\n      }\n*/\n\n\nlet checkboxStyle = document.createElement(\"style\")\ncheckboxStyle.textContent=`\nsvg {\n  width: 12px;\n  height: 12px;\n  vertical-align: middle;\n  margin: 3px;              /* space for the outline */\n  background: none;\n}\nsvg:focus {\n  outline-offset: -2px;     /* bring outline in touch with the svg */\n  background: #9eccfb;      /* the rectangle is rounded, fill the corners */\n  outline-color: 9eccfb;    /* outline shall be the same color used to fill the corners */\n}\n@media(pointer: coarse) { /* works on Chrome but iOS is never coarse :( */\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n}\nsvg rect {\n  stroke: var(--border-color, var(--toad-neutral-color, #aaa));\n  fill: var(--background-color, #fff);\n  stroke-width: 1px;\n}\nsvg path {\n  stroke: var(--marker-color, none);\n  fill: none;\n  stroke-width: 2px;\n}\n:host([checked]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #0052cc));\n  fill: var(--checked-background-color, var(--toad-primary-color, #0052cc));\n}\n:host([checked]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #fff));\n}\n:host([disabled]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #bdbdbd));\n  fill: var(--checked-background-color, var(--toad-primary-color, #fff));\n}\n:host([disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, none));\n}\n:host([checked][disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #bdbdbd));\n}`\n\nexport class CheckboxView extends GenericView<BooleanModel> {\n  constructor() {\n    super()\n    \n    let svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\")\n    svg.setAttributeNS(\"\", \"viewBox\", \"0 0 18 18\")\n\n    let rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n    rect.setAttributeNS(\"\", \"x\", \"1\")\n    rect.setAttributeNS(\"\", \"y\", \"1\")\n    rect.setAttributeNS(\"\", \"width\", \"16\")\n    rect.setAttributeNS(\"\", \"height\", \"16\")\n    rect.setAttributeNS(\"\", \"rx\", \"3\")\n    rect.setAttributeNS(\"\", \"ry\", \"3\")\n    \n    let checkmark = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\")\n    checkmark.setAttributeNS(\"\", \"d\", \"M4 9.5 L 7.5 13 L 14.5 4\")\n\n    svg.onclick = () => {\n      this.toggle()\n    }\n    svg.setAttributeNS(\"\", \"tabindex\", \"0\")\n    svg.addEventListener(\"keydown\", (event: Event) => {\n      if ((event as KeyboardEvent).key === \" \") {\n        this.toggle()\n      }\n    })\n    svg.onmousedown = (event) => {\n      svg.focus()\n      event.preventDefault()\n    }\n    \n    svg.appendChild(rect)\n    svg.appendChild(checkmark)\n    \n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(checkboxStyle, true))\n    this.shadowRoot!.appendChild(svg)\n  }\n\n  override setModel(model?: BooleanModel) {\n    if (model !== undefined && !(model instanceof BooleanModel)) {\n      throw Error(`CheckBoxView.setModel(): model is not of type BooleanModel`)\n    }\n    super.setModel(model)\n  }\n  \n  static get observedAttributes() {return ['checked'] }\n  \n  attributeChangedCallback(name: string, oldValue?: string, newValue?: string) {\n    switch(name) {\n      case \"checked\":\n        this.updateModel()\n        break\n    }\n  }\n  \n  toggle() {\n    if (this.hasAttribute(\"disabled\"))\n      return\n    if (this.hasAttribute(\"checked\"))\n      this.removeAttribute(\"checked\")\n    else\n      this.setAttribute(\"checked\", \"\")\n    this.updateModel()\n  }\n\n  updateModel() {\n    if (this.model) {\n      this.model.value = this.hasAttribute(\"checked\")\n    }\n  }\n\n  updateView() {\n    if (!this.model) {\n      this.setAttribute(\"disabled\", \"\")\n      this.removeAttribute(\"checked\")\n      return\n    }\n    this.removeAttribute(\"disabled\")\n\n    if (this.model.value)\n      this.setAttribute(\"checked\", \"\")\n    else\n      this.removeAttribute(\"checked\")\n  }\n}\nwindow.customElements.define(\"toad-checkbox\", CheckboxView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { NumberModel } from \"../model/NumberModel\"\nimport { GenericView } from \"./GenericView\"\n\nexport class SliderView extends GenericView<NumberModel> {\n  input: HTMLInputElement\n\n  constructor() {\n    super()\n    this.input = document.createElement(\"input\") as HTMLInputElement\n    this.input.type = \"range\"\n    let view = this\n    this.input.oninput = () => { view.updateModel() }\n    this.attachShadow({mode: 'open'})\n        .appendChild(this.input)\n  }\n  \n  updateModel() {\n    if (this.model)\n      this.model.value = Number.parseFloat(this.input.value)\n  }\n\n  updateView() {\n    if (!this.model)\n      return\n    if (this.model.step === undefined && this.model.min !== undefined && this.model.max !== undefined)\n      this.input.step = `${(this.model.max - this.model.min)/100}`\n    else\n      this.input.step = String(this.model.step)\n    this.input.min = String(this.model.min)\n    this.input.max = String(this.model.max)\n    this.input.value = String(this.model.value)\n  }\n}\nwindow.customElements.define(\"toad-slider\", SliderView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TextModel } from \"../model/TextModel\"\nimport { GenericView } from \"./GenericView\"\n\nlet textStyle = document.createElement(\"style\")\ntextStyle.textContent=`\ninput {\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n}\n\n:host(.embedded) input {\n  border: none 0;\n  border-radius: 0;\n  padding: 0;\n  margin: 2px;\n  width: 100%;\n  background: #fff;\n}\n`\n\nexport class TextView extends GenericView<TextModel> {\n  input: HTMLInputElement\n\n  constructor() {\n    super()\n    this.input = document.createElement(\"input\") as HTMLInputElement\n    this.input.oninput = () => { this.updateModel() }\n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(textStyle, true))\n    this.shadowRoot!.appendChild(this.input)\n  }\n  \n  override focus() {\n    this.input.focus()\n  }\n  override blur() {\n    this.input.blur()\n  }\n  \n  static get observedAttributes() { return ['value'] }\n  \n  attributeChangedCallback(name: string, oldValue?: string, newValue?: string) {\n    switch(name) {\n      case \"value\":\n        if (this.model && newValue !== undefined) {\n          this.model.value = newValue\n        }\n        break\n    }\n  }\n  \n  updateModel() {\n    if (this.model) {\n      this.model.value = this.input.value\n    }\n    this.setAttribute(\"value\", this.input.value)\n  }\n\n  updateView() {\n    if (!this.model)\n      return\n    const strValue = `${this.model.value}`\n    if (this.input.value !== strValue) {\n      this.input.value = strValue\n      this.setAttribute(\"value\", this.input.value)\n    }\n    \n  }\n  \n  get value() {\n    return this.input.value\n  }\n  set value(value: string) {\n    this.input.value = value\n    this.updateModel() // FIXME: do we need this?\n  }\n}\nwindow.customElements.define(\"toad-text\", TextView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport let textAreaStyle = document.createElement(\"style\")\ntextAreaStyle.textContent=`\n\n/* try to follow material ui: when active render button labels in black, otherwise in gray */\nsvg .fill {\n  fill: #ccc;\n  stroke: #ccc;\n}\nsvg .stroke {\n  fill: none;\n  stroke: #ccc;\n}\nsvg .strokeFill {\n  fill: #fff;\n  stroke: #ccc;\n}\n\n.toolbar.active svg .fill {\n  fill: #000;\n  stroke: #000;\n}\n.toolbar.active svg .stroke {\n  fill: none;\n  stroke: #000;\n}\n.toolbar.active svg .strokeFill {\n  fill: #fff;\n  stroke: #000;\n}\n\n.toolbar button {\n    background: #fff;\n    color: #000;\n    border: 1px #ccc;\n    border-style: solid solid solid none;\n    padding: 5;\n    margin: 0;\n    vertical-align: middle;\n    height: 22px;\n}\n\n.toolbar button:active:hover {\n  background: linear-gradient(to bottom, #7abcff 0%,#0052cc 100%,#4096ee 100%);\n}\n\n.toolbar button.left {\n    border-style: solid;\n    border-radius: 3px 0 0 3px;\n}\n\n.toolbar button.right {\n    border: 1px #ccc;\n    border-style: solid solid solid none;\n    border-radius: 0 3px 3px 0;\n}\n\n.toolbar button.active {\n    background: linear-gradient(to bottom, #7abcff 0%,#0052cc 100%,#4096ee 100%);\n    border: 1px #0052cc solid;\n    color: #fff;\n}\n\ndiv.textarea {\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n  outline-offset: -2px;\n}\n\ndiv.textarea h1 {\n  font-size: 22px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h2 {\n  font-size: 18px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h3 {\n  font-size: 16px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h4 {\n  font-size: 14px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea div {\n  padding: 2px 0 2px 0;\n}\n`\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"../model/Model\"\nimport { GenericView } from \"./GenericView\"\nimport { textAreaStyle } from \"./textAreaStyle\"\n\n// TODO: we should be able to reduce the amount of code by adding some helper functions\n\nexport class TextTool extends GenericView<Model> {\n    // FIXME: make this a list where all texttools register/unregister via connectedCallback()/disconnectedCallback()\n    // FIXME: disable texttool when it is not above an active textarea in the view hierachy\n    static texttool?: TextTool\n\n    buttonH1: HTMLElement\n    buttonH2: HTMLElement\n    buttonH3: HTMLElement\n    buttonH4: HTMLElement\n    buttonUnorderedList: HTMLElement\n    buttonOrderedList: HTMLElement\n\n    buttonBold: HTMLElement\n    buttonItalic: HTMLElement\n    buttonUnderline: HTMLElement\n    buttonStrikeThrough: HTMLElement\n    buttonSubscript: HTMLElement\n    buttonSuperscript: HTMLElement\n\n    buttonJustifyLeft: HTMLElement\n    buttonJustifyCenter: HTMLElement\n    buttonJustifyRight: HTMLElement\n    //    buttonJustifyFull: HTMLElement\n    constructor() {\n        super()\n\n        TextTool.texttool = this\n\n        let toolbar = <div class=\"toolbar\"/>\n\n        this.buttonH1 = <button class=\"left\">H1</button>\n        this.buttonH1.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h1>\")\n            this.update()\n        }\n        toolbar.appendChild(this.buttonH1)\n\n        this.buttonH2 = <button>H2</button>\n        this.buttonH2.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h2>\")\n            this.update()\n        }\n        toolbar.appendChild(this.buttonH2)\n\n        this.buttonH3 = <button>H3</button>\n        this.buttonH3.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h3>\")\n            this.update()\n        }\n        toolbar.appendChild(this.buttonH3)\n\n        this.buttonH4 = <button class=\"right\">H4</button>\n        this.buttonH4.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h4>\")\n            this.update()\n        }\n        toolbar.appendChild(this.buttonH4)\n\n        toolbar.appendChild(document.createTextNode(\" \"))\n\n        this.buttonBold = <button class=\"left\"><b>B</b></button>\n        this.buttonBold.onclick = () => {\n            document.execCommand(\"bold\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonBold)\n\n        this.buttonItalic = <button><i>I</i></button>\n        this.buttonItalic.onclick = () => {\n            document.execCommand(\"italic\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonItalic)\n\n        this.buttonUnderline = <button><u>U</u></button>\n        this.buttonUnderline.onclick = () => {\n            document.execCommand(\"underline\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonUnderline)\n\n        this.buttonStrikeThrough = <button><strike>S</strike></button>\n        this.buttonStrikeThrough.onclick = () => {\n            document.execCommand(\"strikeThrough\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonStrikeThrough)\n\n        this.buttonSubscript = <button>x₂</button>\n        this.buttonSubscript.onclick = () => {\n            document.execCommand(\"subscript\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonSubscript)\n\n        this.buttonSuperscript = <button class=\"right\">x²</button>\n        this.buttonSuperscript.onclick = () => {\n            document.execCommand(\"superscript\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonSuperscript)\n\n\n        toolbar.appendChild(document.createTextNode(\" \"))\n\n        this.buttonJustifyLeft = <button class=\"left\">\n            <svg viewBox=\"0 0 10 9\" width=\"10\" height=\"9\">\n                <line x1=\"0\" y1=\"0.5\" x2=\"10\" y2=\"0.5\" stroke=\"#000\" />\n                <line x1=\"0\" y1=\"2.5\" x2=\"6\" y2=\"2.5\" stroke=\"#000\" />\n                <line x1=\"0\" y1=\"4.5\" x2=\"10\" y2=\"4.5\" stroke=\"#000\" />\n                <line x1=\"0\" y1=\"6.5\" x2=\"6\" y2=\"6.5\" stroke=\"#000\" />\n                <line x1=\"0\" y1=\"8.5\" x2=\"10\" y2=\"8.5\" stroke=\"#000\" />\n            </svg>\n        </button>\n        this.buttonJustifyLeft.onclick = () => {\n            document.execCommand(\"justifyLeft\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonJustifyLeft)\n\n        this.buttonJustifyCenter = <button>\n            <svg viewBox=\"0 0 10 9\" width=\"10\" height=\"9\">\n                <line x1=\"0\" y1=\"0.5\" x2=\"10\" y2=\"0.5\" stroke=\"#000\" />\n                <line x1=\"2\" y1=\"2.5\" x2=\"8\" y2=\"2.5\" stroke=\"#000\" />\n                <line x1=\"0\" y1=\"4.5\" x2=\"10\" y2=\"4.5\" stroke=\"#000\" />\n                <line x1=\"2\" y1=\"6.5\" x2=\"8\" y2=\"6.5\" stroke=\"#000\" />\n                <line x1=\"0\" y1=\"8.5\" x2=\"10\" y2=\"8.5\" stroke=\"#000\" />\n            </svg>\n        </button>\n        this.buttonJustifyCenter.onclick = () => {\n            document.execCommand(\"justifyCenter\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonJustifyCenter)\n\n        this.buttonJustifyRight = <button class=\"right\">\n            <svg viewBox=\"0 0 10 9\" width=\"10\" height=\"9\">\n                <line x1=\"0\" y1=\"0.5\" x2=\"10\" y2=\"0.5\" stroke=\"#000\" />\n                <line x1=\"4\" y1=\"2.5\" x2=\"10\" y2=\"2.5\" stroke=\"#000\" />\n                <line x1=\"0\" y1=\"4.5\" x2=\"10\" y2=\"4.5\" stroke=\"#000\" />\n                <line x1=\"4\" y1=\"6.5\" x2=\"10\" y2=\"6.5\" stroke=\"#000\" />\n                <line x1=\"0\" y1=\"8.5\" x2=\"10\" y2=\"8.5\" stroke=\"#000\" />\n            </svg>\n        </button>\n        this.buttonJustifyRight.onclick = () => {\n            document.execCommand(\"justifyRight\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonJustifyRight)\n\n        // this.buttonJustifyFull = <button class=\"right\">\n        //     <svg viewBox=\"0 0 10 9\" width=\"10\" height=\"9\">\n        //         <line x1=\"0\" y1=\"0.5\" x2=\"10\" y2=\"0.5\" stroke=\"#000\" />\n        //         <line x1=\"0\" y1=\"2.5\" x2=\"10\" y2=\"2.5\" stroke=\"#000\" />\n        //         <line x1=\"0\" y1=\"4.5\" x2=\"10\" y2=\"4.5\" stroke=\"#000\" />\n        //         <line x1=\"0\" y1=\"6.5\" x2=\"10\" y2=\"6.5\" stroke=\"#000\" />\n        //         <line x1=\"0\" y1=\"8.5\" x2=\"10\" y2=\"8.5\" stroke=\"#000\" />\n        //     </svg>\n        // </button>\n        // this.buttonJustifyFull.onclick = () => {\n        //     document.execCommand(\"justifyFull\", false)\n        //     this.update()\n        // }\n        // toolbar.appendChild(this.buttonJustifyFull)\n        // toolbar.appendChild(document.createTextNode(\" \"))\n\n        this.buttonUnorderedList = <button class=\"left\">\n            <svg style={{display: \"block\"}} viewBox=\"0 0 17 11.5\" width=\"17\" height=\"11.5\">\n                <circle cx=\"4.5\" cy=\"1.5\" r=\"0.8\" stroke=\"#000\" fill=\"#000\" />\n                <line x1=\"7\" y1=\"1.5\" x2=\"17\" y2=\"1.5\" stroke=\"#000\" />\n                <circle cx=\"4.5\" cy=\"5.5\" r=\"0.8\" stroke=\"#000\" fill=\"#000\" />\n                <line x1=\"7\" y1=\"5.5\" x2=\"17\" y2=\"5.5\" stroke=\"#000\" />\n                <circle cx=\"4.5\" cy=\"9.5\" r=\"0.8\" stroke=\"#000\" fill=\"#000\" />\n                <line x1=\"7\" y1=\"9.5\" x2=\"17\" y2=\"9.5\" stroke=\"#000\" />\n            </svg>\n        </button>\n        this.buttonUnorderedList.onclick = (event) => {\n            document.execCommand(\"insertUnorderedList\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonUnorderedList)\n\n        this.buttonOrderedList = <button class=\"right\">\n            <svg style={{ display: \"block\" }} viewBox=\"0 0 17 11.5\" width=\"17\" height=\"11.5\">\n                <line x1=\"4.5\" y1=\"0\" x2=\"4.5\" y2=\"3\" stroke=\"#000\" />\n                <line x1=\"7\" y1=\"1.5\" x2=\"17\" y2=\"1.5\" stroke=\"#000\" />\n                <line x1=\"2.5\" y1=\"4\" x2=\"2.5\" y2=\"7\" stroke=\"#000\" />\n                <line x1=\"4.5\" y1=\"4\" x2=\"4.5\" y2=\"7\" stroke=\"#000\" />\n                <line x1=\"7\" y1=\"5.5\" x2=\"17\" y2=\"5.5\" stroke=\"#000\" />\n                <line x1=\"0.5\" y1=\"8\" x2=\"0.5\" y2=\"11\" stroke=\"#000\" />\n                <line x1=\"2.5\" y1=\"8\" x2=\"2.5\" y2=\"11\" stroke=\"#000\" />\n                <line x1=\"4.5\" y1=\"8\" x2=\"4.5\" y2=\"11\" stroke=\"#000\" />\n                <line x1=\"7\" y1=\"9.5\" x2=\"17\" y2=\"9.5\" stroke=\"#000\" />\n            </svg>\n        </button>\n        this.buttonOrderedList.onclick = () => {\n            document.execCommand(\"insertOrderedList\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonOrderedList)\n\n        this.attachShadow({ mode: 'open' })\n        this.shadowRoot!.appendChild(document.importNode(textAreaStyle, true))\n        this.shadowRoot!.appendChild(toolbar)\n    }\n\n    update() {\n        this.buttonH1.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h1\")\n        this.buttonH2.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h2\")\n        this.buttonH3.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h3\")\n        this.buttonH4.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h4\")\n\n        this.buttonBold.classList.toggle(\"active\", document.queryCommandState(\"bold\"))\n        this.buttonItalic.classList.toggle(\"active\", document.queryCommandState(\"italic\"))\n        this.buttonUnderline.classList.toggle(\"active\", document.queryCommandState(\"underline\"))\n        this.buttonStrikeThrough.classList.toggle(\"active\", document.queryCommandState(\"strikeThrough\"))\n        this.buttonSubscript.classList.toggle(\"active\", document.queryCommandState(\"subscript\"))\n        this.buttonSuperscript.classList.toggle(\"active\", document.queryCommandState(\"superscript\"))\n\n        this.buttonJustifyLeft.classList.toggle(\"active\", document.queryCommandState(\"justifyLeft\"))\n        this.buttonJustifyCenter.classList.toggle(\"active\", document.queryCommandState(\"justifyCenter\"))\n        this.buttonJustifyRight.classList.toggle(\"active\", document.queryCommandState(\"justifyRight\"))\n        // this.buttonJustifyFull.classList.toggle(\"active\", document.queryCommandState(\"justifyFull\"))\n    }\n\n    updateModel() {\n        if (this.model) {\n        }\n    }\n\n    updateView() {\n        if (!this.model) {\n            return\n        }\n    }\n}\nwindow.customElements.define(\"toad-texttool\", TextTool)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { HtmlModel } from \"../model/HtmlModel\"\nimport { TextModel } from \"../model/TextModel\"\nimport { GenericView } from \"./GenericView\"\nimport { TextTool } from \"./TextTool\"\nimport { textAreaStyle } from \"./textAreaStyle\"\n\nexport class TextArea extends GenericView<TextModel> {\n\n    content: HTMLElement\n\n    constructor() {\n        super()\n\n        // FIXME: when model is not HtmlModel but TextModel, use <textarea> instead of <div contenteditable>\n        let content = document.createElement(\"div\")\n        this.content = content\n        content.classList.add(\"textarea\")\n        content.contentEditable = \"true\"\n        \n        content.oninput = (event: Event) => {\n            let firstChild = (event.target as Node).firstChild\n            if (firstChild && firstChild.nodeType === 3) {\n                // if the document starts with text, wrap it into a paragraph\n                document.execCommand(\"formatBlock\", false, `<div>`)\n            }\n            else if (content.innerHTML === \"<br>\") {\n                content.innerHTML = \"\"\n            }\n            this.updateModel()\n        }\n        \n        content.onkeydown = (event: KeyboardEvent) => {\n            if (event.metaKey === true && event.key === \"b\") {\n                event.preventDefault()\n                document.execCommand(\"bold\", false)\n                this.updateTextTool()\n            } else\n            if (event.metaKey === true && event.key === \"i\") {\n                event.preventDefault()\n                document.execCommand(\"italic\", false)\n                this.updateTextTool()\n            } else\n            if (event.metaKey === true && event.key === \"u\") {\n                event.preventDefault()\n                document.execCommand(\"underline\", false)\n                this.updateTextTool()\n            } else\n            if (event.key === \"Tab\") {\n                event.preventDefault()\n            } else\n            if (event.key === \"Enter\" &&\n                event.shiftKey !== true &&\n                document.queryCommandValue(\"formatBlock\") === \"blockquote\" )\n            {\n                document.execCommand(\"formatBlock\", false, \"<p>\")\n            }\n/*\n            else if (event.key === \"Enter\" &&\n                event.shiftKey === true )\n            {\n                event.preventDefault()\n            \n                // entering <br> with execCommand will also insert a paragraph, hence the following.\n                // beware! it is not perfect when inserting <br> at the end of the document.\n                // sometimes is works, sometimes it doesn't\n                let docFragment = document.createDocumentFragment()\n\n                let lineBreak = document.createElement(\"br\")\n                docFragment.appendChild(lineBreak)\n                let lineCR = document.createTextNode(\"\\n\")\n                docFragment.appendChild(lineCR)\n\n                // replace selection with <br>\\n\n                let range = window.getSelection().getRangeAt(0)\n                range.deleteContents()\n                range.insertNode(docFragment)\n\n                // create a new range\n                range = document.createRange()\n                range.setStartAfter(lineCR);\n                range.collapse(true)\n\n                // move cursor\n                let selection = window.getSelection()\n                selection.removeAllRanges()\n                selection.addRange(range)\n\n                this.updateTextTool()\n            }\n*/\n        }\n        \n        content.onkeyup = () => {\n            this.updateTextTool()\n        }\n        content.onmouseup = () => {\n            this.updateTextTool()\n        }\n\n        this.attachShadow({mode: 'open'})\n        this.shadowRoot!.appendChild(document.importNode(textAreaStyle, true))\n        this.shadowRoot!.appendChild(content)\n    }\n    \n    updateTextTool() {\n        if (TextTool.texttool !== undefined)\n            TextTool.texttool.update()\n    }\n    \n    updateModel() {\n        if (this.model) {\n            // textarea with it's markup may be expensive, hence we let the model fetch it's data on demand\n            this.model.promise = () => {\n                return this.content.innerHTML\n            }\n        }\n    }\n    \n    updateView() {\n        if (!this.model) {\n            return\n        }\n        if (this.model instanceof HtmlModel) {\n            // because of TextModel.promise we check here instead inside the model\n            // if we don't check at all, the cursor ends up in the wrong location\n            // after each change\n            if (this.content.innerHTML !== this.model.value) {\n                this.content.innerHTML = this.model.value\n            }\n        } else {\n            // FIXME: no tested\n            if (this.content.innerText !== this.model.value) {\n                this.content.innerText = this.model.value\n            }\n        }\n    }\n}\nwindow.customElements.define(\"toad-textarea\", TextArea)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { BooleanModel } from \"../model/BooleanModel\"\nimport { GenericView } from \"./GenericView\"\n\n// <toad-if> requires correct HTML otherwise <toad-if> and it's content might\n// be separated by stuff like an </p> inserted automatically by the browser\n// so one should use stuff like htmltidy or htmlhint\nexport class ToadIf extends GenericView<BooleanModel> {\n  updateModel() {\n  }\n\n  updateView() {\n    if (this.model) {\n      this.style.display = this.model.value ? \"\" : \"none\"\n    }\n  }\n}\ncustomElements.define('toad-if', ToadIf)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport const menuStyle = document.createElement(\"style\")\nmenuStyle.textContent=`\n  :host(.menu-button) {\n    font-family: var(--toad-font-family, sans-serif);\n    font-size: 14px;\n    font-weight: bold;\n    padding: 7px;\n    vertical-align: center;\n  \n    background: #fff;\n    color: #000;\n    cursor: default;\n  }\n  :host(.menu-button.active) {\n    background: #000;\n    color: #fff;\n  }\n  :host(.menu-button.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.active.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.menu-down) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-down) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.menu-side) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-side) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  .menu-bar {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .menu-popup {\n    position: fixed;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 2px 2px 5px #888;\n  }\n`\n\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport enum MenuState {\n  WAIT,\n  DOWN,\n  UP_N_HOLD,\n  DOWN_N_HOLD,\n  DOWN_N_OUTSIDE,\n  DOWN_N_INSIDE_AGAIN\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { MenuButton } from \"./MenuButton\"\nimport { MenuState } from \"./MenuState\"\n\nexport class MenuButtonContainer extends HTMLElement {\n  vertical: boolean\n  closeOnClose: boolean\n  active?: MenuButton\n  state: MenuState\n  btnmaster?: MenuButton\n  parentButton?: MenuButton\n\n  constructor() {\n    super()\n    this.vertical = true\n    this.closeOnClose = false\n    this.state = MenuState.WAIT\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { MenuButton } from \"./MenuButton\"\nimport { MenuNode } from \"./MenuNode\"\nimport { MenuButtonContainer } from \"./MenuButtonContainer\"\n\nexport class PopupMenu extends MenuButtonContainer {\n  root: MenuNode\n  // vertical: boolean\n  // parentButton: MenuButton\n  popup: HTMLElement\n\n  constructor(root: MenuNode, parent: MenuButton) {\n    super()\n    this.vertical = true\n    this.root = root\n    this.parentButton = parent\n\n    this.popup = document.createElement(\"div\")\n    this.popup.classList.add(\"menu-popup\")\n\n    let node = root.down\n    while (node) {\n      if (node.isAvailable()) {\n        node.createWindowAt(this, this.popup)\n      } else {\n        node.deleteWindow()\n      }\n      node = node.next\n    }\n    this.appendChild(this.popup)\n    this.show()\n  }\n\n\n  show() {\n    if (!this.parentButton!.master!.vertical)\n      placePopupVertical(this.parentButton!, this.popup)\n\n    else\n      placePopupHorizontal(this.parentButton!, this.popup)\n    this.style.display = \"\"\n  }\n\n  hide() {\n    this.style.display = \"none\"\n  }\n}\n\nwindow.customElements.define(\"toad-popupmenu\", PopupMenu)\n\nexport function placePopupVertical(parent: HTMLElement, popup: HTMLElement): void {\n  let parentBoundary = parent.getBoundingClientRect()\n\n  // FIXME: need to handle scrollLeft, scrollTop?\n\n  popup.style.opacity = \"0\"\n  popup.style.left = parentBoundary.left+\"px\"\n  popup.style.top = (parentBoundary.top+parentBoundary.height)+\"px\"\n\n  setTimeout(function() {\n    // FIXME: there might still not be enough space, might want to scroll and/or overlap parent\n    let popupBoundary = popup.getBoundingClientRect()\n    let popupBottom = parentBoundary.top + parentBoundary.height + popupBoundary.height\n    if (popupBottom > window.innerHeight) {\n      popup.style.top = (parentBoundary.top - popupBoundary.height)+\"px\"\n    }\n    let popupRight = parentBoundary.left + popupBoundary.width\n    if (popupRight > window.innerWidth) {\n       popup.style.left = (parentBoundary.left + parentBoundary.width - popupBoundary.width)+\"px\"\n    }\n    popup.style.opacity = \"1\"\n  }, 0)\n\n//  window.addEventListener(\"mouseup\", new PopupListener(popup), true)\n}\n\nexport function placePopupHorizontal(parent: HTMLElement, popup: HTMLElement): void {\n  let parentBoundary = parent.getBoundingClientRect()\n\n  // FIXME: need to handle scrollLeft, scrollTop?\n\n  popup.style.opacity = \"0\"\n  popup.style.left = (parentBoundary.left+parentBoundary.width)+\"px\"\n  popup.style.top = parentBoundary.top+\"px\"\n\n  setTimeout(function() {\n    // FIXME: there might still not be enough space, might want to scroll and/or overlap parent\n    let popupBoundary = popup.getBoundingClientRect()\n    let popupBottom = parentBoundary.top + popupBoundary.height\n    if (popupBottom > window.innerHeight) {\n      popup.style.top = (parentBoundary.top + parentBoundary.height - popupBoundary.height)+\"px\"\n    }\n    let popupRight = parentBoundary.left + parentBoundary.width + popupBoundary.width\n    if (popupRight > window.innerWidth) {\n       popup.style.left = (parentBoundary.left - popupBoundary.width)+\"px\"\n    }\n    popup.style.opacity = \"1\"\n  }, 0)\n\n//  window.addEventListener(\"mouseup\", new PopupListener(popup), true)\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Action } from \"../model/Action\"\nimport { HtmlModel } from \"../model/HtmlModel\"\nimport { TextModel } from \"../model/TextModel\"\nimport { Model } from \"../model/Model\"\nimport { GenericView } from \"../view/GenericView\"\nimport { globalController } from \"../controller/globalController\"\nimport { menuStyle } from \"./menuStyle\"\nimport { MenuState } from \"./MenuState\"\nimport { MenuNode } from \"./MenuNode\"\nimport { MenuButtonContainer } from \"./MenuButtonContainer\"\nimport { PopupMenu } from \"./PopupMenu\"\n\nexport class MenuButton extends GenericView<TextModel> {\n  static inside?: MenuButton\n  static buttonDown: boolean\n  static documentMouseDown?: (event: MouseEvent) => void\n\n  node: MenuNode\n  master?: MenuButtonContainer // FIXME: rename into container\n  popup?: PopupMenu\n\n  action?: Action\n\n  constructor(master: MenuButtonContainer, node: MenuNode) {\n    super()\n    this.master = master\n    this.node = node\n    let menuButton = this\n    this.classList.add(\"menu-button\")\n    if (node.down) {\n      if (master.vertical)\n        this.classList.add(\"menu-side\")\n\n      else\n        this.classList.add(\"menu-down\")\n    }\n    this.updateView()\n\n    this.onmousedown = (event: MouseEvent) => {\n      event.stopPropagation()\n\n      //if (this.node) console.log(\"mousedown \", this.node.title)\n      let documentMouseUp = function (event: MouseEvent) {\n        document.removeEventListener(\"mouseup\", documentMouseUp, { capture: true })\n        event.preventDefault()\n        setTimeout(() => {\n          if (MenuButton.buttonDown)\n            menuButton.dispatchEvent(new MouseEvent(\"mouseup\", event))\n        }, 0)\n      }\n      document.addEventListener(\"mouseup\", documentMouseUp, { capture: true })\n      MenuButton.buttonDown = true\n\n      if (!this.master)\n        throw Error(\"fuck\")\n      switch (this.master.state) {\n        case MenuState.WAIT:\n          this.master.state = MenuState.DOWN\n          this.activate()\n          break\n        case MenuState.UP_N_HOLD:\n          if (this.master.active !== this) {\n            this.master.state = MenuState.DOWN\n            this.activate()\n          } else {\n            this.master.state = MenuState.DOWN_N_HOLD\n          }\n          break\n        default:\n          throw Error(\"unexpected state \" + this.master.state)\n      }\n      return false\n    }\n\n    this.onmouseup = (event: MouseEvent) => {\n      event.stopPropagation()\n      if (!MenuButton.buttonDown)\n        return\n      MenuButton.buttonDown = false\n\n      //if (this.node) console.log(\"mouseup \", this.node.title)\n      if (!this.master)\n        throw Error(\"fuck\")\n      if (!this.node)\n        throw Error(\"fuck\")\n      switch (this.master.state) {\n        case MenuState.DOWN:\n          if (this.node.isEnabled() && !this.node.down) {\n            this.trigger()\n            this.master.state = MenuState.WAIT\n          } else {\n            this.master.state = MenuState.UP_N_HOLD\n\n            if (MenuButton.documentMouseDown) {\n              document.removeEventListener(\"mousedown\", MenuButton.documentMouseDown, { capture: false })\n            }\n            MenuButton.documentMouseDown = function (event: MouseEvent) {\n              if (MenuButton.documentMouseDown)\n                document.removeEventListener(\"mousedown\", MenuButton.documentMouseDown, { capture: false })\n              MenuButton.documentMouseDown = undefined\n              let tagName = (event.target as HTMLElement).tagName\n              if (tagName !== \"TOAD-MENUBUTTON\") {\n                menuButton.collapse()\n              }\n            }\n            document.addEventListener(\"mousedown\", MenuButton.documentMouseDown, { capture: false })\n          }\n          break\n        case MenuState.DOWN_N_HOLD:\n        case MenuState.DOWN_N_OUTSIDE:\n          this.master.state = MenuState.WAIT\n          this.deactivate()\n          this.collapse()\n          // this.dropKeyboard()\n          if (this.master.closeOnClose) {\n            // this.master.destroyWindow()\n          }\n          break\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          // this.dropKeyboard()\n          this.trigger()\n          break\n        default:\n          throw Error(\"unexpected state \" + this.master.state)\n      }\n      return false\n    }\n\n    // leave\n    this.onmouseout = (event: MouseEvent) => {\n      event.stopPropagation()\n      //console.log(\"mouseout \", this.node.title)\n      if (!this.master)\n        throw Error(\"fuck\")\n      MenuButton.inside = undefined\n      switch (this.master.state) {\n        case MenuState.WAIT:\n        case MenuState.DOWN_N_OUTSIDE:\n        case MenuState.UP_N_HOLD:\n        case MenuState.DOWN_N_HOLD:\n          break\n        case MenuState.DOWN:\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          this.master.state = MenuState.DOWN_N_OUTSIDE\n          this.updateView()\n          break\n        default:\n          throw Error(\"unexpected state\")\n      }\n      return false\n    }\n\n    this.onmouseover = (event: MouseEvent) => {\n      event.stopPropagation()\n      //console.log(\"mouseover \", this.node.title)\n      if (!menuButton.master)\n        throw Error(\"fuck\")\n      MenuButton.inside = menuButton\n      switch (menuButton.master.state) {\n        case MenuState.WAIT:\n        case MenuState.UP_N_HOLD:\n        case MenuState.DOWN_N_OUTSIDE:\n        case MenuState.DOWN_N_HOLD:\n        case MenuState.DOWN:\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          if (!MenuButton.buttonDown)\n            break\n          if (!this.master)\n            throw Error(\"fuck\")\n          if (this.master.active)\n            this.master.active.deactivate()\n          this.master.state = MenuState.DOWN_N_INSIDE_AGAIN\n          this.activate()\n          break\n        default:\n          throw Error(\"unexpected state \" + menuButton.master.state)\n      }\n      return false\n    }\n\n    this.attachShadow({ mode: 'open' })\n    if (!this.shadowRoot)\n      throw Error(\"fuck\")\n    this.shadowRoot.appendChild(document.importNode(menuStyle, true))\n    if (!this.node.modelId)\n      this.shadowRoot.appendChild(document.createTextNode(node.label))\n  }\n\n  override connectedCallback() {\n    if (this.controller)\n      return\n\n    if (this.node.down === undefined) {\n      let actionId = this.node.title\n      for (let node = this.node.parent; node; node = node.parent) {\n        if (!node.title.length)\n          break\n        actionId = node.title + \"|\" + actionId\n      }\n      actionId = \"A:\" + actionId\n      //console.log(\"*** register view action \"+actionId, this.node)\n      globalController.registerView(actionId, this)\n    }\n\n    if (this.node.modelId !== undefined) {\n      let modelId = \"M:\" + this.node.modelId\n      globalController.registerView(modelId, this)\n    }\n\n  }\n\n  override disconnectedCallback() {\n    if (this.controller)\n      this.controller.unregisterView(this)\n  }\n\n  override setModel(model?: Model): void {\n    if (!model) {\n      if (this.action)\n        this.action.modified.remove(this)\n      this.model = undefined\n      this.action = undefined\n      this.updateView()\n      return\n    }\n\n    if (model instanceof Action) {\n      this.action = model\n      this.action.modified.add(() => {\n        this.updateView()\n      }, this)\n    }\n    else if (model instanceof TextModel) {\n      this.model = model\n    } else {\n      throw Error(\"unexpected model of type \" + model.constructor.name)\n    }\n    this.updateView()\n  }\n\n  updateModel() {\n    //console.log(\"MenuButton.updateModel \"+this.node.title)\n  }\n\n  updateView(): void {\n    if (this.model && this.model.value) { // FIXME: use updateView only for Model stuff\n      if (!this.shadowRoot)\n        throw Error(\"fuck\")\n      //      console.log(\"update view with model\")\n      let span = document.createElement(\"span\")\n      if (this.model instanceof HtmlModel)\n        span.innerHTML = this.model.value\n\n      else\n        span.innerText = this.model.value\n\n      // FIXME: dom.replaceChild(this.shadowRoot, 1, span)\n      if (this.shadowRoot.children.length > 1)\n        this.shadowRoot.removeChild(this.shadowRoot.children[1])\n      if (this.shadowRoot.children.length > 1)\n        this.shadowRoot.insertBefore(span, this.shadowRoot.children[1])\n\n      else\n        this.shadowRoot.appendChild(span)\n    }\n\n    if (!this.master)\n      throw Error(\"fuck\")\n\n    let active = false\n    if (this.master.active == this) {\n      switch (this.master.state) {\n        case MenuState.DOWN:\n        case MenuState.UP_N_HOLD:\n        case MenuState.DOWN_N_HOLD:\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          active = true\n          break\n        case MenuState.DOWN_N_OUTSIDE:\n          if (!this.node)\n            throw Error(\"fuck\")\n          active = this.node.down !== undefined && this.node.isEnabled()\n          break\n      }\n    }\n\n    this.classList.toggle(\"active\", active)\n\n    this.classList.toggle(\"disabled\", !this.isEnabled())\n  }\n\n  isEnabled(): boolean {\n    if (this.node.down !== undefined)\n      return true\n    return this.action !== undefined && this.action.enabled\n  }\n\n  trigger(): void {\n    this.collapse()\n    if (!this.action)\n      return\n    this.action.trigger()\n  }\n\n  collapse(): void {\n    if (!this.master)\n      throw Error(\"fuck\")\n    if (this.master.parentButton)\n      this.master.parentButton.collapse()\n\n    else\n      this.deactivate()\n  }\n\n  openPopup(): void {\n    if (!this.node)\n      return\n    if (!this.node.down)\n      return\n\n    if (!this.shadowRoot)\n      throw Error(\"fuck\")\n\n    if (!this.popup) {\n      this.popup = new PopupMenu(this.node, this)\n      this.shadowRoot.appendChild(this.popup)\n    } else {\n      this.popup.show()\n    }\n  }\n\n  closePopup(): void {\n    if (!this.popup)\n      return\n    if (this.popup.active)\n      this.popup.active.deactivate()\n    this.popup.hide()\n  }\n\n  activate(): void {\n    if (!this.master)\n      throw Error(\"fuck\")\n    if (!this.node)\n      throw Error(\"fuck\")\n\n    // if active return\n    let oldActive = this.master.active\n    this.master.active = this\n    if (oldActive && oldActive !== this) {\n      oldActive.closePopup()\n      oldActive.updateView()\n    }\n    this.updateView()\n    this.openPopup()\n  }\n\n  deactivate(): void {\n    if (!this.master)\n      throw Error(\"fuck\")\n    if (this.master.active !== this)\n      return\n\n    this.master.active.closePopup()\n    this.master.active = undefined\n    this.master.state = MenuState.WAIT\n    this.updateView()\n  }\n}\nwindow.customElements.define(\"toad-menubutton\", MenuButton)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { MenuButton } from \"./MenuButton\"\nimport { MenuButtonContainer } from \"./MenuHelper\"\n\nexport class MenuNode {\n  title: string\n  label: string\n  shortcut?: string\n  type: string\n  modelId?: string\n\n  parent?: MenuNode\n  down?: MenuNode\n  next?: MenuNode\n\n  view?: HTMLElement\n\n  constructor(title: string, label: string, shortcut?: string, type?: string, modelId?: string) {\n    this.title = title\n    this.label = label\n    this.shortcut = shortcut\n    this.type = type ? type : \"entry\"\n    this.modelId = modelId\n  }\n\n  isEnabled(): boolean {\n    return true\n  }\n\n  isAvailable(): boolean {\n    return true\n  }\n\n  createWindowAt(parent: MenuButtonContainer, parentView: HTMLElement): void {\n    if (this.type == \"spacer\") {\n      let span = document.createElement(\"span\") as HTMLSpanElement\n      span.style.flexGrow = \"1\"\n      parentView.appendChild(span)\n      return\n    }\n    this.view = new MenuButton(parent, this)\n    parentView.appendChild(this.view)\n  }\n\n  deleteWindow(): void {\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { MenuButton } from \"./MenuButton\"\nimport { MenuState } from \"./MenuState\"\n\nexport class MenuButtonContainer extends HTMLElement {\n  vertical: boolean\n  closeOnClose: boolean\n  active?: MenuButton\n  state: MenuState\n  btnmaster?: MenuButton\n  parentButton?: MenuButton\n\n  constructor() {\n    super()\n    this.vertical = true\n    this.closeOnClose = false\n    this.state = MenuState.WAIT\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"../util/dom\"\nimport { MenuNode } from \"./MenuNode\"\nimport { MenuButtonContainer } from \"./MenuHelper\"\nimport { menuStyle } from \"./menuStyle\"\n\nexport class Menu extends MenuButtonContainer {\n  root: MenuNode\n  view?: HTMLElement\n  _observer?: MutationObserver\n  _timer?: number\n\n  constructor() {\n    super()\n    this.vertical = false\n    this.root = new MenuNode(\"\", \"\", undefined, undefined)\n\n  }\n\n  connectedCallback() {\n    this.tabIndex = 0\n\n    if (this.children.length === 0) {\n      // Chrome, Opera invoke connectedCallback() before the children are conected\n      this._observer = new MutationObserver((record: MutationRecord[], observer: MutationObserver) => {\n        if (this._timer !== undefined)\n          clearTimeout(this._timer)\n        this._timer = window.setTimeout(() => {\n          this._timer = undefined\n          this.layout2nodes(this.children, this.root)\n          this.referenceActions()\n          this.createShadowDOM()\n        }, 100)\n      })\n      this._observer.observe(this, {\n        childList: true,\n        subtree: true\n      })\n    } else {\n      // Safari invokes connectedCallback() after the children are connected\n      this.layout2nodes(this.children, this.root)\n      this.referenceActions()\n      this.createShadowDOM()\n    }\n    /*\n        globalController.sigChanged.add(() => {\n          if (globalController.reasonType===\"action-add\") {\n            if (!globalController.reasonAction)\n              return\n            let node = this.findNode(globalController.reasonAction.title)\n            if (node) {\n              node.addAction(globalController.reasonAction)\n            }\n          }\n        }, this)\n    */\n  }\n\n  disconnectedCallback() {\n    //    globalController.sigChanged.remove(this)\n  }\n\n  layout2nodes(children: HTMLCollection, parent: MenuNode): void {\n    let node = parent.down\n    for (let child of children) {\n      let newnode: MenuNode | undefined = undefined\n      switch (child.nodeName) {\n        case \"TOAD-MENUSPACER\":\n          newnode = new MenuNode(\"\", \"\", \"\", \"spacer\")\n          break\n        case \"TOAD-MENUENTRY\":\n          newnode = new MenuNode(\n            dom.attribute(child, \"name\"),\n            dom.attribute(child, \"label\"),\n            dom.attributeOrUndefined(child, \"shortcut\"),\n            dom.attributeOrUndefined(child, \"type\"),\n            dom.attributeOrUndefined(child, \"model\")\n          )\n          break\n      }\n      if (newnode) {\n        newnode.parent = parent\n        if (!node)\n          parent.down = newnode\n\n        else\n          node.next = newnode\n        node = newnode\n      }\n      if (!node)\n        throw Error(\"fuck\")\n      this.layout2nodes(child.children, node)\n    }\n  }\n\n  referenceActions(): void {\n    /*\n        for(let titleAndAction of globalController.actionStorage) {\n          let title = titleAndAction[0]\n          let action = titleAndAction[1]\n          let node = this.findNode(title)\n          if (node) {\n            node.addAction(action)\n          }\n        }\n    */\n  }\n\n  findNode(str: string, parent?: MenuNode): MenuNode | undefined {\n    let strpos = str.indexOf(\"|\")\n    let left = strpos == -1 ? str : str.substr(0, strpos)\n    let right = strpos == -1 ? \"\" : str.substr(strpos + 1)\n\n    if (!parent)\n      parent = this.root\n\n    for (let n = parent.down; n; n = n.next) {\n      if (n.title == left) {\n        if (!n.down) {\n          return n\n        }\n        return this.findNode(right, n)\n      }\n    }\n\n    return undefined\n  }\n\n  createShadowDOM() {\n    this.view = document.createElement(\"div\")\n    this.view.classList.add(\"menu-bar\")\n\n    let node = this.root.down\n    while (node) {\n      if (node.isAvailable()) {\n        node.createWindowAt(this, this.view)\n      } else {\n        node.deleteWindow()\n      }\n      node = node.next\n    }\n\n    this.attachShadow({ mode: 'open' })\n    this.shadowRoot!.appendChild(document.importNode(menuStyle, true))\n    this.shadowRoot!.appendChild(this.view)\n  }\n}\nwindow.customElements.define(\"toad-menu\", Menu)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport class MenuSpacer extends HTMLElement {\n}\nwindow.customElements.define(\"toad-menuspacer\", MenuSpacer)","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nlet animationFrameCount = 468\n\nexport function setAnimationFrameCount(frames: number) {\n    animationFrameCount = frames\n}\n\n// FIXME: handle concurrent smoothScroll within the same scrollableParent\nexport function scrollIntoView(element: Element | undefined): void {\n    if (element === undefined)\n        return\n    // console.log(`scrollIntoView(${element})`)\n    const scrollableParent = findScrollableParent(element)\n    if (scrollableParent === undefined)\n        return\n    const parentRect = scrollableParent.getBoundingClientRect()\n    const clientRect = element.getBoundingClientRect()\n\n    if (scrollableParent !== document.body) {       \n        const {x, y} = calculateScrollGoal(scrollableParent, parentRect, clientRect)\n        // console.log(`  scroll from (${scrollableParent.scrollLeft}, ${scrollableParent.scrollTop}) to (${x}, ${y})`)\n        smoothScroll(scrollableParent, x, y)\n        if (window.getComputedStyle(scrollableParent).position !== 'fixed') {\n            window.scrollBy({\n                left: parentRect.left,\n                top: parentRect.top,\n                behavior: 'smooth'\n            })\n        }\n    } else {\n        window.scrollBy({\n            left: clientRect.left,\n            top: clientRect.top,\n            behavior: 'smooth'\n        })\n    }\n}\n\nfunction calculateScrollGoal(scrollableParent: Element, parentRect: DOMRect, clientRect: DOMRect): {x: number, y: number} {\n    const GAP = 16\n    const clientLeft   = clientRect.left   + scrollableParent.scrollLeft - parentRect.left - GAP\n    const clientRight  = clientRect.right  + scrollableParent.scrollLeft - parentRect.left + GAP\n    const clientTop    = clientRect.top    + scrollableParent.scrollTop  - parentRect.top  - GAP\n    const clientBottom = clientRect.bottom + scrollableParent.scrollTop  - parentRect.top  + GAP\n    const parentWidth = scrollableParent.clientWidth\n    const parentHeight = scrollableParent.clientHeight\n\n    var x = scrollableParent.scrollLeft\n    var y = scrollableParent.scrollTop\n\n    // @ts-ignore\n    // console.log(`calculateScrollGoal() className=${scrollableParent.className} ${scrollableParent.foo} client=(${clientLeft}, ${clientRight}, ${clientTop}, ${clientBottom}), parent=(${parentWidth}, ${parentHeight}), scroll=(${x}, ${y})`)\n\n    if (clientRight - clientLeft - 2*GAP > parentWidth)\n        x = clientLeft\n    else if (clientRight > scrollableParent.scrollLeft + parentWidth)\n        x = clientRight - parentWidth\n    else if (clientLeft < scrollableParent.scrollLeft)\n        x = clientLeft\n\n    if (clientBottom - clientTop - 2*GAP > parentHeight)\n        y = clientTop\n    else if (clientBottom > scrollableParent.scrollTop + parentHeight)\n        y = clientBottom - parentHeight\n    else if (clientTop < scrollableParent.scrollTop)\n        y = clientTop\n\n    x = Math.max(0, x)\n    y = Math.max(0, y)\n\n    // console.log(`scroll goal = (${x}, ${y})`)\n\n    return { x, y }\n}\n\nconst concurrentScroll = new Map<Element, {x:number, y:number}>()\n\nfunction smoothScroll(scrollable: Element, x: number, y: number): void {\n\n    let activeGoal = concurrentScroll.get(scrollable)\n    if (activeGoal === undefined) {\n        activeGoal = {x: x, y: y}\n        concurrentScroll.set(scrollable, activeGoal)\n        // console.log(`initial goal ${x}, ${y}`)\n    } else {\n        // console.log(`update goal from ${activeGoal.x}, ${activeGoal.y} to ${x}, ${y}`)\n        activeGoal.x = x\n        activeGoal.y = y\n    }\n\n    let startX:number, startY: number\n    if (scrollable === document.body) {\n        startX = window.scrollX || window.pageXOffset\n        startY = window.scrollY || window.pageYOffset\n    } else {\n        startX = scrollable.scrollLeft\n        startY = scrollable.scrollTop\n    }\n    const deltaX = x - startX\n    const deltaY = y - startY\n    if (deltaX === 0 && deltaY === 0) {\n        // console.log(`no delta, abort smoothScroll from ${startX}, ${startY} to ${x}, ${y}`)\n        // console.log(`delete goal`)\n        concurrentScroll.delete(scrollable)\n        return\n    }\n\n    animate( (value: number): boolean => {\n        // console.log(`animate active ${activeGoal!.x}, ${activeGoal!.y}, local ${x}, ${y}`)\n        if (activeGoal!.x !== x || activeGoal!.y !== y) {\n            // console.log(\"  skip\")\n            return false\n        }\n\n        const nx = startX + value * deltaX\n        const ny = startY + value * deltaY\n\n        if (scrollable === document.body) {\n            window.scrollTo(nx, ny)\n        } else {\n            // const ox = scrollable.scrollLeft\n            // const oy = scrollable.scrollTop\n\n            scrollable.scrollLeft = nx\n            scrollable.scrollTop  = ny\n            // @ts-ignore\n            // scrollable.foo = `scroll=${nx}, ${ny}`\n            // console.log(`set scrollable className=${scrollable.className} from (${ox}, ${oy}) to (${nx}, ${ny}) (now: ${scrollable.scrollLeft}, ${scrollable.scrollTop})`)\n        }\n        if (value === 1) {\n            // console.log(`delete goal`)\n            concurrentScroll.delete(scrollable)\n        }\n        return true\n    })\n}\n\nlet idSource = 0\n\nexport function animate(callback: (value: number) => boolean) {\n    setTimeout( ()=> { window.requestAnimationFrame(animateStep.bind(window, callback, undefined, undefined)) } , 0)\n}\n\nfunction animateStep(callback: (value: number) => boolean, startTime?: number, id?: number) {\n    if (startTime === undefined) {\n        startTime = Date.now()\n        id = ++idSource\n    }\n\n    const time = Date.now()\n    let elapsed = animationFrameCount > 0 ? (time - startTime) / animationFrameCount : 1\n\n    elapsed = elapsed > 1 ? 1 : elapsed\n\n    const value = ease(elapsed)\n    // console.log(`animate: id=${id}, value=${elapsed}`)\n    if (callback(value) === false)\n        return\n    if (value < 1.0) {\n        window.requestAnimationFrame(animateStep.bind(window, callback, startTime, id))\n    }\n}\n\nfunction ease(k: number): number {\n    return 0.5 * (1 - Math.cos(Math.PI * k))\n}\n\nvar ROUNDING_TOLERANCE = isMicrosoftBrowser(window.navigator.userAgent) ? 1 : 0\n\nfunction isMicrosoftBrowser(userAgent: string): boolean {\n    const userAgentPatterns = ['MSIE ', 'Trident/', 'Edge/']\n    return new RegExp(userAgentPatterns.join('|')).test(userAgent)\n}\n\nexport function findScrollableParent(el: Element): Element | undefined {\n    while (el !== document.body && isScrollable(el) === false) {\n        if (el.parentElement === null)\n            return undefined\n        el = el.parentElement\n    }\n    return el\n}\n\nexport function isScrollable(el: Element): boolean {\n    const isScrollableY = hasScrollableSpace(el, \"Y\") && canOverflow(el, \"Y\")\n    const isScrollableX = hasScrollableSpace(el, \"X\") && canOverflow(el, \"X\")\n    return isScrollableY || isScrollableX\n}\n\nfunction hasScrollableSpace(el: Element, axis: \"X\"|\"Y\"): boolean {\n    if (axis === 'X')\n        return el.clientWidth + ROUNDING_TOLERANCE < el.scrollWidth\n    else\n        return el.clientHeight + ROUNDING_TOLERANCE < el.scrollHeight\n}\n\nfunction canOverflow(el: Element, axis: \"X\"|\"Y\"): boolean {\n    const style = window.getComputedStyle(el, null) as any\n    const overflowValue = style['overflow' + axis]\n    return overflowValue === 'auto' || overflowValue === 'scroll'\n}","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport enum TableEditMode {\n  EDIT_CELL,\n  SELECT_CELL,\n  //  SELECT_COLUMN,\n  SELECT_ROW\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport enum TableEventType {\n    // Model Messages (generated by model)\n    INSERT_ROW, REMOVE_ROW,\n    INSERT_COL, REMOVE_COL,\n    CELL_CHANGED,\n\n    // TableAdapter messages (not generated by models)\n    RESIZE_ROW, RESIZE_COL,\n    CHANGED\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"../model/Model\"\nimport { TableEvent } from \"./TableEvent\"\n\n// TODO: API for insert, delete and move rows and columns\nexport abstract class TableModel extends Model<TableEvent> {\n  abstract get colCount(): number\n  abstract get rowCount(): number\n  isEmpty() { return this.colCount === 0 && this.rowCount === 0 }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport class TablePos {\n  col: number\n  row: number\n  constructor(col: number, row: number) {\n    this.col = col\n    this.row = row\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"../model/Model\"\nimport { TableEditMode } from \"./TableEditMode\"\nimport { TablePos } from \"./TablePos\"\n\n// FIXME: also needed is a model for range and 'random' selections\n\nexport class SelectionModel extends Model {\n  mode: TableEditMode // FIXME: there might be a way to do without, just by the behaviour of a common API towards TableView\n  _value: TablePos\n\n  constructor(mode = TableEditMode.EDIT_CELL) {\n    super()\n    this.mode = mode\n    this._value = new TablePos(0, 0)\n  }\n\n  set col(col: number) {\n    if (this._value.col === col)\n      return\n    this._value.col = col\n    this.modified.trigger()\n  }\n\n  get col(): number {\n    return this._value.col\n  }\n\n  set row(row: number) {\n    if (this._value.row === row)\n      return\n    this._value.row = row\n    this.modified.trigger()\n  }\n\n  get row(): number {\n    return this._value.row\n  }\n\n  set value(value: TablePos) {\n    if (this._value.col === value.col && this._value.row === value.row)\n      return\n    this._value = value\n    this.modified.trigger()\n  }\n\n  get value(): TablePos {\n    return this._value\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TableModel } from \"./TableModel\"\n\nexport abstract class TypedTableModel<T> extends TableModel {\n    nodeClass: new () => T\n    constructor(nodeClass: new () => T, root?: T) {\n        super()\n        this.nodeClass = nodeClass\n    }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TableModel } from \"./TableModel\"\nimport { TypedTableModel } from \"./TypedTableModel\"\nimport { TypedTableAdapter } from \"./TypedTableAdapter\"\n\nexport class TableAdapter<T extends TableModel> {\n    model?: T\n    get colCount(): number {\n        return this.model === undefined ? 0 : this.model.colCount\n    }\n    get rowCount(): number {\n        return this.model === undefined ? 0 : this.model.rowCount\n    }\n    setModel(model: T): void {\n        this.model = model\n    }\n    getColumnHead(col: number): Node | undefined { return undefined }\n    getRowHead(row: number): Node | undefined { return undefined }\n    getDisplayCell(col: number, row: number): Node | Node[] | undefined { return undefined }\n    getEditorCell(col: number, row: number): Node | undefined { return undefined }\n\n    isViewCompact(): boolean { return false }\n\n    // FIXME: convert the comments below into clean code\n    // data is used for TypeTableModel\n    // Map<model, Map<data, adapter>>\n    private static modelToAdapter = new Map<new(...args: any[]) => TableModel, Map<new(...args: any[])=> any, new()=> TableAdapter<any>>>()\n    static register<T, A extends TypedTableAdapter<TypedTableModel<T>>, C extends TypedTableModel<T>>(adapter: new(...args: any[]) => A, model: new(...args: any[]) => C, data: new(...args: any[]) => T): void\n    static register(adapter: new() => TableAdapter<any>, model: new(...args: any[])=>TableModel): void\n    static register(adapter: new() => TableAdapter<any>, model: new(...args: any[])=>TableModel, data?: any): void\n    {\n        // console.log(\"TableAdapter.register() ============\")\n        // console.log(adapter)\n        // console.log(model)\n        // console.log(data)\n        let typeToModel = TableAdapter.modelToAdapter.get(model)\n        if (typeToModel === undefined) {\n            typeToModel = new Map<any, any>()\n            TableAdapter.modelToAdapter.set(model, typeToModel)\n        }\n        if (typeToModel.get(data) !== undefined) {\n            throw Error(`attempt to redefine existing table adapter`)\n        }\n        typeToModel.set(data, adapter)\n    }\n\n    static unbind() {\n        TableAdapter.modelToAdapter.clear()\n    }\n\n    static lookup(model: TableModel): (new() => TableAdapter<any>) {\n        // console.log(\"TableAdapter.lookup() ============\")\n\n        let dataType: any\n        if(model instanceof TypedTableModel) {\n            dataType = model.nodeClass\n        } else {\n            dataType = undefined\n        }\n        \n        let adapter = TableAdapter.modelToAdapter.get(Object.getPrototypeOf(model).constructor)?.get(dataType)\n        if (adapter === undefined) {\n            for(let baseClass of TableAdapter.modelToAdapter.keys()) {\n                if (model instanceof baseClass) {\n                    adapter = TableAdapter.modelToAdapter.get(baseClass)?.get(dataType)\n                    break\n                }\n            }\n        }\n\n        if (adapter === undefined) {\n            let msg = `TableAdapter.lookup(): Did not find an adapter for model of type ${model.constructor.name}`\n            msg += `\\n    Requested adapter: model=${model.constructor.name}, type=${dataType.name}\\n    Available adapters:`\n            for (const [modelX, typeToAdapterX] of TableAdapter.modelToAdapter) {\n                for(const [typeX, adapterX] of typeToAdapterX) {\n                    // msg += `\\n model=${model?.constructor.name}, type=${type.name}`\n                    msg += `\\n        model=${modelX.name}, type=${typeX}`\n                }\n            }\n            throw Error(msg)\n        }\n        // console.log(\"TableAdapter.lookup() found adapter\")\n        // console.log(adapter)\n        return adapter\n    }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport let tableStyle = document.createElement(\"style\")\ntableStyle.textContent = `\n:host {\n  position: relative;\n  display: inline-block;\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  outline-offset: -2px;\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  background: #fff;\n}\n:host:focus .cells tr.selected,\n:host:focus .cells td.selected {\n  background: #0069d4;\n  color: #fff;\n}\n\n.colhead {\n  position: absolute;\n  top: 0;\n  overflow: hidden;\n}\n.rowhead {\n  position: absolute;\n  left: 0;\n  overflow: hidden;\n}\n.cells {\n  position: absolute;\n\n  bottom: 0;\n  right: 0;\n\n  overflow: auto;\n  /* resize: both; */\n  cursor: default;\n}\n\n:host > div > table, :host > table {\n  border-collapse: collapse;\n  border-spacing: 0;\n  border: none 0px;\n}\n.colhead > table, .rowhead > table {\n  background: #e0e0e0;\n}\n\n.colhead th,\n.rowhead th,\n.cells td,\n.hiddenSizeCheck td {\n  letter-spacing: 0;  \n  overflow: hidden;   \n  padding: 2px;\n  margin: 0px;\n\n  /* this might not be always desirable; */\n  white-space: nowrap; \n\n  border: solid 1px #ccc;\n}\n\n.colhead th, .rowhead th {\n  z-index: 1;\n}\n\n.bodyrow td {\n  padding-top: 0px;\n  padding-bottom: 0px;\n  border-top: none 0px;\n  border-bottom: none 0px;\n}\n\n.cells tr:nth-child(even) {\n  background: var(--toad-table-even-row, #f5f5f5);\n}\n.cells tr:nth-child(odd) {\n  background: var(--toad-table-odd-row, #ffffff);\n}\n\n.cells td:nth-child(1) {\n  border-left: none;\n}\n.cells tr:nth-child(2) td {\n  border-top: none;\n}\n\n.cells tr.selected,\n.cells tr td.selected {\n  background: #808080;\n  color: #fff;\n}\n\n// .compact.colhead th,\n// .compact.rowhead th,\n// .compact.hiddenSizeCheck * th,\n// .compact.cells * td,\n// .compact.hiddenSizeCheck * td {\n//   /* for some reason, without this, the cells have a distance... */\n//   display: flex;\n// }\n\n.compact.colhead th,\n.compact.rowhead th,\n.compact.hiddenSizeCheck * th {\n  border-color: none;\n  border-style: none;\n  border-width: 0;\n  padding: 0px;\n}\n.compact.cells * td,\n.compact.hiddenSizeCheck * td {\n  border-color: none;\n  border-style: none;\n  border-width: 0;\n  padding: 0px;\n}\n\n.zeroSize {\n  width: 0;\n  height: 0;\n  margin: 0;\n  padding: 0;\n  border: none;\n}\n\n.inputDiv { \n  position: relative;\n  background: #fff;\n  border: none;\n  opacity: 0;\n}\n\n.hiddenSizeCheck {\n  position: absolute;\n  opacity: 0;\n}\n`\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"../../util/dom\"\nimport { findScrollableParent } from \"../../scrollIntoView\"\n\nexport class InputOverlay extends HTMLDivElement {\n\n  focusInFromLeft?: () => void\n  focusInFromRight?: () => void\n\n  // workaround\n  static init(div: InputOverlay): void {\n    div.addEventListener(\"focusin\", (event: FocusEvent) => {\n      div.style.opacity = \"1\"\n      if (event.target && event.relatedTarget) {\n        try {\n          if (dom.isNodeBeforeNode(event.relatedTarget as Node, div)) {\n            if (div.focusInFromLeft)\n              div.focusInFromLeft()\n          } else {\n            if (div.focusInFromRight)\n              div.focusInFromRight()\n          }\n        }\n        catch(e) {}\n      }\n    })\n\n    div.addEventListener(\"focusout\", (event: FocusEvent) => {\n      div.style.opacity = \"0\" // this is for debugging to check if the overlay is really placed nicely...\n    })\n\n    div.style.display = \"none\"\n    // div.style.background = \"#f80\"\n\n    div.setViewRect = InputOverlay.prototype.setViewRect\n    div.unsetViewRect = InputOverlay.prototype.unsetViewRect\n    div.setEditView = InputOverlay.prototype.setEditView\n    div.adjustToCell = InputOverlay.prototype.adjustToCell\n  }\n\n  setEditView(fieldView: HTMLElement | undefined) {\n    // avoid side effect of scrolling parent on safari\n    const scrollableParent = findScrollableParent(this)\n    let savedScrollLeft = 0, savedScrollTop = 0\n    if (scrollableParent !== undefined)\n      [savedScrollLeft, savedScrollTop] = [scrollableParent.scrollLeft, scrollableParent.scrollTop]\n\n    if (!this.hasChildNodes()) {\n      if (fieldView)\n        this.appendChild(fieldView)\n    } else {\n      if (dom.hasFocus(this.children[0])) {\n        this.children[0].dispatchEvent(new FocusEvent(\"blur\"))\n      }\n      if (fieldView)\n        this.replaceChild(fieldView, this.childNodes[0])\n      else\n        this.removeChild(this.childNodes[0])\n    }\n\n    this.style.display = fieldView ? \"\" : \"none\"\n\n    // restore scrollable parent\n    if (scrollableParent !== undefined) {\n      scrollableParent.scrollLeft = savedScrollLeft\n      scrollableParent.scrollTop = savedScrollTop\n    }\n  }\n\n  adjustToCell(cell: HTMLTableDataCellElement | undefined) {\n\n    if (!this.hasChildNodes()) {\n      this.unsetViewRect()\n      return\n    }\n\n    if (cell === undefined)\n      return\n\n    let boundary = cell.getBoundingClientRect()\n    let tr = cell.parentElement\n    if (tr === null) {\n      // console.trace(`InputOverlay.adjustToCell(): cell to adjust to has no parent`)\n      // console.log(cell)\n      return\n    }\n    let tbody = tr.parentElement\n    if (tbody === null) {\n      // console.trace(`InputOverlay.adjustToCell(): cell's parent row has no parent`)\n      // console.log(tr)\n      return\n    }\n\n    let top, left\n    if (navigator.userAgent.indexOf(\"Chrome\") > -1) {\n      // Chrome\n      left = cell.offsetLeft + 2\n      top = cell.offsetTop - tbody.clientHeight\n    } else {\n      // Safari & Opera\n      left = cell.offsetLeft + 0.5\n      top = cell.offsetTop - tbody.clientHeight \n    }\n\n    const width = cell.clientWidth - dom.horizontalPadding(cell)\n    const height = boundary.height\n\n    this.setViewRect(top, left, width, height)\n  }\n\n  private setViewRect(top: number, left: number, width: number, height: number) {\n    this.style.display = \"\"\n    this.style.opacity = \"1\"\n    this.style.top = `${top}px`\n    this.style.left = `${left}px`\n    this.style.width = `${width}px`\n    this.style.height = `${height}px`\n  }\n\n  private unsetViewRect() {\n    this.style.opacity = \"0\"\n    this.style.display = \"none\"\n    this.style.top = \"\"\n    this.style.left = \"\"\n    this.style.width = \"\"\n    this.style.height = \"\"\n  }\n}\n// window.customElements.define(\"toad-table-inputoverlay\", InputOverlay, { extends: 'div' })\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TableEvent } from \"../TableEvent\"\nimport { AnimationBase } from '@toad/util/animation'\nimport { TableView } from '../TableView'\n\nenum SelectionIs {\n  BEFORE_REMOVED_AREA,\n  INSIDE_REMOVED_AREA,\n  INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS,\n  BEHIND_REMOVED_AREA\n}\n\nexport class RemoveRowAnimation extends AnimationBase {\n  table: TableView\n  event: TableEvent\n  rowAnimationHeight = 0;\n  hadFocus: boolean = false;\n  trAnimationHead!: HTMLTableRowElement\n  trAnimationBody!: HTMLTableRowElement\n\n  overlayTop?: number\n  selectionIs!: SelectionIs\n\n  constructor(table: TableView, event: TableEvent) {\n    super()\n    this.table = table\n    this.event = event\n  }\n\n  override prepare() {\n    this.hadFocus = this.table.hasFocus()\n    \n    let overlayTopDrift = 0\n\n    // adjust selection to rows being removed\n    if (this.table.editView && this.table.selectionModel !== undefined) {\n      if (this.table.selectionModel.row < this.event.index) {\n        // selection is before removed area\n        // console.log(`selection (${this.table.selectionModel.col}, ${this.table.selectionModel.row}) is before removed area ${this.event.index} to ${this.event.index + this.event.size - 1}`)\n        this.selectionIs = SelectionIs.BEFORE_REMOVED_AREA\n      } else\n      if (this.table.selectionModel.row <= this.event.index + this.event.size) {\n        // selection is inside removed area (what if there's nothing left?)\n        // console.log(`selection (${this.table.selectionModel.col}, ${this.table.selectionModel.row}) is inside removed area ${this.event.index} to ${this.event.index + this.event.size - 1}`)\n        const rowCount = this.table.bodyBody.children.length - 1\n        // console.log(`index=${this.event.index}, size=${this.event.size}, rowCount=${rowCount}`)\n        if (this.event.index + this.event.size >= rowCount) { // is the rowCount alreay decreased from the removed rows?\n          this.selectionIs = SelectionIs.INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS\n          for (let i = this.event.index; i <= this.table.selectionModel.row; ++i) {\n            const tr = this.table.bodyBody.children[i + 1] as HTMLTableRowElement\n            overlayTopDrift -= tr.clientHeight\n          }\n          // if there are no rows after the removed area, go to the models last row\n          if (this.event.index === 0) {\n            // there are no rows left\n            // console.log(`  there are no rows left, go to 0 for now`)\n            this.table.selectionModel.row = 0\n          } else {\n            // there are no rows left after the removed area, go to the end of the table\n            // console.log(`  there are no rows left after the removed area, go to the end of the table`)\n            this.table.selectionModel.row = this.event.index - 1\n          }\n        } else {\n          // there are rows after the removed area, go to the 1st of them\n          // console.log(`  there are rows after the removed area, go to the 1st of them`)\n          // console.log(`    ${this.table.selectionModel.row}, ${this.event.index}`)\n\n          this.selectionIs = SelectionIs.INSIDE_REMOVED_AREA\n          for (let i = this.event.index+1; i <= this.table.selectionModel.row; ++i) {\n            const tr = this.table.bodyBody.children[i + 1] as HTMLTableRowElement\n            overlayTopDrift -= tr.clientHeight\n          }\n\n          this.table.selectionModel.row = this.event.index\n          this.table.prepareInputOverlayForPosition({col: this.table.selectionModel.value.col, row: this.table.selectionModel.value.row})\n        }\n        // console.log(`set selection.row to ${this.table.selectionModel.row}`)\n      } else {\n        // selection is behind removed area\n        // console.log(`selection (${this.table.selectionModel.col}, ${this.table.selectionModel.row}) is behind removed area ${this.event.index} to ${this.event.index + this.event.size - 1}`)\n        this.table.selectionModel.row -= this.event.size\n        // console.log(`set selection.row to ${this.table.selectionModel.row}`)\n        this.selectionIs = SelectionIs.BEHIND_REMOVED_AREA\n      }\n    }\n\n    // if (this.selectionIs === undefined) {\n    //   console.log(`!!! NO STRATEGY TO MOVE INPUTOVERLAY !!!`)\n    // } else {\n    //   console.log(`STRATEGY TO MOVE INPUTOVERLAY IS ${SelectionIs[this.selectionIs]}`)\n    // }\n\n    this.rowAnimationHeight = 0\n    for (let i = 0; i < this.event.size; ++i) {\n      const tr = this.table.bodyBody.children[this.event.index + i + 1] as HTMLTableRowElement\n      this.rowAnimationHeight += tr.clientHeight\n    }\n    // const rowAnimationHeight = trBody.clientHeight\n    this.table.rowAnimationHeight = this.rowAnimationHeight\n\n    // delete all but the 1st row\n    for (let i = 1; i < this.event.size; ++i) {\n      this.table.rowHeadHead.deleteRow(this.event.index + 1)\n      this.table.bodyBody.deleteRow(this.event.index + 2)\n    }\n\n    // rebuild the 1st row to be used during the animation\n    this.trAnimationHead = this.table.rowHeadHead.children[this.event.index] as HTMLTableRowElement\n    this.trAnimationBody = this.table.bodyBody.children[this.event.index + 1] as HTMLTableRowElement\n\n    this.trAnimationHead.style.minHeight = this.trAnimationHead.style.maxHeight = \"\"\n    this.trAnimationBody.style.minHeight = this.trAnimationBody.style.maxHeight = \"\"\n    this.trAnimationHead.style.height = `${this.rowAnimationHeight}px`\n    this.trAnimationBody.style.height = `${this.rowAnimationHeight}px`\n    \n    const img=`url(\\\"data:image/svg+xml;utf8,<svg width='3' height='3' xmlns='http://www.w3.org/2000/svg'><line shape-rendering='crispEdges' x1='-1' y1='-1' x2='5' y2='5' stroke='%23888' /></svg>\\\")`\n\n    // empty\n    while (this.trAnimationHead.childNodes.length > 0)\n      this.trAnimationHead.removeChild(this.trAnimationHead.childNodes[0])\n    while (this.trAnimationBody.childNodes.length > 0)\n      this.trAnimationBody.removeChild(this.trAnimationBody.childNodes[0])\n\n    // insert some dummy <td> & <th> to make the row visible during animation\n    this.trAnimationHead.appendChild(<th style={{padding: \"0\"}}/>)\n    this.trAnimationHead.style.background = img\n    for(let i=0; i<this.table.adapter!.colCount; ++i) {\n      this.trAnimationBody.appendChild(<td style={{padding: \"0\"}}/>)\n      this.trAnimationBody.style.background = img\n    }\n    const top = this.table.inputOverlay.style.top\n    if (top.length > 2)\n      this.overlayTop = Number.parseFloat(top.substr(0, top.length-2)) + overlayTopDrift\n  }\n\n  override animationFrame(value: number) {\n    const inverseValue = 1 - value\n    this.trAnimationBody.style.height = this.trAnimationHead.style.height = `${inverseValue * this.rowAnimationHeight}px`\n    if (this.overlayTop) {\n      switch(this.selectionIs) {\n        case SelectionIs.BEFORE_REMOVED_AREA:\n          this.table.inputOverlay.style.top = `${this.overlayTop + value * this.rowAnimationHeight}px`\n          break\n        case SelectionIs.INSIDE_REMOVED_AREA:\n          this.table.inputOverlay.style.top = `${this.overlayTop + this.rowAnimationHeight}px`\n          break\n        case SelectionIs.INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS:\n          this.table.inputOverlay.style.top = `${this.overlayTop + value * this.rowAnimationHeight}px`\n          break;\n        case SelectionIs.BEHIND_REMOVED_AREA:\n          this.table.inputOverlay.style.top = `${this.overlayTop}px`\n          break\n      }\n    }\n  }\n\n  override lastFrame() {\n    this.table.rowHeadHead.deleteRow(this.event.index)\n    this.table.bodyBody.deleteRow(this.event.index + 1)\n\n    // this.table.selectionModel?.modified.trigger()\n\n    // setTimeout(() => {\n    //   if (this.hadFocus)\n    //     this.table.focus()\n\n    // }, 0)\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\n// 1st step: this class has gone completly out of control\n//           create a list of all methods plus who calls who\n//           try to move code outside by converting them into object of their own\n//           begin with the inputOverlay\n\nimport { Fragment, ref } from '../jsx-runtime'\n\nimport * as dom from \"../util/dom\"\nimport { scrollIntoView } from \"../scrollIntoView\"\nimport { Model } from \"../model/Model\"\nimport { View } from \"../view/View\"\nimport { TableModel } from \"./TableModel\"\nimport { SelectionModel } from \"./SelectionModel\"\nimport { TableEditMode } from \"./TableEditMode\"\nimport { TablePos } from \"./TablePos\"\nimport { TableAdapter } from \"./TableAdapter\"\nimport { TableEvent } from \"./TableEvent\"\nimport { TableEventType } from \"./TableEventType\"\nimport { tableStyle } from \"./private/tableStyle\"\nimport { InputOverlay } from \"./private/InputOverlay\"\nimport { Animator } from '@toad/util/animation'\nimport { RemoveRowAnimation } from './private/RemoveRowAnimation'\nimport { InsertRowAnimation } from './private/InsertRowAnimation'\nimport { throws } from 'assert'\n\nenum Log {\n  LAYOUT,\n  SELECTION,\n  USER\n}\n\n/*\n * rootDiv (div.root, onkeydown)\n *   rowHeadDiv (div.rowhead, hidden)\n *     rowHeadTable (table)\n *       rowHeadHead (thead)\n *         rowHeadRow (tr)\n *   colHeadDiv (div.colhead, hidden)\n *     colHeadTable (table)\n *       colHeadHead (thead)\n *         colHeadRow (tr)\n *   bodyDiv (div.cells, onscroll)\n *     bodyTable (table, onmousedown)\n *       bodyBody (tbody)\n *         bodyRow (tr, hidden, controls the width of all cells)\n *     zeroSize (div)\n *       inputOverlay (div, focusin & focusout)\n *     hiddenSizeCheckTable (table, hidden)\n *       hiddenSizeCheckBody (tbody)\n */\nexport class TableView extends View {\n  model?: TableModel\n\n  adapter?: TableAdapter<any>\n  selectionModel?: SelectionModel\n\n  rootDiv: Fragment\n\n  rowHeadDiv!: HTMLElement\n  rowHeadTable!: HTMLTableElement\n  rowHeadHead!: HTMLTableSectionElement\n\n  colHeadDiv!: HTMLElement\n  colHeadTable!: HTMLTableElement\n  colHeadRow!: HTMLTableRowElement\n\n  scrollDiv!: HTMLElement\n  bodyTable!: HTMLTableElement\n  bodyBody!: HTMLTableSectionElement\n  bodyRow!: HTMLTableRowElement\n\n  inputOverlay!: InputOverlay\n  editView?: HTMLElement\n  fieldModel?: Model\n  insideGoTo: boolean\n\n  hiddenSizeCheckRowHead!: HTMLTableSectionElement\n  hiddenSizeCheckBody!: HTMLTableSectionElement\n\n  private log(what: Log, msg: string) {\n    // if (what == Log.USER)\n    //   console.log(msg)\n  }\n\n  private animator = new Animator()\n\n  rowAnimationHeight = 0 // TODO: put in testAPI object\n\n  constructor() {\n    super()\n\n    this.insideGoTo = false\n\n    this.rootDiv =\n      <>\n        <div set={ref(this, 'rowHeadDiv')} class=\"rowhead\">\n          <table set={ref(this, 'rowHeadTable')}>\n            <thead set={ref(this, 'rowHeadHead')}></thead>\n          </table>\n        </div>\n        <div set={ref(this, 'colHeadDiv')} class=\"colhead\">\n          <table set={ref(this, 'colHeadTable')}>\n            <thead>\n              <tr set={ref(this, 'colHeadRow')}></tr>\n            </thead>\n          </table>\n        </div>\n        <div set={ref(this, 'scrollDiv')} class=\"cells\">\n          <table set={ref(this, 'bodyTable')}>\n            <tbody set={ref(this, 'bodyBody')}>\n              <tr set={ref(this, 'bodyRow')} class=\"bodyrow\"></tr>\n            </tbody>\n          </table>\n          <div class=\"zeroSize\">\n            <div set={ref(this, 'inputOverlay')} class=\"inputDiv\"></div>\n          </div>\n        </div>\n        <table class=\"hiddenSizeCheck\">\n          <thead set={ref(this, 'hiddenSizeCheckRowHead')} />\n          <tbody set={ref(this, 'hiddenSizeCheckBody')} />\n        </table>\n      </>\n\n    this.onkeydown = this.onRootDivKeyDown\n\n    this.scrollDiv.onscroll = () => {\n      this.rowHeadDiv.scrollTop = this.scrollDiv.scrollTop\n      this.colHeadDiv.scrollLeft = this.scrollDiv.scrollLeft\n    }\n\n    this.bodyTable.onmousedown = (event: MouseEvent) => {\n      if (!event.target) {\n        console.log(\"bodyTable.onmousedown() -> no target\")\n        return\n      }\n      if ((event.target as HTMLElement).tagName !== \"TD\") {\n        // FIXME: if the element is inside a TD, go up\n        console.log(`bodyTable.onmousedown() -> target is not TD but ${(event.target as HTMLElement).tagName}`)\n        return\n      }\n      event.preventDefault() // otherwise field will loose focus again\n      this.log(Log.USER, `bodyTable.onmousedown() -> goToCell(event.target)`)\n      this.goToCell(event.target as HTMLTableDataCellElement)\n    }\n\n    InputOverlay.init(this.inputOverlay)\n    this.inputOverlay.focusInFromLeft = () => {\n      if (!this.insideGoTo)\n        this.goToFirstCell()\n    }\n    this.inputOverlay.focusInFromRight = () => {\n      if (!this.insideGoTo)\n        this.goToLastCell()\n    }\n\n    this.attachShadow({ mode: 'open' })\n    this.shadowRoot!.appendChild(document.importNode(tableStyle, true))\n    this.rootDiv.appendTo(this.shadowRoot!)\n\n    // const resizeObserver = new ResizeObserver( entries => {\n    //   for (let e of entries) {\n    //     if (e.target === this.bodyDiv) {\n    //       const columnHeadBounds = this.colHeadDiv.getBoundingClientRect()\n    //       const rowHeadBounds = this.rowHeadDiv.getBoundingClientRect()\n    //       const bodyBounds = this.bodyDiv.getBoundingClientRect()\n\n    //       // :host { height & width: fit-content } did not work\n    //       if (this.style.left === \"\" && this.style.right === \"\")\n    //         this.style.width = (bodyBounds.width + rowHeadBounds.width)+\"px\"\n    //       if (this.style.top === \"\" && this.style.bottom === \"\")\n    //         this.style.height = (bodyBounds.height + columnHeadBounds.height)+\"px\"\n\n    //       this.bodyDiv.style.top = columnHeadBounds.height + \"px\"\n    //       this.bodyDiv.style.left = rowHeadBounds.width + \"px\"\n    //       this.colHeadDiv.style.left = rowHeadBounds.width + \"px\"\n    //       this.colHeadDiv.style.right = (bodyBounds.width - e.contentRect.width)+\"px\"\n    //       this.rowHeadDiv.style.top = columnHeadBounds.height + \"px\"\n    //       this.rowHeadDiv.style.bottom = (bodyBounds.height - e.contentRect.height)+\"px\"\n    //     }\n    //   }\n    // })\n    // resizeObserver.observe(this.bodyDiv)\n  }\n\n  updateModel() {\n  }\n\n  setModel(model?: Model): void {\n    if (!model) {\n      if (this.selectionModel)\n        this.selectionModel.modified.remove(this)\n      this.model = undefined\n      this.selectionModel = new SelectionModel()\n      this.selectionModel.modified.add(() => {\n        this.createSelection()\n      }, this)\n      this.updateView()\n      return\n    }\n\n    if (model instanceof SelectionModel) {\n      if (this.selectionModel) {\n        this.selectionModel.modified.remove(this)\n      }\n      this.selectionModel = model\n      this.createSelection()\n      this.selectionModel.modified.add(() => {\n        this.createSelection()\n      }, this)\n      return\n    }\n    if (model instanceof TableModel) {\n      this.model = model\n      this.model.modified.add((event: TableEvent) => { this.modelChanged(event) }, this)\n      const adapter = TableAdapter.lookup(model)\n      try {\n        this.adapter = new adapter()\n      }\n      catch (e) {\n        console.log(`TableView.setModel(): failed to instantiate table adapter: ${e}`)\n        console.log(`setting TypeScript's target to 'es6' might help`)\n        throw e\n      }\n      this.adapter.setModel(model)\n      this.updateCompact()\n      this.updateView()\n      return\n    }\n    throw Error(\"TableView.setModel(): unexpected model of type \" + model.constructor.name)\n  }\n\n  updateCompact() {\n    if (this.adapter?.isViewCompact()) {\n      this.rootDiv.forEach(child => child.classList.add(\"compact\"))\n    } else {\n      this.rootDiv.forEach(child => child.classList.remove(\"compact\"))\n    }\n  }\n\n  modelChanged(event: TableEvent) {\n    switch (event.type) {\n      case TableEventType.INSERT_ROW:\n        this.animator.run(new InsertRowAnimation(this, event))\n        break\n      case TableEventType.REMOVE_ROW:\n        this.animator.run(new RemoveRowAnimation(this, event))\n        break\n      case TableEventType.CELL_CHANGED:\n        this.onFieldViewBlur(new TablePos(event.col, event.row))\n        break\n    }\n  }\n\n  /*\n   * Update View For New Model\n   */\n\n  updateView() {\n    try {\n      // console.log(\"TableView.updateView()\")\n      if (!this.model) {\n        return\n      }\n\n      //console.log(\"updateHeader, updateBody\")\n      this.createColumnHeader()\n      this.createRowHeader()\n      this.createBody()\n      this.createSelection()\n      setTimeout(() => {\n        if (this.model)\n          this.adjustLayoutAfterRender()\n      }, 0)\n    }\n    catch (e) {\n      console.log(\"caught exception in updateView\")\n      console.log(e.stack)\n      throw e\n    }\n  }\n\n  protected createColumnHeader() {\n    this.updateHeader(true)\n  }\n\n  protected createRowHeader() {\n    this.updateHeader(false)\n  }\n\n  protected updateHeader(column: boolean) {\n    if (!this.model)\n      throw Error(\"TableView.updateHeader(): no model\")\n    if (!this.adapter)\n      throw Error(\"TableView.updateHeader(): no adapter\")\n\n    let headTable, headRow, count\n    if (column === true) {\n      headTable = this.colHeadTable\n      headRow = this.colHeadRow\n      count = this.adapter.colCount\n    } else {\n      headTable = this.rowHeadTable\n      headRow = this.rowHeadHead\n      count = this.adapter.rowCount\n    }\n\n    let noHeader = false\n\n    while (headRow.children.length > count + 1)\n      headRow.removeChild(headRow.children[headRow.children.length - 1])\n\n    for (let i = 0; i < count; ++i) {\n      let cell\n      if (i >= headRow.children.length) {\n        cell = <th />\n        if (column) {\n          headRow.appendChild(cell)\n        } else {\n          const row = <tr />\n          row.appendChild(cell)\n          headRow.appendChild(row)\n        }\n      } else {\n        if (column)\n          cell = headRow.children[i] as HTMLTableHeaderCellElement\n        else\n          cell = headRow.children[i].children[0] as HTMLTableHeaderCellElement\n        cell.style.minWidth = \"\"\n        cell.style.border = \"\"\n      }\n      const content = column ? this.adapter.getColumnHead(i) : this.adapter.getRowHead(i)\n      if (content === undefined) {\n        noHeader = true\n        continue\n      }\n      cell.appendChild(content)\n    }\n\n    let fillerForMissingScrollbar\n    if (headRow.children.length < count + 1) {\n      fillerForMissingScrollbar = <th />\n      if (column) {\n        headRow.appendChild(fillerForMissingScrollbar)\n      } else {\n        const row = <tr />\n        row.appendChild(fillerForMissingScrollbar)\n        headRow.appendChild(row)\n      }\n    } else {\n      if (column)\n        fillerForMissingScrollbar = headRow.children[headRow.children.length - 1] as HTMLTableHeaderCellElement\n      else\n        fillerForMissingScrollbar = headRow.children[headRow.children.length - 1].children[0] as HTMLTableHeaderCellElement\n    }\n    if (column) {\n      fillerForMissingScrollbar.innerText = \"\"\n      fillerForMissingScrollbar.style.minWidth = \"777px\"\n    } else {\n      fillerForMissingScrollbar.parentElement!.style.height = \"777px\"\n      // fillerForMissingScrollbar.innerHTML = '<span style=\"height: 777px\"></span>'\n    }\n    fillerForMissingScrollbar.style.border = \"0px none\"\n\n    headTable.style.display = noHeader ? \"none\" : \"\"\n  }\n\n  protected createBody() {\n    if (!this.model)\n      throw Error(\"TableView.updateBody(): no model\")\n    if (!this.adapter)\n      throw Error(\"TableView.updateBody(): no adapter\")\n\n    // body row\n    while (this.bodyRow.children.length > this.adapter.colCount)\n      this.bodyRow.removeChild(this.bodyRow.children[this.bodyRow.children.length - 1])\n\n    while (this.bodyRow.children.length < this.adapter.colCount) {\n      this.bodyRow.appendChild(<td />)\n    }\n\n    // cells\n\n    //    (this.bodyRow.children[this.bodyRow.children.length] as HTMLElement).style.width=\"100%\"\n    while (this.bodyBody.children.length - 1 > this.adapter.rowCount)\n      this.bodyBody.removeChild(this.bodyBody.children[this.bodyBody.children.length - 1])\n\n    for (let row = 0; row < this.adapter.rowCount; ++row) {\n\n      // FIXME: call createDOMBodyRow here\n\n      let bodyRow: HTMLTableRowElement\n      if (row + 1 >= this.bodyBody.children.length) {\n        bodyRow = <tr />\n        this.bodyBody.appendChild(bodyRow)\n      } else {\n        bodyRow = this.bodyBody.children[row + 1] as HTMLTableRowElement\n      }\n\n      while (bodyRow.children.length > this.adapter.colCount)\n        bodyRow.removeChild(bodyRow.children[bodyRow.children.length - 1])\n\n      for (let col = 0; col < this.adapter.colCount; ++col) {\n        let cell: HTMLTableDataCellElement\n        if (col >= bodyRow.children.length) {\n          cell = <td />\n          bodyRow.appendChild(cell)\n        } else {\n          cell = bodyRow.children[col] as HTMLTableDataCellElement\n        }\n        cell.style.width = \"\"\n        const content = this.adapter.getDisplayCell(col, row)\n        if (content) {\n          if (Array.isArray(content))\n            content.forEach( e => cell.appendChild(e))\n          else\n            cell.appendChild(content)\n        }\n      }\n\n      if (this.style.width === \"100%\") {\n        let lastCell = bodyRow.children[bodyRow.children.length - 1] as HTMLTableDataCellElement\n        lastCell.style.width = \"100%\"\n      }\n\n    }\n    //    dump(this.bodyBody)\n  }\n\n  createDOMRowHeaderRow(row: number) {\n    if (!this.model || !this.adapter)\n      throw Error()\n    const cell = this.adapter.getRowHead(row)\n    // TODO: we really should return undefined to avoid creating unused tags\n    if (cell === undefined)\n      return <tr />\n    return <tr><th>{cell}</th></tr>\n  }\n\n  createDOMBodyRow(row: number) {\n    if (!this.model || !this.adapter)\n      throw Error()\n\n    const result = <tr />\n    for (let col = 0; col < this.adapter.colCount; ++col) {\n      let cell: HTMLTableDataCellElement\n      if (col >= result.children.length) {\n        cell = <td />\n        result.appendChild(cell)\n      } else {\n        cell = result.children[col] as HTMLTableDataCellElement\n      }\n      cell.style.width = \"\"\n      const content = this.adapter.getDisplayCell(col, row)\n      if (content) {\n        if (Array.isArray(content))\n            content.forEach( e => cell.appendChild(e))\n          else\n            cell.appendChild(content)\n      }\n    }\n\n    if (this.style.width === \"100%\") {\n      let lastCell = result.children[result.children.length - 1] as HTMLTableDataCellElement\n      lastCell.style.width = \"100%\"\n    }\n\n    return result\n  }\n\n  protected createSelection() {\n    if (this.selectionModel === undefined)\n      return\n\n    switch (this.selectionModel.mode) {\n      case TableEditMode.EDIT_CELL:\n        this.log(Log.SELECTION, `TableView.createSelection(): mode=EDIT_CELL, selection=${this.selectionModel.col}, ${this.selectionModel.row}`)\n        this.prepareInputOverlayForPosition(new TablePos(this.selectionModel.col, this.selectionModel.row))\n        delete (this.rootDiv as any).tabIndex\n        break\n      case TableEditMode.SELECT_CELL: {\n        this.log(Log.SELECTION, `TableView.createSelection(): mode=SELECT_CELL, selection=${this.selectionModel.col}, ${this.selectionModel.row}`)\n        let allSelected = this.bodyBody.querySelectorAll(\"tbody > tr > td.selected\")\n        for (let selected of allSelected)\n          selected.classList.remove(\"selected\")\n        this.toggleCellSelection(this.selectionModel.value, true)\n        this.tabIndex = 0\n        break\n      }\n      case TableEditMode.SELECT_ROW: {\n        this.log(Log.SELECTION, `TableView.createSelection(): mode=SELECT_ROW, selection=${this.selectionModel.col}, ${this.selectionModel.row}`)\n        let allSelected = this.bodyBody.querySelectorAll(\"tbody > tr.selected\")\n        for (let selected of allSelected)\n          selected.classList.remove(\"selected\")\n        this.toggleRowSelection(this.selectionModel.value.row, true)\n        this.tabIndex = 0\n        break\n      }\n    }\n  }\n\n  adjustLayout(pos: TablePos | undefined) {\n    this.unadjustLayoutBeforeRender(pos)\n    setTimeout(() => {\n      this.adjustLayoutAfterRender()\n    }, 0)\n  }\n\n\n  // this causes the screen to flicker. there doesn't seem to be a way to take screenshots which\n  // can be used for double buffering. (html2canvas doesn't take a screenshot)\n  // two possible counter measures:\n  // * create an invisible copy of the dom and let the browser align it.\n  //   this might not scale with large tables\n  // * measure each cell individually before displaying them on the screen to obtain their measurements.\n  //   store the data for later use.\n  protected unadjustLayoutBeforeRender(pos: TablePos | undefined) {\n    if (pos === undefined) {\n      for(let column = 0; column<this.adapter!.colCount; ++column) {\n        this.unadjustLayoutColumnBeforeRender(column)\n      }\n    } else {\n      this.unadjustLayoutColumnBeforeRender(pos.col)\n    }\n    // FIXME: row height\n  }\n\n  protected unadjustLayoutColumnBeforeRender(column: number) {\n    const head = this.colHeadRow.children[column] as HTMLElement\n    const body = this.bodyRow.children[column] as HTMLElement\n    head.style.width = head.style.minWidth = head.style.maxWidth =\n      body.style.width = body.style.minWidth = body.style.maxWidth = \"\"\n    // FIXME: row height\n  }\n\n  protected adjustLayoutAfterRender() {\n    if (!this.model)\n      throw Error(\"TableView.adjustLayoutAfterRender(): no model\")\n    if (!this.adapter)\n      throw Error(\"TableView.adjustLayoutAfterRender(): no adapter\")\n\n    this.log(Log.LAYOUT, `TableView.adjustLayoutAfterRender()`)\n\n    const colHeadRow = this.colHeadRow.children\n    const rowHeadHead = this.rowHeadHead.children\n    const bodyRow = this.bodyRow.children\n\n    // set column widths\n    for (let col = 0; col < this.adapter.colCount; ++col) {\n      const columnHeader = colHeadRow[col] as HTMLElement\n      const columnBody = bodyRow[col] as HTMLElement\n\n      if (columnHeader.style.width === \"\") {\n        const headWidth = columnHeader.getBoundingClientRect().width - dom.horizontalPadding(columnHeader)\n        const bodyWidth = columnBody.getBoundingClientRect().width - dom.horizontalPadding(columnBody)\n        const width = Math.max(headWidth, bodyWidth)\n        columnHeader.style.width = columnHeader.style.minWidth = columnHeader.style.maxWidth = `${width}px`\n        columnBody.style.width = columnBody.style.minWidth = columnBody.style.maxWidth = `${width}px`\n      }\n    }\n\n    if (this.adapter.rowCount != this.bodyBody.children.length - 1) {\n      this.log(Log.LAYOUT, `adjustLayoutAfterRender(): bodyBody has ${this.bodyBody.children.length - 1} rows while model has ${this.adapter.rowCount} rows`)\n    }\n\n    // set row heights\n    for (let row = 0; row < this.bodyBody.children.length - 1; ++row) {\n      const rowHeader = rowHeadHead[row] as HTMLElement\n      const rowBody = this.bodyBody.children[row + 1] as HTMLElement\n\n      let headHeight = rowHeader.clientHeight - dom.verticalPadding(rowHeader)\n      let bodyHeight = rowBody.clientHeight - dom.verticalPadding(rowBody)\n\n      let height = Math.max(headHeight, bodyHeight)\n\n      // if (this.adapter?.isViewCompact()) {\n      //   height += 2\n      // }\n      // console.log(`TableView.adjustLayoutAfterRender(): row ${row}, headHeight=${headHeight}, bodyHeight=${bodyHeight}`)\n\n      rowHeader.style.height = rowHeader.style.minHeight = rowHeader.style.maxHeight =\n        rowBody.style.height = rowBody.style.minHeight = rowBody.style.maxHeight =\n        `${height}px`\n    }\n\n    function b2s(r: DOMRect): string {\n      return `${r.x}, ${r.y}, ${r.width}, ${r.height}`\n    }\n\n    // basic layout\n\n    const columnHeadBounds = this.colHeadDiv.getBoundingClientRect()\n    const rowHeadBounds = this.rowHeadDiv.getBoundingClientRect()\n    let scrollBounds = this.scrollDiv.getBoundingClientRect()\n    let cellsBounds = this.bodyTable.getBoundingClientRect()\n\n    const computedStyle = window.getComputedStyle(this)\n    const computedWidth = computedStyle.width\n    const computedHeight = computedStyle.height\n\n    // console.log(`column = ${b2s(columnHeadBounds)}`)\n    // console.log(`row    = ${b2s(rowHeadBounds)}`)\n    // console.log(`scroll  = ${b2s(scrollBounds)}`)\n    // console.log(`hosts computed size = ${computedWidth}, ${computedHeight}`)\n\n    //\n    // set TableView width and height\n    //\n    this.style.overflowX = \"\"\n    this.style.overflowY = \"\"\n\n    let enoughHorizontalSpace = false\n    let enoughVerticalSpace = false\n\n    // note: we can check if a style is set for TableView either directly or via a class by comparing\n    // computed(Height|Width) to \"0px\" as a result of having the shadowDom\n    if (computedWidth === \"0px\") {\n      this.log(Log.LAYOUT, `  TableView has no width specified`)\n      const parent = this.parentElement\n      if (parent) {\n        const requiredWidth = rowHeadBounds.width + cellsBounds.width\n        if (requiredWidth < parent.clientWidth) {\n          this.log(Log.LAYOUT, `    parent is wide enough for content, set TableView width to ${requiredWidth}px`)\n          this.style.width = requiredWidth + \"px\"\n          this.scrollDiv.style.overflowX = \"hidden\"\n          enoughHorizontalSpace = true\n        } else {\n          this.log(Log.LAYOUT, `    parent isn't wide enough for content, set TableView width to parent's width of ${parent.clientWidth - 2}px`)\n          // elements like <div> default to have the maximum width, use it\n          this.style.width = (parent.clientWidth - 2) + \"px\"\n        }\n      }\n    }\n    if (computedHeight === \"0px\") {\n      this.log(Log.LAYOUT, `  TableView has no height specified`)\n      const parent = this.parentElement\n      if (parent) {\n        let requiredHeight = columnHeadBounds.height + cellsBounds.height\n        // include the horizontal scrollbar in the calculation FIXME: also include the vertical one for the width\n        if (!enoughHorizontalSpace)\n          requiredHeight += 15 // FIXME: this is the scrollbar height on Safari as of time of writing\n\n        const maxHeight = window.innerHeight // FIXME: use maxSize: 100vh and then let it begin overridden?\n\n        if (requiredHeight < maxHeight) {\n          this.log(Log.LAYOUT, `    parent IS high enough for content, set TableView height to ${requiredHeight}px`)\n          this.style.height = requiredHeight + \"px\"\n          this.scrollDiv.style.overflowY = \"hidden\"\n          enoughVerticalSpace = true\n        } else {\n          // elements like <div> adjust to their children\n          // set height to required height but no higher than body as table has it's own scroll feature\n          this.log(Log.LAYOUT, `    parent is NOT high enough for content, default TableView height to ${maxHeight}px`)\n          this.style.height = maxHeight + \"px\"\n        }\n      }\n    }\n\n    let outerBounds = this.getBoundingClientRect()\n    const hostBounds = {\n      x: this.clientLeft + outerBounds.x,\n      y: this.clientTop + outerBounds.y,\n      width: this.clientWidth,\n      height: this.clientHeight\n    } as DOMRect\n\n    //\n    // adjust the bodyDiv to setup the scrollbars\n    //\n    this.log(Log.LAYOUT, `  adjust the bodyDiv to setup the scrollbars`)\n    if (enoughHorizontalSpace) {\n      this.log(Log.LAYOUT, `    table IS wide enough for content, do not set scrollDiv's width`)\n      this.scrollDiv.style.width = \"\"\n    } else {\n      this.log(Log.LAYOUT, `    table is NOT wide enough for content, set scroll width to ${hostBounds.width - rowHeadBounds.width}px`)\n      this.scrollDiv.style.width = (hostBounds.width - rowHeadBounds.width) + \"px\"\n    }\n    if (enoughVerticalSpace) {\n      this.log(Log.LAYOUT, `    table IS heigh enough for content, do not set scrollDiv's height`)\n      this.scrollDiv.style.height = \"\"\n    } else {\n      this.log(Log.LAYOUT, `    table is NOT high enough for content, set scroll height to ${hostBounds.height - columnHeadBounds.height}px`)\n      this.scrollDiv.style.height = (hostBounds.height - columnHeadBounds.height) + \"px\"\n    }\n\n    //\n    // figure out how much space the scrollbars take\n    //\n    this.log(Log.LAYOUT, `  figure out how much space the scrollbars take`)\n    scrollBounds = this.scrollDiv.getBoundingClientRect()\n    let verticalScrollbarWidth = enoughVerticalSpace ? 0 : scrollBounds.width - this.scrollDiv.clientWidth\n    let horizontalScrollbarHeight = enoughHorizontalSpace ? 0 : scrollBounds.height - this.scrollDiv.clientHeight\n    this.log(Log.LAYOUT, `    width ${verticalScrollbarWidth}, height ${horizontalScrollbarHeight}`)\n\n    // console.log(`host   = ${b2s(hostBounds)}`)\n    // console.log(`column = ${b2s(columnHeadBounds)}`)\n    // console.log(`row    = ${b2s(rowHeadBounds)}`)\n    // console.log(`scroll = ${b2s(scrollBounds)}`)\n    // console.log(`verticalScrollbarWidth=${verticalScrollbarWidth}, ${horizontalScrollbarHeight}`)\n    // console.log(`style          left=${this.style.left} right=${this.style.right} width=${this.style.width}`)\n    // console.log(`               top=${this.style.top} bottom=${this.style.bottom} height=${this.style.height}`)\n    // console.log(`computed style left=${computedStyle.left} right=${computedStyle.right} width=${computedStyle.width}`)\n    // console.log(`               top=${computedStyle.top} bottom=${computedStyle.bottom} height=${computedStyle.height}`)\n\n    this.scrollDiv.style.top = columnHeadBounds.height + \"px\"\n    this.scrollDiv.style.left = rowHeadBounds.width + \"px\"\n\n    this.colHeadDiv.style.top = \"0\"\n    this.colHeadDiv.style.left = (rowHeadBounds.width - 1) + \"px\"\n    this.log(Log.LAYOUT, `  set colHeadDiv = ${hostBounds.width} (host width) - ${rowHeadBounds.width} (rowHeadDiv width) - ${verticalScrollbarWidth} (vertical scrollbar width) = ${hostBounds.width - rowHeadBounds.width - verticalScrollbarWidth + 1}`)\n    this.colHeadDiv.style.width = (hostBounds.width - rowHeadBounds.width - verticalScrollbarWidth + 1) + \"px\"\n    // console.log(`set colHead width = ${hostBounds.width} - ${rowHeadBounds.width} - ${verticalScrollbarWidth} = ${hostBounds.width - rowHeadBounds.width - verticalScrollbarWidth} `)\n\n    this.rowHeadDiv.style.top = columnHeadBounds.height + \"px\"\n    this.rowHeadDiv.style.left = \"0\"\n    this.rowHeadDiv.style.height = (hostBounds.height - columnHeadBounds.height - horizontalScrollbarHeight) + \"px\"\n  }\n\n  protected prepareInputOverlayForCell(cell: HTMLTableDataCellElement | undefined) {\n    if (cell === undefined || cell.tagName !== \"TD\")\n      return\n    this.prepareInputOverlayForPosition(this.getCellPosition(cell))\n  }\n\n  prepareInputOverlayForPosition(pos: TablePos) {\n    if (!this.adapter)\n      return\n\n    let hadFocus = this.hasFocus()\n\n    this.log(Log.USER, `TableView.prepareInputOverlayForPosition(${pos.col}, ${pos.row})`)\n\n    this.setSelectionTo(pos)\n\n    let editView = this.adapter.getEditorCell(pos.col, pos.row) as View // as HTMLElement\n    this.log(Log.SELECTION, `prepareInputOverlayForPosition() got editView=${editView}`)\n    // FIXME: call this.inputOverlay.setChild(editView) to hide inputOverlay?\n    if (!editView) {\n      this.inputOverlay.setEditView(undefined)\n      return\n    }\n    this.editView = editView\n    editView.classList.add(\"embedded\")\n    editView.onkeydown = (event: KeyboardEvent) => {\n      this.onFieldViewKeyDown(event, pos)\n    }\n\n    this.inputOverlay.setEditView(editView)\n\n    const cell = this.getCellAt(pos.col, pos.row)\n    setTimeout(() => {\n      // console.log(`prepareInputOverlayForPosition: => this.inputOverlay.adjustToCell()`)\n      this.inputOverlay.adjustToCell(cell)\n      if (hadFocus)\n        this.focus()\n    }, 0)\n  }\n\n  setSelectionTo(pos: TablePos) {\n    if (!this.selectionModel)\n      return\n    switch (this.selectionModel.mode) {\n      case TableEditMode.EDIT_CELL:\n        this.selectionModel.value = pos\n        break\n      case TableEditMode.SELECT_CELL:\n        this.toggleCellSelection(this.selectionModel.value, false)\n        this.selectionModel.value = pos\n        this.toggleCellSelection(this.selectionModel.value, true)\n        return\n      case TableEditMode.SELECT_ROW:\n        this.toggleRowSelection(this.selectionModel!.value.row, false)\n        this.selectionModel.value.row = pos.row\n        this.toggleRowSelection(this.selectionModel!.value.row, true)\n        return\n    }\n  }\n\n  /*\n   * set focus\n   */\n  override focus() {\n    const { x, y } = { x: this.scrollDiv.scrollLeft, y: this.scrollDiv.scrollTop }\n    if (this.editView) {\n      this.editView.focus({ preventScroll: true })\n    } else {\n      super.focus({ preventScroll: true })\n    }\n    this.scrollDiv.scrollLeft = x\n    this.scrollDiv.scrollTop = y\n  }\n\n  hasFocus(): boolean {\n    return document.activeElement !== null && document.activeElement === this\n  }\n\n  /*\n   * Selection\n   */\n  protected toggleCellSelection(pos: TablePos, flag: boolean): void {\n    if (pos.col >= this.adapter!.colCount || pos.row >= this.adapter!.rowCount)\n      return\n    let element = this.bodyBody.children[pos.row + 1].children[pos.col]\n    element.classList.toggle(\"selected\", flag)\n    if (flag) {\n      // console.log(`toggleCellSelection() -> scrollIntoView()`)\n      scrollIntoView(element)\n    }\n  }\n\n  protected toggleRowSelection(row: number, flag: boolean): void {\n    if (row >= this.adapter!.rowCount)\n      return\n    let rowElement = this.bodyBody.children[1 + this.selectionModel!.value.row]\n    rowElement.classList.toggle(\"selected\", flag)\n    if (flag) {\n      // console.log(`toggleRowSelection() -> scrollIntoView()`)\n      scrollIntoView(rowElement)\n    }\n  }\n\n  /*\n   * Navigate Cells\n   */\n  goTo(column: number, row: number) {\n    this.insideGoTo = true\n    this.prepareInputOverlayForPosition(new TablePos(column, row))\n    this.focus()\n    // console.log(`TableView.goTo(${column}, ${row}) -> scrollIntoView()`)\n    scrollIntoView(this.getCellAt(column, row))\n    this.insideGoTo = false\n  }\n\n  goToCell(element: HTMLTableDataCellElement | undefined) {\n    if (!element)\n      return\n    this.insideGoTo = true\n    this.prepareInputOverlayForCell(element)\n    this.focus()\n    scrollIntoView(element)\n    this.insideGoTo = false\n  }\n\n  goToFirstCell() {\n    this.goTo(0, 0)\n  }\n\n  goToLastCell() {\n    if (this.adapter)\n      this.goTo(this.adapter.colCount - 1, this.adapter.rowCount - 1)\n  }\n\n  getCellAt(column: number, row: number): HTMLTableDataCellElement | undefined {\n    return this.bodyBody.children[row + 1].children[column] as HTMLTableDataCellElement\n  }\n\n  getCellPosition(element: HTMLElement): TablePos {\n    let col: number, row: number\n    for (col = 0; col < this.adapter!.colCount; ++col) {\n      if (element.parentElement!.children[col] === element)\n        break\n    }\n    for (row = 1; row < this.adapter!.rowCount + 1; ++row) {\n      if (element.parentElement!.parentElement!.children[row] === element.parentElement)\n        break\n    }\n    --row\n    return new TablePos(col, row)\n  }\n\n  /*\n   * Event Handler For Children\n   */\n\n  protected onRootDivKeyDown(event: KeyboardEvent) {\n    if (!this.selectionModel)\n      return\n    // FIXME: based on the selection model we could plug in a behaviour class\n    switch (this.selectionModel.mode) {\n      case TableEditMode.SELECT_ROW: {\n        let row = this.selectionModel.value.row\n        switch (event.key) {\n          case \"ArrowDown\":\n            if (row + 1 < this.adapter!.rowCount)\n              ++row\n            break\n          case \"ArrowUp\":\n            if (row > 0)\n              --row\n            break\n        }\n        if (row != this.selectionModel.value.row) {\n          this.toggleRowSelection(this.selectionModel.value.row, false)\n          this.selectionModel.row = row\n          this.toggleRowSelection(this.selectionModel.value.row, true)\n        }\n      } break\n      case TableEditMode.SELECT_CELL: {\n        let pos = { col: this.selectionModel.col, row: this.selectionModel.row }\n        switch (event.key) {\n          case \"ArrowRight\":\n            if (pos.col + 1 < this.adapter!.colCount) {\n              ++pos.col\n            }\n            break\n          case \"ArrowLeft\":\n            if (pos.col > 0) {\n              --pos.col\n            }\n            break\n          case \"ArrowDown\":\n            if (pos.row + 1 < this.adapter!.rowCount)\n              ++pos.row\n            break\n          case \"ArrowUp\":\n            if (pos.row > 0)\n              --pos.row\n            break\n        }\n        if (pos.col != this.selectionModel.col ||\n          pos.row != this.selectionModel.row) {\n          this.toggleCellSelection(this.selectionModel.value, false)\n          this.selectionModel.value = pos\n          this.toggleCellSelection(this.selectionModel.value, true)\n        }\n      } break\n    }\n  }\n\n  protected onFieldViewKeyDown(event: KeyboardEvent, pos: TablePos) {\n    switch (event.key) {\n      case \"ArrowDown\":\n        if (pos.row + 1 >= this.adapter!.rowCount)\n          break\n        event.preventDefault()\n        this.goTo(pos.col, pos.row + 1)\n        break\n      case \"ArrowUp\":\n        if (pos.row === 0)\n          break\n        event.preventDefault()\n        this.goTo(pos.col, pos.row - 1)\n        break\n      case \"Tab\":\n        if (event.shiftKey) {\n          if (pos.col > 0) {\n            event.preventDefault()\n            this.goTo(pos.col - 1, pos.row)\n          } else {\n            if (pos.row > 0) {\n              event.preventDefault()\n              this.goTo(this.adapter!.colCount - 1, pos.row - 1)\n            }\n          }\n        } else {\n          if (pos.col + 1 < this.adapter!.colCount) {\n            event.preventDefault()\n            this.goTo(pos.col + 1, pos.row)\n          } else {\n            if (pos.row + 1 < this.adapter!.rowCount) {\n              event.preventDefault()\n              this.goTo(0, pos.row + 1)\n            }\n          }\n        }\n        break\n    }\n  }\n\n  protected onFieldViewBlur(pos: TablePos) {\n    // refresh cell after loosing focus\n    const cell = this.getCellAt(pos.col, pos.row)\n    if (cell === undefined)\n      return\n\n    const content = this.adapter!.getDisplayCell(pos.col, pos.row)!\n\n    const tmp = document.createElement('div')\n    if (Array.isArray(content)) {\n      content.forEach( e => tmp.appendChild(e))\n    } else {\n      tmp.appendChild(content)\n    }\n\n    this.log(Log.USER, `TableView.onFieldViewBlur(${pos.col}, ${pos.row}): change \"${cell.innerHTML}\" to \"${tmp.innerHTML}\"`)\n\n    if (tmp.innerHTML == cell.innerHTML)\n      return\n\n    this.log(Log.USER, `TableView.onFieldViewBlur(${pos.col}, ${pos.row})\"): cell is now \"${cell.innerHTML}\"`)\n\n    while(cell.childNodes.length > 0)\n      cell.removeChild(cell.childNodes[cell.childNodes.length - 1])\n\n    this.log(Log.USER, `TableView.onFieldViewBlur(${pos.col}, ${pos.row})\"): cleared cell, it's now \"${cell.innerHTML}\"`)\n\n    if (Array.isArray(content))\n      content.forEach( e => cell.appendChild(e))\n    else\n      cell.appendChild(content)\n\n    this.log(Log.USER, `TableView.onFieldViewBlur(${pos.col}, ${pos.row})\"): cell is now \"${cell.innerHTML}\"`)\n\n    this.unadjustLayoutBeforeRender(pos)\n    setTimeout(() => {\n      this.adjustLayoutAfterRender()\n    }, 0)\n  }\n\n  /*\n   * Window Resize Event Handler\n   */\n\n  private resizeEventListener?: EventListener\n\n  override connectedCallback() {\n    super.connectedCallback()\n    this.resizeEventListener = () => {\n      try {\n        this.adjustLayoutAfterRender()\n      }\n      catch (e) {\n        console.log(\"resizeEventListener caught exception in adjustLayoutAfterRender()\")\n        throw e\n      }\n    }\n    window.addEventListener(\"resize\", this.resizeEventListener)\n\n    if (this.selectionModel === undefined) {\n      this.selectionModel = new SelectionModel()\n      this.selectionModel.modified.add(() => {\n        this.createSelection()\n      }, this)\n    }\n  }\n\n  override disconnectedCallback() {\n    window.removeEventListener(\"resize\", this.resizeEventListener!)\n  }\n}\n\nwindow.customElements.define(\"toad-table\", TableView)\n\n\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TableEvent } from \"../TableEvent\"\nimport { AnimationBase } from '@toad/util/animation'\nimport { TableView } from '../TableView'\n\n// TODO: fix animation at last row (i might've seen a disabled test for this)\nexport class InsertRowAnimation extends AnimationBase {\n  table: TableView\n  event: TableEvent\n  rowAnimationHeight = 0;\n  trHead: Array<HTMLTableRowElement> = [];\n  trBody: Array<HTMLTableRowElement> = [];\n  trAnimationHead!: HTMLTableRowElement\n  trAnimationBody!: HTMLTableRowElement\n\n  constructor(table: TableView, event: TableEvent) {\n    super()\n    this.table = table\n    this.event = event\n  }\n\n  override prepare() {\n    // create new rows and add them to the hiddenSizeCheckTable for measuring\n    for (let i = 0; i < this.event.size; ++i) {\n      const trH = this.table.createDOMRowHeaderRow(this.event.index)\n      this.table.hiddenSizeCheckRowHead.appendChild(trH)\n      this.trHead.push(trH)\n\n      const trB = this.table.createDOMBodyRow(this.event.index + i)\n      this.table.hiddenSizeCheckBody.appendChild(trB)\n      this.trBody.push(trB)\n    }\n\n    // insert temporary rows used for animation\n    const img = `url(\\\"data:image/svg+xml;utf8,<svg width='3' height='3' xmlns='http://www.w3.org/2000/svg'><line shape-rendering='crispEdges' x1='-1' y1='-1' x2='5' y2='5' stroke='%23888' /></svg>\\\")`\n\n    this.trAnimationHead = <tr style={{ height: '0px', background: img }}><th style={{padding: \"0\"}}/></tr>\n    this.table.rowHeadHead.insertBefore(this.trAnimationHead, this.table.rowHeadHead.children[this.event.index])\n    this.trAnimationBody = <tr style={{ height: '0px', background: img }}></tr>\n    for(let i=0; i<this.table.adapter!.colCount; ++i) {\n      this.trAnimationBody.appendChild(<td style={{padding: \"0\"}}/>)\n      this.trAnimationBody.style.background = img\n    }\n    this.table.bodyBody.insertBefore(this.trAnimationBody, this.table.bodyBody.children[this.event.index + 1])\n  }\n\n  override firstFrame() {\n    this.table.rowAnimationHeight = this.rowAnimationHeight = Math.max(\n      this.table.hiddenSizeCheckBody.clientHeight,\n      this.table.hiddenSizeCheckRowHead.clientHeight\n    )\n  }\n\n  override animationFrame(animationTime: number) {\n    const rowHeight = `${Math.round(animationTime * this.rowAnimationHeight)}px`\n    this.trAnimationHead.style.height = this.trAnimationBody.style.height = rowHeight\n    // FIXME: the following code needs a test\n    if (this.table.selectionModel !== undefined && this.table.selectionModel.row < this.event.index) {\n      const cell = this.table.getCellAt(this.table.selectionModel.value.col, this.table.selectionModel.value.row)\n      this.table.inputOverlay.adjustToCell(cell)\n    }\n  }\n\n  override lastFrame() {\n    for (let i = 0; i < this.event.size; ++i) {\n      const rowHeight = `${Math.max(this.trHead[i].clientHeight, this.trBody[i].clientHeight)}px`\n      const bodyStyle = this.trHead[i].style\n      bodyStyle.height = bodyStyle.minHeight = bodyStyle.maxHeight = rowHeight\n      const headStyle = this.trHead[i].style\n      headStyle.height = headStyle.minHeight = headStyle.maxHeight = rowHeight\n    }\n    this.table.rowHeadHead.replaceChild(this.trHead[0], this.trAnimationHead)\n    this.table.bodyBody.replaceChild(this.trBody[0], this.trAnimationBody)\n    for (let i = 1; i < this.event.size; ++i) {\n      this.table.rowHeadHead.insertBefore(this.trHead[i], this.trHead[i - 1].nextSibling)\n      this.table.bodyBody.insertBefore(this.trBody[i], this.trBody[i - 1].nextSibling)\n    }\n\n    if (this.table.selectionModel !== undefined && this.table.selectionModel.row >= this.event.index) {\n      this.table.selectionModel.row += this.event.size\n    }\n\n    if (this.table.editView && this.table.selectionModel !== undefined && this.table.selectionModel.row < this.event.index) {\n      const cell = this.table.getCellAt(this.table.selectionModel.value.col, this.table.selectionModel.value.row)\n      // console.log(`updateViewAfterInsertRow: => this.inputOverlay.adjustToCell()`)\n      this.table.inputOverlay.adjustToCell(cell)\n    }\n    // FIXME: only one row\n    // this.table.adjustLayout({col: 0, row: this.event.index})\n    this.table.adjustLayout(undefined) // all columns\n    // setTimeout( () => {\n    //   let actualHeight = 0\n    //   for(let i=0; i<this.event.size; ++i) {\n    //     actualHeight += this.table.bodyBody.children[i+1].clientHeight\n    //   }\n    //   if (actualHeight != this.rowAnimationHeight) {\n    //     console.log(`InsertRowAnimation.lastFrame(): calculated height was ${this.rowAnimationHeight} but actually it's ${actualHeight}`)\n    //   }\n    // }, 0)\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TableEventType } from './TableEventType'\n\n// TODO: rename into TableModelEvent ???\n\nexport class TableEvent {\n    type: TableEventType\n    index: number\n    size: number\n    constructor(type: TableEventType, index: number, size: number) {\n        this.type = type\n        this.index = index\n        this.size = size\n    }\n\n    get col() {\n        return this.index\n    }\n\n    get row() {\n        return this.size\n    }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TableEvent } from \"./TableEvent\"\nimport { TableEventType } from \"./TableEventType\"\nimport { TypedTableModel } from \"./TypedTableModel\"\n\nexport abstract class ArrayTableModel<T> extends TypedTableModel<T> {\n\n  data: Array<T>\n\n  constructor(data: Array<T>, rowClass: new () => T) {\n    super(rowClass)\n    this.data = data\n  }\n\n  // get colCount(): number { return this.data ? this.data[0].length : 0 }\n  get rowCount(): number { return this.data ? this.data.length : 0 }\n\n  createRow(): T { return new this.nodeClass() }\n\n  insert(row: number, rowData?: T | Array<T>): number {\n    // console.log(`add row above ${row}`)\n    if (row > this.rowCount) {\n      throw Error(`ArrayTableModel.insert(${row}) is out of range, model size is ${this.colCount}, ${this.rowCount}`)\n    }\n\n    if (rowData === undefined)\n      rowData = this.createRow()\n    let rowArray\n    if (rowData instanceof Array)\n      rowArray = rowData\n    else\n      rowArray = [rowData]\n    this.data.splice(row, 0, ...rowArray)\n    this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row, rowArray.length))\n    return row\n  }\n\n  remove(row: number, count: number = 1): number {\n    if (row >= this.rowCount || row+count > this.rowCount) {\n      throw Error(`ArrayTableModel.remove(${row}, ${count}) is out of range, model size is ${this.colCount}, ${this.rowCount}`)\n    }\n    // console.log(`delete row ${row}`)\n    this.data.splice(row, count)\n    this.modified.trigger(new TableEvent(TableEventType.REMOVE_ROW, row, count))\n    return row\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"../model/Model\"\nimport { View } from \"../view/View\"\nimport { GenericTool } from \"../view/GenericTool\"\nimport { textAreaStyle } from \"../view/textAreaStyle\"\n\nimport { TableView } from \"./TableView\"\nimport { ArrayTableModel } from \"./ArrayTableModel\"\n\n// TODO: we should be able to reduce the amount of code by adding some helper functions\n\nexport class TableTool extends GenericTool<Model> {\n    toolbar: HTMLDivElement\n    buttonAddRowAbove: HTMLElement\n    buttonAddRowBelow: HTMLElement\n    buttonDeleteRow: HTMLElement\n\n    buttonAddColumnLeft: HTMLElement\n    buttonAddColumnRight: HTMLElement\n    buttonDeleteColumn: HTMLElement\n\n    buttonAddNodeAbove: HTMLElement\n    buttonAddNodeBelow: HTMLElement\n    buttonAddNodeParent: HTMLElement\n    buttonAddNodeChild: HTMLElement\n    buttonDeleteNode: HTMLElement\n\n    lastActiveTable: TableView | undefined\n\n    constructor() {\n        super()\n\n        this.toolbar = <div class=\"toolbar\"/>\n\n        this.buttonAddRowAbove = <button class=\"left\" title=\"add row above\">\n            <svg style={{ display: \"block\" }} viewBox=\"0 0 13 13\" width=\"13\" height=\"13\">\n                <rect x=\"0.5\" y=\"0.5\" width=\"12\" height=\"12\" class=\"strokeFill\" />\n                <line x1=\"0.5\" y1=\"8.5\" x2=\"12.5\" y2=\"8.5\" class=\"stroke\" />\n                <line x1=\"4.5\" y1=\"8.5\" x2=\"4.5\" y2=\"13.5\" class=\"stroke\" />\n                <line x1=\"8.5\" y1=\"8.5\" x2=\"8.5\" y2=\"13.5\" class=\"stroke\" />\n                <line x1=\"6.5\" y1=\"2\" x2=\"6.5\" y2=\"7\" class=\"stroke\" />\n                <line x1=\"4\" y1=\"4.5\" x2=\"9\" y2=\"4.5\" class=\"stroke\" />\n            </svg>\n        </button>\n        this.buttonAddRowAbove.onclick = () => {\n            this.lastActiveTable?.focus()\n            const model = this.lastActiveTable?.model\n            const selection = this.lastActiveTable?.selectionModel\n            if (selection && model && model instanceof ArrayTableModel) {\n                model.insert(selection.row)\n            }\n        }\n        this.toolbar.appendChild(this.buttonAddRowAbove)\n\n        this.buttonAddRowBelow = <button title=\"add row below\">\n            <svg viewBox=\"0 0 13 13\" width=\"13\" height=\"13\">\n                <rect x=\"0.5\" y=\"0.5\" width=\"12\" height=\"12\" class=\"strokeFill\" />\n                <line x1=\"0.5\" y1=\"4.5\" x2=\"12.5\" y2=\"4.5\" class=\"stroke\" />\n                <line x1=\"4.5\" y1=\"0.5\" x2=\"4.5\" y2=\"4.5\" class=\"stroke\" />\n                <line x1=\"8.5\" y1=\"0.5\" x2=\"8.5\" y2=\"4.5\" class=\"stroke\" />\n                <line x1=\"6.5\" y1=\"6\" x2=\"6.5\" y2=\"11\" class=\"stroke\" />\n                <line x1=\"4\" y1=\"8.5\" x2=\"9\" y2=\"8.5\" class=\"stroke\" />\n            </svg>\n        </button>\n        this.buttonAddRowBelow.onclick = () => {\n            this.lastActiveTable?.focus()\n            const model = this.lastActiveTable?.model\n            const selection = this.lastActiveTable?.selectionModel\n            if (selection && model && model instanceof ArrayTableModel) {\n                model.insert(selection.row+1)\n            }\n        }\n        this.toolbar.appendChild(this.buttonAddRowBelow)\n\n        this.buttonDeleteRow = <button class=\"right\" title=\"delete row\">\n            <svg viewBox=\"0 0 13 13\" width=\"13\" height=\"13\">\n                <rect x=\"0.5\" y=\"0.5\" width=\"12\" height=\"12\" class=\"strokeFill\" />\n                <line x1=\"0.5\" y1=\"4.5\" x2=\"12.5\" y2=\"4.5\" class=\"stroke\" />\n                <line x1=\"0.5\" y1=\"8.5\" x2=\"12.5\" y2=\"8.5\" class=\"stroke\" />\n                <line x1=\"5.5\" y1=\"3.5\" x2=\"11.5\" y2=\"9.5\" class=\"stroke\" stroke-width=\"1.5\" />\n                <line x1=\"11.5\" y1=\"3.5\" x2=\"5.5\" y2=\"9.5\" class=\"stroke\" stroke-width=\"1.5\" />\n            </svg>\n        </button>\n        this.buttonDeleteRow.onclick = () => {\n            this.lastActiveTable?.focus()\n            const model = this.lastActiveTable?.model\n            const selection = this.lastActiveTable?.selectionModel\n            if (selection && model && model instanceof ArrayTableModel) {\n                model.remove(selection.row)\n            }\n        }\n        this.toolbar.appendChild(this.buttonDeleteRow)\n\n        this.toolbar.appendChild(document.createTextNode(\" \"))\n\n        this.buttonAddColumnLeft = <button class=\"left\" title=\"add column left\">\n            <svg viewBox=\"0 0 13 13\" width=\"13\" height=\"13\">\n                <rect x=\"0.5\" y=\"0.5\" width=\"12\" height=\"12\" class=\"strokeFill\" />\n                <line x1=\"8.5\" y1=\"0.5\" x2=\"8.5\" y2=\"12.5\" class=\"stroke\" />\n                <line x1=\"8.5\" y1=\"4.5\" x2=\"12.5\" y2=\"4.5\" class=\"stroke\" />\n                <line x1=\"8.5\" y1=\"8.5\" x2=\"12.5\" y2=\"8.5\" class=\"stroke\" />\n                <line x1=\"2\" y1=\"6.5\" x2=\"7\" y2=\"6.5\" class=\"stroke\" />\n                <line x1=\"4.5\" y1=\"4\" x2=\"4.5\" y2=\"9\" class=\"stroke\" />\n            </svg>\n        </button>\n        this.toolbar.appendChild(this.buttonAddColumnLeft)\n\n        this.buttonAddColumnRight = <button title=\"add column right\">\n            <svg viewBox=\"0 0 13 13\" width=\"13\" height=\"13\">\n                <rect x=\"0.5\" y=\"0.5\" width=\"12\" height=\"12\" class=\"strokeFill\" />\n                <line x1=\"4.5\" y1=\"0.5\" x2=\"4.5\" y2=\"12.5\" class=\"stroke\" />\n                <line x1=\"0.5\" y1=\"4.5\" x2=\"4.5\" y2=\"4.5\" class=\"stroke\" />\n                <line x1=\"0.5\" y1=\"8.5\" x2=\"4.5\" y2=\"8.5\" class=\"stroke\" />\n                <line x1=\"6\" y1=\"6.5\" x2=\"11\" y2=\"6.5\" class=\"stroke\" />\n                <line x1=\"8.5\" y1=\"4\" x2=\"8.5\" y2=\"9\" class=\"stroke\" />\n            </svg>\n        </button>\n        // this.buttonAddColumnRight.onclick = (event) => {\n        //     document.execCommand(\"insertUnorderedList\", false)\n        //     this.update()\n        // }\n        this.toolbar.appendChild(this.buttonAddColumnRight)\n\n        this.buttonDeleteColumn = <button class=\"right\" title=\"delete column\">\n            <svg viewBox=\"0 0 13 13\" width=\"13\" height=\"13\">\n                <rect x=\"0.5\" y=\"0.5\" width=\"12\" height=\"12\" class=\"strokeFill\" />\n                <line x1=\"4.5\" y1=\"0.5\" x2=\"4.5\" y2=\"12.5\" class=\"stroke\" />\n                <line x1=\"8.5\" y1=\"0.5\" x2=\"8.5\" y2=\"12.5\" class=\"stroke\" />\n                <line x1=\"3.5\" y1=\"5.5\" x2=\"9.5\" y2=\"11.5\" class=\"stroke\" stroke-width=\"1.5\" />\n                <line x1=\"3.5\" y1=\"11.5\" x2=\"9.5\" y2=\"5.5\" class=\"stroke\" stroke-width=\"1.5\" />\n            </svg>\n        </button>\n        // this.buttonDeleteColumn.onclick = () => {\n        //     document.execCommand(\"insertOrderedList\", false)\n        //     this.update()\n        // }\n        this.toolbar.appendChild(this.buttonDeleteColumn)\n\n        this.toolbar.appendChild(document.createTextNode(\" \"))\n\n        this.buttonAddNodeAbove = <button class=\"left\" title=\"add node above\">\n            <svg style={{ display: \"block\", border: \"none\" }} viewBox=\"0 0 8 17\" width=\"8\" height=\"17\">\n                <rect x=\"0.5\" y=\"1.5\" width=\"6\" height=\"6\" class=\"strokeFill\" />\n                <rect x=\"0.5\" y=\"9.5\" width=\"6\" height=\"6\" class=\"fill\" />\n                <line x1=\"3.5\" y1=\"3\" x2=\"3.5\" y2=\"6\" class=\"stroke\" />\n                <line x1=\"2\" y1=\"4.5\" x2=\"5\" y2=\"4.5\" class=\"stroke\" />\n                <line x1=\"3.5\" y1=\"0\" x2=\"3.5\" y2=\"1\" class=\"stroke\" />\n                <line x1=\"3.5\" y1=\"8\" x2=\"3.5\" y2=\"17\" class=\"stroke\" />\n            </svg>\n        </button>\n        // this.buttonAddNodeAbove.onclick = () => {\n        //     document.execCommand(\"bold\", false)\n        //     this.update()\n        // }\n        this.toolbar.appendChild(this.buttonAddNodeAbove)\n\n        this.buttonAddNodeBelow = <button title=\"add node below\">\n            <svg style={{ display: \"block\", border: \"none\" }} viewBox=\"0 0 8 17\" width=\"8\" height=\"17\">\n                <rect x=\"0.5\" y=\"1.5\" width=\"6\" height=\"6\" class=\"fill\" />\n                <rect x=\"0.5\" y=\"9.5\" width=\"6\" height=\"6\" class=\"strokeFill\" />\n                <line x1=\"3.5\" y1=\"11\" x2=\"3.5\" y2=\"14\" class=\"stroke\" />\n                <line x1=\"2\" y1=\"12.5\" x2=\"5\" y2=\"12.5\" class=\"stroke\" />\n                <line x1=\"3.5\" y1=\"0\" x2=\"3.5\" y2=\"9\" class=\"stroke\" />\n                <line x1=\"3.5\" y1=\"16\" x2=\"3.5\" y2=\"17\" class=\"stroke\" />\n            </svg>\n        </button>\n        // this.buttonAddNodeBelow.onclick = () => {\n        //     document.execCommand(\"italic\", false)\n        //     this.update()\n        // }\n        this.toolbar.appendChild(this.buttonAddNodeBelow)\n\n        this.buttonAddNodeParent = <button title=\"add node parent\">\n            <svg viewBox=\"0 0 13 17\" width=\"13\" height=\"17\">\n                <rect x=\"0.5\" y=\"1.5\" width=\"6\" height=\"6\" class=\"strokeFill\" />\n                <rect x=\"6.5\" y=\"9.5\" width=\"6\" height=\"6\" class=\"fill\" />\n                <line x1=\"7\" y1=\"4.5\" x2=\"10\" y2=\"4.5\" class=\"stroke\" />\n                <line x1=\"9.5\" y1=\"4\" x2=\"9.5\" y2=\"9\" class=\"stroke\" />\n                <line x1=\"3.5\" y1=\"3\" x2=\"3.5\" y2=\"6\" class=\"stroke\" />\n                <line x1=\"2\" y1=\"4.5\" x2=\"5\" y2=\"4.5\" class=\"stroke\" />\n                <line x1=\"3.5\" y1=\"0\" x2=\"3.5\" y2=\"1\" class=\"stroke\" />\n                <line x1=\"3.5\" y1=\"8\" x2=\"3.5\" y2=\"17\" class=\"stroke\" />\n            </svg>\n        </button>\n        this.buttonAddNodeParent.onclick = () => {\n            // document.execCommand(\"underline\", false)\n            // this.update()\n        }\n        this.toolbar.appendChild(this.buttonAddNodeParent)\n\n        this.buttonAddNodeChild = <button title=\"add node child\">\n            <svg viewBox=\"0 0 13 17\" width=\"13\" height=\"17\">\n                <rect x=\"0.5\" y=\"1.5\" width=\"6\" height=\"6\" class=\"fill\" />\n                <rect x=\"6.5\" y=\"9.5\" width=\"6\" height=\"6\" class=\"strokeFill\" />\n                <line x1=\"7\" y1=\"4.5\" x2=\"10\" y2=\"4.5\" class=\"stroke\" />\n                <line x1=\"9.5\" y1=\"4\" x2=\"9.5\" y2=\"9\" class=\"stroke\" />\n                <line x1=\"9.5\" y1=\"11\" x2=\"9.5\" y2=\"14\" class=\"stroke\" />\n                <line x1=\"8\" y1=\"12.5\" x2=\"11\" y2=\"12.5\" class=\"stroke\" />\n                <line x1=\"3.5\" y1=\"0\" x2=\"3.5\" y2=\"17\" class=\"stroke\" />\n            </svg>\n        </button>\n        // this.buttonAddNodeChild.onclick = () => {\n        //     document.execCommand(\"strikeThrough\", false)\n        //     this.update()\n        // }\n        this.toolbar.appendChild(this.buttonAddNodeChild)\n\n        this.buttonDeleteNode = <button class=\"right\" title=\"delete node\">\n            <svg viewBox=\"0 0 10 17\" width=\"10\" height=\"17\">\n                <rect x=\"1.5\" y=\"5.5\" width=\"6\" height=\"6\" class=\"strokeFill\" />\n                <line x1=\"4.5\" y1=\"2\" x2=\"4.5\" y2=\"5\" class=\"stroke\" />\n                <line x1=\"4.5\" y1=\"12\" x2=\"4.5\" y2=\"15\" class=\"stroke\" />\n                <line x1=\"0.5\" y1=\"4.5\" x2=\"8.5\" y2=\"12.5\" class=\"stroke\" stroke-width=\"1.5\" />\n                <line x1=\"8.5\" y1=\"4.5\" x2=\"0.5\" y2=\"12.5\" class=\"stroke\" stroke-width=\"1.5\" />\n            </svg>\n        </button>\n        // this.buttonDeleteNode.onclick = () => {\n        //     document.execCommand(\"subscript\", false)\n        //     this.update()\n        // }\n        this.toolbar.appendChild(this.buttonDeleteNode)\n\n        this.attachShadow({ mode: 'open' })\n        this.shadowRoot!.appendChild(document.importNode(textAreaStyle, true))\n        this.shadowRoot!.appendChild(this.toolbar)\n    }\n\n    canHandle(view: View): boolean {\n        return view instanceof TableView\n    }\n    activate(): void {\n        this.lastActiveTable = GenericTool.activeView as TableView\n        this.toolbar.classList.add(\"active\")\n    }\n    deactivate(): void {\n        this.lastActiveTable = undefined\n        this.toolbar.classList.remove(\"active\")\n    }\n\n    // update() {\n    //     this.buttonAddRowAbove.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h1\")\n    //     this.buttonAddRowBelow.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h2\")\n    //     this.buttonDeleteRow.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h3\")\n    //     this.buttonAddColumnLeft.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h4\")\n\n    //     this.buttonAddNodeAbove.classList.toggle(\"active\", document.queryCommandState(\"bold\"))\n    //     this.buttonAddNodeBelow.classList.toggle(\"active\", document.queryCommandState(\"italic\"))\n    //     this.buttonAddNodeParent.classList.toggle(\"active\", document.queryCommandState(\"underline\"))\n    //     this.buttonAddNodeChild.classList.toggle(\"active\", document.queryCommandState(\"strikeThrough\"))\n    //     this.buttonDeleteNode.classList.toggle(\"active\", document.queryCommandState(\"subscript\"))\n    //     this.buttonSuperscript.classList.toggle(\"active\", document.queryCommandState(\"superscript\"))\n\n    //     this.buttonJustifyLeft.classList.toggle(\"active\", document.queryCommandState(\"justifyLeft\"))\n    //     this.buttonJustifyCenter.classList.toggle(\"active\", document.queryCommandState(\"justifyCenter\"))\n    //     this.buttonJustifyRight.classList.toggle(\"active\", document.queryCommandState(\"justifyRight\"))\n    //     //        this.buttonJustifyFull.classList.toggle(\"active\", document.queryCommandState(\"justifyFull\"))\n    // }\n}\nwindow.customElements.define(\"toad-tabletool\", TableTool)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TableAdapter } from './TableAdapter'\nimport { TypedTableModel } from './TypedTableModel'\n\nabstract class AbstractTypedTableAdapter<T, M extends TypedTableModel<T>> extends TableAdapter<M> {}\nexport type InferTypedTableModelParameter<M> = M extends TypedTableModel<infer T> ? T : never\nexport class TypedTableAdapter<M extends TypedTableModel<any>> extends AbstractTypedTableAdapter<InferTypedTableModelParameter<M>, M> {}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TypedTableModel } from \"./TypedTableModel\"\nimport { TableEvent } from \"./TableEvent\"\nimport { TableEventType } from \"./TableEventType\"\n\nexport class RowInfo<T> {\n    node: T\n    open: boolean\n    depth: number\n    constructor(node: T, depth: number, open = true) {\n        this.node = node\n        this.depth = depth\n        this.open = open\n    }\n}\n\nexport abstract class TreeModel<T> extends TypedTableModel<T> {\n\n    rows: Array<RowInfo<T>>\n\n    constructor(nodeClass: new () => T, root?: T) {\n        super(nodeClass)\n        this.rows = new Array<RowInfo<T>>()\n        if (root !== undefined) {\n            this.createRowInfoHelper(this.rows, root, 0)\n        }\n    }\n\n    override get colCount(): number { return 1 }\n    override get rowCount(): number { return this.rows.length }\n\n    getRow(node: T): number | undefined {\n        for (let i = 0; i < this.rows.length; ++i) {\n            if (this.rows[i].node === node) {\n                return i\n            }\n        }\n        return undefined\n    }\n\n    addSiblingBefore(row: number): number {\n        const nn = this.createNode()\n        if (this.rows.length === 0) { // TODO: can we remove this?\n            row = 0\n            this.setRoot(nn)\n            this.rows.push(new RowInfo(nn, 0))\n        } else {\n            if (row === 0) {\n                this.setNext(nn, this.getRoot())\n                this.setRoot(nn)\n                this.rows.unshift(new RowInfo(nn, 0))\n            } else {\n                this.setNext(nn, this.rows[row].node)\n                if (this.getNext(this.rows[row - 1].node) === this.rows[row].node)\n                    this.setNext(this.rows[row - 1].node, nn)\n\n                else\n                    this.setDown(this.rows[row - 1].node, nn)\n                this.rows.splice(row, 0, new RowInfo(nn, this.rows[row].depth))\n            }\n        }\n        this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row, 1))\n        return row\n    }\n\n    addSiblingAfter(row: number): number {\n        const nn = this.createNode()\n        if (this.rows.length === 0) {\n            row = 0\n            this.setRoot(nn)\n            this.rows.push(new RowInfo(nn, 0))\n        } else {\n            this.setNext(nn, this.getNext(this.rows[row].node))\n            this.setNext(this.rows[row].node, nn)\n\n            const count = this.nodeCount(this.getDown(this.rows[row].node))\n            // console.log(`addSiblingAfter: subtree has ${count} nodes`)\n            const depth = this.rows[row].depth\n            row += count + 1\n            this.rows.splice(row, 0, new RowInfo(nn, depth))\n        }\n        this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row, 1))\n        return row\n    }\n\n    addChildAfter(row: number): number {\n        const nn = this.createNode()\n        if (this.rows.length === 0) {\n            this.setRoot(nn)\n            this.rows.push(new RowInfo(nn, 0))\n            this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, 0, 1))\n        } else {\n            const down = this.getDown(this.rows[row].node)\n\n            const subtreeSize = this.nodeCount(down)\n            // console.log(`subtreeSize = ${subtreeSize}`)\n            for (let i = 0; i < subtreeSize; ++i)\n                ++this.rows[row + 1 + i].depth\n\n            this.setDown(nn, down)\n            this.setDown(this.rows[row].node, nn)\n\n            this.rows.splice(row + 1, 0, new RowInfo(nn, this.rows[row].depth + 1))\n            this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row + 1, 1))\n        }\n        return row\n    }\n\n    addParentBefore(row: number): number {\n        const nn = this.createNode()\n        if (row === 0) {\n            for (let i = 0; i < this.rows.length; ++i)\n                ++this.rows[row + i].depth\n            this.setDown(nn, this.getRoot())\n            this.setRoot(nn)\n            this.rows.unshift(new RowInfo(nn, 0))\n        } else {\n            const depth = this.rows[row].depth\n            const subtreeSize = this.nodeCount(this.getDown(this.rows[row].node)) + 1\n            // console.log(`row = ${row}, this.rows.length=${this.rows.length}, subtreeSize = ${subtreeSize}`)\n            for (let i = 0; i < subtreeSize; ++i)\n                ++this.rows[row + i].depth\n\n            this.setDown(nn, this.rows[row].node)\n            this.setNext(nn, this.getNext(this.rows[row].node))\n\n            this.setNext(this.rows[row].node, undefined)\n            if (this.getNext(this.rows[row - 1].node) === this.rows[row].node)\n                this.setNext(this.rows[row - 1].node, nn)\n\n            else\n                this.setDown(this.rows[row - 1].node, nn)\n            this.rows.splice(row, 0, new RowInfo(nn, depth))\n        }\n        this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row, 1))\n        return row\n    }\n\n    deleteAt(row: number): number {\n        let down = this.getDown(this.rows[row].node)\n        if (down !== undefined) {\n            // move child to current position\n            const subtreeSize = this.nodeCount(down) + 1\n            // console.log(`row = ${row}, this.rows.length=${this.rows.length}, subtreeSize = ${subtreeSize}`)\n            for (let i = 0; i < subtreeSize; ++i)\n                --this.rows[row + i].depth\n\n            this.append(down, this.getNext(this.rows[row].node))\n            this.setNext(this.rows[row].node, undefined)\n            if (row === 0) {\n                this.setRoot(down)\n            } else {\n                this.setNext(this.rows[row - 1].node, down)\n            }\n        } else {\n            // move sibling to current position\n            if (row === 0) {\n                const next = this.getNext(this.rows[row].node)\n                this.setNext(this.rows[row].node, undefined)\n                this.setRoot(next)\n            } else {\n                const next = this.getNext(this.rows[row].node)\n                this.setNext(this.rows[row].node, undefined)\n\n                // this.setDown(this.rows[row-1].node, next)\n                if (this.getNext(this.rows[row - 1].node) === this.rows[row].node)\n                    this.setNext(this.rows[row - 1].node, next)\n\n                else\n                    this.setDown(this.rows[row - 1].node, next)\n            }\n        }\n        this.rows.splice(row, 1)\n        this.modified.trigger(new TableEvent(TableEventType.REMOVE_ROW, row, 1))\n        return row\n    }\n\n    // initialize rows from an existing structure\n    init() {}\n\n    toggleAt(row: number) {\n        if (this.rows[row].open) {\n            this.closeAt(row)\n        } else {\n            this.openAt(row)\n        }\n    }\n\n    isOpen(row: number) {\n        return this.rows[row].open\n    }\n\n    openAt(row: number) {\n        let r = this.rows[row]\n        if (r.open || this.getDown(r.node) === undefined)\n            return\n        r.open = true\n        const newRows = this.createRowInfo(row)\n        this.rows.splice(row + 1, 0, ...newRows)\n        this.modified.trigger(new TableEvent(TableEventType.INSERT_ROW, row+1, newRows.length))\n        // console.log(`TreeModel.openAt(${row})`)\n    }\n\n    closeAt(row: number) {\n        let r = this.rows[row]\n        if (!r.open || this.getDown(r.node) === undefined)\n            return\n        // console.log(`TreeModel.closeAt(${row})`)\n        const count = this.getVisibleChildCount(row)\n        r.open = false\n        this.rows.splice(row+1, count)\n        this.modified.trigger(new TableEvent(TableEventType.REMOVE_ROW, row+1, count))\n    }\n\n    createRowInfo(row: number) {\n        const newRows = new Array<RowInfo<T>>()\n        // this.rows.splice(row, 0, new TreeModelRow(nn, depth))\n\n        let r = this.rows[row]\n        if (r.open && this.getDown(r.node)) {\n            this.createRowInfoHelper(newRows, this.getDown(r.node)!, r.depth + 1)\n        }\n\n        return newRows\n    }\n    private createRowInfoHelper(newRows: Array<RowInfo<T>>, node: T, depth: number) {\n        const rowInfo = new RowInfo(node, depth, false)\n        newRows.push(rowInfo)\n        if (rowInfo.open && this.getDown(node)) {\n            this.createRowInfoHelper(newRows, this.getDown(node)!, rowInfo.depth + 1)\n        }\n        if (this.getNext(node)) {\n            this.createRowInfoHelper(newRows, this.getNext(node)!, rowInfo.depth)\n        }\n    }\n\n    getVisibleChildCount(row: number): number {\n        let r = this.rows[row]\n        let count = 1\n        // console.log(`row=${row}, count=${count}, open=${r.open}`)\n        if (r.open && this.getDown(r.node)) {\n            // console.log(`  go down`)\n            const rows = this.getVisibleChildCountHelper(row+1)\n            row += rows\n            count += rows\n            // console.log(`  down rows=${rows} row=${row}, count=${count}, open=${r.open}`)\n        }\n        return count - 1\n    }\n\n    private getVisibleChildCountHelper(row: number): number {\n        let r = this.rows[row]\n        let count = 1\n        // console.log(`row=${row}, count=${count}, open=${r.open}`)\n        if (r.open && this.getDown(r.node)) {\n            // console.log(`  go down`)\n            const rows = this.getVisibleChildCountHelper(row+1)\n            row += rows\n            count += rows\n            // console.log(`  down rows=${rows} row=${row}, count=${count}, open=${r.open}`)\n        }\n        if (this.getNext(r.node)) {\n            // console.log(`  next`)\n            const rows = this.getVisibleChildCountHelper(row+1)\n            row += rows\n            count += rows\n            // console.log(`  next rows=${rows} row=${row}, count=${count}, open=${r.open}`)\n        }\n        return count\n    }\n\n    private append(chain: T, node?: T) {\n        if (node === undefined)\n            return\n        let p = chain\n        let next\n        while (true) {\n            next = this.getNext(p)\n            if (next === undefined)\n                break\n            p = next\n        }\n        this.setNext(p, node)\n    }\n\n    private nodeCount(node?: T): number {\n        if (node === undefined)\n            return 0\n        return 1 + this.nodeCount(this.getDown(node)) + this.nodeCount(this.getNext(node))\n    }\n\n    abstract createNode(): T\n    abstract deleteNode(node: T): void\n    abstract getRoot(): T | undefined\n    abstract setRoot(node?: T): void\n    abstract getDown(node: T): T | undefined\n    abstract setDown(node: T, down?: T): void\n    abstract getNext(node: T): T | undefined\n    abstract setNext(node: T, next?: T): void\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport bind from 'bind-decorator'\n\nimport { TreeModel } from \"./TreeModel\"\nimport { TypedTableAdapter } from \"./TypedTableAdapter\"\nimport { View } from '../view/View'\nimport { Model } from '../model/Model'\nimport { RowInfo } from './TreeModel'\n\nexport class TreeNodeCell<T> extends View {\n    model: TreeModel<T>\n    rowinfo: RowInfo<T>\n    label: string\n    constructor(model: TreeModel<T>, rowinfo: RowInfo<T>, label: string) {\n        super()\n        this.model = model\n        this.rowinfo = rowinfo\n        this.label = label\n\n        this.attachShadow({ mode: 'open' })\n    }\n\n    setModel(model: Model) { }\n\n    override connectedCallback() {\n        super.connectedCallback()\n        this.paint()\n    }\n\n    override disconnectedCallback() {\n        super.disconnectedCallback()\n    }\n\n    paint() {\n        if (!this.shadowRoot)\n            return\n        if (!this.parentElement)\n            return\n\n        const row = this.model.getRow(this.rowinfo.node)\n        if (row === undefined)\n            return\n\n        const rs = 8      // rectangle width and height\n        const sx = rs + 4 // horizontal step width, minimal vertical step width\n        const height = sx\n        const dx = 3.5    // additional step before and after drawing the rectangle\n        const dy = Math.round(height / 2 - rs / 2) - 0.5       // step from top to rectangle\n        const rx = 3      // horizontal line from rectangle to data on the left\n        const width = this.rowinfo.depth * sx + sx + dx\n\n        const content = <>\n            <svg width={width} height={sx} style={{\n                verticalAlign: \"middle\",\n                background: \"none\",\n            }} />\n            <span style={{\n                verticalAlign: \"middle\",\n                padding: \"2px\",\n            }}>{this.label}</span>\n        </>\n\n        const svg = content[0] as SVGElement\n\n        if (true) {\n            const rowinfo = this.rowinfo\n            const d = rowinfo.depth\n\n            // when we have children, draw a box\n            if (this.model.getDown(rowinfo.node)) {\n                // TODO: port Rectangle from workflow to toad.js\n                const x0 = d * sx + dx\n\n                // box\n                const box = <rect x={x0} y={dy} width={rs} height={rs} stroke=\"#000\" fill=\"#fff\" cursor=\"pointer\" />\n                svg.appendChild(box)\n\n                // minus\n                svg.appendChild(<line x1={x0 + (rs >> 2)} y1={dy + (rs >> 1)} x2={x0 + rs - (rs >> 2)} y2={dy + (rs >> 1)} stroke=\"#000\" cursor=\"pointer\" />)\n\n                // plus\n                const plus = <line x1={x0 + (rs >> 1)} y1={dy + (rs >> 2)} x2={x0 + (rs >> 1)} y2={dy + rs - (rs >> 2)} stroke=\"#000\" cursor=\"pointer\" />\n                plus.style.display = rowinfo.open ? \"none\" : \"\"\n                svg.appendChild(plus)\n\n                // horizontal line to data\n                svg.appendChild(<line x1={x0 + rs} y1={dy + (rs >> 1)} x2={x0 + rs + rx} y2={dy + (rs >> 1)} stroke=\"#000\" />)\n\n                svg.onmousedown = (event: MouseEvent) => {\n                    event.preventDefault()\n                    event.stopPropagation()\n\n                    const rowNumber = this.model.getRow(rowinfo.node)\n                    if (rowNumber === undefined) {\n                        console.log(\"  ==> couldn't find row number for node\")\n                        return\n                    }\n\n                    const bounds = svg.getBoundingClientRect()\n                    const x = event.clientX - bounds.left\n                    const y = event.clientY - bounds.top\n\n                    // console.log(`TreeNodeCell.mouseDown(): ${event.clientX}, ${event.clientY} -> ${x}, ${y} (rect at ${x0}, ${dy}, ${rs}, ${rs})`)\n\n                    if (x0 <= x && x <= x0 + rs && dy <= y && y <= dy + rs) {\n                        this.model?.toggleAt(rowNumber)\n                        plus.style.display = this.model.isOpen(rowNumber) ? \"none\" : \"\"\n                    }\n                }\n            } else {\n                // upper vertical line instead of box\n                svg.appendChild(<line x1={d * sx + dx + (rs >> 1)} y1=\"0\" x2={d * sx + dx + (rs >> 1)} y2={dy + (rs >> 1)} stroke=\"#000\" />)\n                // horizontal line to data\n                svg.appendChild(<line x1={d * sx + dx + (rs >> 1)} y1={dy + (rs >> 1)} x2={d * sx + dx + rs + rx} y2={dy + (rs >> 1)} stroke=\"#000\" />)\n            }\n\n            // the vertical lines connecting with the surrounding rows are done as background images in the <td> parent.\n            // this frees us to set a vertical size to meet the boundaries of the <td>\n            // as well as removing the vertical size while the table layout is recalculated\n            let lines = \"\"\n            for (let i = 0; i <= d; ++i) {\n                const x = i * sx + dx + (rs >> 1)\n                for (let j = row + 1; j < this.model.rowCount; ++j) {\n                    if (this.model.rows[j].depth < i)\n                        break\n                    if (i === this.model.rows[j].depth) {\n                        if (i !== d) {\n                            // long line without box\n                            lines += `<line x1='${x}' y1='0' x2='${x}' y2='100%' stroke='%23000' />`\n                        } else {\n                            if (this.model.getNext(rowinfo.node) !== undefined) {\n                                // there's more below (either subtree or next sibling), draw a full line\n                                lines += `<line x1='${x}' y1='0' x2='${x}' y2='100%' stroke='%23000' />`\n                              }\n                        }\n                        break\n                    }\n                }\n            }\n            // there isn't more below, draw a line from the top to the middle\n            if (this.model.getDown(rowinfo.node) === undefined || this.model.getNext(rowinfo.node) === undefined) {\n                const x = d * sx + dx + (rs >> 1)\n                lines += `<line x1='${x}' y1='0' x2='${x}' y2='50%' stroke='%23000' />`\n            }\n            \n            this.parentElement.style.background = `url(\\\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'>${lines}</svg>\\\")`\n            this.parentElement.style.backgroundRepeat = \"repeat-y\"\n        }\n        content.replaceIn(this.shadowRoot!)\n    }\n\n}\n\nwindow.customElements.define(\"toad-treenodecell\", TreeNodeCell)\n\nexport class TreeAdapter<T> extends TypedTableAdapter<TreeModel<T>> {\n\n    override isViewCompact(): boolean { return true }\n\n    treeCell(row: number, label: string): Element | Element[] | undefined {\n        if (!this.model)\n            return undefined\n        return new TreeNodeCell(this.model, this.model.rows[row], label)\n        // return <>\n        //     <svg width=\"40\" height=\"40\" viewBox=\"0 0 40 40\" style={{background: \"#88f\", verticalAlign: \"middle\"}}>\n        //         <line x1=\"20.5\" y1=\"0\" x2=\"20.5\" y2=\"40\" stroke=\"#000\" />\n        //         <line x1=\"0\" y1=\"20.5\" x2=\"40\" y2=\"20.5\" stroke=\"#000\" />\n        //     </svg>\n        //     <span style={{background: \"#f88\", verticalAlign: \"middle\"}}>Achtung</span>\n        // </>\n    }\n}","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { TreeModel } from './TreeModel'\nimport { TreeNode } from './TreeNode'\n\nexport class TreeNodeModel<T extends TreeNode> extends TreeModel<T> {\n    root?: T\n    constructor(nodeClass: new() => T, root?: T) {\n        super(nodeClass, root)\n        this.root = root\n    }\n\n    override createNode(): T { return new this.nodeClass() }\n    override deleteNode(node: T): void { }\n    override getRoot(): T | undefined { return this.root }\n    override setRoot(node?: T): void { this.root = node }\n    override getDown(node: T): T | undefined { return node.down as T }\n    override setDown(node: T, down?: T): void { node.down = down }\n    override getNext(node: T): T | undefined { return node.next as T }\n    override setNext(node: T, next?: T): void { node.next = next }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { ArrayTableModel } from \"./ArrayTableModel\"\n\nexport class ArrayModel<T> extends ArrayTableModel<T> {\n    constructor(data: Array<T>, rowClass: new () => T) {\n        super(data, rowClass)\n    }\n    get colCount(): number { return 10 }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018-2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU Affero General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU Affero General Public License for more details.\n *\n *  You should have received a copy of the GNU Affero General Public License\n *  along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { ArrayModel } from \"./ArrayModel\"\nimport { TypedTableAdapter, InferTypedTableModelParameter } from \"./TypedTableAdapter\"\nimport { TableEvent } from \"./TableEvent\"\nimport { TableEventType } from \"./TableEventType\"\n\nimport { Reference } from \"../jsx-runtime\"\nimport { TextModel } from \"../model/TextModel\"\nimport { TextView } from \"../view/TextView\"\n\nexport abstract class ArrayAdapter<M extends ArrayModel<any>, T = InferTypedTableModelParameter<M>> extends TypedTableAdapter<M> {\n\n    abstract getColumnHeads(): Array<string>\n    abstract getRow(row: T): Array<Reference<T>>\n\n    override getColumnHead(col: number): Node | undefined {\n        const headers = this.getColumnHeads()\n        return document.createTextNode(headers[col])\n    }\n    \n    override get colCount(): number {\n        return this.getRow(this.model?.data[0]).length\n    }\n\n    override getRowHead(row: number) {\n        return undefined\n    }\n\n    override getDisplayCell(col: number, row: number): Node | undefined {\n        const text = this.getField(col, row)\n        if (text === undefined)\n            return undefined\n        return document.createTextNode(text)\n    }\n\n    override getEditorCell(col: number, row: number): Node | undefined {\n        const text = this.getField(col, row)\n        if (text === undefined)\n            return undefined\n        const model = new TextModel(text)\n        model.modified.add(() => {\n            this.setField(col, row, model.value)\n        })\n        const view = new TextView()\n        view.setModel(model)\n        return view\n    }\n\n    private getField(col: number, row: number): string | undefined {\n        if (!this.model)\n            return undefined\n        return this.getRow(this.model.data[row])[col].toString()\n    }\n\n    private setField(col: number, row: number, text: string): void {\n        if (!this.model)\n            return\n        this.getRow(this.model.data[row])[col].fromString(text)\n        this.model.modified.trigger(new TableEvent(TableEventType.CELL_CHANGED, col, row))\n    }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2021 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {\n    TextModel, HtmlModel, NumberModel, BooleanModel,\n\n    Template,\n\n    ArrayModel, ArrayAdapter, TableAdapter,\n    TreeNode, TreeNodeModel, TreeAdapter,\n    bind, action, refs\n} from '@toad'\n\n//\n// <toad-text>\n//\n\nlet textModel = new TextModel(\"\")\nbind(\"hello\", textModel)\n\n//\n// <toad-texttool> & <toad-textarea>\n//\nlet markupModel = new HtmlModel(\"\")\nmarkupModel.modified.add(() => {\n    document.getElementById(\"rawhtml\")!.innerText = markupModel.value\n})\nbind(\"markup\", markupModel)\n\n//\n// <toad-button>\n//\naction(\"hitMe\", () => {\n    textModel.value = \"Hit me too!\"\n    hitMeMore.enabled = true\n})\nvar hitMeMore = action(\"hitMeMore\", () => {\n    textModel.value = \"You hit me!\"\n    hitMeMore.enabled = false\n})\n\n//\n// <toad-checkbox> and <toad-if>\n//\n\nlet onoff = new BooleanModel(false)\nbind(\"onoff\", onoff)\n\n//\n// <toad-slider>\n//\n\nlet size = new NumberModel(42, { min: 0, max: 99 })\nbind(\"size\", size)\n\n// <toad-menu>\naction(\"file|logout\", () => {\n    alert(\"You are about to logout\")\n})\naction(\"help\", () => {\n    alert(\"Please.\")\n})\n\n//\n// Books\n//\n\nclass Book {\n    title: string = \"\"\n    author: string = \"\"\n    year: number = 1970\n}\n\nconst bookList = [\n    { title: \"The Moon Is A Harsh Mistress\", author: \"Robert A. Heinlein\", year: 1966 },\n    { title: \"Stranger In A Strange Land\", author: \"Robert A. Heinlein\", year: 1961 },\n    { title: \"The Fountains of Paradise\", author: \"Arthur C. Clarke\", year: 1979 },\n    { title: \"Rendezvous with Rama\", author: \"Arthur C. Clarke\", year: 1973 },\n    { title: \"2001: A Space Odyssey\", author: \"Arthur C. Clarke\", year: 1968 },\n    { title: \"Do Androids Dream of Electric Sheep?\", author: \"Philip K. Dick\", year: 1968 },\n    { title: \"A Scanner Darkly\", author: \"Philip K. Dick\", year: 1977 },\n    { title: \"Second Variety\", author: \"Philip K. Dick\", year: 1953 },\n]\n\nclass BookAdapter extends ArrayAdapter<ArrayModel<Book>> {\n    override getColumnHeads() { return [\"Title\", \"Author\", \"Year\"] }\n    override getRow(book: Book) { return refs(book, \"title\", \"author\", \"year\") }\n}\n\nfunction initializeBooks() {\n    TableAdapter.register(BookAdapter, ArrayModel, Book)\n    const model = new ArrayModel<Book>(bookList, Book)\n    bind(\"books\", model)\n}\n\n//\n// Tree\n//\n\nclass MyNode implements TreeNode {\n    label: string\n    next?: MyNode\n    down?: MyNode\n    static counter = 0\n    constructor() {\n        this.label = `#${MyNode.counter++}`\n    }\n}\n\nclass MyTreeAdapter extends TreeAdapter<MyNode> {\n    override getDisplayCell(col: number, row: number) {\n        return this.model && this.treeCell(row, this.model.rows[row].node.label)\n    }\n}\n\nfunction initializeTree(): void {\n    TreeAdapter.register(MyTreeAdapter, TreeNodeModel, MyNode)\n    let model = new TreeNodeModel(MyNode)\n    model.addSiblingAfter(0)\n    model.addChildAfter(0)\n    model.addChildAfter(1)\n    model.addSiblingAfter(2)\n    model.addSiblingAfter(1)\n    model.addChildAfter(4)\n    model.addSiblingAfter(0)\n    bind(\"tree\", model)\n}\n\nexport function main(): void {\n    initializeBooks()\n    initializeTree()\n}\n\nclass MyCodeButton extends HTMLElement {\n    condition = new BooleanModel(false)\n    constructor() {\n        super()\n        let template = new Template(\"my-code-button\") // FIXME: how about inlining the HTML?\n        let label = template.text(\"label\", \"Show Code\")\n        template.action(\"action\", () => {\n            if (this.condition.value) {\n                this.condition.value = false\n                label.value = \"Show Code\"\n            } else {\n                this.condition.value = true\n                label.value = \"Hide Code\"\n            }\n        })\n        this.attachShadow({ mode: 'open' })\n        this.shadowRoot!.appendChild(template.root)\n    }\n    connectedCallback() {\n        bind(this.getAttribute(\"condition\")!, this.condition) // FIXME: bind to parents context\n    }\n}\nwindow.customElements.define(\"my-code-button\", MyCodeButton)\n"],"names":["SignalLink","[object Object]","callback","id","this","Signal","callbacks","Array","push","i","length","splice","locked","undefined","triggered","data","trigger","Model","modified","GenericModel","value","super","_value","BooleanModel","NumberModel","options","min","max","step","TextModel","promise","console","trace","HtmlModel","Action","parent","title","signal","_enabled","placeHolder","Error","enabled","Controller","modelId2Models","Map","modelId2Views","view2ModelIds","sigChanged","actionId","action","add","_registerModel","modelId","model","modelsForModelId","get","Set","set","viewsForModelId","view","setModel","controller","log","modelIdsForView","modelsForView","modelIds","views","delete","size","entry","clear","registerModel","registerAction","bind","instantiateTemplate","name","t","document","querySelector","z","content","importNode","tmpl","attribute","element","getAttribute","nodeName","attributeOrUndefined","getPropertyValue","propertyName","pixel","substr","Number","parseFloat","pixelToNumber","window","getComputedStyle","horizontalPadding","verticalPadding","Template","template","root","dom.instantiateTemplate","registerViews","querySelectorAll","registerView","getModelId","e","getActionId","href","globalController","constants","target","propertyKey","descriptor","typeOfFunction","TypeError","configurable","boolTrue","bound","Object","defineProperty","writable","bindDecorator","AnimationBase","prepare","_stop","requestAnimationFrame","_firstFrame","animator","current","animation","next","animationFrame","lastFrame","time","startTime","firstFrame","_animationFrame","elapsed","animationFrameCount","ease","k","Math","cos","PI","__decorate","Animator","replace","start","Reference","object","toString","type","outValue","ref","Fragment","props","children","childNodes","removeChild","appendTo","child","appendChild","jsx","nameOrConstructor","key","jsxs","namespace","tag","createElementNS","entries","classList","skey","svalue","regex","upperCase","toLowerCase","style","setProperty","setAttributeNS","createTextNode","View","HTMLElement","hasAttribute","error","unregisterView","GenericView","remove","updateView","GenericTool","viewParents","parentElement","distance","closestParent","closestTool","closestToolDistance","MAX_SAFE_INTEGER","closestToolList","tool","allTools","values","canHandle","toolParent","depth","toolDistance","viewIndex","getIndex","closestNextSiblingIndex","MIN_SAFE_INTEGER","toolIndex","setActive","from","indexOf","activeTool","deactivate","activeView","activate","connectedCallback","disconnectedCallback","addEventListener","event","relatedTarget","focusOut","focusIn","ActionView","constructor","customElements","define","innerHTML","innerText","buttonStyle","createElement","textContent","button","onclick","disabled","attachShadow","mode","shadowRoot","_observer","MutationObserver","record","observer","_timer","clearTimeout","setTimeout","observe","childList","subtree","characterData","isEnabled","toolbuttonStyle","onmousedown","focus","preventDefault","stringValue","getValue","img","src","setAttribute","removeAttribute","isValidStringValue","checkboxStyle","svg","rect","checkmark","toggle","observedAttributes","oldValue","newValue","updateModel","input","oninput","String","textStyle","TextView","blur","strValue","textAreaStyle","TextTool","texttool","toolbar","_jsx","class","buttonH1","execCommand","update","buttonH2","buttonH3","buttonH4","buttonBold","buttonItalic","buttonUnderline","buttonStrikeThrough","buttonSubscript","buttonSuperscript","buttonJustifyLeft","_jsxs","viewBox","width","height","x1","y1","x2","y2","stroke","buttonJustifyCenter","buttonJustifyRight","buttonUnorderedList","display","cx","cy","r","fill","buttonOrderedList","queryCommandValue","queryCommandState","contentEditable","firstChild","nodeType","onkeydown","metaKey","updateTextTool","shiftKey","onkeyup","onmouseup","menuStyle","MenuState","MenuButtonContainer","vertical","closeOnClose","state","WAIT","PopupMenu","parentButton","popup","node","down","isAvailable","createWindowAt","deleteWindow","show","master","parentBoundary","getBoundingClientRect","opacity","left","top","popupBoundary","innerHeight","innerWidth","placePopupHorizontal","placePopupVertical","MenuButton","menuButton","stopPropagation","documentMouseUp","removeEventListener","capture","buttonDown","dispatchEvent","MouseEvent","DOWN","UP_N_HOLD","active","DOWN_N_HOLD","documentMouseDown","tagName","collapse","DOWN_N_OUTSIDE","DOWN_N_INSIDE_AGAIN","onmouseout","inside","onmouseover","label","span","insertBefore","hide","oldActive","closePopup","openPopup","MenuNode","shortcut","parentView","flexGrow","tabIndex","layout2nodes","referenceActions","createShadowDOM","newnode","dom.attribute","dom.attributeOrUndefined","str","strpos","right","n","findNode","MenuSpacer","scrollIntoView","scrollableParent","findScrollableParent","parentRect","clientRect","body","x","y","GAP","clientLeft","scrollLeft","clientRight","clientTop","scrollTop","clientBottom","bottom","parentWidth","clientWidth","parentHeight","clientHeight","calculateScrollGoal","scrollable","startX","startY","activeGoal","concurrentScroll","scrollX","pageXOffset","scrollY","pageYOffset","deltaX","deltaY","nx","ny","scrollTo","animateStep","smoothScroll","position","scrollBy","behavior","idSource","Date","now","userAgent","TableEditMode","TableEventType","ROUNDING_TOLERANCE","navigator","RegExp","join","test","el","isScrollable","isScrollableY","hasScrollableSpace","canOverflow","isScrollableX","axis","scrollWidth","scrollHeight","overflowValue","TableModel","colCount","rowCount","TablePos","col","row","SelectionModel","EDIT_CELL","TypedTableModel","nodeClass","TableAdapter","adapter","typeToModel","modelToAdapter","dataType","getPrototypeOf","baseClass","keys","msg","modelX","typeToAdapterX","typeX","adapterX","tableStyle","InputOverlay","HTMLDivElement","div","first","second","firstPrevious","parentsOfFirstNode","parentNode","secondPrevious","lookup","dom.isNodeBeforeNode","focusInFromRight","focusInFromLeft","setViewRect","prototype","unsetViewRect","setEditView","adjustToCell","fieldView","savedScrollLeft","savedScrollTop","hasChildNodes","hasFocus","activeElement","dom.hasFocus","FocusEvent","replaceChild","cell","boundary","tr","tbody","offsetLeft","offsetTop","dom.horizontalPadding","SelectionIs","Log","RemoveRowAnimation","table","hadFocus","overlayTopDrift","editView","selectionModel","index","selectionIs","BEFORE_REMOVED_AREA","bodyBody","INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS","INSIDE_REMOVED_AREA","prepareInputOverlayForPosition","BEHIND_REMOVED_AREA","rowAnimationHeight","rowHeadHead","deleteRow","trAnimationHead","trAnimationBody","minHeight","maxHeight","padding","background","inputOverlay","overlayTop","inverseValue","InsertRowAnimation","trH","createDOMRowHeaderRow","hiddenSizeCheckRowHead","trHead","trB","createDOMBodyRow","hiddenSizeCheckBody","trBody","animationTime","rowHeight","round","getCellAt","bodyStyle","headStyle","nextSibling","adjustLayout","TableView","insideGoTo","rootDiv","onRootDivKeyDown","scrollDiv","onscroll","rowHeadDiv","colHeadDiv","bodyTable","USER","goToCell","init","goToFirstCell","goToLastCell","what","createSelection","modelChanged","updateCompact","isViewCompact","forEach","INSERT_ROW","run","REMOVE_ROW","CELL_CHANGED","onFieldViewBlur","createColumnHeader","createRowHeader","createBody","adjustLayoutAfterRender","stack","updateHeader","column","headTable","headRow","count","colHeadTable","colHeadRow","rowHeadTable","fillerForMissingScrollbar","noHeader","minWidth","border","getColumnHead","getRowHead","bodyRow","getDisplayCell","isArray","result","SELECTION","SELECT_CELL","allSelected","selected","toggleCellSelection","SELECT_ROW","toggleRowSelection","pos","unadjustLayoutBeforeRender","unadjustLayoutColumnBeforeRender","head","maxWidth","LAYOUT","columnHeader","columnBody","headWidth","bodyWidth","rowHeader","rowBody","headHeight","dom.verticalPadding","bodyHeight","columnHeadBounds","rowHeadBounds","scrollBounds","cellsBounds","computedStyle","computedWidth","computedHeight","overflowX","overflowY","enoughHorizontalSpace","enoughVerticalSpace","requiredWidth","requiredHeight","outerBounds","hostBounds","verticalScrollbarWidth","horizontalScrollbarHeight","getCellPosition","setSelectionTo","getEditorCell","onFieldViewKeyDown","preventScroll","flag","rowElement","prepareInputOverlayForCell","goTo","tmp","resizeEventListener","TableEvent","ArrayTableModel","rowClass","rowData","rowArray","createRow","buttonAddRowAbove","lastActiveTable","selection","insert","buttonAddRowBelow","buttonDeleteRow","buttonAddColumnLeft","buttonAddColumnRight","buttonDeleteColumn","buttonAddNodeAbove","buttonAddNodeBelow","buttonAddNodeParent","buttonAddNodeChild","buttonDeleteNode","AbstractTypedTableAdapter","TypedTableAdapter","RowInfo","open","TreeModel","rows","createRowInfoHelper","nn","createNode","setRoot","setNext","getRoot","unshift","getNext","setDown","nodeCount","getDown","subtreeSize","append","closeAt","openAt","newRows","createRowInfo","getVisibleChildCount","rowInfo","getVisibleChildCountHelper","chain","p","TreeNodeCell","rowinfo","paint","getRow","sx","rs","dx","dy","verticalAlign","d","x0","box","cursor","plus","rowNumber","bounds","clientX","clientY","toggleAt","isOpen","lines","j","backgroundRepeat","replaceIn","TreeAdapter","TreeNodeModel","ArrayModel","ArrayAdapter","headers","getColumnHeads","text","getField","setField","fromString","textModel","markupModel","getElementById","hitMeMore","alert","Book","bookList","author","year","BookAdapter","book","attributes","map","a","refs","MyNode","counter","MyTreeAdapter","treeCell","MyCodeButton","condition","register","addSiblingAfter","addChildAfter","initializeTree"],"mappings":"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"}