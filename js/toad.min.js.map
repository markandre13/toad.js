{"version":3,"sources":["webpack://toad/webpack/bootstrap","webpack://toad/./src/action.ts","webpack://toad/./src/controller.ts","webpack://toad/./src/dom.ts","webpack://toad/./src/matrix.ts","webpack://toad/./src/model.ts","webpack://toad/./src/signal.ts","webpack://toad/./src/toad.ts","webpack://toad/./src/view.ts","webpack://toad/./src/view/button.ts","webpack://toad/./src/view/checkbox.ts","webpack://toad/./src/view/menu.ts","webpack://toad/./src/view/slider.ts","webpack://toad/./src/view/table.ts","webpack://toad/./src/view/text.ts","webpack://toad/./src/view/textarea.ts","webpack://toad/./src/view/toolbutton.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","model_1","signal_1","Action","Model","[object Object]","parent","title","super","this","signal","Signal","_enabled","placeHolder","Error","enabled","modified","trigger","data","dom","action_1","Controller","modelId2Models","Map","modelId2Views","view2ModelIds","sigChanged","actionId","callback","action","undefined","add","_registerModel","modelId","model","models","Set","set","views","view","setModel","controller","console","log","modelIds","delete","size","entry","clear","registerModel","registerAction","TextModel","HtmlModel","BooleanModel","options","NumberModel","Template","template","root","instantiateTemplate","registerViews","querySelectorAll","element","registerView","getModelId","e","getActionId","href","Dialog","shadow","document","createElement","style","position","left","top","right","bottom","backgroundColor","opacity","body","appendChild","link","linkList","head","availableLink","dispatchEvent","Event","rel","onload","event","import","querySelector","content","importNode","frame","border","removeChild","globalController","unbind","text","boolean","tmpl","z","find","node","selector","tag","txt","createTextNode","img","src","n0","n1","remove","parentNode","erase","firstChild","grabMouse","target","documentMouseMove","MouseEvent","stopPropagation","documentMouseUp","removeEventListener","capture","pointerEvents","addEventListener","preventDefault","attribute","getAttribute","nodeName","attributeOrUndefined","order","first","second","parentsOfFirstNode","firstPrevious","secondPrevious","lookup","child","childNodes","Matrix","matrix","m11","m12","m21","m22","tX","tY","n11","n12","n21","n22","nX","nY","point","x","y","append","radiant","Math","cos","sin","GenericModel","_value","promise","String","min","max","step","OptionModelBase","_stringValue","stringValue","v","OptionModel","_map","id","has","SignalLink","callbacks","Array","push","length","splice","locked","triggered","view_1","matrix_1","view_2","View","GenericView","ActionView","SlotView","button_1","ButtonView","toolbutton_1","ToolButton","checkbox_1","CheckboxView","menu_1","MenuButton","slider_1","SliderView","table_1","TableView","TableModel","TableEditMode","SelectionModel","registerTableModelLocator","createTableModel","text_1","TextView","textarea_1","TextArea","TextTool","controller_1","customElements","define","display","HTMLElement","hasAttribute","error","unregisterView","updateView","disconnectedCallback","constructor","innerHTML","innerText","window","buttonStyle","textContent","button","onclick","disabled","attachShadow","shadowRoot","connectedCallback","children","_observer","MutationObserver","record","observer","_timer","clearTimeout","setTimeout","observe","childList","subtree","characterData","isEnabled","checkboxStyle","svg","createElementNS","setAttributeNS","rect","checkmark","toggle","onmousedown","focus","observedAttributes","oldValue","newValue","updateModel","removeAttribute","setAttribute","menuStyle","MenuState","Type","Node","label","shortcut","type","parentView","span","flexGrow","MenuHelper","vertical","closeOnClose","state","WAIT","Menu","tabIndex","layout2nodes","referenceActions","createShadowDOM","down","newnode","next","str","strpos","indexOf","substr","findNode","classList","isAvailable","createWindowAt","deleteWindow","PopupMenu","parentButton","popup","show","master","parentBoundary","getBoundingClientRect","width","popupBoundary","popupBottom","height","innerHeight","popupRight","innerWidth","placePopupHorizontal","placePopupVertical","menuButton","buttonDown","DOWN","activate","UP_N_HOLD","active","DOWN_N_HOLD","onmouseup","documentMouseDown","tagName","collapse","DOWN_N_OUTSIDE","deactivate","DOWN_N_INSIDE_AGAIN","onmouseout","inside","onmouseover","insertBefore","hide","oldActive","closePopup","openPopup","input","oninput","Number","parseFloat","tableStyle","getPropertyValue","propertyName","pixel","pixelToNumber","getComputedStyle","horizontalPadding","TablePos","col","row","SELECT_ROW","cols","rows","column","tableModelLocators","locator","ArrayTableModel","field","insideGoTo","rootElement","className","onkeydown","selectionModel","toggleRowSelection","SELECT_CELL","pos","toggleCellSelection","headDiv","overflow","headTable","headHead","headRow","bodyDiv","onscroll","scrollLeft","bodyTable","srcElement","goToField","bodyBody","bodyRow","zeroSize","margin","padding","background","genericEvent","relatedTarget","goTo","updateSelection","updateHeader","updateBody","adjustInternalTables","fillerForMissingScrollbar","noHeader","cell","minWidth","getColumnHead","paddingTop","paddingBottom","fieldModel","getFieldModel","EDIT_CELL","prepareFieldAtPosition","allSelected","selected","headWidth","clientWidth","bodyWidth","maxWidth","offsetWidth","flag","scrollIntoViewIfNeeded","scrollIntoView","rowElement","boundary","td","tbody","parentElement","navigator","userAgent","offsetLeft","offsetTop","clientHeight","prepareFieldAtElement","fieldView","getElementAt","positionOfField","getFieldView","onblur","unadjustInternalTables","shiftKey","hasFocus","activeElement","FocusEvent","replaceChild","adjustInputToElement","textStyle","blur","textareaStyle","texttool","toolbar","buttonH1","execCommand","update","buttonH2","buttonH3","buttonH4","buttonBold","buttonItalic","buttonUnderline","buttonStrikeThrough","buttonSubscript","buttonSuperscript","buttonJustifyLeft","buttonJustifyCenter","buttonJustifyRight","buttonUnorderedList","buttonOrderedList","queryCommandValue","queryCommandState","contentEditable","nodeType","metaKey","updateTextTool","onkeyup","toolbuttonStyle","getValue","isValidStringValue"],"mappings":"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","file":"toad.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/toad.ts\");\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"./model\"\nimport { Signal } from \"./signal\"\n\nexport class Action extends Model {\n  signal: Signal\n  title: string\n  \n  _enabled: boolean\n\n  constructor(parent: HTMLElement | undefined, title: string) {\n    super()\n    this.signal = new Signal()\n    this.title = title\n    this._enabled = true\n  }\n  \n  set value(placeHolder: any) {\n    throw Error(\"Action.value can not be assigned a value\")\n  }\n\n  get value(): any {\n    throw Error(\"Action.value can not return a value\")\n  }\n\n  set enabled(enabled: boolean) {\n    if (this._enabled == enabled)\n      return\n    this._enabled = enabled\n    this.modified.trigger()\n  }\n  \n  get enabled(): boolean {\n    return this._enabled\n  }\n  \n  trigger(data?: any): void {\n    if (!this._enabled)\n      return\n    this.signal.trigger(data)\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"./dom\"\nimport { Model, TextModel, HtmlModel, BooleanModel, NumberModel } from \"./model\"\nimport { View } from \"./view\"\nimport { Action } from \"./action\"\nimport { Signal } from \"./signal\"\n\n// HTML Imports Working Draft\ndeclare global {\n  interface HTMLLinkElement {\n    import?: Document\n  }\n}\n\nexport class Controller {\n  modelId2Models: Map<string, Set<Model>>\n  modelId2Views: Map<string, Set<View>>\n  view2ModelIds: Map<View, Set<string>>\n  \n  sigChanged: Signal\n  \n  constructor() {\n    this.modelId2Models = new Map<string, Set<Model>>()\n    this.modelId2Views = new Map<string, Set<View>>()\n    this.view2ModelIds = new Map<View, Set<string>>()\n    this.sigChanged = new Signal()\n  }\n\n  registerAction(actionId: string, callback: () => void): Action {\n    let action = new Action(undefined, actionId)\n    action.signal.add(callback)\n    this._registerModel(\"A:\"+actionId, action)\n    return action\n  }\n  \n  registerModel(modelId: string, model: Model): void {\n    this._registerModel(\"M:\"+modelId, model)\n  }\n  \n  _registerModel(modelId: string, model: Model): void {\n    let models = this.modelId2Models.get(modelId)\n    if (!models) {\n      models = new Set<Model>()\n      this.modelId2Models.set(modelId, models)\n    }\n    models.add(model)\n    \n    let views = this.modelId2Views.get(modelId)\n    if (!views)\n      return\n    for(let view of views) {\n      view.setModel(model)\n    }\n  }\n\n  registerView(modelId: string, view: View): void {\n    if (view.controller && view.controller!==this) {\n      console.log(\"error: attempt to register view more than once at different controllers\")\n      return\n    }\n    view.controller = this\n  \n    let modelIds = this.view2ModelIds.get(view)\n    if (!modelIds) {\n      modelIds = new Set<string>()\n      this.view2ModelIds.set(view, modelIds)\n    }\n    modelIds.add(modelId)\n  \n    let views = this.modelId2Views.get(modelId)\n    if (!views) {\n      views = new Set<View>()\n      this.modelId2Views.set(modelId, views)\n    }\n    views.add(view)\n    \n    let models = this.modelId2Models.get(modelId)\n    if (models)\n      for(let model of models)\n        view.setModel(model)\n  }\n  \n  unregisterView(view: View): void {\n    if (!view.controller)\n      return\n    if (view.controller !== this)\n      throw Error(\"attempt to unregister view from wrong controller\")\n  \n    let modelIds = this.view2ModelIds.get(view)\n    if (!modelIds)\n      return\n\n    for(let modelId of modelIds) {\n      let views = this.modelId2Views.get(modelId)\n      if (!views)\n        continue\n      views.delete(view)\n      if (views.size === 0) {\n        this.modelId2Views.delete(modelId)\n      }\n      view.setModel(undefined)\n    }\n  }\n  \n  clear(): void {\n    for(let entry of this.view2ModelIds) {\n      entry[0].setModel(undefined)\n    }\n    this.modelId2Models.clear()\n    this.modelId2Views.clear()\n    this.view2ModelIds.clear()\n  }\n  \n  bind(modelId: string, model: Model): void {\n    this.registerModel(modelId, model)\n  }\n  \n  action(actionId: string, callback: () => void): Action {\n    return this.registerAction(actionId, callback)\n  }\n  \n  text(modelId: string, value: string): TextModel {\n    let model = new TextModel(value)\n    this.bind(modelId, model)\n    return model\n  }\n\n  html(modelId: string, value: string): HtmlModel {\n    let model = new HtmlModel(value)\n    this.bind(modelId, model)\n    return model\n  }\n\n  boolean(modelId: string, value: boolean): BooleanModel {\n    let model = new BooleanModel(value)\n    this.bind(modelId, model)\n    return model\n  }\n  \n  number(modelId: string, value: number, options: any): NumberModel {\n    let model = new NumberModel(value, options)\n    this.bind(modelId, model)\n    return model\n  }\n}\n\nexport class Template extends Controller {\n  root: DocumentFragment\n\n  constructor(template: string) {\n    super()\n    this.root = dom.instantiateTemplate(template)\n    this.registerViews()\n  }\n  \n  registerViews() {\n    let views = this.root.querySelectorAll(\"[model]\")\n    for(let element of views) {\n      //if (element.nodeName.toUpperCase().substring(0,4)!==\"TOAD-\")\n      //  continue\n      let view = element as View\n      if (!view)\n        continue\n      try {\n        this.registerView(view.getModelId(), view)\n      }\n      catch(e) {\n      }\n    }\n    \n    views = this.root.querySelectorAll(\"[action]\")\n    for(let element of views) {\n      //if (element.nodeName.toUpperCase().substring(0,4)!==\"TOAD-\")\n      //  continue\n      let view = element as View\n      if (!view)\n        continue\n//      view.controller = this\n      try {\n        this.registerView(view.getActionId(), view)\n      }\n      catch(e) {\n      }\n    }\n    \n  }\n  \n  openHref(href: string) {\n  }\n}\n\nexport class Dialog extends Controller {\n  root?: DocumentFragment\n  shadow?: HTMLElement\n  frame?: HTMLElement\n  \n  constructor() {\n    super()\n  }\n\n  open(href: string): void {\n    let shadow = document.createElement(\"div\")\n    shadow.style.position = \"absolute\"\n    shadow.style.left = \"0\"\n    shadow.style.top = \"0\"\n    shadow.style.right = \"0\"\n    shadow.style.bottom = \"0\"\n    shadow.style.backgroundColor = \"#aaa\"\n    shadow.style.opacity = \"0.5\"\n    this.shadow = shadow\n    document.body.appendChild(shadow)\n  \n    let linkList = document.head.querySelectorAll(\"link[rel=import]\")\n    let link\n    for(let availableLink of linkList) {\n      if ((availableLink as HTMLLinkElement).href === href) {\n        link = availableLink\n        break\n      }\n    }\n\n    if (!link) {\n      let link = document.createElement(\"link\")\n      link.rel = \"import\"\n      link.href = href\n      link.onload = (event) => {\n        let template = link.import!.querySelector(\"template\")\n        if (!template)\n          throw Error(\"toad.openDialog: failed to find template in '\"+href+\"'\")\n          \n        let content = document.importNode(template.content, true)\n        this.registerViews(content)\n        \n        let frame = document.createElement(\"div\")\n        frame.style.position = \"absolute\"\n        frame.style.left = \"5%\"\n        frame.style.top = \"5%\"\n        frame.style.right = \"5%\"\n        frame.style.bottom = \"5%\"\n        frame.style.backgroundColor = \"#fff\"\n        frame.style.border = \"solid 2px #000\"\n        \n        frame.appendChild(content)\n        document.body.appendChild(frame)\n        this.frame = frame\n      }\n      document.head.appendChild(link)\n    } else {\n      link.dispatchEvent(new Event(\"load\"))\n    }\n  }\n  \n  close(): void {\n    if (this.frame)\n      document.body.removeChild(this.frame)\n    if (this.shadow)\n      document.body.removeChild(this.shadow)\n  }\n\n  registerViews(root: DocumentFragment) {\n    let views = root.querySelectorAll(\"[model]\")\n    for(let element of views) {\n      //if (element.nodeName.toUpperCase().substring(0,4)!==\"TOAD-\")\n      //  continue\n      let view = element as View\n      if (!view)\n        continue\n      try {\n        this.registerView(view.getModelId(), view)\n      }\n      catch(e) {\n      }\n    }\n    \n    views = root.querySelectorAll(\"[action]\")\n    for(let element of views) {\n      //if (element.nodeName.toUpperCase().substring(0,4)!==\"TOAD-\")\n      //  continue\n      let view = element as View\n      if (!view)\n        continue\n//      view.controller = this\n      try {\n        this.registerView(view.getActionId(), view)\n      }\n      catch(e) {\n      }\n    }\n    \n  }\n}\n\nexport let globalController = new Controller()\n\nexport function bind(modelId: string, model: Model) {\n  globalController.bind(modelId, model)\n}\n\nexport function action(actionId: string, action: () => void): Action { // FIXME: deprecated\n  return globalController.registerAction(actionId, action)\n}\n\nexport function unbind() {\n  globalController.clear()\n}\n\nexport function text(modelId: string, value: string): TextModel {\n  return globalController.text(modelId, value)\n}\n\nexport function boolean(modelId: string, value: boolean): BooleanModel {\n  return globalController.boolean(modelId, value)\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n/**\n *\n * Utility functions to work with the DOM.\n *\n */\n\nexport function instantiateTemplate(name: string): DocumentFragment {\n  return tmpl(name);\n}\nexport function tmpl(name: string): DocumentFragment {\n  let t = document.querySelector('template[id=\"'+name+'\"]');\n  if (!t) {\n    throw new Error(\"failed to find template '\"+name+\"'\");\n  }\n  let x = t as HTMLTemplateElement;\n  let z: DocumentFragment = x.content;\n  let y = document.importNode(z, true);\n  return y;\n}\nexport function find(node: Element|DocumentFragment, selector: string): Element|null {\n  return node.querySelector(selector);\n}\nexport function tag(name: string): HTMLElement { return document.createElement(name); } // FIXME: stupid idea with TypeScript\nexport function txt(txt: string): Text { return document.createTextNode(txt); } // FIXME: stupid idea with TypeScript\nexport function img(src: string): HTMLImageElement {\n  let img = document.createElement(\"img\") as HTMLImageElement\n  img.src = src\n  return img\n}\nexport function add(n0: Node, n1: Node): void { n0.appendChild(n1); }\nexport function remove(n: Node): void { \n  if (!n.parentNode)\n    throw Error(\"element has no parent\");\n  n.parentNode.removeChild(n);\n}\nexport function erase(n: Element): void { while(n.firstChild) n.removeChild(n.firstChild); }\n\nexport function grabMouse(event: MouseEvent) {\n  let target = event.target as HTMLElement\n//  console.log(event)\n    \n  let documentMouseMove = (event: MouseEvent) => {\n//  console.log(\"document.moveMove\", target)\n    target.dispatchEvent(new MouseEvent(\"mousemove\", event))\n    // srcElement, target, toElement, offsetX, offsetY, ...?\n//    target.onmousemove(event)\n    event.stopPropagation()\n  }\n\n  let documentMouseUp = (event: MouseEvent) => {\n//  console.log(\"document.mouseUp\", target)\n    target.dispatchEvent(new MouseEvent(\"mouseup\", event))\n//    target.onmouseup(event)\n    document.removeEventListener(\"mousemove\", documentMouseMove, {capture: true})\n    document.removeEventListener(\"mouseup\", documentMouseUp, {capture: true})\n    document.body.style.pointerEvents = \"auto\"\n    event.stopPropagation()\n  }\n\n  document.addEventListener(\"mousemove\", documentMouseMove, {capture: true})\n  document.addEventListener(\"mouseup\", documentMouseUp, {capture: true})\n  document.body.style.pointerEvents = \"none\"\n  event.preventDefault()\n  event.stopPropagation()\n}\n\nexport function attribute(element: Element, name: string): string {\n  let attribute = element.getAttribute(name)\n  if (attribute === null) {\n    console.log(\"missing attribute '\"+name+\"' in \", element)\n    throw Error(\"missing attribute '\"+name+\"' in \"+element.nodeName)\n  }\n  return attribute\n}\n\nexport function attributeOrUndefined(element: Element, name: string): string|undefined {\n  let attribute = element.getAttribute(name)\n  return attribute === null ? undefined : attribute\n}\n\nexport function order(first: Node, second: Node): boolean {\n  let parentsOfFirstNode = new Map<Node, Node>()\n  let node: Node|null\n  \n  let firstPrevious = first\n  node = first\n  while(true) {\n    firstPrevious = node\n    node = node.parentNode\n    if (!node)\n      break\n    parentsOfFirstNode.set(node, firstPrevious)\n  }\n\n  let secondPrevious = second\n  node = second\n  while(node) {\n    secondPrevious = node\n    node = node.parentNode\n    if (!node)\n      throw Error(\"fuck\")\n    let lookup = parentsOfFirstNode.get(node)\n    if (lookup) {\n      firstPrevious = lookup\n      break\n    }\n    node = node.parentNode\n  }\n  if (!node)\n    throw Error(\"fuck\")\n  \n  for(let child of node!.childNodes) {\n    if (child === firstPrevious)\n      return true\n    if (child === secondPrevious)\n      return false\n  }\n  throw Error(\"fuck\")\n}\n","export interface Point {\n    x: number\n    y: number\n}\n\nexport interface MatrixStruct {\n    m11: number\n    m12: number\n    m21: number\n    m22: number\n    tX: number\n    tY: number\n}\n\nexport class Matrix implements MatrixStruct\n{\n    m11: number\n    m12: number\n    m21: number\n    m22: number\n    tX: number\n    tY: number\n    \n    constructor(matrix?: MatrixStruct) {\n        if (matrix === undefined) {\n            this.m11 = 1.0\n            this.m12 = 0.0\n            this.m21 = 0.0\n            this.m22 = 1.0\n            this.tX  = 0.0\n            this.tY  = 0.0\n        } else {\n            this.m11 = matrix.m11\n            this.m12 = matrix.m12\n            this.m21 = matrix.m21\n            this.m22 = matrix.m22\n            this.tX  = matrix.tX\n            this.tY  = matrix.tY\n        }\n    }\n    \n    identity() {\n        this.m11 = 1.0\n        this.m12 = 0.0\n        this.m21 = 0.0\n        this.m22 = 1.0\n        this.tX  = 0.0\n        this.tY  = 0.0\n    }\n    \n    append(matrix: Matrix) {\n        let n11 = this.m11 * matrix.m11 + this.m12 * matrix.m21\n        let n12 = this.m11 * matrix.m12 + this.m12 * matrix.m22\n        let n21 = this.m21 * matrix.m11 + this.m22 * matrix.m21\n        let n22 = this.m21 * matrix.m12 + this.m22 * matrix.m22\n        let nX  = this.tX  * matrix.m11 + this.tY  * matrix.m21 + matrix.tX\n        let nY  = this.tX  * matrix.m12 + this.tY  * matrix.m22 + matrix.tY\n        \n        this.m11 = n11\n        this.m12 = n12\n        this.m21 = n21\n        this.m22 = n22\n        this.tX  = nX\n        this.tY  = nY\n    }\n\n    prepend(matrix: Matrix) {\n        let n11 = matrix.m11 * this.m11 + matrix.m12 * this.m21\n        let n12 = matrix.m11 * this.m12 + matrix.m12 * this.m22\n        let n21 = matrix.m21 * this.m11 + matrix.m22 * this.m21\n        let n22 = matrix.m21 * this.m12 + matrix.m22 * this.m22\n        let nX  = matrix.tX  * this.m11 + matrix.tY  * this.m21 + this.tX\n        let nY  = matrix.tX  * this.m12 + matrix.tY  * this.m22 + this.tY\n        \n        this.m11 = n11\n        this.m12 = n12\n        this.m21 = n21\n        this.m22 = n22\n        this.tX  = nX\n        this.tY  = nY\n    }\n    \n    invert() {\n        let d = 1.0 / (this.m11 * this.m22 - this.m21 * this.m12)\n        let n11 = d *  this.m22\n        let n12 = d * -this.m12\n        let n21 = d * -this.m21\n        let n22 = d *  this.m11\n        let nX  = d * (this.m21 * this.tY - this.m22 * this.tX)\n        let nY  = d * (this.m12 * this.tX - this.m11 * this.tY)\n\n        this.m11 = n11\n        this.m12 = n12\n        this.m21 = n21\n        this.m22 = n22\n        this.tX  = nX\n        this.tY  = nY\n    }\n    \n    translate(point: Point) {\n        let m = new Matrix({\n            m11: 1.0, m12: 0.0,\n            m21: 0.0, m22: 1.0,\n            tX: point.x, tY: point.y\n        })\n        this.append(m)\n    }\n\n    rotate(radiant: number) {\n        let m = new Matrix({\n            m11:  Math.cos(radiant), m12: Math.sin(radiant),\n            m21: -Math.sin(radiant), m22: Math.cos(radiant),\n            tX: 0, tY: 0\n        })\n        this.append(m)\n    }\n    \n    scale(x: number, y:number) {\n        let m = new Matrix({\n            m11:  x, m12: 0,\n            m21:  0, m22: y,\n            tX: 0, tY: 0\n        })\n        this.append(m)\n    }\n    \n    transformPoint(point: Point): Point {\n        return {\n            x: point.x * this.m11 + point.y * this.m21 + this.tX,\n            y: point.x * this.m12 + point.y * this.m22 + this.tY\n        }\n    }\n\n    transformArrayPoint(point: [number, number]): [number, number] {\n        return [\n            point[0] * this.m11 + point[1] * this.m21 + this.tX,\n            point[0] * this.m12 + point[1] * this.m22 + this.tY\n        ]\n    }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Signal } from \"./signal\"\n\nexport abstract class Model {\n  modified: Signal\n  \n  constructor() {\n    this.modified = new Signal()\n  }\n  \n//  abstract set value(value: any)\n//  abstract get value(): any\n}\n\nexport class GenericModel<T> extends Model {\n  _value: T\n\n  constructor(value: T) {\n    super()\n    this._value = value\n  }\n  \n  set value(value: T) {\n    if (this._value == value)\n      return\n    this._value = value\n    this.modified.trigger()\n  }\n  \n  get value(): T {\n    return this._value\n  }\n}\n\nexport class TextModel extends Model {\n  _value: string|Function\n\n  constructor(value: string) {\n    super()\n    this._value = value\n  }\n  \n  set promise(promise: Function) {\n    this._value = promise\n    this.modified.trigger()\n  }\n  \n  get promise(): Function {\n    if (typeof this._value === \"string\") {\n      return () => {\n        return this._value\n      }\n    }\n    return this._value\n  }\n  \n  set value(value: string) {\n    if (this._value == value)\n      return\n    this._value = value\n    this.modified.trigger()\n  }\n  \n  get value(): string {\n    if (typeof this._value === \"number\") {\n      this._value = String(this._value)\n    } else\n    if (typeof this._value !== \"string\") {\n      this._value = this._value() as string\n    }\n    return this._value\n  }\n}\n\nexport class HtmlModel extends TextModel {\n  constructor(value: string) {\n    super(value)\n  }\n}\n\nexport class NumberModel extends GenericModel<number> {\n  min?: number\n  max?: number\n  step?: number\n  \n  constructor(value: number, options: any) {\n    super(value)\n    if (options) {\n      this.min = options.min\n      this.max = options.max\n      this.step = options.step\n    }\n  }\n}\n\nexport class BooleanModel extends GenericModel<boolean> {\n  constructor(value: boolean) {\n    super(value)\n  }\n}\n\nexport class OptionModelBase extends Model {\n    private _stringValue: string\n    \n    constructor() {\n        super()\n        this._stringValue = \"\"\n    }\n    \n    set stringValue(v: string) {\n        if (this._stringValue === v)\n            return\n        this._stringValue = v\n        this.modified.trigger()\n    }\n    \n    get stringValue() {\n        return this._stringValue\n    }\n    \n    isValidStringValue(stringValue: string): boolean {\n        return false\n    }\n}\n\nexport class OptionModel<T> extends OptionModelBase {\n    private _map: Map<string, T>\n\n    constructor() {\n        super()\n        this._map = new Map<string, T>()\n    }\n\n    add(id: string, value: T) {\n        this._map.set(id, value)\n    }\n\n    isValidStringValue(stringValue: string): boolean {\n        return this._map.has(stringValue)\n    }\n\n    get value(): T {\n        return this._map.get(this.stringValue)!\n    }\n\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nexport class SignalLink {\n  callback: (data?: any) => void\n  id?: any\n  constructor(callback: (data?: any) => void, id?: any) {\n    this.callback = callback\n    this.id = id\n  }\n}\n\nexport class Signal {\n  locked?: boolean\n  triggered?: any\n  callbacks?: Array<SignalLink>\n\n  add(callback: () => void): void\n  add(callback: () => void, id: any): void\n  add(callback: () => void, id?: any) {\n    if (!this.callbacks)\n      this.callbacks = new Array<SignalLink>()\n    this.callbacks.push(new SignalLink(callback, id))\n  }\n\n  remove(id: any) {\n    if (!this.callbacks)\n      return\n    for(let i=this.callbacks.length-1; i>=0; --i) {\n      if (this.callbacks[i].id === id)\n        this.callbacks.splice(i, 1)\n    }\n  }\n  \n  count(): number {\n    if (!this.callbacks)\n      return 0\n    return this.callbacks.length\n  }\n  \n  lock(): void {\n    this.locked = true\n  }\n  \n  unlock(): void {\n    this.locked = undefined\n    if (this.triggered) {\n      let data = this.triggered.data\n      this.triggered = undefined\n      this.trigger(data)\n    }\n  }\n\n  trigger(data?: any): void {\n    if (this.locked) {\n      this.triggered = { data: data }\n      return\n    }\n    if (!this.callbacks)\n      return\n    for(let i=0; i<this.callbacks.length; ++i)\n      this.callbacks[i].callback(data)\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"./dom\"\n\nimport { Signal } from \"./signal\"\nimport { Model, GenericModel, TextModel, HtmlModel, NumberModel, BooleanModel } from \"./model\"\nimport { GenericView } from \"./view\"\nimport { Controller, globalController } from \"./controller\"\n\nexport { Point, MatrixStruct, Matrix } from \"./matrix\"\nexport { Signal } from \"./signal\"\nexport { Action } from \"./action\"\nexport { Model, GenericModel, TextModel, HtmlModel, NumberModel, BooleanModel, OptionModel, OptionModelBase } from \"./model\"\n\nexport { View, GenericView, ActionView, SlotView } from \"./view\"\nexport { ButtonView } from \"./view/button\"\nexport { ToolButton } from \"./view/toolbutton\"\t// FIXME: no View in name?\nexport { CheckboxView } from \"./view/checkbox\"\nexport { MenuButton } from \"./view/menu\"\t// FIXME: no View in name?\nexport { SliderView } from \"./view/slider\"\nexport { TableView, TableModel, TableEditMode, SelectionModel, registerTableModelLocator, createTableModel } from \"./view/table\"\nexport { TextView } from \"./view/text\"\nexport { TextArea, TextTool } from \"./view/textarea\"\n\nexport { Controller, Template, Dialog, bind, action, unbind, globalController, boolean } from \"./controller\"\n\n// <toad-if> requires correct HTML otherwise <toad-if> and it's content might\n// be separated by stuff like an </p> inserted automatically by the browser\n// so one should use stuff like htmltidy or htmlhint\nclass ToadIf extends GenericView<BooleanModel> {\n  updateModel() {\n  }\n\n  updateView() {\n    if (this.model) {\n      this.style.display = this.model.value ? \"\" : \"none\"\n    }\n  }\n}\ncustomElements.define('toad-if', ToadIf)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Model, TextModel, HtmlModel, BooleanModel, NumberModel } from \"./model\"\nimport { Controller, globalController } from \"./controller\"\n\nimport { Action } from \"./action\"\n\nexport abstract class View extends HTMLElement {\n  controller?: Controller\n\n  abstract setModel(model?: Model): void\n\n  getModelId(): string {\n    if (!this.hasAttribute(\"model\")) \n      throw Error(\"no 'model' attribute\")\n    let modelId = this.getAttribute(\"model\") // FIXME: both hasAttribute & getAttribute? really?\n    if (!modelId)\n      throw Error(\"no model id\")\n    return \"M:\"+modelId\n  }\n\n  getActionId(): string {\n    if (!this.hasAttribute(\"action\")) \n      throw Error(\"no 'action' attribute\")\n    let actionId = this.getAttribute(\"action\") // FIXME: both hasAttribute & getAttribute? really?\n    if (!actionId)\n      throw Error(\"no action id\")\n    return \"A:\"+actionId\n  }\n\n}\n\nexport abstract class GenericView<T extends Model> extends View {\n  model?: T\n\n  constructor() {\n    super()\n  }\n\n  abstract updateModel(): void\n  abstract updateView(): void\n  \n  connectedCallback() {\n    if (this.controller)\n      return\n    let modelId = \"\"\n    try {\n      modelId = this.getModelId()\n    } catch(error) {\n    }\n    if (modelId!=\"\")\n      globalController.registerView(modelId, this)\n  }\n  \n  disconnectedCallback() {\n    if (this.controller)\n      this.controller.unregisterView(this)\n  }\n\n  setModel(model?: T): void {\n    if (model === this.model)\n      return\n\n    let view = this\n    \n    if (this.model)\n      this.model.modified.remove(view)\n    \n    if (model)\n      model.modified.add(() => { view.updateView() }, view)\n\n    this.model = model\n    this.updateView()\n  }\n}\n\n// FIXME: ActionView should also be a template instead of having a fixed TextModel\nexport abstract class ActionView extends GenericView<TextModel> {\n  action?: Action\n\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    if (this.controller) {\n      this.updateView()\n      return\n    }\n\n    try {\n      globalController.registerView(this.getActionId(), this) // FIXME: don't register always on globalController\n    }\n    catch(e) {\n    }\n    \n    try {\n      globalController.registerView(this.getModelId(), this) // FIXME: don't register always on globalController\n    }\n    catch (e) {\n    }\n\n    this.updateView()\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    if (this.controller)\n      this.controller.unregisterView(this)\n  }\n  \n  setModel(model?: Model): void {\n    if (!model) {\n      if (this.model)\n        this.model.modified.remove(this)\n      if (this.action)\n        this.action.modified.remove(this)\n      this.model = undefined\n      this.action = undefined\n      this.updateView()\n      return\n    }\n\n    if (model instanceof Action) {\n      // FIXME: what if this.action is already set?\n      this.action = model\n      this.action.modified.add(() => {\n        this.updateView()\n      }, this)\n    } else\n    if (model instanceof TextModel) {\n      // FIXME: what if this.model is already set?\n      this.model = model\n      this.model.modified.add(() => {\n        this.updateView()\n      }, this)\n    } else {\n      throw Error(\"unexpected model of type \"+model.constructor.name)\n    }\n\n    this.updateView()\n  }\n\n  isEnabled(): boolean {\n    return this.action!==undefined && this.action.enabled\n  }\n}\n\n\nexport class SlotView extends GenericView<TextModel> {\n  constructor() { super() }\n  updateModel() { }\n  updateView() {\n    if (!this.model)\n      return\n      \n    let value = this.model.value === undefined ? \"\" : this.model.value\n    if (this.model instanceof HtmlModel)\n      this.innerHTML = value\n    else\n      this.innerText = value\n  }\n}\nwindow.customElements.define(\"toad-slot\", SlotView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Model, TextModel, HtmlModel } from \"../model\"\nimport { ActionView } from \"../view\"\nimport { globalController } from \"../controller\"\nimport { Action } from \"../action\"\n\nlet buttonStyle = document.createElement(\"style\")\nbuttonStyle.textContent=`\n  button {\n    border: none;\n    background-color: var(--toad-primary-color, #0052cc);\n    color: #ffffff;\n    border-radius: 3px;\n    font-size: 14px;\n    font-weight: bold;\n    height: 32px;\n    line-height: 32px;\n    min-width: 24px;\n    text-shadow: none;\n    padding: 0 10px;\n    margin-right: 4px;\n  }\n  \n  button:hover {\n    background-color: #0065ff;\n  }\n  \n  button:hover:active {\n    background-color: #0049b0;\n  }\n  \n  button:disabled, button:disabled:active {\n    background-color: #888;\n  }\n`\n\nexport class ButtonView extends ActionView {\n  button: HTMLButtonElement\n  _observer?: MutationObserver\n  _timer?: number\n\n  constructor() {\n    super()\n    let buttonView = this\n    this.button = document.createElement(\"button\") as HTMLButtonElement\n    this.button.onclick = () => {\n      if (this.action)\n        this.action.trigger()\n    }\n    this.button.disabled = true\n    \n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(buttonStyle, true))\n    this.shadowRoot!.appendChild(this.button)\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n    if (this.children.length===0) {\n      // Chrome, Opera invoke connectedCallback() before the children are conected\n      this._observer = new MutationObserver((record: MutationRecord[], observer: MutationObserver) => {\n        if (this._timer !== undefined)\n          clearTimeout(this._timer)\n        this._timer = window.setTimeout( () => {\n          this._timer = undefined\n          this.updateView()\n        }, 100)\n      })\n      this._observer.observe(this, {\n        childList: true,\n        subtree: true,\n        characterData: true\n      })\n    }\n  }\n\n\n  updateModel() {\n  }\n\n  updateView() {\n    if (this.model && this.model.value) { // FIXME: use updateView only for Model stuff\n      if (this.model instanceof HtmlModel)\n        this.button.innerHTML = this.model.value\n      else\n        this.button.innerText = this.model.value\n    } else {\n      this.button.innerHTML = this.innerHTML\n    }\n\n    this.button.disabled = !this.isEnabled()\n    // FIXME: set \"disabled\" property of this\n  }\n}\nwindow.customElements.define(\"toad-button\", ButtonView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { BooleanModel } from \"../model\"\nimport { GenericView } from \"../view\"\n\n/* Safari & Chrome can do this and we want this */\ndeclare global {\n  interface SVGElement {\n    focus(): void;\n  }\n}\n\n/*\nthe checkbox can be customized like this (color names are not final yet)\n\n      :root {\n        --toad-neutral-color: #000;\n        --toad-dark-color: #000;\n        --toad-light-color: #fff;\n        --toad-primary-color: #000;\n      }\n\n      toad-checkbox {\n        --border-color: #000;\n        --background-color: none;\n        --marker-color: none;\n        --checked-border-color: #000;\n        --checked-background-color: none;\n        --checked-marker-color: #000;\n      }\n*/\n\n\nlet checkboxStyle = document.createElement(\"style\")\ncheckboxStyle.textContent=`\nsvg {\n  width: 12px;\n  height: 12px;\n  vertical-align: middle;\n  margin: 3px;              /* space for the outline */\n  background: none;\n}\nsvg:focus {\n  outline-offset: -2px;     /* bring outline in touch with the svg */\n  background: #9eccfb;      /* the rectangle is rounded, fill the corners */\n  outline-color: 9eccfb;    /* outline shall be the same color used to fill the corners */\n}\n@media(pointer: coarse) { /* works on Chrome but iOS is never coarse :( */\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n}\nsvg rect {\n  stroke: var(--border-color, var(--toad-neutral-color, #aaa));\n  fill: var(--background-color, #fff);\n  stroke-width: 1px;\n}\nsvg path {\n  stroke: var(--marker-color, none);\n  fill: none;\n  stroke-width: 2px;\n}\n:host([checked]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #0052cc));\n  fill: var(--checked-background-color, var(--toad-primary-color, #0052cc));\n}\n:host([checked]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #fff));\n}\n:host([disabled]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #bdbdbd));\n  fill: var(--checked-background-color, var(--toad-primary-color, #fff));\n}\n:host([disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, none));\n}\n:host([checked][disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #bdbdbd));\n}`\n\nexport class CheckboxView extends GenericView<BooleanModel> {\n  constructor() {\n    super()\n    \n    let svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\")\n    svg.setAttributeNS(\"\", \"viewBox\", \"0 0 18 18\")\n\n    let rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n    rect.setAttributeNS(\"\", \"x\", \"1\")\n    rect.setAttributeNS(\"\", \"y\", \"1\")\n    rect.setAttributeNS(\"\", \"width\", \"16\")\n    rect.setAttributeNS(\"\", \"height\", \"16\")\n    rect.setAttributeNS(\"\", \"rx\", \"3\")\n    rect.setAttributeNS(\"\", \"ry\", \"3\")\n    \n    let checkmark = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\")\n    checkmark.setAttributeNS(\"\", \"d\", \"M4 9.5 L 7.5 13 L 14.5 4\")\n\n    svg.onclick = () => {\n      this.toggle()\n    }\n    svg.setAttributeNS(\"\", \"tabindex\", \"0\")\n    svg.addEventListener(\"keydown\", (event: Event) => {\n      if ((event as KeyboardEvent).key === \" \") {\n        this.toggle()\n      }\n    })\n    svg.onmousedown = (event) => {\n      svg.focus()\n      event.preventDefault()\n    }\n    \n    svg.appendChild(rect)\n    svg.appendChild(checkmark)\n    \n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(checkboxStyle, true))\n    this.shadowRoot!.appendChild(svg)\n  }\n  \n  static get observedAttributes() {return ['checked'] }\n  \n  attributeChangedCallback(name: string, oldValue?: string, newValue?: string) {\n    switch(name) {\n      case \"checked\":\n        this.updateModel()\n        break\n    }\n  }\n  \n  toggle() {\n    if (this.hasAttribute(\"disabled\"))\n      return\n    if (this.hasAttribute(\"checked\"))\n      this.removeAttribute(\"checked\")\n    else\n      this.setAttribute(\"checked\", \"\")\n    this.updateModel()\n  }\n\n  updateModel() {\n    if (this.model) {\n      this.model.value = this.hasAttribute(\"checked\")\n    }\n  }\n\n  updateView() {\n    if (!this.model) {\n      this.setAttribute(\"disabled\", \"\")\n      this.removeAttribute(\"checked\")\n      return\n    }\n    this.removeAttribute(\"disabled\")\n\n    if (this.model.value)\n      this.setAttribute(\"checked\", \"\")\n    else\n      this.removeAttribute(\"checked\")\n  }\n}\nwindow.customElements.define(\"toad-checkbox\", CheckboxView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"../dom\"\nimport { Signal } from \"../signal\"\nimport { Action } from \"../action\"\nimport { Model, TextModel, HtmlModel } from \"../model\"\nimport { GenericView } from \"../view\"\nimport { Controller, globalController } from \"../controller\"\n\nlet menuStyle = document.createElement(\"style\")\nmenuStyle.textContent=`\n  :host(.menu-button) {\n    font-family: var(--toad-font-family, sans-serif);\n    font-size: 14px;\n    font-weight: bold;\n    padding: 7px;\n    vertical-align: center;\n  \n    background: #fff;\n    color: #000;\n    cursor: default;\n  }\n  :host(.menu-button.active) {\n    background: #000;\n    color: #fff;\n  }\n  :host(.menu-button.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.active.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.menu-down) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-down) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.menu-side) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-side) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  .menu-bar {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .menu-popup {\n    position: fixed;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 2px 2px 5px #888;\n  }\n`\n\nexport enum MenuState {\n  WAIT,\n  DOWN,\n  UP_N_HOLD,\n  DOWN_N_HOLD,\n  DOWN_N_OUTSIDE,\n  DOWN_N_INSIDE_AGAIN\n}\n\nexport enum Type {\n  BUTTON,\n  RADIOBUTTON,\n  CHECKBUTTON,\n  SEPARATOR\n}\n\n// menu node\nexport class Node {\n  title: string\n  label: string\n  shortcut?: string\n  type: string\n  modelId?: string\n\n  parent?: Node\n  down?: Node\n  next?: Node\n\n  view?: HTMLElement\n  \n  constructor(title: string, label: string, shortcut?: string, type?: string, modelId?: string) {\n    this.title = title\n    this.label = label\n    this.shortcut = shortcut\n    this.type = type ? type : \"entry\"\n    this.modelId = modelId\n  }\n  \n  isEnabled(): boolean {   // get/set\n    return true\n  }\n  \n  isAvailable(): boolean { // get/set\n    return true\n  }\n  \n  createWindowAt(parent: MenuHelper, parentView: HTMLElement): void {\n    if (this.type==\"spacer\") {\n      let span = document.createElement(\"span\") as HTMLSpanElement\n      span.style.flexGrow = \"1\"\n      parentView.appendChild(span)\n      return\n    }\n    this.view = new MenuButton(parent, this)\n    parentView.appendChild(this.view)\n  }\n  \n  deleteWindow(): void {\n  }\n}\n\n// FIXME: rename into MenuButtonContainer\nexport class MenuHelper extends HTMLElement {\n  vertical: boolean\n  closeOnClose: boolean\n  active?: MenuButton\n  state: MenuState\n  btnmaster?: MenuButton\n  parentButton?: MenuButton\n  \n  constructor() {\n    super()\n    this.vertical = true\n    this.closeOnClose = false\n    this.state = MenuState.WAIT\n  }\n}\n\nexport class Menu extends MenuHelper\n{\n  root: Node\n  view?: HTMLElement\n  _observer?: MutationObserver\n  _timer?: number\n  \n  constructor() {\n    super()\n    this.vertical = false\n    this.root = new Node(\"\", \"\", undefined, undefined)\n    \n  }\n\n  connectedCallback() {\n    this.tabIndex = 0\n\n    if (this.children.length===0) {\n      // Chrome, Opera invoke connectedCallback() before the children are conected\n      this._observer = new MutationObserver((record: MutationRecord[], observer: MutationObserver) => {\n        if (this._timer !== undefined)\n          clearTimeout(this._timer)\n        this._timer = window.setTimeout( () => {\n          this._timer = undefined\n          this.layout2nodes(this.children, this.root)\n          this.referenceActions()\n          this.createShadowDOM()\n        }, 100)\n      })\n      this._observer.observe(this, {\n        childList: true,\n        subtree: true\n      })\n    } else {\n      // Safari invokes connectedCallback() after the children are connected\n      this.layout2nodes(this.children, this.root)\n      this.referenceActions()\n      this.createShadowDOM()\n    }\n/*    \n    globalController.sigChanged.add(() => {\n      if (globalController.reasonType===\"action-add\") {\n        if (!globalController.reasonAction)\n          return\n        let node = this.findNode(globalController.reasonAction.title)\n        if (node) {\n          node.addAction(globalController.reasonAction)\n        }\n      }\n    }, this)\n*/\n  }\n  \n  disconnectedCallback() {\n//    globalController.sigChanged.remove(this)\n  }\n  \n  layout2nodes(children: HTMLCollection, parent: Node): void {\n    let node = parent.down\n    for(let child of children) {\n      let newnode: Node|undefined = undefined\n      switch(child.nodeName) {\n        case \"TOAD-MENUSPACER\":\n          newnode = new Node(\"\", \"\", \"\", \"spacer\")\n          break\n        case \"TOAD-MENUENTRY\":\n          newnode = new Node(\n            dom.attribute(child, \"name\"),\n            dom.attribute(child, \"label\"),\n            dom.attributeOrUndefined(child, \"shortcut\"),\n            dom.attributeOrUndefined(child, \"type\"),\n            dom.attributeOrUndefined(child, \"model\")\n          )\n          break\n      }\n      if (newnode) {\n        newnode.parent = parent\n        if (!node)\n          parent.down = newnode\n        else\n          node.next = newnode\n        node = newnode\n      }\n      if (!node)\n        throw Error(\"fuck\")\n      this.layout2nodes(child.children, node)\n    }\n  }\n  \n  referenceActions(): void {\n/*\n    for(let titleAndAction of globalController.actionStorage) {\n      let title = titleAndAction[0]\n      let action = titleAndAction[1]\n      let node = this.findNode(title)\n      if (node) {\n        node.addAction(action)\n      }\n    }\n*/\n  }\n  \n  findNode(str: string, parent?: Node): Node | undefined {\n    let strpos = str.indexOf(\"|\")\n    let left = strpos == -1 ? str : str.substr(0, strpos)\n    let right = strpos == -1 ? \"\" : str.substr(strpos+1)\n    \n    if (!parent)\n      parent = this.root\n    \n    for(let n=parent.down; n; n=n.next) {\n      if (n.title == left) {\n        if (!n.down) {\n          return n\n        }\n        return this.findNode(right, n)\n      }\n    }\n  \n    return undefined\n  }\n  \n  createShadowDOM() {\n    this.view = document.createElement(\"div\")\n    this.view.classList.add(\"menu-bar\")\n\n    let node = this.root.down\n    while(node) {\n      if (node.isAvailable()) {\n        node.createWindowAt(this, this.view)\n      } else {\n        node.deleteWindow()\n      }\n      node = node.next\n    }\n\n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(menuStyle, true))\n    this.shadowRoot!.appendChild(this.view)\n  }\n}\nwindow.customElements.define(\"toad-menu\", Menu)\n\nclass MenuEntry extends HTMLElement {\n}\nwindow.customElements.define(\"toad-menuentry\", MenuEntry)\nclass MenuSpacer extends HTMLElement {\n}\nwindow.customElements.define(\"toad-menuspacer\", MenuSpacer)\n\nexport class PopupMenu extends MenuHelper\n{\n  root: Node\n  vertical: boolean\n  parentButton: MenuButton\n  popup: HTMLElement\n\n  constructor(root: Node, parent: MenuButton) {\n    super()\n    this.vertical = true\n    this.root = root\n    this.parentButton = parent\n\n    this.popup = document.createElement(\"div\")\n    this.popup.classList.add(\"menu-popup\")\n\n    let node = root.down\n    while(node) {\n      if (node.isAvailable()) {\n        node.createWindowAt(this, this.popup)\n      } else {\n        node.deleteWindow()\n      }\n      node = node.next\n    }\n    this.appendChild(this.popup)\n    this.show()\n  }\n    \n  \n  show() {\n    if (!this.parentButton.master!.vertical)\n      placePopupVertical(this.parentButton, this.popup)\n    else\n      placePopupHorizontal(this.parentButton, this.popup)\n    this.style.display = \"\"\n  }\n  \n  hide() {\n    this.style.display = \"none\"\n  }\n}\nwindow.customElements.define(\"toad-popupmenu\", PopupMenu)\n\nexport class MenuButton extends GenericView<TextModel> {\n  static inside?: MenuButton\n  static buttonDown: boolean\n  static documentMouseDown?: (event: MouseEvent) => void\n\n  node: Node\n  master?: MenuHelper // FIXME: rename into container\n  popup?: PopupMenu\n  \n  action?: Action\n\n  constructor(master: MenuHelper, node: Node) {\n    super()\n    this.master = master\n    this.node = node\n    let menuButton = this\n    this.classList.add(\"menu-button\")\n    if (node.down) {\n      if (master.vertical)\n        this.classList.add(\"menu-side\")\n      else\n        this.classList.add(\"menu-down\")\n    }\n    this.updateView()\n    \n    this.onmousedown = (event: MouseEvent) => {\n      event.stopPropagation()\n\n//if (this.node) console.log(\"mousedown \", this.node.title)\n\n      let documentMouseUp = function(event: MouseEvent) {\n        document.removeEventListener(\"mouseup\", documentMouseUp, {capture: true})\n        event.preventDefault()\n        setTimeout(()=>{\n          if (MenuButton.buttonDown)\n            menuButton.dispatchEvent(new MouseEvent(\"mouseup\", event))\n        }, 0)\n      }\n      document.addEventListener(\"mouseup\", documentMouseUp, {capture: true})\n      MenuButton.buttonDown = true\n\n      if (!this.master)\n        throw Error(\"fuck\")\n      switch(this.master.state) {\n        case MenuState.WAIT:\n          this.master.state = MenuState.DOWN\n          this.activate()\n          break\n        case MenuState.UP_N_HOLD:\n          if (this.master.active!==this) {\n            this.master.state = MenuState.DOWN\n            this.activate()\n          } else {\n            this.master.state = MenuState.DOWN_N_HOLD\n          }\n          break\n        default:\n          throw Error(\"unexpected state \"+this.master.state)\n      }\n      return false\n    }\n    \n    this.onmouseup = (event: MouseEvent) => {\n      event.stopPropagation()\n      if (!MenuButton.buttonDown)\n        return\n      MenuButton.buttonDown = false\n\n//if (this.node) console.log(\"mouseup \", this.node.title)\n\n      if (!this.master)\n        throw Error(\"fuck\")\n      if (!this.node)\n        throw Error(\"fuck\")\n      switch(this.master.state) {\n        case MenuState.DOWN:\n          if (this.node.isEnabled() && !this.node.down) {\n            this.trigger()\n            this.master.state = MenuState.WAIT\n          } else {\n            this.master.state = MenuState.UP_N_HOLD\n            \n            if (MenuButton.documentMouseDown) {\n              document.removeEventListener(\"mousedown\", MenuButton.documentMouseDown, {capture: false})\n            }\n            MenuButton.documentMouseDown = function(event: MouseEvent) {\n              if (MenuButton.documentMouseDown)\n                document.removeEventListener(\"mousedown\", MenuButton.documentMouseDown, {capture: false})\n              MenuButton.documentMouseDown = undefined\n              let tagName = (event.target as HTMLElement).tagName\n              if (tagName!==\"TOAD-MENUBUTTON\") {\n                menuButton.collapse()\n              }\n            }\n            document.addEventListener(\"mousedown\", MenuButton.documentMouseDown, {capture: false})\n          }\n          break\n        case MenuState.DOWN_N_HOLD:\n        case MenuState.DOWN_N_OUTSIDE:\n          this.master.state = MenuState.WAIT\n          this.deactivate()\n          this.collapse()\n          // this.dropKeyboard()\n          if (this.master.closeOnClose) {\n            // this.master.destroyWindow()\n          }\n          break\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          // this.dropKeyboard()\n          this.trigger()\n          break\n        default:\n          throw Error(\"unexpected state \"+this.master.state)\n      }\n      return false\n    }\n    \n    // leave\n    this.onmouseout = (event: MouseEvent) => {\n      event.stopPropagation()\n//console.log(\"mouseout \", this.node.title)\n      if (!this.master)\n        throw Error(\"fuck\")\n      MenuButton.inside = undefined\n      switch(this.master.state) {\n        case MenuState.WAIT:\n        case MenuState.DOWN_N_OUTSIDE:\n        case MenuState.UP_N_HOLD:\n        case MenuState.DOWN_N_HOLD:\n          break\n        case MenuState.DOWN:\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          this.master.state = MenuState.DOWN_N_OUTSIDE\n          this.updateView()\n          break;\n        default:\n          throw Error(\"unexpected state\")\n      }\n      return false\n    }\n    \n    this.onmouseover = (event: MouseEvent) => {\n      event.stopPropagation()\n//console.log(\"mouseover \", this.node.title)\n      if (!menuButton.master)\n        throw Error(\"fuck\")\n      MenuButton.inside = menuButton\n      switch(menuButton.master.state) {\n        case MenuState.WAIT:\n        case MenuState.UP_N_HOLD:\n        case MenuState.DOWN_N_OUTSIDE:\n        case MenuState.DOWN_N_HOLD:\n        case MenuState.DOWN:\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          if (!MenuButton.buttonDown)\n            break\n          if (!this.master)\n            throw Error(\"fuck\")\n          if (this.master.active)\n            this.master.active.deactivate()\n          this.master.state = MenuState.DOWN_N_INSIDE_AGAIN\n          this.activate()\n          break\n        default:\n          throw Error(\"unexpected state \"+menuButton.master.state)\n      }\n      return false\n    }\n    \n    this.attachShadow({mode: 'open'})\n    if (!this.shadowRoot)\n      throw Error(\"fuck\")\n    this.shadowRoot.appendChild(document.importNode(menuStyle, true))\n    if (!this.node.modelId)\n      this.shadowRoot.appendChild(document.createTextNode(node.label))\n  }\n\n  connectedCallback() {\n    if (this.controller)\n      return\n      \n    if (this.node.down===undefined) {\n      let actionId=this.node.title\n      for(let node=this.node.parent; node; node=node.parent) {\n        if (!node.title.length)\n          break\n        actionId=node.title+\"|\"+actionId\n      }\n      actionId = \"A:\"+actionId\n//console.log(\"*** register view action \"+actionId, this.node)\n      globalController.registerView(actionId, this)\n    }\n\n    if (this.node.modelId!==undefined) {\n      let modelId = \"M:\"+this.node.modelId\n      globalController.registerView(modelId, this)\n    }\n    \n  }\n\n  disconnectedCallback() {\n    if (this.controller)\n      this.controller.unregisterView(this)\n  }\n  \n  setModel(model?: Model): void {\n    if (!model) {\n      if (this.action)\n        this.action.modified.remove(this)\n      this.model = undefined\n      this.action = undefined\n      this.updateView()\n      return\n    }\n\n    if (model instanceof Action) {\n      this.action = model\n      this.action.modified.add(() => {\n        this.updateView()\n      }, this)\n    } else\n    if (model instanceof TextModel) {\n      this.model = model\n    } else {\n      throw Error(\"unexpected model of type \"+model.constructor.name)\n    }\n    this.updateView()\n  }\n  \n  updateModel() {\n//console.log(\"MenuButton.updateModel \"+this.node.title)\n  }\n\n  updateView(): void {\n    if (this.model && this.model.value) { // FIXME: use updateView only for Model stuff\n      if (!this.shadowRoot)\n        throw Error(\"fuck\")\n//      console.log(\"update view with model\")\n      let span = document.createElement(\"span\")\n      if (this.model instanceof HtmlModel)\n        span.innerHTML = this.model.value\n      else\n        span.innerText = this.model.value\n\n      // FIXME: dom.replaceChild(this.shadowRoot, 1, span)\n      if (this.shadowRoot.children.length>1)\n        this.shadowRoot.removeChild(this.shadowRoot.children[1])\n      if (this.shadowRoot.children.length>1)\n        this.shadowRoot.insertBefore(span, this.shadowRoot.children[1])\n      else\n        this.shadowRoot.appendChild(span)\n    }\n  \n    if (!this.master)\n      throw Error(\"fuck\")\n\n    let active = false\n    if (this.master.active==this) {\n      switch(this.master.state) {\n        case MenuState.DOWN:\n        case MenuState.UP_N_HOLD:\n        case MenuState.DOWN_N_HOLD:\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          active = true\n          break\n        case MenuState.DOWN_N_OUTSIDE:\n          if (!this.node)\n            throw Error(\"fuck\")\n          active = this.node.down!==undefined && this.node.isEnabled()\n          break\n      }\n    }\n\n    this.classList.toggle(\"active\", active)\n\n    this.classList.toggle(\"disabled\", !this.isEnabled())\n  }\n  \n  isEnabled(): boolean {\n    if (this.node.down!==undefined)\n      return true\n    return this.action!==undefined && this.action.enabled\n  }\n  \n  trigger(): void {\n    this.collapse()\n    if (!this.action)\n      return\n    this.action.trigger()\n  }\n  \n  collapse(): void {\n    if (!this.master)\n      throw Error(\"fuck\")\n    if (this.master.parentButton)\n      this.master.parentButton.collapse()\n    else\n      this.deactivate()\n  }\n  \n  openPopup(): void {\n    if (!this.node)\n      return\n    if (!this.node.down)\n      return\n\n    if (!this.shadowRoot)\n      throw Error(\"fuck\")\n\n    if (!this.popup) {\n      this.popup = new PopupMenu(this.node, this)\n      this.shadowRoot.appendChild(this.popup)\n    } else {\n      this.popup.show()\n    }\n  }\n  \n  closePopup(): void {\n    if (!this.popup)\n      return\n    if (this.popup.active)\n      this.popup.active.deactivate()\n    this.popup.hide()\n  }\n  \n  activate(): void {\n    if (!this.master)\n      throw Error(\"fuck\")\n    if (!this.node)\n      throw Error(\"fuck\")\n    \n    // if active return\n    \n    let oldActive = this.master.active\n    this.master.active = this\n    if (oldActive && oldActive!==this) {\n      oldActive.closePopup()\n      oldActive.updateView()\n    }\n    this.updateView()\n    this.openPopup()\n  }\n  \n  deactivate(): void {\n    if (!this.master)\n      throw Error(\"fuck\")\n    if (this.master.active !== this)\n      return\n    \n    this.master.active.closePopup()\n    this.master.active = undefined\n    this.master.state = MenuState.WAIT\n    this.updateView()\n  }\n  \n}\nwindow.customElements.define(\"toad-menubutton\", MenuButton)\n\nfunction placePopupVertical(parent: HTMLElement, popup: HTMLElement): void {\n  let parentBoundary = parent.getBoundingClientRect()\n\n  // FIXME: need to handle scrollLeft, scrollTop?\n\n  popup.style.opacity = \"0\"\n  popup.style.left = parentBoundary.left+\"px\"\n  popup.style.top = (parentBoundary.top+parentBoundary.height)+\"px\"\n\n  setTimeout(function() {\n    // FIXME: there might still not be enough space, might want to scroll and/or overlap parent\n    let popupBoundary = popup.getBoundingClientRect()\n    let popupBottom = parentBoundary.top + parentBoundary.height + popupBoundary.height\n    if (popupBottom > window.innerHeight) {\n      popup.style.top = (parentBoundary.top - popupBoundary.height)+\"px\"\n    }\n    let popupRight = parentBoundary.left + popupBoundary.width\n    if (popupRight > window.innerWidth) {\n       popup.style.left = (parentBoundary.left + parentBoundary.width - popupBoundary.width)+\"px\"\n    }\n    popup.style.opacity = \"1\"\n  }, 0)\n\n//  window.addEventListener(\"mouseup\", new PopupListener(popup), true)\n}\n\nfunction placePopupHorizontal(parent: HTMLElement, popup: HTMLElement): void {\n  let parentBoundary = parent.getBoundingClientRect()\n\n  // FIXME: need to handle scrollLeft, scrollTop?\n\n  popup.style.opacity = \"0\"\n  popup.style.left = (parentBoundary.left+parentBoundary.width)+\"px\"\n  popup.style.top = parentBoundary.top+\"px\"\n\n  setTimeout(function() {\n    // FIXME: there might still not be enough space, might want to scroll and/or overlap parent\n    let popupBoundary = popup.getBoundingClientRect()\n    let popupBottom = parentBoundary.top + popupBoundary.height\n    if (popupBottom > window.innerHeight) {\n      popup.style.top = (parentBoundary.top + parentBoundary.height - popupBoundary.height)+\"px\"\n    }\n    let popupRight = parentBoundary.left + parentBoundary.width + popupBoundary.width\n    if (popupRight > window.innerWidth) {\n       popup.style.left = (parentBoundary.left - popupBoundary.width)+\"px\"\n    }\n    popup.style.opacity = \"1\"\n  }, 0)\n\n//  window.addEventListener(\"mouseup\", new PopupListener(popup), true)\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { NumberModel } from \"../model\"\nimport { GenericView } from \"../view\"\n\nexport class SliderView extends GenericView<NumberModel> {\n  input: HTMLInputElement\n\n  constructor() {\n    super()\n    this.input = document.createElement(\"input\") as HTMLInputElement\n    this.input.type = \"range\"\n    let view = this\n    this.input.oninput = () => { view.updateModel() }\n    this.attachShadow({mode: 'open'})\n        .appendChild(this.input)\n  }\n  \n  updateModel() {\n    if (this.model)\n      this.model.value = Number.parseFloat(this.input.value)\n  }\n\n  updateView() {\n    if (!this.model)\n      return\n    this.input.step = String(this.model.step)\n    this.input.min = String(this.model.min)\n    this.input.max = String(this.model.max)\n    this.input.value = String(this.model.value)\n  }\n}\nwindow.customElements.define(\"toad-slider\", SliderView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"../dom\"\nimport { Model, TextModel, HtmlModel } from \"../model\"\nimport { View, GenericView } from \"../view\"\nimport { TextView } from \"./text\"\n\nfunction dump(element: HTMLElement, depth?: number): void {\n  if (depth===undefined)\n    depth = 0\n  let out=\"\"\n  for(let i=0; i<depth; ++i)\n    out += \"  \"\n  out += element.tagName\n  if (element.tagName===\"TD\" || element.tagName===\"TH\")\n    out+=\"  '\" + element.innerText + \"'\"\n  console.log(out)\n  for(let child of element.children)\n    dump(child as HTMLElement, depth+1)\n}\n\ndeclare global {\n  interface Element {\n    scrollIntoViewIfNeeded(center?: boolean): void\n  }\n}\n\nlet tableStyle = document.createElement(\"style\")\ntableStyle.textContent=`\n.t2 {\n  /* border: 1px inset; */\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  outline-offset: -2px;\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n}\n\n.t2h, .t2d {\n  border-color: #ccc #fff #fff #ccc;\n  border-width: 2px 0px 0px 2px;\n  border-style: solid none none solid;\n  border-collapse: collapse;\n  border-spacing: 0;\n}\n\n/* FIXME: there is no re-evaluation after the table view was resized */\n/*\nth:last-child, td:last-child {\n  width: 100%;\n}\n*/\n\n.t2h tr {\n  background: #e0e0e0;\n}\n\n.t2h * th {\n  border-color: #fff #ccc #ccc #fff;\n  border-style: none solid none none;\n  border-width: 0 1px 0 0;\n  z-index: 1;\n  letter-spacing: 0;  \n  overflow: hidden;   \n  padding: 2px;\n  margin: 0px; \n  white-space: nowrap;\n}\n \n.t2d * td {\n  border-color: #fff #ccc #ccc #fff;\n  border-style: none solid solid none;\n  border-width: 0 1px 1px 0;\n  letter-spacing: 0;\n  overflow: hidden; \n  padding: 2px;\n  margin: 0px; \n  white-space: nowrap;\n  /* background: #fff; */\n}\n\n.t2d tr:nth-child(even) {\n  background: var(--toad-table-even-row, #f5f5f5);\n}\n.t2d tr:nth-child(odd) {\n  background: var(--toad-table-odd-row, #ffffff);\n}\n\ndiv .t2d tr.selected,\ndiv .t2d tr td.selected {\n/*\n  background: #dcdcdc;\n  color: #000;\n*/\n  background: #808080;\n  color: #fff;\n}\n\n.t2:focus .t2d tr.selected,\n.t2:focus .t2d tr td.selected {\n  background: #0069d4;\n  color: #fff;\n}\n\n`\n\nfunction pixelToNumber(pixel: string): number {\n  if (pixel.substr(pixel.length-2) !== \"px\")\n    throw Error(\"expected 'px' suffix\")\n  return Number.parseFloat(pixel.substr(0, pixel.length-2))\n}\n  \nfunction getPropertyValue(element: HTMLElement, propertyName: string): number {\n  let elementStyle = window.getComputedStyle(element, undefined)\n  let property = elementStyle.getPropertyValue(propertyName)\n  return pixelToNumber(property)\n}\n  \nfunction horizontalPadding(element: HTMLElement): number {\n  return getPropertyValue(element, \"padding-left\") + getPropertyValue(element, \"padding-right\")\n}\n\nexport enum TableEditMode {\n  EDIT_CELL, // FIXME: replace with SELECT_CELL and TableModel.getFieldView will return undefined when not editable\n  SELECT_CELL,\n//  SELECT_COLUMN,\n  SELECT_ROW\n}\n\nexport class TablePos {\n  col: number\n  row: number\n  constructor(col: number, row: number) {\n    this.col = col\n    this.row = row\n  }\n}\n\n// FIXME: also needed is a model for range and 'random' selections\nexport class SelectionModel extends Model {\n  mode: TableEditMode // FIXME: there might be a way to do without, just by the behaviour of a common API towards TableView\n  _value: TablePos\n  \n  constructor() {\n    super()\n    this.mode = TableEditMode.SELECT_ROW\n    this._value = new TablePos(0,0)\n  }\n  \n  set col(col: number) {\n    if (this._value.col === col)\n      return\n    this._value.col = col\n    this.modified.trigger()\n  }\n\n  get col(): number {\n    return this._value.col\n  }\n\n  set row(row: number) {\n    if (this._value.row === row)\n      return\n    this._value.row = row\n    this.modified.trigger()\n  }\n\n  get row(): number {\n    return this._value.row\n  }\n\n  set value(value: TablePos) {\n    if (this._value.col === value.col && this._value.row === value.row)\n      return\n    this._value = value\n    this.modified.trigger()\n  }\n  \n  get value(): TablePos {\n    return this._value\n  }\n}\n\n// FIXME: API for insert, delete and move row(s)\nexport abstract class TableModel extends Model {\n  cols: number\n  rows: number\n  \n  constructor() {\n    super()\n    this.cols = 0\n    this.rows = 0\n  }\n\n//  set value(data: any) {}\n//  get value(): any { return undefined }\n\n  getColumnHead(column: number): TextModel | undefined { return undefined }\n  abstract getFieldModel(col: number, row: number): TextModel\n  getFieldView(col: number, row: number): View | undefined { return undefined }\n}\n\nlet tableModelLocators = new Array<(data: any) => TableModel|undefined>()\n\nexport function registerTableModelLocator( locator: (data: any) => TableModel|undefined ): void {\n  tableModelLocators.push(locator)\n}\n\nexport function createTableModel(data: any): TableModel {\n  for(let locator of tableModelLocators) {\n    let model = locator(data)\n    if (model)\n      return model\n  }\n  throw new Error(\"findTableModel() failed to locate a table model\")\n}\n\nclass ArrayTableModel extends TableModel {\n\n  data: any\n\n  constructor(data: any) {\n    super()\n    this.data = data\n    this.rows = this.data.length\n    this.cols = this.data[0].length\n  }\n\n  getColumnHead(column: number): TextModel {\n    switch(column) {\n      case 0: return new TextModel(\"Title\")\n      case 1: return new TextModel(\"Author\")\n      case 2: return new TextModel(\"Year\")\n    }\n    throw Error(\"fuck\")\n  }\n  \n  getFieldModel(col: number, row: number): TextModel {\n    let model = new TextModel(this.data[row][col])\n    model.modified.add( () => {\n      this.data[row][col] = model.value\n    })\n    return model\n  }\n\n  getFieldView(col: number, row: number): View {\n    return new TextView()\n  }\n}\n\nregisterTableModelLocator( function(data: any): TableModel | undefined {\n  if (!(data instanceof Array)) {\n    return undefined\n  }\n  if (data.length===0) {\n    return undefined\n  }\n  if (!(data[0] instanceof Array)) {\n    return undefined\n  }\n  for(let field of data[0]) {\n    if ( typeof field !== \"string\" &&\n         typeof field !== \"number\" )\n    {\n      return undefined\n    }\n  }\n  return new ArrayTableModel(data)\n})\n\nexport class TableView extends GenericView<TableModel> {\n\n  selectionModel?: SelectionModel\n\n  rootElement: HTMLElement\n  headTable: HTMLTableElement\n  headRow: HTMLTableRowElement\n  bodyRow: HTMLTableRowElement\n  bodyDiv: HTMLDivElement\n  bodyBody: HTMLTableSectionElement\n\n  input: HTMLElement\n  fieldView?: HTMLElement\n  fieldModel?: Model\n  cellBeingEdited?: HTMLElement\n  insideGoTo: boolean\n\n  constructor() {\n    super()\n    \n    this.insideGoTo = false\n    \n    let rootElement = dom.tag(\"div\")\n    rootElement.className = \"t2\"\n    \n    rootElement.onkeydown = (event: KeyboardEvent) => {\n      if (!this.selectionModel)\n        return\n      // FIXME: based on the selection model we could plug in a behaviour class\n      switch(this.selectionModel.mode) {\n        case TableEditMode.SELECT_ROW: {\n          let row = this.selectionModel.value.row\n          switch(event.key) {\n            case \"ArrowDown\":\n              if (row+1<this.model!.rows)\n                ++row\n              break\n            case \"ArrowUp\":\n              if (row>0)\n                --row\n              break\n          }\n          if (row != this.selectionModel.value.row) {\n            this.toggleRowSelection(this.selectionModel.value.row, false)\n            this.selectionModel.row = row\n            this.toggleRowSelection(this.selectionModel.value.row, true)\n          }\n        } break\n        case TableEditMode.SELECT_CELL: {\n          let pos = { col: this.selectionModel.col, row: this.selectionModel.row }\n          switch(event.key) {\n            case \"ArrowRight\":\n              if (pos.col+1<this.model!.cols) {\n                ++pos.col\n              }\n              break\n            case \"ArrowLeft\":\n              if (pos.col>0) {\n                --pos.col\n              }\n              break\n            case \"ArrowDown\":\n              if (pos.row+1<this.model!.rows)\n                ++pos.row\n              break\n            case \"ArrowUp\":\n              if (pos.row>0)\n                --pos.row\n              break\n          }\n          if (pos.col != this.selectionModel.col ||\n              pos.row != this.selectionModel.row)\n          {\n            this.toggleCellSelection(this.selectionModel.value, false)\n            this.selectionModel.value = pos\n            this.toggleCellSelection(this.selectionModel.value, true)\n          }\n        } break\n      }\n    }\n    this.rootElement = rootElement\n\n    // head\n    let headDiv = dom.tag(\"div\")\n    // headDiv.style.width = \"1px\"\n    headDiv.style.overflow = \"hidden\"\n    \n    let headTable = dom.tag(\"table\") as HTMLTableElement\n    this.headTable = headTable\n    headTable.className = \"t2h\"\n    \n    let headHead = dom.tag(\"thead\")\n    \n    let headRow = dom.tag(\"tr\") as HTMLTableRowElement\n    this.headRow = headRow\n    \n    headHead.appendChild(headRow)\n    headTable.appendChild(headHead)\n    headDiv.appendChild(headTable)\n    rootElement.appendChild(headDiv)\n\n    // body\n    let bodyDiv = dom.tag(\"div\") as HTMLDivElement\n    // headDiv.style.width = \"1px\"\n    bodyDiv.style.overflow = \"auto\"\n    bodyDiv.onscroll = function() {\n      headDiv.scrollLeft = bodyDiv.scrollLeft\n    }\n    this.bodyDiv = bodyDiv\n    \n    let bodyTable = dom.tag(\"table\")\n    bodyTable.className = \"t2d\"\n    bodyTable.onmousedown = (event: MouseEvent) => {\n      if (!event.srcElement)\n        return\n      if ((event.srcElement as HTMLElement).tagName !== \"TD\")\n        return\n      event.preventDefault() // otherwise field will loose focus again\n      this.goToField(event.srcElement as HTMLTableDataCellElement)\n    }\n    \n    let bodyBody = dom.tag(\"tbody\") as HTMLTableSectionElement\n    this.bodyBody = bodyBody\n    \n    let bodyRow = dom.tag(\"tr\") as HTMLTableRowElement\n    bodyBody.appendChild(bodyRow)\n    this.bodyRow = bodyRow\n    \n    bodyTable.appendChild(bodyBody)\n    bodyDiv.appendChild(bodyTable)\n\n    let zeroSize = dom.tag(\"div\")\n    zeroSize.style.width = \"0px\"\n    zeroSize.style.height = \"0px\"\n    zeroSize.style.margin = \"0\"\n    zeroSize.style.padding = \"0\"\n    zeroSize.style.border = \"none\"\n    \n    this.input = dom.tag(\"div\") as HTMLElement\n    this.input.style.position = \"relative\"\n    this.input.style.background = \"#fff\"\n    this.input.style.border=\"none\"\n    this.input.style.opacity = \"0\"\n    \n    this.input.addEventListener(\"focusin\", (genericEvent: Event) => {\n      this.input.style.opacity = \"1\"\n      if (this.insideGoTo)\n        return\n      if (!this.model)\n        return\n      let event = genericEvent as FocusEvent\n      if (event.target && event.relatedTarget) {\n        if (dom.order(event.relatedTarget as Node, this)) {\n          this.goTo(0, 0)\n        } else {\n          this.goTo(this.model.cols-1, this.model.rows-1)\n        }\n      }\n    })\n    this.input.addEventListener(\"focusout\", () => {\n      this.input.style.opacity = \"0\"\n    })\n    \n    zeroSize.appendChild(this.input)\n    bodyDiv.appendChild(zeroSize)\n\n    rootElement.appendChild(bodyDiv)\n\n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(tableStyle, true))\n    this.shadowRoot!.appendChild(rootElement)\n  }\n  \n  connectedCallback() {\n    super.connectedCallback()\n    this.bodyDiv.style.height = this.style.height // FIXME: include heading\n  }\n  \n  setModel(model?: Model): void {\n    if (!model) {\n      if (this.selectionModel)\n        this.selectionModel.modified.remove(this)\n      this.model = undefined\n      this.selectionModel = new SelectionModel()\n      this.updateView()\n      return\n    }\n\n    if (model instanceof SelectionModel) {\n      this.selectionModel = model\n      this.updateSelection()\n      this.selectionModel.modified.add(() => {\n        this.updateSelection()\n      }, this)\n    } else\n    if (model instanceof TableModel) {\n      this.model = model\n      this.updateView()\n    } else {\n      throw Error(\"unexpected model of type \"+model.constructor.name)\n    }\n  }\n  \n  updateModel() {\n//console.log(\"TableView.updateModel()\")\n//    if (this.model)\n//      this.model.value = this.input.value\n  }\n\n  updateView() {\n//console.log(\"TableView.updateView()\")\n    if (!this.model) {\n      return\n    }\n\n//console.log(\"updateHeader, updateBody\")\n    this.updateHeader()\n    this.updateBody()\n    this.updateSelection()\n    setTimeout( () => {\n      this.adjustInternalTables()\n    })\n  }\n\n  updateHeader() {\n    if (!this.model)\n      throw Error(\"fuck\")\n\n    let noHeader = false\n\n    while(this.headRow.children.length>this.model.cols+1)\n      this.headRow.removeChild(this.headRow.children[this.headRow.children.length-1])\n\n    for(let i=0; i<this.model.cols; ++i) {\n      let cell\n      if (i>=this.headRow.children.length) {\n        cell = dom.tag(\"th\")\n        this.headRow.appendChild(cell)\n      } else {\n        cell = this.headRow.children[i] as HTMLTableDataCellElement\n        cell.style.minWidth = \"\"\n        cell.style.border = \"\"\n      }\n      let text = this.model.getColumnHead(i)\n      if (text === undefined) {\n        noHeader = true\n        continue\n      }\n      if (text instanceof HtmlModel)\n        cell.innerHTML = text.value\n      else\n        cell.innerText = text.value\n    }\n    \n    let fillerForMissingScrollbar\n    if (this.headRow.children.length<this.model.cols+1) {\n      fillerForMissingScrollbar = dom.tag(\"th\") as HTMLTableDataCellElement\n      this.headRow.appendChild(fillerForMissingScrollbar)\n    } else {\n      fillerForMissingScrollbar = this.headRow.children[this.headRow.children.length-1] as HTMLTableDataCellElement\n    }\n    fillerForMissingScrollbar.innerText = \"\"\n    fillerForMissingScrollbar.style.minWidth = \"777px\"\n    fillerForMissingScrollbar.style.border = \"0px none\"\n    \n    this.headTable.style.display = noHeader ? \"none\" : \"\"\n  }\n  \n  updateBody() {\n    if (!this.model)\n      throw Error(\"fuck\")\n      \n    while(this.bodyRow.children.length > this.model.cols)\n      this.bodyRow.removeChild(this.bodyRow.children[this.bodyRow.children.length-1])\n\n    while(this.bodyRow.children.length < this.model.cols) {\n      let cell = dom.tag(\"td\")\n      cell.style.paddingTop = \"0\"\n      cell.style.paddingBottom = \"0\"\n      this.bodyRow.appendChild(cell)\n    }\n//    (this.bodyRow.children[this.bodyRow.children.length] as HTMLElement).style.width=\"100%\"\n\n    while(this.bodyBody.children.length-1 > this.model.rows)\n      this.bodyBody.removeChild(this.bodyBody.children[this.bodyBody.children.length-1])\n\n    for(let row=0; row<this.model.rows; ++row) {\n      let bodyRow: HTMLTableRowElement\n      if (row+1 >= this.bodyBody.children.length) {\n        bodyRow = dom.tag(\"tr\") as HTMLTableRowElement\n        this.bodyBody.appendChild(bodyRow)\n      } else {\n        bodyRow = this.bodyBody.children[row+1] as HTMLTableRowElement\n      }\n\n      while(bodyRow.children.length>this.model.cols)\n        bodyRow.removeChild(bodyRow.children[bodyRow.children.length-1])\n\n      for(let col=0; col<this.model.cols; ++col) {\n        let cell: HTMLTableDataCellElement\n        if (col >= bodyRow.children.length) {\n          cell = dom.tag(\"td\") as HTMLTableDataCellElement\n          bodyRow.appendChild(cell)\n        } else {\n          cell = bodyRow.children[col] as HTMLTableDataCellElement\n        }\n        cell.style.width = \"\"\n        let fieldModel = this.model.getFieldModel(col, row)\n//console.log(\"  updateBody. cell \"+col+\", \"+row+\" = '\"+fieldModel.value+\"'\")\n        if (cell.innerText!=fieldModel.value) {\n//          if (cell.innerText != \"\")\n//            throw Error(\"TableView.updateBody(): cell \"+col+\", \"+row+\" differs during update, old='\" + cell.innerText + \"', new='\" + fieldModel.value + \"'\")\n          if (fieldModel instanceof HtmlModel)\n            cell.innerHTML = fieldModel.value\n          else\n            cell.innerText = fieldModel.value\n        }\n      }\n      \n      if (this.style.width===\"100%\") {\n        let lastCell = bodyRow.children[ bodyRow.children.length-1] as HTMLTableDataCellElement\n        lastCell.style.width = \"100%\"\n      }\n      \n    }\n//    dump(this.bodyBody)\n  }\n  \n  updateSelection() {\n    if (this.selectionModel === undefined)\n      return\n\n    switch(this.selectionModel.mode) {\n      case TableEditMode.EDIT_CELL:\n        this.prepareFieldAtPosition(this.selectionModel.col, this.selectionModel.row)\n        delete this.rootElement.tabIndex\n        break\n      case TableEditMode.SELECT_CELL: {\n        let allSelected = this.bodyBody.querySelectorAll(\"tbody > tr > td.selected\")\n        for(let selected of allSelected)\n          selected.classList.remove(\"selected\")\n        this.toggleCellSelection(this.selectionModel.value, true)\n        this.rootElement.tabIndex = 0\n        break\n      }\n      case TableEditMode.SELECT_ROW: {\n        let allSelected = this.bodyBody.querySelectorAll(\"tbody > tr.selected\")\n        for(let selected of allSelected)\n          selected.classList.remove(\"selected\")\n        this.toggleRowSelection(this.selectionModel.value.row, true)\n        this.rootElement.tabIndex = 0\n        break\n      }\n    }\n  }\n  \n  adjustInternalTables() {\n    let headRow = this.headRow.children\n    let bodyRow = this.bodyRow.children\n    for(let col=0; col<this.model!.cols; ++col) {\n      let head = headRow[col] as HTMLElement\n      let body = bodyRow[col] as HTMLElement\n      \n      let headWidth = head.clientWidth - horizontalPadding(head)\n      let bodyWidth = body.clientWidth - horizontalPadding(body)\n\n      head.style.width = head.style.minWidth = head.style.maxWidth =\n      body.style.width = body.style.minWidth = body.style.maxWidth =\n        ((headWidth > bodyWidth ? headWidth : bodyWidth)) + \"px\"\n    }\n    \n    if (this.style.width!==\"100%\")\n      this.rootElement.style.width  = (this.bodyRow.clientWidth + this.bodyDiv.offsetWidth - this.bodyDiv.clientWidth + 2) + \"px\"\n//    this.rootElement.style.height = (this.bodyRow.clientHeight + this.bodyDiv.offsetHeight - this.bodyDiv.clientHeight + 2) + \"px\"\n\n  }\n  \n  unadjustInternalTables(pos: any) {\n    let headRow = this.headRow.children\n    let bodyRow = this.bodyRow.children\n    let head = headRow[pos.col] as HTMLElement\n    let body = bodyRow[pos.col] as HTMLElement\n    head.style.width = head.style.minWidth = head.style.maxWidth =\n    body.style.width = body.style.minWidth = body.style.maxWidth = \"\"\n  }\n\n  toggleCellSelection(pos: TablePos, flag: boolean): void {\n    if (pos.col >= this.model!.cols || pos.row >= this.model!.rows)\n      return\n    let element = this.bodyBody.children[pos.row+1].children[pos.col]\n    element.classList.toggle(\"selected\", flag)\n    if (flag) {\n      // FIXME: only when we also have the focus\n      if (element.scrollIntoViewIfNeeded)\n        element.scrollIntoViewIfNeeded()\n      else\n        element.scrollIntoView()\n    }\n  }\n\n  toggleRowSelection(row: number, flag: boolean): void {\n    if (row >= this.model!.rows)\n      return\n    let rowElement = this.bodyBody.children[1+this.selectionModel!.value.row]\n    rowElement.classList.toggle(\"selected\", flag)\n    if (flag) {\n      // FIXME: only when we also have the focus\n      if (rowElement.scrollIntoViewIfNeeded)\n        rowElement.scrollIntoViewIfNeeded()\n      else\n        rowElement.scrollIntoView()\n    }\n  }\n\n  adjustInputToElement(element: HTMLTableDataCellElement) {\n    let boundary = element.getBoundingClientRect()\n    let td = element\n    let tr = td.parentElement\n    let tbody = tr!.parentElement\n    \n    if(navigator.userAgent.indexOf(\"Chrome\") > -1) {\n      // Chrome\n      this.input.style.left = (td.offsetLeft+2)+\"px\"\n      this.input.style.top  = (td.offsetTop-tbody!.clientHeight)+\"px\"\n    } else {\n      // Safari & Opera\n      this.input.style.left = (td.offsetLeft+1)+\"px\"\n      this.input.style.top  = (td.offsetTop-tbody!.clientHeight-1)+\"px\"\n    }\n\n    let width = (element.clientWidth - horizontalPadding(element)) + \"px\"\n    \n    this.input.style.width = width\n    this.input.style.height = (boundary.height)+\"px\"\n\n    // FIXME: add two new functions: lockElement(), unlockElement() and invoke the accordingly\n    // element.style.width = element.style.minWidth = element.style.maxWidth = width\n  }\n\n  goTo(column: number, row: number) {\n    this.insideGoTo = true\n    this.prepareFieldAtPosition(column, row)\n    this.focus()\n    this.insideGoTo = false\n  }\n  \n  goToField(element: HTMLTableDataCellElement | undefined) { // FIXME: names are inconsistent\n    this.insideGoTo = true\n    if (!element)\n      return\n    this.prepareFieldAtElement(element)\n    this.focus()\n    this.insideGoTo = false\n  }\n  \n  focus() {\n    if (this.fieldView) {\n      this.fieldView.focus()\n    } else {\n      this.rootElement.focus()\n    }\n  }\n  \n  prepareFieldAtPosition(column: number, row: number) {\n    this.prepareFieldAtElement(this.getElementAt(column, row))\n  }\n  \n  getElementAt(column: number, row: number): HTMLTableDataCellElement {\n    let element = this.bodyBody.children[row+1].children[column] as HTMLTableDataCellElement\n    if (!element)\n      throw Error(\"fuck\")\n    return element\n  }\n  \n  prepareFieldAtElement(element: HTMLTableDataCellElement | undefined) {\n    if (element===undefined || element.tagName!==\"TD\")\n      return\n    \n    let pos = this.positionOfField(element)\n    \n    if (this.selectionModel) {\n      switch(this.selectionModel.mode) {\n        case TableEditMode.EDIT_CELL:\n          this.selectionModel.value = pos\n          break\n        case TableEditMode.SELECT_CELL:\n          this.toggleCellSelection(this.selectionModel.value, false)\n          this.selectionModel.value = pos\n          this.toggleCellSelection(this.selectionModel.value, true)\n          return\n        case TableEditMode.SELECT_ROW:\n          this.toggleRowSelection(this.selectionModel!.value.row, false)\n          this.selectionModel.value.row = pos.row\n          this.toggleRowSelection(this.selectionModel!.value.row, true)\n          return\n      }\n    }\n\n    let fieldView  = this.model!.getFieldView(pos.col, pos.row)\n    if (!fieldView)\n      return\n    this.fieldView = fieldView\n    fieldView.classList.add(\"embedded\")\n\n    let fieldModel = this.model!.getFieldModel(pos.col, pos.row)\n    fieldView.setModel(fieldModel)\n\n/*\n    // adjust table size while editing (cursor handling is ugly)    \n    fieldModel.modified.add( () => {\n      element.innerText = fieldModel.value\n      setTimeout( () => {\n        // apply element size to fieldView\n        this.adjustInputToElement(element)\n        this.adjustInternalTables()\n      }, 0)\n    })\n*/\n\n    fieldView.onblur = () => {\n      if (element.innerText == fieldModel.value)\n        return\n      element.innerText = fieldModel.value\n      this.unadjustInternalTables(pos)\n      setTimeout( () => {\n        this.adjustInternalTables()\n      }, 0)\n    }\n\n    fieldView.onkeydown = (event: KeyboardEvent) => {\n      switch(event.key) {\n        case \"ArrowDown\":\n          if (pos.row+1 >= this.model!.rows)\n            break\n          event.preventDefault()\n          this.goTo(pos.col, pos.row+1)\n          break\n        case \"ArrowUp\":\n          if (pos.row === 0)\n            break\n          event.preventDefault()\n          this.goTo(pos.col, pos.row-1)\n          break\n        case \"Tab\":\n          if (event.shiftKey) {\n            if (pos.col>0) {\n              event.preventDefault()\n              this.goTo(pos.col-1, pos.row)\n            } else {\n              if (pos.row>0) {\n                event.preventDefault()\n                this.goTo(this.model!.cols-1, pos.row-1)\n              }\n            }\n          } else {\n            if (pos.col+1<this.model!.cols) {\n              event.preventDefault()\n              this.goTo(pos.col+1, pos.row)\n            } else {\n              if (pos.row+1<this.model!.rows) {\n                event.preventDefault()\n                this.goTo(0, pos.row+1)\n              }\n            }\n          }\n          break\n      }\n      \n    }\n    \n    if (this.input.children.length===0) {\n      this.input.appendChild(fieldView)\n    } else {\n      if (document.hasFocus() && document.activeElement === this) {\n        this.input.children[0].dispatchEvent(new FocusEvent(\"blur\"))\n      }\n      this.input.replaceChild(fieldView, this.input.children[0])\n    }\n\n    this.adjustInputToElement(element)\n  }\n  \n  positionOfField(element: HTMLElement): TablePos {\n    let col:number, row:number\n    for(col=0; col<this.model!.cols; ++col) {\n      if (element.parentElement!.children[col]===element)\n        break\n    }\n    for(row=1; row<this.model!.rows+1; ++row) {\n      if (element.parentElement!.parentElement!.children[row]===element.parentElement)\n        break\n    }\n    --row\n    return new TablePos(col, row)\n  }\n}\nwindow.customElements.define(\"toad-table\", TableView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { TextModel } from \"../model\"\nimport { GenericView } from \"../view\"\n\nlet textStyle = document.createElement(\"style\")\ntextStyle.textContent=`\ninput {\n/*\n  height: 2.14285714em;\n  line-height: 1.4285714285714;\n  padding: 4px 5px;\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  box-sizing: border-box;\n  margin: 2px;\n  max-width: 250px;\n  vertical-align: baseline;\n  width: 100%;\n  background-color: #fff;\n  color: #333;\n  font-size: 14px;\n*/\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n}\n\n:host(.embedded) input {\n  border: none 0;\n  border-radius: 0;\n  padding: 0;\n  margin: 2px;\n  width: 100%;\n  background: #fff;\n}\n`\n\nexport class TextView extends GenericView<TextModel> {\n  input: HTMLInputElement\n\n  constructor() {\n    super()\n    this.input = document.createElement(\"input\") as HTMLInputElement\n    this.input.oninput = () => { this.updateModel() }\n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(textStyle, true))\n    this.shadowRoot!.appendChild(this.input)\n  }\n  \n  focus() {\n    this.input.focus()\n  }\n  blur() {\n    this.input.blur()\n  }\n  \n  static get observedAttributes() {return ['value'] }\n  \n  attributeChangedCallback(name: string, oldValue?: string, newValue?: string) {\n    switch(name) {\n      case \"value\":\n        if (this.model && newValue !== undefined)\n          this.model.value = newValue\n        break\n    }\n  }\n  \n  updateModel() {\n    if (this.model) {\n      this.model.value = this.input.value\n    }\n    this.setAttribute(\"value\", this.input.value)\n  }\n\n  updateView() {\n    if (this.model && this.input.value != this.model.value) {\n      this.input.value = this.model.value\n    }\n    this.setAttribute(\"value\", this.input.value)\n  }\n  \n  get value() {\n    return this.input.value\n  }\n  set value(value: string) {\n    this.input.value = value\n    this.updateModel() // FIXME: do we need this?\n  }\n}\nwindow.customElements.define(\"toad-text\", TextView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Model, TextModel, HtmlModel } from \"../model\"\nimport { GenericView } from \"../view\"\n\nlet textareaStyle = document.createElement(\"style\")\ntextareaStyle.textContent=`\n.toolbar button {\n    background: #fff;\n    color: #000;\n    border: 1px #ccc;\n    border-style: solid solid solid none;\n    padding: 5;\n    margin: 0;\n}\n\n.toolbar button.left {\n    border-style: solid;\n    border-radius: 3px 0 0 3px;\n}\n\n.toolbar button.right {\n    border: 1px #ccc;\n    border-style: solid solid solid none;\n    border-radius: 0 3px 3px 0;\n}\n\n.toolbar button.active {\n    background: linear-gradient(to bottom, #7abcff 0%,#0052cc 100%,#4096ee 100%);\n    border: 1px #0052cc solid;\n    color: #fff;\n}\n\ndiv.textarea {\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n  outline-offset: -2px;\n}\n\ndiv.textarea h1 {\n  font-size: 22px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h2 {\n  font-size: 18px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h3 {\n  font-size: 16px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h4 {\n  font-size: 14px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea div {\n  padding: 2px 0 2px 0;\n}\n`\n\nexport class TextTool extends GenericView<Model> {\n    // FIXME: make this a list where all texttools register/unregister via connectedCallback()/disconnectedCallback()\n    // FIXME: disable texttool when it is not above an active textarea in the view hierachy\n    static texttool?: TextTool\n    \n    buttonH1: HTMLElement\n    buttonH2: HTMLElement\n    buttonH3: HTMLElement\n    buttonH4: HTMLElement\n    buttonUnorderedList: HTMLElement\n    buttonOrderedList: HTMLElement\n    \n    buttonBold: HTMLElement\n    buttonItalic: HTMLElement\n    buttonUnderline: HTMLElement\n    buttonStrikeThrough: HTMLElement\n    buttonSubscript: HTMLElement\n    buttonSuperscript: HTMLElement\n    \n    buttonJustifyLeft: HTMLElement\n    buttonJustifyCenter: HTMLElement\n    buttonJustifyRight: HTMLElement\n//    buttonJustifyFull: HTMLElement\n\n    constructor() {\n        super()\n        \n        TextTool.texttool = this\n        \n        let toolbar = document.createElement(\"div\")\n        toolbar.classList.add(\"toolbar\")\n        \n        this.buttonH1 = document.createElement(\"button\")\n        this.buttonH1.classList.add(\"left\")\n        this.buttonH1.innerHTML = \"H1\"\n        this.buttonH1.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h1>\")\n            this.update()\n        }\n        toolbar.appendChild(this.buttonH1)\n\n        this.buttonH2 = document.createElement(\"button\")\n        this.buttonH2.innerHTML = \"H2\"\n        this.buttonH2.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h2>\")\n            this.update()\n        }\n        toolbar.appendChild(this.buttonH2)\n\n        this.buttonH3 = document.createElement(\"button\")\n        this.buttonH3.innerHTML = \"H3\"\n        this.buttonH3.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h3>\")\n            this.update()\n        }\n        toolbar.appendChild(this.buttonH3)\n\n        this.buttonH4 = document.createElement(\"button\")\n        this.buttonH4.classList.add(\"right\")\n        this.buttonH4.innerHTML = \"H4\"\n        this.buttonH4.onclick = () => {\n            document.execCommand(\"formatBlock\", false, \"<h4>\")\n            this.update()\n        }\n        toolbar.appendChild(this.buttonH4)\n\n        toolbar.appendChild(document.createTextNode(\" \"))\n\n        this.buttonBold = document.createElement(\"button\")\n        this.buttonBold.classList.add(\"left\")\n        this.buttonBold.innerHTML = \"<b>B</b>\"\n        this.buttonBold.onclick = () => {\n            document.execCommand(\"bold\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonBold)\n\n        this.buttonItalic = document.createElement(\"button\")\n        this.buttonItalic.innerHTML = \"<i>I</i>\"\n        this.buttonItalic.onclick = () => {\n            document.execCommand(\"italic\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonItalic)\n\n        this.buttonUnderline = document.createElement(\"button\")\n        this.buttonUnderline.innerHTML = \"<u>U</u>\"\n        this.buttonUnderline.onclick = () => {\n            document.execCommand(\"underline\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonUnderline)\n\n        this.buttonStrikeThrough = document.createElement(\"button\")\n        this.buttonStrikeThrough.innerHTML = \"<strike>S</strike>\"\n        this.buttonStrikeThrough.onclick = () => {\n            document.execCommand(\"strikeThrough\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonStrikeThrough)\n\n        this.buttonSubscript = document.createElement(\"button\")\n        this.buttonSubscript.innerHTML = \"x₂\"\n        this.buttonSubscript.onclick = () => {\n            document.execCommand(\"subscript\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonSubscript)\n\n        this.buttonSuperscript = document.createElement(\"button\")\n        this.buttonSuperscript.classList.add(\"right\")\n        this.buttonSuperscript.innerHTML = \"x²\"\n        this.buttonSuperscript.onclick = () => {\n            document.execCommand(\"superscript\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonSuperscript)\n\n\n        toolbar.appendChild(document.createTextNode(\" \"))\n\n        this.buttonJustifyLeft = document.createElement(\"button\")\n        this.buttonJustifyLeft.classList.add(\"left\")\n        this.buttonJustifyLeft.innerHTML = `<svg viewBox=\"0 0 10 9\" width=\"10\" height=\"9\">\n            <line x1=\"0\" y1=\"0.5\" x2=\"10\" y2=\"0.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"2.5\" x2=\"6\" y2=\"2.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"4.5\" x2=\"10\" y2=\"4.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"6.5\" x2=\"6\" y2=\"6.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"8.5\" x2=\"10\" y2=\"8.5\" stroke=\"#000\" />\n            </svg>`\n        this.buttonJustifyLeft.onclick = () => {\n            document.execCommand(\"justifyLeft\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonJustifyLeft)\n        \n        this.buttonJustifyCenter = document.createElement(\"button\")\n        this.buttonJustifyCenter.innerHTML = `<svg viewBox=\"0 0 10 9\" width=\"10\" height=\"9\">\n            <line x1=\"0\" y1=\"0.5\" x2=\"10\" y2=\"0.5\" stroke=\"#000\" />\n            <line x1=\"2\" y1=\"2.5\" x2=\"8\" y2=\"2.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"4.5\" x2=\"10\" y2=\"4.5\" stroke=\"#000\" />\n            <line x1=\"2\" y1=\"6.5\" x2=\"8\" y2=\"6.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"8.5\" x2=\"10\" y2=\"8.5\" stroke=\"#000\" />\n            </svg>`\n        this.buttonJustifyCenter.onclick = () => {\n            document.execCommand(\"justifyCenter\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonJustifyCenter)\n        \n        this.buttonJustifyRight = document.createElement(\"button\")\n        this.buttonJustifyRight.classList.add(\"right\")\n        this.buttonJustifyRight.innerHTML = `<svg viewBox=\"0 0 10 9\" width=\"10\" height=\"9\">\n            <line x1=\"0\" y1=\"0.5\" x2=\"10\" y2=\"0.5\" stroke=\"#000\" />\n            <line x1=\"4\" y1=\"2.5\" x2=\"10\" y2=\"2.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"4.5\" x2=\"10\" y2=\"4.5\" stroke=\"#000\" />\n            <line x1=\"4\" y1=\"6.5\" x2=\"10\" y2=\"6.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"8.5\" x2=\"10\" y2=\"8.5\" stroke=\"#000\" />\n            </svg>`\n        this.buttonJustifyRight.onclick = () => {\n            document.execCommand(\"justifyRight\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonJustifyRight)\n\n/*        \n        this.buttonJustifyFull = document.createElement(\"button\")\n        this.buttonJustifyFull.classList.add(\"right\")\n        this.buttonJustifyFull.innerHTML = `<svg viewBox=\"0 0 10 9\" width=\"10\" height=\"9\">\n            <line x1=\"0\" y1=\"0.5\" x2=\"10\" y2=\"0.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"2.5\" x2=\"10\" y2=\"2.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"4.5\" x2=\"10\" y2=\"4.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"6.5\" x2=\"10\" y2=\"6.5\" stroke=\"#000\" />\n            <line x1=\"0\" y1=\"8.5\" x2=\"10\" y2=\"8.5\" stroke=\"#000\" />\n            </svg>`\n        this.buttonJustifyFull.onclick = () => {\n            document.execCommand(\"justifyFull\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonJustifyFull)\n*/        \n        toolbar.appendChild(document.createTextNode(\" \"))\n\n        this.buttonUnorderedList = document.createElement(\"button\")\n        this.buttonUnorderedList.classList.add(\"left\")\n        this.buttonUnorderedList.innerHTML = `<svg viewBox=\"0 0 17 10.5\" width=\"17\" height=\"10.5\">\n            <circle cx=\"4.5\" cy=\"1.5\" r=\"0.8\" stroke=\"#000\" fill=\"#000\"/>\n            <line x1=\"7\" y1=\"1.5\" x2=\"17\" y2=\"1.5\" stroke=\"#000\"/>\n            <circle cx=\"4.5\" cy=\"5.5\" r=\"0.8\" stroke=\"#000\" fill=\"#000\"/>\n            <line x1=\"7\" y1=\"5.5\" x2=\"17\" y2=\"5.5\" stroke=\"#000\"/>\n            <circle cx=\"4.5\" cy=\"9.5\" r=\"0.8\" stroke=\"#000\" fill=\"#000\"/>\n            <line x1=\"7\" y1=\"9.5\" x2=\"17\" y2=\"9.5\" stroke=\"#000\"/>\n            </svg>`\n        this.buttonUnorderedList.onclick = (event) => {\n            document.execCommand(\"insertUnorderedList\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonUnorderedList)\n        \n        this.buttonOrderedList = document.createElement(\"button\")\n        this.buttonOrderedList.classList.add(\"right\")\n        this.buttonOrderedList.innerHTML = `<svg viewBox=\"0 0 17 10.5\" width=\"17\" height=\"10.5\">\n            <line x1=\"4.5\" y1=\"0\" x2=\"4.5\" y2=\"3\" stroke=\"#000\" />\n            <line x1=\"7\" y1=\"1.5\" x2=\"17\" y2=\"1.5\" stroke=\"#000\"/>\n            <line x1=\"2.5\" y1=\"4\" x2=\"2.5\" y2=\"7\" stroke=\"#000\" />\n            <line x1=\"4.5\" y1=\"4\" x2=\"4.5\" y2=\"7\" stroke=\"#000\" />\n            <line x1=\"7\" y1=\"5.5\" x2=\"17\" y2=\"5.5\" stroke=\"#000\"/>\n            <line x1=\"0.5\" y1=\"8\" x2=\"0.5\" y2=\"11\" stroke=\"#000\" />\n            <line x1=\"2.5\" y1=\"8\" x2=\"2.5\" y2=\"11\" stroke=\"#000\" />\n            <line x1=\"4.5\" y1=\"8\" x2=\"4.5\" y2=\"11\" stroke=\"#000\" />\n            <line x1=\"7\" y1=\"9.5\" x2=\"17\" y2=\"9.5\" stroke=\"#000\"/>\n            </svg>`\n        this.buttonOrderedList.onclick = () => {\n            document.execCommand(\"insertOrderedList\", false)\n            this.update()\n        }\n        toolbar.appendChild(this.buttonOrderedList)\n\n        this.attachShadow({mode: 'open'})\n        this.shadowRoot!.appendChild(document.importNode(textareaStyle, true))\n        this.shadowRoot!.appendChild(toolbar)\n    }\n    \n    update() {\n        this.buttonH1.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h1\")\n        this.buttonH2.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h2\")\n        this.buttonH3.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h3\")\n        this.buttonH4.classList.toggle(\"active\", document.queryCommandValue(\"formatBlock\") === \"h4\")\n        \n        this.buttonBold.classList.toggle(\"active\", document.queryCommandState(\"bold\"))\n        this.buttonItalic.classList.toggle(\"active\", document.queryCommandState(\"italic\"))\n        this.buttonUnderline.classList.toggle(\"active\", document.queryCommandState(\"underline\"))\n        this.buttonStrikeThrough.classList.toggle(\"active\", document.queryCommandState(\"strikeThrough\"))\n        this.buttonSubscript.classList.toggle(\"active\", document.queryCommandState(\"subscript\"))\n        this.buttonSuperscript.classList.toggle(\"active\", document.queryCommandState(\"superscript\"))\n        \n        this.buttonJustifyLeft.classList.toggle(\"active\", document.queryCommandState(\"justifyLeft\"))\n        this.buttonJustifyCenter.classList.toggle(\"active\", document.queryCommandState(\"justifyCenter\"))\n        this.buttonJustifyRight.classList.toggle(\"active\", document.queryCommandState(\"justifyRight\"))\n//        this.buttonJustifyFull.classList.toggle(\"active\", document.queryCommandState(\"justifyFull\"))\n    }\n    \n    updateModel() {\n        if (this.model) {\n        }\n    }\n    \n    updateView() {\n        if (!this.model) {\n            return\n        }\n    }\n}\nwindow.customElements.define(\"toad-texttool\", TextTool)\n\nexport class TextArea extends GenericView<TextModel> {\n\n    content: HTMLElement\n\n    constructor() {\n        super()\n\n        // FIXME: when model is not HtmlModel but TextModel, use <textarea> instead of <div contenteditable>\n        let content = document.createElement(\"div\")\n        this.content = content\n        content.classList.add(\"textarea\")\n        content.contentEditable = \"true\"\n        \n        content.oninput = (event: Event) => {\n            let firstChild = (event.target as Node).firstChild\n            if (firstChild && firstChild.nodeType === 3) {\n                // if the document starts with text, wrap it into a paragraph\n                document.execCommand(\"formatBlock\", false, `<div>`)\n            }\n            else if (content.innerHTML === \"<br>\") {\n                content.innerHTML = \"\"\n            }\n            this.updateModel()\n        }\n        \n        content.onkeydown = (event: KeyboardEvent) => {\n            if (event.metaKey === true && event.key === \"b\") {\n                event.preventDefault()\n                document.execCommand(\"bold\", false)\n                this.updateTextTool()\n            } else\n            if (event.metaKey === true && event.key === \"i\") {\n                event.preventDefault()\n                document.execCommand(\"italic\", false)\n                this.updateTextTool()\n            } else\n            if (event.metaKey === true && event.key === \"u\") {\n                event.preventDefault()\n                document.execCommand(\"underline\", false)\n                this.updateTextTool()\n            } else\n            if (event.key === \"Tab\") {\n                event.preventDefault()\n            } else\n            if (event.key === \"Enter\" &&\n                event.shiftKey !== true &&\n                document.queryCommandValue(\"formatBlock\") === \"blockquote\" )\n            {\n                document.execCommand(\"formatBlock\", false, \"<p>\")\n            }\n/*\n            else if (event.key === \"Enter\" &&\n                event.shiftKey === true )\n            {\n                event.preventDefault()\n            \n                // entering <br> with execCommand will also insert a paragraph, hence the following.\n                // beware! it is not perfect when inserting <br> at the end of the document.\n                // sometimes is works, sometimes it doesn't\n                let docFragment = document.createDocumentFragment()\n\n                let lineBreak = document.createElement(\"br\")\n                docFragment.appendChild(lineBreak)\n                let lineCR = document.createTextNode(\"\\n\")\n                docFragment.appendChild(lineCR)\n\n                // replace selection with <br>\\n\n                let range = window.getSelection().getRangeAt(0)\n                range.deleteContents()\n                range.insertNode(docFragment)\n\n                // create a new range\n                range = document.createRange()\n                range.setStartAfter(lineCR);\n                range.collapse(true)\n\n                // move cursor\n                let selection = window.getSelection()\n                selection.removeAllRanges()\n                selection.addRange(range)\n\n                this.updateTextTool()\n            }\n*/\n        }\n        \n        content.onkeyup = () => {\n            this.updateTextTool()\n        }\n        content.onmouseup = () => {\n            this.updateTextTool()\n        }\n\n        this.attachShadow({mode: 'open'})\n        this.shadowRoot!.appendChild(document.importNode(textareaStyle, true))\n        this.shadowRoot!.appendChild(content)\n    }\n    \n    updateTextTool() {\n        if (TextTool.texttool !== undefined)\n            TextTool.texttool.update()\n    }\n    \n    updateModel() {\n        if (this.model) {\n            // textarea with it's markup may be expensive, hence we let the model fetch it's data on demand\n            this.model.promise = () => {\n                return this.content.innerHTML\n            }\n        }\n    }\n    \n    updateView() {\n        if (!this.model) {\n            return\n        }\n        if (this.model instanceof HtmlModel) {\n            // because of TextModel.promise we check here instead inside the model\n            // if we don't check at all, the cursor ends up in the wrong location\n            // after each change\n            if (this.content.innerHTML !== this.model.value) {\n                this.content.innerHTML = this.model.value\n            }\n        } else {\n            // FIXME: no tested\n            if (this.content.innerText !== this.model.value) {\n                this.content.innerText = this.model.value\n            }\n        }\n    }\n}\nwindow.customElements.define(\"toad-textarea\", TextArea)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { OptionModelBase } from \"../model\"\nimport { GenericView } from \"../view\"\n\nlet toolbuttonStyle = document.createElement(\"style\")\ntoolbuttonStyle.textContent=`\ndiv {\n    border: 1px solid #e3dbdb;\n    border-radius: 5px;\n    background: #e3dbdb;\n    width: 32px;\n    height: 32px;\n    padding: 3px;\n}\n\n:host([selected]) div {\n    background: #ac9393;\n}\n\n:host([disabled]) div {\n    opacity: 0.5;\n}\n\n:host([disabled]) div img {\n    opacity: 0.5;\n}\n\n:host([checked][disabled]) div {\n}\n`\n\nexport class ToolButton extends GenericView<OptionModelBase> {\n    constructor() {\n        super()\n        \n        let button = document.createElement(\"div\")\n        // button.setAttribute(\"tabindex\", \"0\")\n        button.onmousedown = (event) => {\n            if (this.hasAttribute(\"disabled\"))\n                return\n            button.focus()\n            event.preventDefault()\n            if (this.model !== undefined)\n                this.model.stringValue = this.getValue()\n        }\n\n        let img = document.createElement(\"img\")\n        if (this.hasAttribute(\"img\")) {\n            img.src = this.getAttribute(\"img\")!\n        }\n        button.appendChild(img)\n\n        this.attachShadow({mode: 'open'})\n        this.shadowRoot!.appendChild(document.importNode(toolbuttonStyle, true))\n        this.shadowRoot!.appendChild(button)\n    }\n\n    getValue(): string {\n        let value = this.getAttribute(\"value\")\n        if (value === null)\n            throw Error(\"no value\")\n        return value\n    }\n\n    connectedCallback() {\n        super.connectedCallback()\n        if (this.model === undefined)\n            this.setAttribute(\"disabled\", \"\")\n    }\n    \n    updateModel() {\n    }\n    \n    updateView() {\n        if (this.model === undefined) {\n            this.setAttribute(\"disabled\", \"\")\n            this.removeAttribute(\"selected\")\n            return\n        }\n        let value = this.getValue()\n        if (this.model.isValidStringValue(value)) {\n            this.removeAttribute(\"disabled\")\n        } else {\n            this.setAttribute(\"disabled\", \"\")\n        }\n        if (this.model.stringValue === value) {\n            this.setAttribute(\"selected\", \"\")\n        } else {\n            this.removeAttribute(\"selected\")\n        }\n    }\n}\nwindow.customElements.define(\"toad-toolbutton\", ToolButton)\n"],"sourceRoot":""}