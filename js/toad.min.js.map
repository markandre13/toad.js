{"version":3,"sources":["webpack://toad/webpack/bootstrap","webpack://toad/./src/action.ts","webpack://toad/./src/controller.ts","webpack://toad/./src/dom.ts","webpack://toad/./src/model.ts","webpack://toad/./src/signal.ts","webpack://toad/./src/toad.ts","webpack://toad/./src/view.ts","webpack://toad/./src/view/button.ts","webpack://toad/./src/view/checkbox.ts","webpack://toad/./src/view/menu.ts","webpack://toad/./src/view/slider.ts","webpack://toad/./src/view/table.ts","webpack://toad/./src/view/text.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_signal__WEBPACK_IMPORTED_MODULE_1__","Action","_model__WEBPACK_IMPORTED_MODULE_0__","[object Object]","parent","title","super","this","signal","_enabled","placeHolder","Error","enabled","modified","trigger","_signal__WEBPACK_IMPORTED_MODULE_3__","Controller","modelId2Models","Map","modelId2Views","view2ModelIds","sigChanged","actionId","callback","action","_action__WEBPACK_IMPORTED_MODULE_2__","undefined","add","_registerModel","modelId","model","models","Set","set","views","view","setModel","controller","console","log","modelIds","delete","size","entry","clear","registerModel","registerAction","_model__WEBPACK_IMPORTED_MODULE_1__","bind","options","Template","templateName","root","_dom__WEBPACK_IMPORTED_MODULE_0__","querySelectorAll","element","registerView","getModelId","e","getActionId","globalController","unbind","text","boolean","instantiateTemplate","tmpl","t","document","querySelector","z","content","importNode","find","node","selector","tag","createElement","txt","createTextNode","img","src","n0","n1","appendChild","remove","parentNode","removeChild","erase","firstChild","grabMouse","event","target","documentMouseMove","dispatchEvent","MouseEvent","stopPropagation","documentMouseUp","removeEventListener","capture","body","style","pointerEvents","addEventListener","preventDefault","attribute","getAttribute","nodeName","attributeOrUndefined","order","first","second","parentsOfFirstNode","firstPrevious","secondPrevious","lookup","child","childNodes","__webpack_exports__","_signal__WEBPACK_IMPORTED_MODULE_0__","Model","GenericModel","_value","TextModel","HtmlModel","NumberModel","min","max","step","BooleanModel","RadioStateModel","setValue","getValue","Signal","SignalLink","id","callbacks","Array","push","length","splice","_controller__WEBPACK_IMPORTED_MODULE_11__","customElements","define","_view__WEBPACK_IMPORTED_MODULE_2__","display","Window","window","RadioButtonBase","clicked","FatRadioButton","button","classList","hasValue","onmousedown","View","HTMLElement","hasAttribute","GenericView","error","_controller__WEBPACK_IMPORTED_MODULE_1__","unregisterView","updateView","ActionView","disconnectedCallback","constructor","SlotView","innerHTML","innerText","_view__WEBPACK_IMPORTED_MODULE_1__","buttonStyle","textContent","ButtonView","onclick","disabled","attachShadow","mode","shadowRoot","connectedCallback","children","_observer","MutationObserver","record","observer","_timer","clearTimeout","setTimeout","observe","childList","subtree","characterData","isEnabled","_view__WEBPACK_IMPORTED_MODULE_0__","checkboxStyle","CheckboxView","svg","createElementNS","setAttributeNS","rect","checkmark","toggle","key","focus","observedAttributes","oldValue","newValue","updateModel","removeAttribute","setAttribute","_controller__WEBPACK_IMPORTED_MODULE_4__","menuStyle","MenuState","Type","Node","label","shortcut","type","parentView","span","flexGrow","MenuButton","MenuHelper","vertical","closeOnClose","state","WAIT","Menu","layout2nodes","referenceActions","createShadowDOM","down","newnode","next","str","strpos","indexOf","left","substr","right","findNode","isAvailable","createWindowAt","deleteWindow","PopupMenu","parentButton","popup","show","master","parentBoundary","getBoundingClientRect","opacity","width","top","popupBoundary","popupBottom","height","innerHeight","popupRight","innerWidth","placePopupHorizontal","placePopupVertical","_view__WEBPACK_IMPORTED_MODULE_3__","menuButton","buttonDown","DOWN","activate","UP_N_HOLD","active","DOWN_N_HOLD","onmouseup","documentMouseDown","tagName","collapse","DOWN_N_OUTSIDE","deactivate","DOWN_N_INSIDE_AGAIN","onmouseout","inside","onmouseover","_action__WEBPACK_IMPORTED_MODULE_1__","_model__WEBPACK_IMPORTED_MODULE_2__","insertBefore","hide","oldActive","closePopup","openPopup","SliderView","input","oninput","Number","parseFloat","String","_text__WEBPACK_IMPORTED_MODULE_3__","tableStyle","getPropertyValue","propertyName","pixel","pixelToNumber","getComputedStyle","horizontalPadding","TableEditMode","TablePos","col","row","SelectionModel","SELECT_ROW","TableModel","cols","rows","column","tableModelLocators","registerTableModelLocator","locator","createTableModel","data","field","TableView","insideGoTo","rootElement","className","onkeydown","selectionModel","toggleRowSelection","SELECT_CELL","pos","toggleCellSelection","headDiv","overflow","headTable","headHead","headRow","bodyDiv","onscroll","scrollLeft","bodyTable","srcElement","goToField","bodyBody","bodyRow","zeroSize","margin","padding","border","position","background","genericEvent","relatedTarget","goTo","updateSelection","updateHeader","updateBody","adjustInternalTables","fillerForMissingScrollbar","noHeader","cell","minWidth","getColumnHead","paddingTop","paddingBottom","fieldModel","getFieldModel","EDIT_CELL","prepareFieldAtPosition","tabIndex","allSelected","selected","head","headWidth","clientWidth","bodyWidth","maxWidth","offsetWidth","flag","scrollIntoViewIfNeeded","scrollIntoView","rowElement","boundary","td","tbody","parentElement","navigator","userAgent","offsetLeft","offsetTop","clientHeight","prepareFieldAtElement","fieldView","getElementAt","positionOfField","getFieldView","onblur","unadjustInternalTables","shiftKey","hasFocus","activeElement","FocusEvent","replaceChild","adjustInputToElement","textStyle","TextView","blur"],"mappings":"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","file":"toad.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/toad.ts\");\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Model } from \"./model\"\nimport { Signal } from \"./signal\"\n\nexport class Action extends Model {\n  signal: Signal\n  title: string\n  \n  _enabled: boolean\n\n  constructor(parent: HTMLElement | undefined, title: string) {\n    super()\n    this.signal = new Signal()\n    this.title = title\n    this._enabled = true\n  }\n  \n  set value(placeHolder: any) {\n    throw Error(\"Action.value can not be assigned a value\")\n  }\n\n  get value(): any {\n    throw Error(\"Action.value can not return a value\")\n  }\n\n  set enabled(enabled: boolean) {\n    if (this._enabled == enabled)\n      return\n    this._enabled = enabled\n    this.modified.trigger()\n  }\n  \n  get enabled(): boolean {\n    return this._enabled\n  }\n  \n  trigger(): void {\n    if (!this._enabled)\n      return\n    this.signal.trigger()\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"./dom\"\nimport { Model, TextModel, HtmlModel, BooleanModel, NumberModel } from \"./model\"\nimport { View } from \"./view\"\nimport { Action } from \"./action\"\nimport { Signal } from \"./signal\"\n\nexport class Controller {\n  modelId2Models: Map<string, Set<Model>>\n  modelId2Views: Map<string, Set<View>>\n  view2ModelIds: Map<View, Set<string>>\n  \n  sigChanged: Signal\n  \n  constructor() {\n    this.modelId2Models = new Map<string, Set<Model>>()\n    this.modelId2Views = new Map<string, Set<View>>()\n    this.view2ModelIds = new Map<View, Set<string>>()\n    this.sigChanged = new Signal()\n  }\n\n  registerAction(actionId: string, callback: () => void): Action {\n    let action = new Action(undefined, actionId)\n    action.signal.add(callback)\n    this._registerModel(\"A:\"+actionId, action)\n    return action\n  }\n  \n  registerModel(modelId: string, model: Model): void {\n    this._registerModel(\"M:\"+modelId, model)\n  }\n  \n  _registerModel(modelId: string, model: Model): void {\n    let models = this.modelId2Models.get(modelId)\n    if (!models) {\n      models = new Set<Model>()\n      this.modelId2Models.set(modelId, models)\n    }\n    models.add(model)\n    \n    let views = this.modelId2Views.get(modelId)\n    if (!views)\n      return\n    for(let view of views) {\n      view.setModel(model)\n    }\n  }\n\n  registerView(modelId: string, view: View): void {\n    if (view.controller && view.controller!==this) {\n      console.log(\"error: attempt to register view more than once at different controllers\")\n      return\n    }\n    view.controller = this\n  \n    let modelIds = this.view2ModelIds.get(view)\n    if (!modelIds) {\n      modelIds = new Set<string>()\n      this.view2ModelIds.set(view, modelIds)\n    }\n    modelIds.add(modelId)\n  \n    let views = this.modelId2Views.get(modelId)\n    if (!views) {\n      views = new Set<View>()\n      this.modelId2Views.set(modelId, views)\n    }\n    views.add(view)\n    \n    let models = this.modelId2Models.get(modelId)\n    if (models)\n      for(let model of models)\n        view.setModel(model)\n  }\n  \n  unregisterView(view: View): void {\n    if (!view.controller)\n      return\n    if (view.controller !== this)\n      throw Error(\"attempt to unregister view from wrong controller\")\n  \n    let modelIds = this.view2ModelIds.get(view)\n    if (!modelIds)\n      return\n\n    for(let modelId of modelIds) {\n      let views = this.modelId2Views.get(modelId)\n      if (!views)\n        continue\n      views.delete(view)\n      if (views.size === 0) {\n        this.modelId2Views.delete(modelId)\n      }\n      view.setModel(undefined)\n    }\n  }\n  \n  clear(): void {\n    for(let entry of this.view2ModelIds) {\n      entry[0].setModel(undefined)\n    }\n    this.modelId2Models.clear()\n    this.modelId2Views.clear()\n    this.view2ModelIds.clear()\n  }\n  \n  bind(modelId: string, model: Model): void {\n    this.registerModel(modelId, model)\n  }\n  \n  action(actionId: string, callback: () => void): Action {\n    return this.registerAction(actionId, callback)\n  }\n  \n  text(modelId: string, value: string): TextModel {\n    let model = new TextModel(value)\n    this.bind(modelId, model)\n    return model\n  }\n\n  html(modelId: string, value: string): HtmlModel {\n    let model = new HtmlModel(value)\n    this.bind(modelId, model)\n    return model\n  }\n\n  boolean(modelId: string, value: boolean): BooleanModel {\n    let model = new BooleanModel(value)\n    this.bind(modelId, model)\n    return model\n  }\n  \n  number(modelId: string, value: number, options: any): NumberModel {\n    let model = new NumberModel(value, options)\n    this.bind(modelId, model)\n    return model\n  }\n}\n\nexport class Template extends Controller {\n  root: DocumentFragment\n\n  constructor(templateName: string) {\n    super()\n    this.root = dom.instantiateTemplate(templateName)\n\n    let views = this.root.querySelectorAll(\"[model]\")\n    for(let element of views) {\n      //if (element.nodeName.toUpperCase().substring(0,4)!==\"TOAD-\")\n      //  continue\n      let view = element as View\n      if (!view)\n        continue\n      try {\n        this.registerView(view.getModelId(), view)\n      }\n      catch(e) {\n      }\n    }\n    \n    views = this.root.querySelectorAll(\"[action]\")\n    for(let element of views) {\n      //if (element.nodeName.toUpperCase().substring(0,4)!==\"TOAD-\")\n      //  continue\n      let view = element as View\n      if (!view)\n        continue\n//      view.controller = this\n      try {\n        this.registerView(view.getActionId(), view)\n      }\n      catch(e) {\n      }\n    }\n    \n  }\n}\n\nexport let globalController = new Controller()\n\nexport function bind(modelId: string, model: Model) {\n  globalController.bind(modelId, model)\n}\n\nexport function action(actionId: string, action: () => void): Action { // FIXME: deprecated\n  return globalController.registerAction(actionId, action)\n}\n\nexport function unbind() {\n  globalController.clear()\n}\n\nexport function text(modelId: string, value: string): TextModel {\n  return globalController.text(modelId, value)\n}\n\nexport function boolean(modelId: string, value: boolean): BooleanModel {\n  return globalController.boolean(modelId, value)\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n/**\n *\n * Utility functions to work with the DOM.\n *\n */\n\nexport function instantiateTemplate(name: string): DocumentFragment {\n  return tmpl(name);\n}\nexport function tmpl(name: string): DocumentFragment {\n  let t = document.querySelector('template[id=\"'+name+'\"]');\n  if (!t) {\n    throw new Error(\"failed to find template '\"+name+\"'\");\n  }\n  let x = t as HTMLTemplateElement;\n  let z: DocumentFragment = x.content;\n  let y = document.importNode(z, true);\n  return y;\n}\nexport function find(node: Element|DocumentFragment, selector: string): Element|null {\n  return node.querySelector(selector);\n}\nexport function tag(name: string): HTMLElement { return document.createElement(name); }\nexport function txt(txt: string): Text { return document.createTextNode(txt); }\nexport function img(src: string): HTMLImageElement {\n  let img = document.createElement(\"img\") as HTMLImageElement\n  img.src = src\n  return img\n}\nexport function add(n0: Node, n1: Node): void { n0.appendChild(n1); }\nexport function remove(n: Node): void { \n  if (!n.parentNode)\n    throw Error(\"element has no parent\");\n  n.parentNode.removeChild(n);\n}\nexport function erase(n: Element): void { while(n.firstChild) n.removeChild(n.firstChild); }\n\nexport function grabMouse(event: MouseEvent) {\n  let target = event.target as HTMLElement\n//  console.log(event)\n    \n  let documentMouseMove = (event: MouseEvent) => {\n//  console.log(\"document.moveMove\", target)\n    target.dispatchEvent(new MouseEvent(\"mousemove\", event))\n    // srcElement, target, toElement, offsetX, offsetY, ...?\n//    target.onmousemove(event)\n    event.stopPropagation()\n  }\n\n  let documentMouseUp = (event: MouseEvent) => {\n//  console.log(\"document.mouseUp\", target)\n    target.dispatchEvent(new MouseEvent(\"mouseup\", event))\n//    target.onmouseup(event)\n    document.removeEventListener(\"mousemove\", documentMouseMove, {capture: true})\n    document.removeEventListener(\"mouseup\", documentMouseUp, {capture: true})\n    document.body.style.pointerEvents = \"auto\"\n    event.stopPropagation()\n  }\n\n  document.addEventListener(\"mousemove\", documentMouseMove, {capture: true})\n  document.addEventListener(\"mouseup\", documentMouseUp, {capture: true})\n  document.body.style.pointerEvents = \"none\"\n  event.preventDefault()\n  event.stopPropagation()\n}\n\nexport function attribute(element: Element, name: string): string {\n  let attribute = element.getAttribute(name)\n  if (attribute === null) {\n    console.log(\"missing attribute '\"+name+\"' in \", element)\n    throw Error(\"missing attribute '\"+name+\"' in \"+element.nodeName)\n  }\n  return attribute\n}\n\nexport function attributeOrUndefined(element: Element, name: string): string|undefined {\n  let attribute = element.getAttribute(name)\n  return attribute === null ? undefined : attribute\n}\n\nexport function order(first: Node, second: Node): boolean {\n  let parentsOfFirstNode = new Map<Node, Node>()\n  let node: Node|null\n  \n  let firstPrevious = first\n  node = first\n  while(true) {\n    firstPrevious = node\n    node = node.parentNode\n    if (!node)\n      break\n    parentsOfFirstNode.set(node, firstPrevious)\n  }\n\n  let secondPrevious = second\n  node = second\n  while(node) {\n    secondPrevious = node\n    node = node.parentNode\n    if (!node)\n      throw Error(\"fuck\")\n    let lookup = parentsOfFirstNode.get(node)\n    if (lookup) {\n      firstPrevious = lookup\n      break\n    }\n    node = node.parentNode\n  }\n  if (!node)\n    throw Error(\"fuck\")\n  \n  for(let child of node!.childNodes) {\n    if (child === firstPrevious)\n      return true\n    if (child === secondPrevious)\n      return false\n  }\n  throw Error(\"fuck\")\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Signal } from \"./signal\"\n\nexport abstract class Model {\n  modified: Signal\n  \n  constructor() {\n    this.modified = new Signal()\n  }\n  \n//  abstract set value(value: any)\n//  abstract get value(): any\n}\n\nexport class GenericModel<T> extends Model {\n  _value: T\n\n  constructor(value: T) {\n    super()\n    this._value = value\n  }\n  \n  set value(value: T) {\n    if (this._value == value)\n      return\n    this._value = value\n    this.modified.trigger()\n  }\n  \n  get value(): T {\n    return this._value\n  }\n}\n\nexport class TextModel extends GenericModel<string> {\n  constructor(value: string) {\n    super(value)\n  }\n}\n\nexport class HtmlModel extends TextModel {\n  constructor(value: string) {\n    super(value)\n  }\n}\n\nexport class NumberModel extends GenericModel<number> {\n  min?: number\n  max?: number\n  step?: number\n  \n  constructor(value: number, options: any) {\n    super(value)\n    if (options) {\n      this.min = options.min\n      this.max = options.max\n      this.step = options.step\n    }\n  }\n}\n\nexport class BooleanModel extends GenericModel<boolean> {\n  constructor(value: boolean) {\n    super(value)\n  }\n}\n\nexport class RadioStateModel<T> extends Model {\n  private _value?: T\n\n  constructor() {\n    super()\n  }\n\n  set value(value: T) {\n    this.setValue(value)\n  }\n\n  get value(): T {\n    return this.getValue()\n  }\n\n  hasValue(): boolean {\n    return this._value != undefined\n  }\n  \n  setValue(value: T): void { // FIXME: set value(value: T)\n    if (this._value == value)\n      return\n    this._value = value\n    this.modified.trigger()\n  }\n  \n  getValue(): T { // FIXME: get value()\n    if (this._value === undefined)\n      throw Error(\"fuck\")\n    return this._value\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nexport class SignalLink {\n  callback: () => void\n  id?: any\n  constructor(callback: () => void, id?: any) {\n    this.callback = callback\n    this.id = id\n  }\n}\n\nexport class Signal {\n\n  callbacks?: Array<SignalLink>\n\n  add(callback: () => void): void\n  add(callback: () => void, id: any): void\n  add(callback: () => void, id?: any) {\n    if (!this.callbacks)\n      this.callbacks = new Array<SignalLink>()\n    this.callbacks.push(new SignalLink(callback, id))\n  }\n\n  remove(id: any) {\n    if (!this.callbacks)\n      return\n    for(let i=this.callbacks.length-1; i>=0; --i) {\n      if (this.callbacks[i].id === id)\n        this.callbacks.splice(i, 1)\n    }\n  }\n  \n  count(): number {\n    if (!this.callbacks)\n      return 0\n    return this.callbacks.length\n  }\n\n  trigger(): void {\n    if (!this.callbacks)\n      return\n    for(let i=0; i<this.callbacks.length; ++i)\n      this.callbacks[i].callback()\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"./dom\"\n\nimport { Signal } from \"./signal\"\nimport { Model, GenericModel, TextModel, HtmlModel, NumberModel, BooleanModel, RadioStateModel } from \"./model\"\nimport { GenericView } from \"./view\"\nimport { Controller, globalController } from \"./controller\"\n\nexport { Signal } from \"./signal\"\nexport { Action } from \"./action\"\nexport { Model, GenericModel, TextModel, HtmlModel, NumberModel, BooleanModel, RadioStateModel } from \"./model\"\n\nexport { View, GenericView, SlotView } from \"./view\"\nexport { ButtonView } from \"./view/button\"\nexport { CheckboxView } from \"./view/checkbox\"\nexport { MenuButton } from \"./view/menu\"\nexport { SliderView } from \"./view/slider\"\nexport { TableView, TableModel, TableEditMode, SelectionModel, registerTableModelLocator, createTableModel } from \"./view/table\"\nexport { TextView } from \"./view/text\"\n\nexport { Controller, Template, bind, action, unbind, globalController, boolean, text } from \"./controller\"\n\n// <toad-if> requires correct HTML otherwise <toad-if> and it's content might\n// be separated by stuff like an </p> inserted automatically by the browser\n// so one should use stuff like htmltidy or htmlhint\nclass ToadIf extends GenericView<BooleanModel> {\n  updateModel() {\n  }\n\n  updateView() {\n    if (this.model) {\n      this.style.display = this.model.value ? \"\" : \"none\"\n    }\n  }\n}\ncustomElements.define('toad-if', ToadIf)\n\n/*\n * OLD STUFF I MIGHT WANT TO GET RID OF\n */\n \nexport class Window {\n  window?: HTMLElement;\n  parent?: Window;\n  title: string;\n  \n  constructor(p: any, t: string) {\n    // p can either be of type Window or a DOM object\n    if (p instanceof Window) {\n      this.window = undefined;\n      this.parent = p;\n    } else {\n      this.window = p;\n      this.parent = undefined;\n    }\n    this.title = t;\n  }\n}\n\nexport class RadioButtonBase extends Window\n{\n  clicked: Signal\n  \n  constructor(p: any, t: string) {\n    super(p, t)\n    this.clicked = new Signal\n  }\n}\n\nexport class FatRadioButton<T> extends RadioButtonBase {\n  model: RadioStateModel<T>\n  value: T\n  \n  constructor(parent: any, title: string, model: RadioStateModel<T>, value: T) {\n    super(parent, title)\n    let button = this\n    this.model = model\n    this.value = value\n    \n    button.window = dom.tag(\"div\")\n    button.window.classList.add(\"fatradiobutton\")\n    if (!model.hasValue())\n      model.setValue(value)\n    if (model.getValue()==value)\n      button.window.classList.add(\"fatradiobutton-selected\")\n\n    button.window.onmousedown = function(e) {\n      button.model.setValue(value)\n      return false\n    }\n    \n    model.modified.add(function() {\n      if (!button.window)\n        throw Error(\"fuck\")\n      if (button.model.getValue()==value) {\n        button.window.classList.add(\"fatradiobutton-selected\")\n      } else {\n        button.window.classList.remove(\"fatradiobutton-selected\")\n      }\n    })\n    \n    let img = dom.img('img/'+title+'.svg')\n    dom.add(button.window, img)\n    dom.add(parent.window, button.window)\n  }\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Model, TextModel, HtmlModel, BooleanModel, NumberModel } from \"./model\"\nimport { Controller, globalController } from \"./controller\"\n\nimport { Action } from \"./action\"\n\nexport abstract class View extends HTMLElement {\n  controller?: Controller\n\n  abstract setModel(model?: Model): void\n\n  getModelId(): string {\n    if (!this.hasAttribute(\"model\")) \n      throw Error(\"no 'model' attribute\")\n    let modelId = this.getAttribute(\"model\") // FIXME: both hasAttribute & getAttribute? really?\n    if (!modelId)\n      throw Error(\"no model id\")\n    return \"M:\"+modelId\n  }\n\n  getActionId(): string {\n    if (!this.hasAttribute(\"action\")) \n      throw Error(\"no 'action' attribute\")\n    let actionId = this.getAttribute(\"action\") // FIXME: both hasAttribute & getAttribute? really?\n    if (!actionId)\n      throw Error(\"no action id\")\n    return \"A:\"+actionId\n  }\n\n}\n\nexport abstract class GenericView<T extends Model> extends View {\n  model?: T\n\n  constructor() {\n    super()\n  }\n\n  abstract updateModel(): void\n  abstract updateView(): void\n  \n  connectedCallback() {\n    if (this.controller)\n      return\n    let modelId = \"\"\n    try {\n      modelId = this.getModelId()\n    } catch(error) {\n    }\n    if (modelId!=\"\")\n      globalController.registerView(modelId, this)\n  }\n  \n  disconnectedCallback() {\n    if (this.controller)\n      this.controller.unregisterView(this)\n  }\n\n  setModel(model?: T): void {\n    if (model === this.model)\n      return\n\n    let view = this\n    \n    if (this.model)\n      this.model.modified.remove(view)\n    \n    if (model)\n      model.modified.add(() => { view.updateView() }, view)\n\n    this.model = model\n    this.updateView()\n  }\n}\n\nexport abstract class ActionView extends GenericView<TextModel> {\n  action?: Action\n\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    if (this.controller) {\n      this.updateView()\n      return\n    }\n\n    try {\n      globalController.registerView(this.getActionId(), this) // FIXME: don't register always on globalController\n    }\n    catch(e) {\n    }\n    \n    try {\n      globalController.registerView(this.getModelId(), this) // FIXME: don't register always on globalController\n    }\n    catch (e) {\n    }\n\n    this.updateView()\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    if (this.controller)\n      this.controller.unregisterView(this)\n  }\n  \n  setModel(model?: Model): void {\n    if (!model) {\n      if (this.model)\n        this.model.modified.remove(this)\n      if (this.action)\n        this.action.modified.remove(this)\n      this.model = undefined\n      this.action = undefined\n      this.updateView()\n      return\n    }\n\n    if (model instanceof Action) {\n      // FIXME: what if this.action is already set?\n      this.action = model\n      this.action.modified.add(() => {\n        this.updateView()\n      }, this)\n    } else\n    if (model instanceof TextModel) {\n      // FIXME: what if this.model is already set?\n      this.model = model\n      this.model.modified.add(() => {\n        this.updateView()\n      }, this)\n    } else {\n      throw Error(\"unexpected model of type \"+model.constructor.name)\n    }\n\n    this.updateView()\n  }\n\n  isEnabled(): boolean {\n    return this.action!==undefined && this.action.enabled\n  }\n}\n\n\nexport class SlotView extends GenericView<TextModel> {\n  constructor() { super() }\n  updateModel() { }\n  updateView() {\n    if (!this.model)\n      return\n      \n    let value = this.model.value === undefined ? \"\" : this.model.value\n    if (this.model instanceof HtmlModel)\n      this.innerHTML = value\n    else\n      this.innerText = value\n  }\n}\nwindow.customElements.define(\"toad-slot\", SlotView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Model, TextModel, HtmlModel } from \"../model\"\nimport { ActionView } from \"../view\"\nimport { globalController } from \"../controller\"\nimport { Action } from \"../action\"\n\nlet buttonStyle = document.createElement(\"style\")\nbuttonStyle.textContent=`\n  button {\n    border: none;\n    background-color: var(--toad-primary-color, #0052cc);\n    color: #ffffff;\n    border-radius: 3px;\n    font-size: 14px;\n    font-weight: bold;\n    height: 32px;\n    line-height: 32px;\n    min-width: 24px;\n    text-shadow: none;\n    padding: 0 10px;\n    margin-right: 4px;\n  }\n  \n  button:hover {\n    background-color: #0065ff;\n  }\n  \n  button:hover:active {\n    background-color: #0049b0;\n  }\n  \n  button:disabled, button:disabled:active {\n    background-color: #888;\n  }\n`\n\nexport class ButtonView extends ActionView {\n  button: HTMLButtonElement\n  _observer?: MutationObserver\n  _timer?: number\n\n  constructor() {\n    super()\n    let buttonView = this\n    this.button = document.createElement(\"button\") as HTMLButtonElement\n    this.button.onclick = () => {\n      if (this.action)\n        this.action.trigger()\n    }\n    this.button.disabled = true\n    \n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(buttonStyle, true))\n    this.shadowRoot!.appendChild(this.button)\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n    if (this.children.length===0) {\n      // Chrome, Opera invoke connectedCallback() before the children are conected\n      this._observer = new MutationObserver((record: MutationRecord[], observer: MutationObserver) => {\n        if (this._timer !== undefined)\n          clearTimeout(this._timer)\n        this._timer = setTimeout( () => {\n          this._timer = undefined\n          this.updateView()\n        }, 100)\n      })\n      this._observer.observe(this, {\n        childList: true,\n        subtree: true,\n        characterData: true\n      })\n    }\n  }\n\n\n  updateModel() {\n  }\n\n  updateView() {\n    if (this.model && this.model.value) { // FIXME: use updateView only for Model stuff\n      if (this.model instanceof HtmlModel)\n        this.button.innerHTML = this.model.value\n      else\n        this.button.innerText = this.model.value\n    } else {\n      this.button.innerHTML = this.innerHTML\n    }\n\n    this.button.disabled = !this.isEnabled()\n    // FIXME: set \"disabled\" property of this\n  }\n}\nwindow.customElements.define(\"toad-button\", ButtonView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { BooleanModel } from \"../model\"\nimport { GenericView } from \"../view\"\n\n/* Safari & Chrome can do this and we want this */\ndeclare global {\n  interface SVGElement {\n    focus(): void;\n  }\n}\n\n/*\nthe checkbox can be customized like this (color names are not final yet)\n\n      :root {\n        --toad-neutral-color: #000;\n        --toad-dark-color: #000;\n        --toad-light-color: #fff;\n        --toad-primary-color: #000;\n      }\n\n      toad-checkbox {\n        --border-color: #000;\n        --background-color: none;\n        --marker-color: none;\n        --checked-border-color: #000;\n        --checked-background-color: none;\n        --checked-marker-color: #000;\n      }\n*/\n\n\nlet checkboxStyle = document.createElement(\"style\")\ncheckboxStyle.textContent=`\nsvg {\n  width: 12px;\n  height: 12px;\n  vertical-align: middle;\n  margin: 3px;              /* space for the outline */\n  background: none;\n}\nsvg:focus {\n  outline-offset: -2px;     /* bring outline in touch with the svg */\n  background: #9eccfb;      /* the rectangle is rounded, fill the corners */\n  outline-color: 9eccfb;    /* outline shall be the same color used to fill the corners */\n}\n@media(pointer: coarse) { /* works on Chrome but iOS is never coarse :( */\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n}\nsvg rect {\n  stroke: var(--border-color, var(--toad-neutral-color, #aaa));\n  fill: var(--background-color, #fff);\n  stroke-width: 1px;\n}\nsvg path {\n  stroke: var(--marker-color, none);\n  fill: none;\n  stroke-width: 2px;\n}\n:host([checked]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #0052cc));\n  fill: var(--checked-background-color, var(--toad-primary-color, #0052cc));\n}\n:host([checked]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #fff));\n}\n:host([disabled]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #bdbdbd));\n  fill: var(--checked-background-color, var(--toad-primary-color, #fff));\n}\n:host([disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, none));\n}\n:host([checked][disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #bdbdbd));\n}`\n\nexport class CheckboxView extends GenericView<BooleanModel> {\n  constructor() {\n    super()\n    \n    let svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\")\n    svg.setAttributeNS(\"\", \"viewBox\", \"0 0 18 18\")\n\n    let rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n    rect.setAttributeNS(\"\", \"x\", \"1\")\n    rect.setAttributeNS(\"\", \"y\", \"1\")\n    rect.setAttributeNS(\"\", \"width\", \"16\")\n    rect.setAttributeNS(\"\", \"height\", \"16\")\n    rect.setAttributeNS(\"\", \"rx\", \"3\")\n    rect.setAttributeNS(\"\", \"ry\", \"3\")\n    \n    let checkmark = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\")\n    checkmark.setAttributeNS(\"\", \"d\", \"M4 9.5 L 7.5 13 L 14.5 4\")\n\n    svg.onclick = () => {\n      this.toggle()\n    }\n    svg.setAttributeNS(\"\", \"tabindex\", \"0\")\n    svg.addEventListener(\"keydown\", (event: Event) => {\n      if ((event as KeyboardEvent).key === \" \") {\n        this.toggle()\n      }\n    })\n    svg.onmousedown = (event) => {\n      svg.focus()\n      event.preventDefault()\n    }\n    \n    svg.appendChild(rect)\n    svg.appendChild(checkmark)\n    \n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(checkboxStyle, true))\n    this.shadowRoot!.appendChild(svg)\n  }\n  \n  static get observedAttributes() {return ['checked'] }\n  \n  attributeChangedCallback(name: string, oldValue?: string, newValue?: string) {\n    switch(name) {\n      case \"checked\":\n        this.updateModel()\n        break\n    }\n  }\n  \n  toggle() {\n    if (this.hasAttribute(\"disabled\"))\n      return\n    if (this.hasAttribute(\"checked\"))\n      this.removeAttribute(\"checked\")\n    else\n      this.setAttribute(\"checked\", \"\")\n    this.updateModel()\n  }\n\n  updateModel() {\n    if (this.model) {\n      this.model.value = this.hasAttribute(\"checked\")\n    }\n  }\n\n  updateView() {\n    if (!this.model) {\n      this.setAttribute(\"disabled\", \"\")\n      this.removeAttribute(\"checked\")\n      return\n    }\n    this.removeAttribute(\"disabled\")\n\n    if (this.model.value)\n      this.setAttribute(\"checked\", \"\")\n    else\n      this.removeAttribute(\"checked\")\n  }\n}\nwindow.customElements.define(\"toad-checkbox\", CheckboxView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"../dom\"\nimport { Signal } from \"../signal\"\nimport { Action } from \"../action\"\nimport { Model, TextModel, HtmlModel } from \"../model\"\nimport { GenericView } from \"../view\"\nimport { Controller, globalController } from \"../controller\"\n\nlet menuStyle = document.createElement(\"style\")\nmenuStyle.textContent=`\n  :host(.menu-button) {\n    font-family: var(--toad-font-family, sans-serif);\n    font-size: 14px;\n    font-weight: bold;\n    padding: 7px;\n    vertical-align: center;\n  \n    background: #fff;\n    color: #000;\n    cursor: default;\n  }\n  :host(.menu-button.active) {\n    background: #000;\n    color: #fff;\n  }\n  :host(.menu-button.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.active.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.menu-down) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-down) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.menu-side) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-side) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  .menu-bar {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .menu-popup {\n    position: fixed;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 2px 2px 5px #888;\n  }\n`\n\nexport enum MenuState {\n  WAIT,\n  DOWN,\n  UP_N_HOLD,\n  DOWN_N_HOLD,\n  DOWN_N_OUTSIDE,\n  DOWN_N_INSIDE_AGAIN\n}\n\nexport enum Type {\n  BUTTON,\n  RADIOBUTTON,\n  CHECKBUTTON,\n  SEPARATOR\n}\n\n// menu node\nexport class Node {\n  title: string\n  label: string\n  shortcut?: string\n  type: string\n  modelId?: string\n\n  parent?: Node\n  down?: Node\n  next?: Node\n\n  view?: HTMLElement\n  \n  constructor(title: string, label: string, shortcut?: string, type?: string, modelId?: string) {\n    this.title = title\n    this.label = label\n    this.shortcut = shortcut\n    this.type = type ? type : \"entry\"\n    this.modelId = modelId\n  }\n  \n  isEnabled(): boolean {   // get/set\n    return true\n  }\n  \n  isAvailable(): boolean { // get/set\n    return true\n  }\n  \n  createWindowAt(parent: MenuHelper, parentView: HTMLElement): void {\n    if (this.type==\"spacer\") {\n      let span = document.createElement(\"span\") as HTMLSpanElement\n      span.style.flexGrow = \"1\"\n      parentView.appendChild(span)\n      return\n    }\n    this.view = new MenuButton(parent, this)\n    parentView.appendChild(this.view)\n  }\n  \n  deleteWindow(): void {\n  }\n}\n\n// FIXME: rename into MenuButtonContainer\nexport class MenuHelper extends HTMLElement {\n  vertical: boolean\n  closeOnClose: boolean\n  active?: MenuButton\n  state: MenuState\n  btnmaster?: MenuButton\n  parentButton?: MenuButton\n  \n  constructor() {\n    super()\n    this.vertical = true\n    this.closeOnClose = false\n    this.state = MenuState.WAIT\n  }\n}\n\nexport class Menu extends MenuHelper\n{\n  root: Node\n  view?: HTMLElement\n  _observer?: MutationObserver\n  _timer?: number\n  \n  constructor() {\n    super()\n    this.vertical = false\n    this.root = new Node(\"\", \"\", undefined, undefined)\n  }\n\n  connectedCallback() {\n    if (this.children.length===0) {\n      // Chrome, Opera invoke connectedCallback() before the children are conected\n      this._observer = new MutationObserver((record: MutationRecord[], observer: MutationObserver) => {\n        if (this._timer !== undefined)\n          clearTimeout(this._timer)\n        this._timer = setTimeout( () => {\n          this._timer = undefined\n          this.layout2nodes(this.children, this.root)\n          this.referenceActions()\n          this.createShadowDOM()\n        }, 100)\n      })\n      this._observer.observe(this, {\n        childList: true,\n        subtree: true\n      })\n    } else {\n      // Safari invokes connectedCallback() after the children are connected\n      this.layout2nodes(this.children, this.root)\n      this.referenceActions()\n      this.createShadowDOM()\n    }\n/*    \n    globalController.sigChanged.add(() => {\n      if (globalController.reasonType===\"action-add\") {\n        if (!globalController.reasonAction)\n          return\n        let node = this.findNode(globalController.reasonAction.title)\n        if (node) {\n          node.addAction(globalController.reasonAction)\n        }\n      }\n    }, this)\n*/\n  }\n  \n  disconnectedCallback() {\n//    globalController.sigChanged.remove(this)\n  }\n  \n  layout2nodes(children: HTMLCollection, parent: Node): void {\n    let node = parent.down\n    for(let child of children) {\n      let newnode: Node|undefined = undefined\n      switch(child.nodeName) {\n        case \"TOAD-MENUSPACER\":\n          newnode = new Node(\"\", \"\", \"\", \"spacer\")\n          break\n        case \"TOAD-MENUENTRY\":\n          newnode = new Node(\n            dom.attribute(child, \"name\"),\n            dom.attribute(child, \"label\"),\n            dom.attributeOrUndefined(child, \"shortcut\"),\n            dom.attributeOrUndefined(child, \"type\"),\n            dom.attributeOrUndefined(child, \"model\")\n          )\n          break\n      }\n      if (newnode) {\n        newnode.parent = parent\n        if (!node)\n          parent.down = newnode\n        else\n          node.next = newnode\n        node = newnode\n      }\n      if (!node)\n        throw Error(\"fuck\")\n      this.layout2nodes(child.children, node)\n    }\n  }\n  \n  referenceActions(): void {\n/*\n    for(let titleAndAction of globalController.actionStorage) {\n      let title = titleAndAction[0]\n      let action = titleAndAction[1]\n      let node = this.findNode(title)\n      if (node) {\n        node.addAction(action)\n      }\n    }\n*/\n  }\n  \n  findNode(str: string, parent?: Node): Node | undefined {\n    let strpos = str.indexOf(\"|\")\n    let left = strpos == -1 ? str : str.substr(0, strpos)\n    let right = strpos == -1 ? \"\" : str.substr(strpos+1)\n    \n    if (!parent)\n      parent = this.root\n    \n    for(let n=parent.down; n; n=n.next) {\n      if (n.title == left) {\n        if (!n.down) {\n          return n\n        }\n        return this.findNode(right, n)\n      }\n    }\n  \n    return undefined\n  }\n  \n  createShadowDOM() {\n    this.view = document.createElement(\"div\")\n    this.view.classList.add(\"menu-bar\")\n\n    let node = this.root.down\n    while(node) {\n      if (node.isAvailable()) {\n        node.createWindowAt(this, this.view)\n      } else {\n        node.deleteWindow()\n      }\n      node = node.next\n    }\n\n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(menuStyle, true))\n    this.shadowRoot!.appendChild(this.view)\n  }\n}\nwindow.customElements.define(\"toad-menu\", Menu)\n\nclass MenuEntry extends HTMLElement {\n}\nwindow.customElements.define(\"toad-menuentry\", MenuEntry)\nclass MenuSpacer extends HTMLElement {\n}\nwindow.customElements.define(\"toad-menuspacer\", MenuSpacer)\n\nexport class PopupMenu extends MenuHelper\n{\n  root: Node\n  vertical: boolean\n  parentButton: MenuButton\n  popup: HTMLElement\n\n  constructor(root: Node, parent: MenuButton) {\n    super()\n    this.vertical = true\n    this.root = root\n    this.parentButton = parent\n\n    this.popup = document.createElement(\"div\")\n    this.popup.classList.add(\"menu-popup\")\n\n    let node = root.down\n    while(node) {\n      if (node.isAvailable()) {\n        node.createWindowAt(this, this.popup)\n      } else {\n        node.deleteWindow()\n      }\n      node = node.next\n    }\n    this.appendChild(this.popup)\n    this.show()\n  }\n    \n  \n  show() {\n    if (!this.parentButton.master!.vertical)\n      placePopupVertical(this.parentButton, this.popup)\n    else\n      placePopupHorizontal(this.parentButton, this.popup)\n    this.style.display = \"\"\n  }\n  \n  hide() {\n    this.style.display = \"none\"\n  }\n}\nwindow.customElements.define(\"toad-popupmenu\", PopupMenu)\n\nexport class MenuButton extends GenericView<TextModel> {\n  static inside?: MenuButton\n  static buttonDown: boolean\n  static documentMouseDown?: (event: MouseEvent) => void\n\n  node: Node\n  master?: MenuHelper // FIXME: rename into container\n  popup?: PopupMenu\n  \n  action?: Action\n\n  constructor(master: MenuHelper, node: Node) {\n    super()\n    this.master = master\n    this.node = node\n    let menuButton = this\n    this.classList.add(\"menu-button\")\n    if (node.down) {\n      if (master.vertical)\n        this.classList.add(\"menu-side\")\n      else\n        this.classList.add(\"menu-down\")\n    }\n    this.updateView()\n    \n    this.onmousedown = (event: MouseEvent) => {\n      event.stopPropagation()\n\n//if (this.node) console.log(\"mousedown \", this.node.title)\n\n      let documentMouseUp = function(event: MouseEvent) {\n        document.removeEventListener(\"mouseup\", documentMouseUp, {capture: true})\n        event.preventDefault()\n        setTimeout(()=>{\n          if (MenuButton.buttonDown)\n            menuButton.dispatchEvent(new MouseEvent(\"mouseup\", event))\n        }, 0)\n      }\n      document.addEventListener(\"mouseup\", documentMouseUp, {capture: true})\n      MenuButton.buttonDown = true\n\n      if (!this.master)\n        throw Error(\"fuck\")\n      switch(this.master.state) {\n        case MenuState.WAIT:\n          this.master.state = MenuState.DOWN\n          this.activate()\n          break\n        case MenuState.UP_N_HOLD:\n          if (this.master.active!==this) {\n            this.master.state = MenuState.DOWN\n            this.activate()\n          } else {\n            this.master.state = MenuState.DOWN_N_HOLD\n          }\n          break\n        default:\n          throw Error(\"unexpected state \"+this.master.state)\n      }\n      return false\n    }\n    \n    this.onmouseup = (event: MouseEvent) => {\n      event.stopPropagation()\n      if (!MenuButton.buttonDown)\n        return\n      MenuButton.buttonDown = false\n\n//if (this.node) console.log(\"mouseup \", this.node.title)\n\n      if (!this.master)\n        throw Error(\"fuck\")\n      if (!this.node)\n        throw Error(\"fuck\")\n      switch(this.master.state) {\n        case MenuState.DOWN:\n          if (this.node.isEnabled() && !this.node.down) {\n            this.trigger()\n            this.master.state = MenuState.WAIT\n          } else {\n            this.master.state = MenuState.UP_N_HOLD\n            \n            if (MenuButton.documentMouseDown) {\n              document.removeEventListener(\"mousedown\", MenuButton.documentMouseDown, {capture: false})\n            }\n            MenuButton.documentMouseDown = function(event: MouseEvent) {\n              if (MenuButton.documentMouseDown)\n                document.removeEventListener(\"mousedown\", MenuButton.documentMouseDown, {capture: false})\n              MenuButton.documentMouseDown = undefined\n              let tagName = (event.target as HTMLElement).tagName\n              if (tagName!==\"TOAD-MENUBUTTON\") {\n                menuButton.collapse()\n              }\n            }\n            document.addEventListener(\"mousedown\", MenuButton.documentMouseDown, {capture: false})\n          }\n          break\n        case MenuState.DOWN_N_HOLD:\n        case MenuState.DOWN_N_OUTSIDE:\n          this.master.state = MenuState.WAIT\n          this.deactivate()\n          this.collapse()\n          // this.dropKeyboard()\n          if (this.master.closeOnClose) {\n            // this.master.destroyWindow()\n          }\n          break\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          // this.dropKeyboard()\n          this.trigger()\n          break\n        default:\n          throw Error(\"unexpected state \"+this.master.state)\n      }\n      return false\n    }\n    \n    // leave\n    this.onmouseout = (event: MouseEvent) => {\n      event.stopPropagation()\n//console.log(\"mouseout \", this.node.title)\n      if (!this.master)\n        throw Error(\"fuck\")\n      MenuButton.inside = undefined\n      switch(this.master.state) {\n        case MenuState.WAIT:\n        case MenuState.DOWN_N_OUTSIDE:\n        case MenuState.UP_N_HOLD:\n        case MenuState.DOWN_N_HOLD:\n          break\n        case MenuState.DOWN:\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          this.master.state = MenuState.DOWN_N_OUTSIDE\n          this.updateView()\n          break;\n        default:\n          throw Error(\"unexpected state\")\n      }\n      return false\n    }\n    \n    this.onmouseover = (event: MouseEvent) => {\n      event.stopPropagation()\n//console.log(\"mouseover \", this.node.title)\n      if (!menuButton.master)\n        throw Error(\"fuck\")\n      MenuButton.inside = menuButton\n      switch(menuButton.master.state) {\n        case MenuState.WAIT:\n        case MenuState.UP_N_HOLD:\n        case MenuState.DOWN_N_OUTSIDE:\n        case MenuState.DOWN_N_HOLD:\n        case MenuState.DOWN:\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          if (!MenuButton.buttonDown)\n            break\n          if (!this.master)\n            throw Error(\"fuck\")\n          if (this.master.active)\n            this.master.active.deactivate()\n          this.master.state = MenuState.DOWN_N_INSIDE_AGAIN\n          this.activate()\n          break\n        default:\n          throw Error(\"unexpected state \"+menuButton.master.state)\n      }\n      return false\n    }\n    \n    this.attachShadow({mode: 'open'})\n    if (!this.shadowRoot)\n      throw Error(\"fuck\")\n    this.shadowRoot.appendChild(document.importNode(menuStyle, true))\n    if (!this.node.modelId)\n      this.shadowRoot.appendChild(document.createTextNode(node.label))\n  }\n\n  connectedCallback() {\n    if (this.controller)\n      return\n      \n    if (this.node.down===undefined) {\n      let actionId=this.node.title\n      for(let node=this.node.parent; node; node=node.parent) {\n        if (!node.title.length)\n          break\n        actionId=node.title+\"|\"+actionId\n      }\n      actionId = \"A:\"+actionId\n//console.log(\"*** register view action \"+actionId, this.node)\n      globalController.registerView(actionId, this)\n    }\n\n    if (this.node.modelId!==undefined) {\n      let modelId = \"M:\"+this.node.modelId\n      globalController.registerView(modelId, this)\n    }\n    \n  }\n\n  disconnectedCallback() {\n    if (this.controller)\n      this.controller.unregisterView(this)\n  }\n  \n  setModel(model?: Model): void {\n    if (!model) {\n      if (this.action)\n        this.action.modified.remove(this)\n      this.model = undefined\n      this.action = undefined\n      this.updateView()\n      return\n    }\n\n    if (model instanceof Action) {\n      this.action = model\n      this.action.modified.add(() => {\n        this.updateView()\n      }, this)\n    } else\n    if (model instanceof TextModel) {\n      this.model = model\n    } else {\n      throw Error(\"unexpected model of type \"+model.constructor.name)\n    }\n    this.updateView()\n  }\n  \n  updateModel() {\n//console.log(\"MenuButton.updateModel \"+this.node.title)\n  }\n\n  updateView(): void {\n    if (this.model && this.model.value) { // FIXME: use updateView only for Model stuff\n      if (!this.shadowRoot)\n        throw Error(\"fuck\")\n//      console.log(\"update view with model\")\n      let span = document.createElement(\"span\")\n      if (this.model instanceof HtmlModel)\n        span.innerHTML = this.model.value\n      else\n        span.innerText = this.model.value\n\n      // FIXME: dom.replaceChild(this.shadowRoot, 1, span)\n      if (this.shadowRoot.children.length>1)\n        this.shadowRoot.removeChild(this.shadowRoot.children[1])\n      if (this.shadowRoot.children.length>1)\n        this.shadowRoot.insertBefore(span, this.shadowRoot.children[1])\n      else\n        this.shadowRoot.appendChild(span)\n    }\n  \n    if (!this.master)\n      throw Error(\"fuck\")\n\n    let active = false\n    if (this.master.active==this) {\n      switch(this.master.state) {\n        case MenuState.DOWN:\n        case MenuState.UP_N_HOLD:\n        case MenuState.DOWN_N_HOLD:\n        case MenuState.DOWN_N_INSIDE_AGAIN:\n          active = true\n          break\n        case MenuState.DOWN_N_OUTSIDE:\n          if (!this.node)\n            throw Error(\"fuck\")\n          active = this.node.down!==undefined && this.node.isEnabled()\n          break\n      }\n    }\n\n    this.classList.toggle(\"active\", active)\n\n    this.classList.toggle(\"disabled\", !this.isEnabled())\n  }\n  \n  isEnabled(): boolean {\n    if (this.node.down!==undefined)\n      return true\n    return this.action!==undefined && this.action.enabled\n  }\n  \n  trigger(): void {\n    this.collapse()\n    if (!this.action)\n      return\n    this.action.trigger()\n  }\n  \n  collapse(): void {\n    if (!this.master)\n      throw Error(\"fuck\")\n    if (this.master.parentButton)\n      this.master.parentButton.collapse()\n    else\n      this.deactivate()\n  }\n  \n  openPopup(): void {\n    if (!this.node)\n      return\n    if (!this.node.down)\n      return\n\n    if (!this.shadowRoot)\n      throw Error(\"fuck\")\n\n    if (!this.popup) {\n      this.popup = new PopupMenu(this.node, this)\n      this.shadowRoot.appendChild(this.popup)\n    } else {\n      this.popup.show()\n    }\n  }\n  \n  closePopup(): void {\n    if (!this.popup)\n      return\n    if (this.popup.active)\n      this.popup.active.deactivate()\n    this.popup.hide()\n  }\n  \n  activate(): void {\n    if (!this.master)\n      throw Error(\"fuck\")\n    if (!this.node)\n      throw Error(\"fuck\")\n    \n    // if active return\n    \n    let oldActive = this.master.active\n    this.master.active = this\n    if (oldActive && oldActive!==this) {\n      oldActive.closePopup()\n      oldActive.updateView()\n    }\n    this.updateView()\n    this.openPopup()\n  }\n  \n  deactivate(): void {\n    if (!this.master)\n      throw Error(\"fuck\")\n    if (this.master.active !== this)\n      return\n    \n    this.master.active.closePopup()\n    this.master.active = undefined\n    this.master.state = MenuState.WAIT\n    this.updateView()\n  }\n  \n}\nwindow.customElements.define(\"toad-menubutton\", MenuButton)\n\nfunction placePopupVertical(parent: HTMLElement, popup: HTMLElement): void {\n  let parentBoundary = parent.getBoundingClientRect()\n\n  // FIXME: need to handle scrollLeft, scrollTop?\n\n  popup.style.opacity = \"0\"\n  popup.style.left = parentBoundary.left+\"px\"\n  popup.style.top = (parentBoundary.top+parentBoundary.height)+\"px\"\n\n  setTimeout(function() {\n    // FIXME: there might still not be enough space, might want to scroll and/or overlap parent\n    let popupBoundary = popup.getBoundingClientRect()\n    let popupBottom = parentBoundary.top + parentBoundary.height + popupBoundary.height\n    if (popupBottom > window.innerHeight) {\n      popup.style.top = (parentBoundary.top - popupBoundary.height)+\"px\"\n    }\n    let popupRight = parentBoundary.left + popupBoundary.width\n    if (popupRight > window.innerWidth) {\n       popup.style.left = (parentBoundary.left + parentBoundary.width - popupBoundary.width)+\"px\"\n    }\n    popup.style.opacity = \"1\"\n  }, 0)\n\n//  window.addEventListener(\"mouseup\", new PopupListener(popup), true)\n}\n\nfunction placePopupHorizontal(parent: HTMLElement, popup: HTMLElement): void {\n  let parentBoundary = parent.getBoundingClientRect()\n\n  // FIXME: need to handle scrollLeft, scrollTop?\n\n  popup.style.opacity = \"0\"\n  popup.style.left = (parentBoundary.left+parentBoundary.width)+\"px\"\n  popup.style.top = parentBoundary.top+\"px\"\n\n  setTimeout(function() {\n    // FIXME: there might still not be enough space, might want to scroll and/or overlap parent\n    let popupBoundary = popup.getBoundingClientRect()\n    let popupBottom = parentBoundary.top + popupBoundary.height\n    if (popupBottom > window.innerHeight) {\n      popup.style.top = (parentBoundary.top + parentBoundary.height - popupBoundary.height)+\"px\"\n    }\n    let popupRight = parentBoundary.left + parentBoundary.width + popupBoundary.width\n    if (popupRight > window.innerWidth) {\n       popup.style.left = (parentBoundary.left - popupBoundary.width)+\"px\"\n    }\n    popup.style.opacity = \"1\"\n  }, 0)\n\n//  window.addEventListener(\"mouseup\", new PopupListener(popup), true)\n}\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { NumberModel } from \"../model\"\nimport { GenericView } from \"../view\"\n\nexport class SliderView extends GenericView<NumberModel> {\n  input: HTMLInputElement\n\n  constructor() {\n    super()\n    this.input = document.createElement(\"input\") as HTMLInputElement\n    this.input.type = \"range\"\n    let view = this\n    this.input.oninput = () => { view.updateModel() }\n    this.attachShadow({mode: 'open'})\n        .appendChild(this.input)\n  }\n  \n  updateModel() {\n    if (this.model)\n      this.model.value = Number.parseFloat(this.input.value)\n  }\n\n  updateView() {\n    if (!this.model)\n      return\n    this.input.step = String(this.model.step)\n    this.input.min = String(this.model.min)\n    this.input.max = String(this.model.max)\n    this.input.value = String(this.model.value)\n  }\n}\nwindow.customElements.define(\"toad-slider\", SliderView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport * as dom from \"../dom\"\nimport { Model, TextModel, HtmlModel } from \"../model\"\nimport { View, GenericView } from \"../view\"\nimport { TextView } from \"./text\"\n\nfunction dump(element: HTMLElement, depth?: number): void {\n  if (depth===undefined)\n    depth = 0\n  let out=\"\"\n  for(let i=0; i<depth; ++i)\n    out += \"  \"\n  out += element.tagName\n  if (element.tagName===\"TD\" || element.tagName===\"TH\")\n    out+=\"  '\" + element.innerText + \"'\"\n  console.log(out)\n  for(let child of element.children)\n    dump(child as HTMLElement, depth+1)\n}\n\ndeclare global {\n  interface Element {\n    scrollIntoViewIfNeeded(center?: boolean): void\n  }\n}\n\nlet tableStyle = document.createElement(\"style\")\ntableStyle.textContent=`\n.t2 {\n  /* border: 1px inset; */\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  outline-offset: -2px;\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n}\n\n.t2h, .t2d {\n  border-color: #ccc #fff #fff #ccc;\n  border-width: 2px 0px 0px 2px;\n  border-style: solid none none solid;\n  border-collapse: collapse;\n  border-spacing: 0;\n}\n\n/* FIXME: there is no re-evaluation after the table view was resized */\n/*\nth:last-child, td:last-child {\n  width: 100%;\n}\n*/\n\n.t2h tr {\n  background: #e0e0e0;\n}\n\n.t2h * th {\n  border-color: #fff #ccc #ccc #fff;\n  border-style: none solid none none;\n  border-width: 0 1px 0 0;\n  z-index: 1;\n  letter-spacing: 0;  \n  overflow: hidden;   \n  padding: 2px;\n  margin: 0px; \n  white-space: nowrap;\n}\n \n.t2d * td {\n  border-color: #fff #ccc #ccc #fff;\n  border-style: none solid solid none;\n  border-width: 0 1px 1px 0;\n  letter-spacing: 0;\n  overflow: hidden; \n  padding: 2px;\n  margin: 0px; \n  white-space: nowrap;\n  /* background: #fff; */\n}\n\n.t2d tr:nth-child(even) {\n  background: var(--toad-table-even-row, #f5f5f5);\n}\n.t2d tr:nth-child(odd) {\n  background: var(--toad-table-odd-row, #ffffff);\n}\n\ndiv .t2d tr.selected,\ndiv .t2d tr td.selected {\n/*\n  background: #dcdcdc;\n  color: #000;\n*/\n  background: #808080;\n  color: #fff;\n}\n\n.t2:focus .t2d tr.selected,\n.t2:focus .t2d tr td.selected {\n  background: #0069d4;\n  color: #fff;\n}\n\n`\n\nfunction pixelToNumber(pixel: string): number {\n  if (pixel.substr(pixel.length-2) !== \"px\")\n    throw Error(\"expected 'px' suffix\")\n  return Number.parseFloat(pixel.substr(0, pixel.length-2))\n}\n  \nfunction getPropertyValue(element: HTMLElement, propertyName: string): number {\n  let elementStyle = window.getComputedStyle(element, undefined)\n  let property = elementStyle.getPropertyValue(propertyName)\n  return pixelToNumber(property)\n}\n  \nfunction horizontalPadding(element: HTMLElement): number {\n  return getPropertyValue(element, \"padding-left\") + getPropertyValue(element, \"padding-right\")\n}\n\nexport enum TableEditMode {\n  EDIT_CELL, // FIXME: replace with SELECT_CELL and TableModel.getFieldView will return undefined when not editable\n  SELECT_CELL,\n//  SELECT_COLUMN,\n  SELECT_ROW\n}\n\nexport class TablePos {\n  col: number\n  row: number\n  constructor(col: number, row: number) {\n    this.col = col\n    this.row = row\n  }\n}\n\n// FIXME: also needed is a model for range and 'random' selections\nexport class SelectionModel extends Model {\n  mode: TableEditMode // FIXME: there might be a way to do without, just by the behaviour of a common API towards TableView\n  _value: TablePos\n  \n  constructor() {\n    super()\n    this.mode = TableEditMode.SELECT_ROW\n    this._value = new TablePos(0,0)\n  }\n  \n  set col(col: number) {\n    if (this._value.col === col)\n      return\n    this._value.col = col\n    this.modified.trigger()\n  }\n\n  get col(): number {\n    return this._value.col\n  }\n\n  set row(row: number) {\n    if (this._value.row === row)\n      return\n    this._value.row = row\n    this.modified.trigger()\n  }\n\n  get row(): number {\n    return this._value.row\n  }\n\n  set value(value: TablePos) {\n    if (this._value.col === value.col && this._value.row === value.row)\n      return\n    this._value = value\n    this.modified.trigger()\n  }\n  \n  get value(): TablePos {\n    return this._value\n  }\n}\n\n// FIXME: API for insert, delete and move row(s)\nexport abstract class TableModel extends Model {\n  cols: number\n  rows: number\n  \n  constructor() {\n    super()\n    this.cols = 0\n    this.rows = 0\n  }\n\n//  set value(data: any) {}\n//  get value(): any { return undefined }\n\n  getColumnHead(column: number): TextModel | undefined { return undefined }\n  abstract getFieldModel(col: number, row: number): TextModel\n  getFieldView(col: number, row: number): View | undefined { return undefined }\n}\n\nlet tableModelLocators = new Array<(data: any) => TableModel|undefined>()\n\nexport function registerTableModelLocator( locator: (data: any) => TableModel|undefined ): void {\n  tableModelLocators.push(locator)\n}\n\nexport function createTableModel(data: any): TableModel {\n  for(let locator of tableModelLocators) {\n    let model = locator(data)\n    if (model)\n      return model\n  }\n  throw new Error(\"findTableModel() failed to locate a table model\")\n}\n\nclass ArrayTableModel extends TableModel {\n\n  data: any\n\n  constructor(data: any) {\n    super()\n    this.data = data\n    this.rows = this.data.length\n    this.cols = this.data[0].length\n  }\n\n  getColumnHead(column: number): TextModel {\n    switch(column) {\n      case 0: return new TextModel(\"Title\")\n      case 1: return new TextModel(\"Author\")\n      case 2: return new TextModel(\"Year\")\n    }\n    throw Error(\"fuck\")\n  }\n  \n  getFieldModel(col: number, row: number): TextModel {\n    let model = new TextModel(this.data[row][col])\n    model.modified.add( () => {\n      this.data[row][col] = model.value\n    })\n    return model\n  }\n\n  getFieldView(col: number, row: number): View {\n    return new TextView()\n  }\n}\n\nregisterTableModelLocator( function(data: any): TableModel | undefined {\n  if (!(data instanceof Array)) {\n    return undefined\n  }\n  if (data.length===0) {\n    return undefined\n  }\n  if (!(data[0] instanceof Array)) {\n    return undefined\n  }\n  for(let field of data[0]) {\n    if ( typeof field !== \"string\" &&\n         typeof field !== \"number\" )\n    {\n      return undefined\n    }\n  }\n  return new ArrayTableModel(data)\n})\n\nexport class TableView extends GenericView<TableModel> {\n\n  selectionModel?: SelectionModel\n\n  rootElement: HTMLElement\n  headTable: HTMLTableElement\n  headRow: HTMLTableRowElement\n  bodyRow: HTMLTableRowElement\n  bodyDiv: HTMLDivElement\n  bodyBody: HTMLTableSectionElement\n\n  input: HTMLElement\n  fieldView?: HTMLElement\n  fieldModel?: Model\n  cellBeingEdited?: HTMLElement\n  insideGoTo: boolean\n\n  constructor() {\n    super()\n    \n    this.insideGoTo = false\n    \n    let rootElement = dom.tag(\"div\")\n    rootElement.className = \"t2\"\n    \n    rootElement.onkeydown = (event: KeyboardEvent) => {\n      if (!this.selectionModel)\n        return\n      // FIXME: based on the selection model we could plug in a behaviour class\n      switch(this.selectionModel.mode) {\n        case TableEditMode.SELECT_ROW: {\n          let row = this.selectionModel.value.row\n          switch(event.key) {\n            case \"ArrowDown\":\n              if (row+1<this.model!.rows)\n                ++row\n              break\n            case \"ArrowUp\":\n              if (row>0)\n                --row\n              break\n          }\n          if (row != this.selectionModel.value.row) {\n            this.toggleRowSelection(this.selectionModel.value.row, false)\n            this.selectionModel.row = row\n            this.toggleRowSelection(this.selectionModel.value.row, true)\n          }\n        } break\n        case TableEditMode.SELECT_CELL: {\n          let pos = { col: this.selectionModel.col, row: this.selectionModel.row }\n          switch(event.key) {\n            case \"ArrowRight\":\n              if (pos.col+1<this.model!.cols) {\n                ++pos.col\n              }\n              break\n            case \"ArrowLeft\":\n              if (pos.col>0) {\n                --pos.col\n              }\n              break\n            case \"ArrowDown\":\n              if (pos.row+1<this.model!.rows)\n                ++pos.row\n              break\n            case \"ArrowUp\":\n              if (pos.row>0)\n                --pos.row\n              break\n          }\n          if (pos.col != this.selectionModel.col ||\n              pos.row != this.selectionModel.row)\n          {\n            this.toggleCellSelection(this.selectionModel.value, false)\n            this.selectionModel.value = pos\n            this.toggleCellSelection(this.selectionModel.value, true)\n          }\n        } break\n      }\n    }\n    this.rootElement = rootElement\n\n    // head\n    let headDiv = dom.tag(\"div\")\n    // headDiv.style.width = \"1px\"\n    headDiv.style.overflow = \"hidden\"\n    \n    let headTable = dom.tag(\"table\") as HTMLTableElement\n    this.headTable = headTable\n    headTable.className = \"t2h\"\n    \n    let headHead = dom.tag(\"thead\")\n    \n    let headRow = dom.tag(\"tr\") as HTMLTableRowElement\n    this.headRow = headRow\n    \n    headHead.appendChild(headRow)\n    headTable.appendChild(headHead)\n    headDiv.appendChild(headTable)\n    rootElement.appendChild(headDiv)\n\n    // body\n    let bodyDiv = dom.tag(\"div\") as HTMLDivElement\n    // headDiv.style.width = \"1px\"\n    bodyDiv.style.overflow = \"auto\"\n    bodyDiv.onscroll = function() {\n      headDiv.scrollLeft = bodyDiv.scrollLeft\n    }\n    this.bodyDiv = bodyDiv\n    \n    let bodyTable = dom.tag(\"table\")\n    bodyTable.className = \"t2d\"\n    bodyTable.onmousedown = (event: MouseEvent) => {\n      if (!event.srcElement)\n        return\n      if (event.srcElement.tagName !== \"TD\")\n        return\n      event.preventDefault() // otherwise field will loose focus again\n      this.goToField(event.srcElement as HTMLTableDataCellElement)\n    }\n    \n    let bodyBody = dom.tag(\"tbody\") as HTMLTableSectionElement\n    this.bodyBody = bodyBody\n    \n    let bodyRow = dom.tag(\"tr\") as HTMLTableRowElement\n    bodyBody.appendChild(bodyRow)\n    this.bodyRow = bodyRow\n    \n    bodyTable.appendChild(bodyBody)\n    bodyDiv.appendChild(bodyTable)\n\n    let zeroSize = dom.tag(\"div\")\n    zeroSize.style.width = \"0px\"\n    zeroSize.style.height = \"0px\"\n    zeroSize.style.margin = \"0\"\n    zeroSize.style.padding = \"0\"\n    zeroSize.style.border = \"none\"\n    \n    this.input = dom.tag(\"div\") as HTMLElement\n    this.input.style.position = \"relative\"\n    this.input.style.background = \"#fff\"\n    this.input.style.border=\"none\"\n    this.input.style.opacity = \"0\"\n    \n    this.input.addEventListener(\"focusin\", (genericEvent: Event) => {\n      this.input.style.opacity = \"1\"\n      if (this.insideGoTo)\n        return\n      if (!this.model)\n        return\n      let event = genericEvent as FocusEvent\n      if (event.target && event.relatedTarget) {\n        if (dom.order(event.relatedTarget as Node, this)) {\n          this.goTo(0, 0)\n        } else {\n          this.goTo(this.model.cols-1, this.model.rows-1)\n        }\n      }\n    })\n    this.input.addEventListener(\"focusout\", () => {\n      this.input.style.opacity = \"0\"\n    })\n    \n    zeroSize.appendChild(this.input)\n    bodyDiv.appendChild(zeroSize)\n\n    rootElement.appendChild(bodyDiv)\n\n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(tableStyle, true))\n    this.shadowRoot!.appendChild(rootElement)\n  }\n  \n  connectedCallback() {\n    super.connectedCallback()\n    this.bodyDiv.style.height = this.style.height // FIXME: include heading\n  }\n  \n  setModel(model?: Model): void {\n    if (!model) {\n      if (this.selectionModel)\n        this.selectionModel.modified.remove(this)\n      this.model = undefined\n      this.selectionModel = new SelectionModel()\n      this.updateView()\n      return\n    }\n\n    if (model instanceof SelectionModel) {\n      this.selectionModel = model\n      this.updateSelection()\n      this.selectionModel.modified.add(() => {\n        this.updateSelection()\n      }, this)\n    } else\n    if (model instanceof TableModel) {\n      this.model = model\n      this.updateView()\n    } else {\n      throw Error(\"unexpected model of type \"+model.constructor.name)\n    }\n  }\n  \n  updateModel() {\n//console.log(\"TableView.updateModel()\")\n//    if (this.model)\n//      this.model.value = this.input.value\n  }\n\n  updateView() {\n//console.log(\"TableView.updateView()\")\n    if (!this.model) {\n      return\n    }\n\n//console.log(\"updateHeader, updateBody\")\n    this.updateHeader()\n    this.updateBody()\n    this.updateSelection()\n    setTimeout( () => {\n      this.adjustInternalTables()\n    })\n  }\n\n  updateHeader() {\n    if (!this.model)\n      throw Error(\"fuck\")\n\n    let noHeader = false\n\n    while(this.headRow.children.length>this.model.cols+1)\n      this.headRow.removeChild(this.headRow.children[this.headRow.children.length-1])\n\n    for(let i=0; i<this.model.cols; ++i) {\n      let cell\n      if (i>=this.headRow.children.length) {\n        cell = dom.tag(\"th\")\n        this.headRow.appendChild(cell)\n      } else {\n        cell = this.headRow.children[i] as HTMLTableDataCellElement\n        cell.style.minWidth = \"\"\n        cell.style.border = \"\"\n      }\n      let text = this.model.getColumnHead(i)\n      if (text === undefined) {\n        noHeader = true\n        continue\n      }\n      if (text instanceof HtmlModel)\n        cell.innerHTML = text.value\n      else\n        cell.innerText = text.value\n    }\n    \n    let fillerForMissingScrollbar\n    if (this.headRow.children.length<this.model.cols+1) {\n      fillerForMissingScrollbar = dom.tag(\"th\") as HTMLTableDataCellElement\n      this.headRow.appendChild(fillerForMissingScrollbar)\n    } else {\n      fillerForMissingScrollbar = this.headRow.children[this.headRow.children.length-1] as HTMLTableDataCellElement\n    }\n    fillerForMissingScrollbar.innerText = \"\"\n    fillerForMissingScrollbar.style.minWidth = \"777px\"\n    fillerForMissingScrollbar.style.border = \"0px none\"\n    \n    this.headTable.style.display = noHeader ? \"none\" : \"\"\n  }\n  \n  updateBody() {\n    if (!this.model)\n      throw Error(\"fuck\")\n      \n    while(this.bodyRow.children.length > this.model.cols)\n      this.bodyRow.removeChild(this.bodyRow.children[this.bodyRow.children.length-1])\n\n    while(this.bodyRow.children.length < this.model.cols) {\n      let cell = dom.tag(\"td\")\n      cell.style.paddingTop = \"0\"\n      cell.style.paddingBottom = \"0\"\n      this.bodyRow.appendChild(cell)\n    }\n//    (this.bodyRow.children[this.bodyRow.children.length] as HTMLElement).style.width=\"100%\"\n\n    while(this.bodyBody.children.length-1 > this.model.rows)\n      this.bodyBody.removeChild(this.bodyBody.children[this.bodyBody.children.length-1])\n\n    for(let row=0; row<this.model.rows; ++row) {\n      let bodyRow: HTMLTableRowElement\n      if (row+1 >= this.bodyBody.children.length) {\n        bodyRow = dom.tag(\"tr\") as HTMLTableRowElement\n        this.bodyBody.appendChild(bodyRow)\n      } else {\n        bodyRow = this.bodyBody.children[row+1] as HTMLTableRowElement\n      }\n\n      while(bodyRow.children.length>this.model.cols)\n        bodyRow.removeChild(bodyRow.children[bodyRow.children.length-1])\n\n      for(let col=0; col<this.model.cols; ++col) {\n        let cell: HTMLTableDataCellElement\n        if (col >= bodyRow.children.length) {\n          cell = dom.tag(\"td\") as HTMLTableDataCellElement\n          bodyRow.appendChild(cell)\n        } else {\n          cell = bodyRow.children[col] as HTMLTableDataCellElement\n        }\n        cell.style.width = \"\"\n        let fieldModel = this.model.getFieldModel(col, row)\n//console.log(\"  updateBody. cell \"+col+\", \"+row+\" = '\"+fieldModel.value+\"'\")\n        if (cell.innerText!=fieldModel.value) {\n//          if (cell.innerText != \"\")\n//            throw Error(\"TableView.updateBody(): cell \"+col+\", \"+row+\" differs during update, old='\" + cell.innerText + \"', new='\" + fieldModel.value + \"'\")\n          if (fieldModel instanceof HtmlModel)\n            cell.innerHTML = fieldModel.value\n          else\n            cell.innerText = fieldModel.value\n        }\n      }\n      \n      if (this.style.width===\"100%\") {\n        let lastCell = bodyRow.children[ bodyRow.children.length-1] as HTMLTableDataCellElement\n        lastCell.style.width = \"100%\"\n      }\n      \n    }\n//    dump(this.bodyBody)\n  }\n  \n  updateSelection() {\n    if (this.selectionModel === undefined)\n      return\n\n    switch(this.selectionModel.mode) {\n      case TableEditMode.EDIT_CELL:\n        this.prepareFieldAtPosition(this.selectionModel.col, this.selectionModel.row)\n        delete this.rootElement.tabIndex\n        break\n      case TableEditMode.SELECT_CELL: {\n        let allSelected = this.bodyBody.querySelectorAll(\"tbody > tr > td.selected\")\n        for(let selected of allSelected)\n          selected.classList.remove(\"selected\")\n        this.toggleCellSelection(this.selectionModel.value, true)\n        this.rootElement.tabIndex = 0\n        break\n      }\n      case TableEditMode.SELECT_ROW: {\n        let allSelected = this.bodyBody.querySelectorAll(\"tbody > tr.selected\")\n        for(let selected of allSelected)\n          selected.classList.remove(\"selected\")\n        this.toggleRowSelection(this.selectionModel.value.row, true)\n        this.rootElement.tabIndex = 0\n        break\n      }\n    }\n  }\n  \n  adjustInternalTables() {\n    let headRow = this.headRow.children\n    let bodyRow = this.bodyRow.children\n    for(let col=0; col<this.model!.cols; ++col) {\n      let head = headRow[col] as HTMLElement\n      let body = bodyRow[col] as HTMLElement\n      \n      let headWidth = head.clientWidth - horizontalPadding(head)\n      let bodyWidth = body.clientWidth - horizontalPadding(body)\n\n      head.style.width = head.style.minWidth = head.style.maxWidth =\n      body.style.width = body.style.minWidth = body.style.maxWidth =\n        ((headWidth > bodyWidth ? headWidth : bodyWidth)) + \"px\"\n    }\n    \n    if (this.style.width!==\"100%\")\n      this.rootElement.style.width  = (this.bodyRow.clientWidth + this.bodyDiv.offsetWidth - this.bodyDiv.clientWidth + 2) + \"px\"\n//    this.rootElement.style.height = (this.bodyRow.clientHeight + this.bodyDiv.offsetHeight - this.bodyDiv.clientHeight + 2) + \"px\"\n\n  }\n  \n  unadjustInternalTables(pos: any) {\n    let headRow = this.headRow.children\n    let bodyRow = this.bodyRow.children\n    let head = headRow[pos.col] as HTMLElement\n    let body = bodyRow[pos.col] as HTMLElement\n    head.style.width = head.style.minWidth = head.style.maxWidth =\n    body.style.width = body.style.minWidth = body.style.maxWidth = \"\"\n  }\n\n  toggleCellSelection(pos: TablePos, flag: boolean): void {\n    if (pos.col >= this.model!.cols || pos.row >= this.model!.rows)\n      return\n    let element = this.bodyBody.children[pos.row+1].children[pos.col]\n    element.classList.toggle(\"selected\", flag)\n    if (flag) {\n      // FIXME: only when we also have the focus\n      if (element.scrollIntoViewIfNeeded)\n        element.scrollIntoViewIfNeeded()\n      else\n        element.scrollIntoView()\n    }\n  }\n\n  toggleRowSelection(row: number, flag: boolean): void {\n    if (row >= this.model!.rows)\n      return\n    let rowElement = this.bodyBody.children[1+this.selectionModel!.value.row]\n    rowElement.classList.toggle(\"selected\", flag)\n    if (flag) {\n      // FIXME: only when we also have the focus\n      if (rowElement.scrollIntoViewIfNeeded)\n        rowElement.scrollIntoViewIfNeeded()\n      else\n        rowElement.scrollIntoView()\n    }\n  }\n\n  adjustInputToElement(element: HTMLTableDataCellElement) {\n    let boundary = element.getBoundingClientRect()\n    let td = element\n    let tr = td.parentElement\n    let tbody = tr!.parentElement\n    \n    if(navigator.userAgent.indexOf(\"Chrome\") > -1) {\n      // Chrome\n      this.input.style.left = (td.offsetLeft+2)+\"px\"\n      this.input.style.top  = (td.offsetTop-tbody!.clientHeight)+\"px\"\n    } else {\n      // Safari & Opera\n      this.input.style.left = (td.offsetLeft+1)+\"px\"\n      this.input.style.top  = (td.offsetTop-tbody!.clientHeight-1)+\"px\"\n    }\n\n    let width = (element.clientWidth - horizontalPadding(element)) + \"px\"\n    \n    this.input.style.width = width\n    this.input.style.height = (boundary.height)+\"px\"\n\n    // FIXME: add two new functions: lockElement(), unlockElement() and invoke the accordingly\n    // element.style.width = element.style.minWidth = element.style.maxWidth = width\n  }\n\n  goTo(column: number, row: number) {\n    this.insideGoTo = true\n    this.prepareFieldAtPosition(column, row)\n    this.focus()\n    this.insideGoTo = false\n  }\n  \n  goToField(element: HTMLTableDataCellElement | undefined) { // FIXME: names are inconsistent\n    this.insideGoTo = true\n    if (!element)\n      return\n    this.prepareFieldAtElement(element)\n    this.focus()\n    this.insideGoTo = false\n  }\n  \n  focus() {\n    if (this.fieldView) {\n      this.fieldView.focus()\n    } else {\n      this.rootElement.focus()\n    }\n  }\n  \n  prepareFieldAtPosition(column: number, row: number) {\n    this.prepareFieldAtElement(this.getElementAt(column, row))\n  }\n  \n  getElementAt(column: number, row: number): HTMLTableDataCellElement {\n    let element = this.bodyBody.children[row+1].children[column] as HTMLTableDataCellElement\n    if (!element)\n      throw Error(\"fuck\")\n    return element\n  }\n  \n  prepareFieldAtElement(element: HTMLTableDataCellElement | undefined) {\n    if (element===undefined || element.tagName!==\"TD\")\n      return\n    \n    let pos = this.positionOfField(element)\n    \n    if (this.selectionModel) {\n      switch(this.selectionModel.mode) {\n        case TableEditMode.EDIT_CELL:\n          this.selectionModel.value = pos\n          break\n        case TableEditMode.SELECT_CELL:\n          this.toggleCellSelection(this.selectionModel.value, false)\n          this.selectionModel.value = pos\n          this.toggleCellSelection(this.selectionModel.value, true)\n          return\n        case TableEditMode.SELECT_ROW:\n          this.toggleRowSelection(this.selectionModel!.value.row, false)\n          this.selectionModel.value.row = pos.row\n          this.toggleRowSelection(this.selectionModel!.value.row, true)\n          return\n      }\n    }\n\n    let fieldView  = this.model!.getFieldView(pos.col, pos.row)\n    if (!fieldView)\n      return\n    this.fieldView = fieldView\n    fieldView.classList.add(\"embedded\")\n\n    let fieldModel = this.model!.getFieldModel(pos.col, pos.row)\n    fieldView.setModel(fieldModel)\n\n/*\n    // adjust table size while editing (cursor handling is ugly)    \n    fieldModel.modified.add( () => {\n      element.innerText = fieldModel.value\n      setTimeout( () => {\n        // apply element size to fieldView\n        this.adjustInputToElement(element)\n        this.adjustInternalTables()\n      }, 0)\n    })\n*/\n\n    fieldView.onblur = () => {\n      if (element.innerText == fieldModel.value)\n        return\n      element.innerText = fieldModel.value\n      this.unadjustInternalTables(pos)\n      setTimeout( () => {\n        this.adjustInternalTables()\n      }, 0)\n    }\n\n    fieldView.onkeydown = (event: KeyboardEvent) => {\n      switch(event.key) {\n        case \"ArrowDown\":\n          if (pos.row+1 >= this.model!.rows)\n            break\n          event.preventDefault()\n          this.goTo(pos.col, pos.row+1)\n          break\n        case \"ArrowUp\":\n          if (pos.row === 0)\n            break\n          event.preventDefault()\n          this.goTo(pos.col, pos.row-1)\n          break\n        case \"Tab\":\n          if (event.shiftKey) {\n            if (pos.col>0) {\n              event.preventDefault()\n              this.goTo(pos.col-1, pos.row)\n            } else {\n              if (pos.row>0) {\n                event.preventDefault()\n                this.goTo(this.model!.cols-1, pos.row-1)\n              }\n            }\n          } else {\n            if (pos.col+1<this.model!.cols) {\n              event.preventDefault()\n              this.goTo(pos.col+1, pos.row)\n            } else {\n              if (pos.row+1<this.model!.rows) {\n                event.preventDefault()\n                this.goTo(0, pos.row+1)\n              }\n            }\n          }\n          break\n      }\n      \n    }\n    \n    if (this.input.children.length===0) {\n      this.input.appendChild(fieldView)\n    } else {\n      if (document.hasFocus() && document.activeElement === this) {\n        this.input.children[0].dispatchEvent(new FocusEvent(\"blur\"))\n      }\n      this.input.replaceChild(fieldView, this.input.children[0])\n    }\n\n    this.adjustInputToElement(element)\n  }\n  \n  positionOfField(element: HTMLElement): TablePos {\n    let col:number, row:number\n    for(col=0; col<this.model!.cols; ++col) {\n      if (element.parentElement!.children[col]===element)\n        break\n    }\n    for(row=1; row<this.model!.rows+1; ++row) {\n      if (element.parentElement!.parentElement!.children[row]===element.parentElement)\n        break\n    }\n    --row\n    return new TablePos(col, row)\n  }\n}\nwindow.customElements.define(\"toad-table\", TableView)\n","/*\n *  The TOAD JavaScript/TypeScript GUI Library\n *  Copyright (C) 2018 Mark-André Hopf <mhopf@mark13.org>\n *\n *  This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n *  This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n *\n *  You should have received a copy of the GNU General Public License\n *  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { TextModel } from \"../model\"\nimport { GenericView } from \"../view\"\n\nlet textStyle = document.createElement(\"style\")\ntextStyle.textContent=`\ninput {\n/*\n  height: 2.14285714em;\n  line-height: 1.4285714285714;\n  padding: 4px 5px;\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  box-sizing: border-box;\n  margin: 2px;\n  max-width: 250px;\n  vertical-align: baseline;\n  width: 100%;\n  background-color: #fff;\n  color: #333;\n  font-size: 14px;\n*/\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n}\n\n:host(.embedded) input {\n  border: none 0;\n  border-radius: 0;\n  padding: 0;\n  margin: 2px;\n  width: 100%;\n  background: #fff;\n}\n`\n\nexport class TextView extends GenericView<TextModel> {\n  input: HTMLInputElement\n\n  constructor() {\n    super()\n    this.input = document.createElement(\"input\") as HTMLInputElement\n    this.input.oninput = () => { this.updateModel() }\n    this.attachShadow({mode: 'open'})\n    this.shadowRoot!.appendChild(document.importNode(textStyle, true))\n    this.shadowRoot!.appendChild(this.input)\n  }\n  \n  focus() {\n    this.input.focus()\n  }\n  blur() {\n    this.input.blur()\n  }\n  \n  static get observedAttributes() {return ['value'] }\n  \n  attributeChangedCallback(name: string, oldValue?: string, newValue?: string) {\n    switch(name) {\n      case \"value\":\n        if (this.model && newValue !== undefined)\n          this.model.value = newValue\n        break\n    }\n  }\n  \n  updateModel() {\n    if (this.model) {\n      this.model.value = this.input.value\n    }\n    this.setAttribute(\"value\", this.input.value)\n  }\n\n  updateView() {\n    if (this.model && this.input.value != this.model.value) {\n      this.input.value = this.model.value\n    }\n    this.setAttribute(\"value\", this.input.value)\n  }\n  \n  get value() {\n    return this.input.value\n  }\n  set value(value: string) {\n    this.input.value = value\n    this.updateModel() // FIXME: do we need this?\n  }\n}\nwindow.customElements.define(\"toad-text\", TextView)\n"],"sourceRoot":""}