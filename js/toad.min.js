var toad=function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="./src/toad.ts")}({"./src/action.ts":
/*!***********************!*\
  !*** ./src/action.ts ***!
  \***********************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ./model */"./src/model.ts"),n=i(/*! ./signal */"./src/signal.ts");e.Action=class extends o.Model{constructor(t,e){super(),this.signal=new n.Signal,this.title=e,this._enabled=!0}set value(t){throw Error("Action.value can not be assigned a value")}get value(){throw Error("Action.value can not return a value")}set enabled(t){this._enabled!=t&&(this._enabled=t,this.modified.trigger())}get enabled(){return this._enabled}trigger(t){this._enabled&&this.signal.trigger(t)}}},"./src/controller.ts":
/*!***************************!*\
  !*** ./src/controller.ts ***!
  \***************************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ./dom */"./src/dom.ts"),n=i(/*! ./model */"./src/model.ts"),s=i(/*! ./action */"./src/action.ts"),r=i(/*! ./signal */"./src/signal.ts");class l{constructor(){this.modelId2Models=new Map,this.modelId2Views=new Map,this.view2ModelIds=new Map,this.sigChanged=new r.Signal}registerAction(t,e){let i=new s.Action(void 0,t);return i.signal.add(e),this._registerModel("A:"+t,i),i}registerModel(t,e){this._registerModel("M:"+t,e)}_registerModel(t,e){let i=this.modelId2Models.get(t);i||(i=new Set,this.modelId2Models.set(t,i)),i.add(e);let o=this.modelId2Views.get(t);if(o)for(let t of o)t.setModel(e)}registerView(t,e){if(e.controller&&e.controller!==this)return void console.log("error: attempt to register view more than once at different controllers");e.controller=this;let i=this.view2ModelIds.get(e);i||(i=new Set,this.view2ModelIds.set(e,i)),i.add(t);let o=this.modelId2Views.get(t);o||(o=new Set,this.modelId2Views.set(t,o)),o.add(e);let n=this.modelId2Models.get(t);if(n)for(let t of n)e.setModel(t)}unregisterView(t){if(!t.controller)return;if(t.controller!==this)throw Error("attempt to unregister view from wrong controller");let e=this.view2ModelIds.get(t);if(e)for(let i of e){let e=this.modelId2Views.get(i);e&&(e.delete(t),0===e.size&&this.modelId2Views.delete(i),t.setModel(void 0))}}clear(){for(let t of this.view2ModelIds)t[0].setModel(void 0);this.modelId2Models.clear(),this.modelId2Views.clear(),this.view2ModelIds.clear()}bind(t,e){this.registerModel(t,e)}action(t,e){return this.registerAction(t,e)}text(t,e){let i=new n.TextModel(e);return this.bind(t,i),i}html(t,e){let i=new n.HtmlModel(e);return this.bind(t,i),i}boolean(t,e){let i=new n.BooleanModel(e);return this.bind(t,i),i}number(t,e,i){let o=new n.NumberModel(e,i);return this.bind(t,o),o}}e.Controller=l;e.Template=class extends l{constructor(t){super(),this.root=o.instantiateTemplate(t),this.registerViews()}registerViews(){let t=this.root.querySelectorAll("[model]");for(let e of t){let t=e;if(t)try{this.registerView(t.getModelId(),t)}catch(t){}}t=this.root.querySelectorAll("[action]");for(let e of t){let t=e;if(t)try{this.registerView(t.getActionId(),t)}catch(t){}}}openHref(t){}};e.Dialog=class extends l{constructor(){super()}open(t){let e=document.createElement("div");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.right="0",e.style.bottom="0",e.style.backgroundColor="#aaa",e.style.opacity="0.5",this.shadow=e,document.body.appendChild(e);let i,o=document.head.querySelectorAll("link[rel=import]");for(let e of o)if(e.href===t){i=e;break}if(i)i.dispatchEvent(new Event("load"));else{let e=document.createElement("link");e.rel="import",e.href=t,e.onload=i=>{let o=e.import.querySelector("template");if(!o)throw Error("toad.openDialog: failed to find template in '"+t+"'");let n=document.importNode(o.content,!0);this.registerViews(n);let s=document.createElement("div");s.style.position="absolute",s.style.left="5%",s.style.top="5%",s.style.right="5%",s.style.bottom="5%",s.style.backgroundColor="#fff",s.style.border="solid 2px #000",s.appendChild(n),document.body.appendChild(s),this.frame=s},document.head.appendChild(e)}}close(){this.frame&&document.body.removeChild(this.frame),this.shadow&&document.body.removeChild(this.shadow)}registerViews(t){let e=t.querySelectorAll("[model]");for(let t of e){let e=t;if(e)try{this.registerView(e.getModelId(),e)}catch(t){}}e=t.querySelectorAll("[action]");for(let t of e){let e=t;if(e)try{this.registerView(e.getActionId(),e)}catch(t){}}}},e.globalController=new l,e.bind=function(t,i){e.globalController.bind(t,i)},e.action=function(t,i){return e.globalController.registerAction(t,i)},e.unbind=function(){e.globalController.clear()},e.text=function(t,i){return e.globalController.text(t,i)},e.boolean=function(t,i){return e.globalController.boolean(t,i)}},"./src/dom.ts":
/*!********************!*\
  !*** ./src/dom.ts ***!
  \********************/
/*! no static exports found */function(t,e,i){"use strict";function o(t){let e=document.querySelector('template[id="'+t+'"]');if(!e)throw new Error("failed to find template '"+t+"'");let i=e.content;return document.importNode(i,!0)}Object.defineProperty(e,"__esModule",{value:!0}),e.instantiateTemplate=function(t){return o(t)},e.tmpl=o,e.find=function(t,e){return t.querySelector(e)},e.tag=function(t){return document.createElement(t)},e.txt=function(t){return document.createTextNode(t)},e.img=function(t){let e=document.createElement("img");return e.src=t,e},e.add=function(t,e){t.appendChild(e)},e.remove=function(t){if(!t.parentNode)throw Error("element has no parent");t.parentNode.removeChild(t)},e.erase=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},e.grabMouse=function(t){let e=t.target,i=t=>{e.dispatchEvent(new MouseEvent("mousemove",t)),t.stopPropagation()},o=t=>{e.dispatchEvent(new MouseEvent("mouseup",t)),document.removeEventListener("mousemove",i,{capture:!0}),document.removeEventListener("mouseup",o,{capture:!0}),document.body.style.pointerEvents="auto",t.stopPropagation()};document.addEventListener("mousemove",i,{capture:!0}),document.addEventListener("mouseup",o,{capture:!0}),document.body.style.pointerEvents="none",t.preventDefault(),t.stopPropagation()},e.attribute=function(t,e){let i=t.getAttribute(e);if(null===i)throw console.log("missing attribute '"+e+"' in ",t),Error("missing attribute '"+e+"' in "+t.nodeName);return i},e.attributeOrUndefined=function(t,e){let i=t.getAttribute(e);return null===i?void 0:i},e.order=function(t,e){let i,o=new Map,n=t;for(i=t;n=i,i=i.parentNode;)o.set(i,n);let s=e;for(i=e;i;){if(s=i,!(i=i.parentNode))throw Error("fuck");let t=o.get(i);if(t){n=t;break}i=i.parentNode}if(!i)throw Error("fuck");for(let t of i.childNodes){if(t===n)return!0;if(t===s)return!1}throw Error("fuck")}},"./src/matrix.ts":
/*!***********************!*\
  !*** ./src/matrix.ts ***!
  \***********************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class o{constructor(t){void 0===t?(this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.tX=0,this.tY=0):(this.m11=t.m11,this.m12=t.m12,this.m21=t.m21,this.m22=t.m22,this.tX=t.tX,this.tY=t.tY)}identity(){this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.tX=0,this.tY=0}append(t){let e=this.m11*t.m11+this.m12*t.m21,i=this.m11*t.m12+this.m12*t.m22,o=this.m21*t.m11+this.m22*t.m21,n=this.m21*t.m12+this.m22*t.m22,s=this.tX*t.m11+this.tY*t.m21+t.tX,r=this.tX*t.m12+this.tY*t.m22+t.tY;this.m11=e,this.m12=i,this.m21=o,this.m22=n,this.tX=s,this.tY=r}prepend(t){let e=t.m11*this.m11+t.m12*this.m21,i=t.m11*this.m12+t.m12*this.m22,o=t.m21*this.m11+t.m22*this.m21,n=t.m21*this.m12+t.m22*this.m22,s=t.tX*this.m11+t.tY*this.m21+this.tX,r=t.tX*this.m12+t.tY*this.m22+this.tY;this.m11=e,this.m12=i,this.m21=o,this.m22=n,this.tX=s,this.tY=r}invert(){let t=1/(this.m11*this.m22-this.m21*this.m12),e=t*this.m22,i=t*-this.m12,o=t*-this.m21,n=t*this.m11,s=t*(this.m21*this.tY-this.m22*this.tX),r=t*(this.m12*this.tX-this.m11*this.tY);this.m11=e,this.m12=i,this.m21=o,this.m22=n,this.tX=s,this.tY=r}translate(t){let e=new o({m11:1,m12:0,m21:0,m22:1,tX:t.x,tY:t.y});this.append(e)}rotate(t){let e=new o({m11:Math.cos(t),m12:Math.sin(t),m21:-Math.sin(t),m22:Math.cos(t),tX:0,tY:0});this.append(e)}scale(t,e){let i=new o({m11:t,m12:0,m21:0,m22:e,tX:0,tY:0});this.append(i)}transformPoint(t){return{x:t.x*this.m11+t.y*this.m21+this.tX,y:t.x*this.m12+t.y*this.m22+this.tY}}transformArrayPoint(t){return[t[0]*this.m11+t[1]*this.m21+this.tX,t[0]*this.m12+t[1]*this.m22+this.tY]}}e.Matrix=o},"./src/model.ts":
/*!**********************!*\
  !*** ./src/model.ts ***!
  \**********************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ./signal */"./src/signal.ts");class n{constructor(){this.modified=new o.Signal}}e.Model=n;class s extends n{constructor(t){super(),this._value=t}set value(t){this._value!=t&&(this._value=t,this.modified.trigger())}get value(){return this._value}}e.GenericModel=s;class r extends n{constructor(t){super(),this._value=t}set promise(t){this._value=t,this.modified.trigger()}get promise(){return"string"==typeof this._value?()=>this._value:this._value}set value(t){this._value!=t&&(this._value=t,this.modified.trigger())}get value(){return"number"==typeof this._value?this._value=String(this._value):"string"!=typeof this._value&&(this._value=this._value()),this._value}}e.TextModel=r;e.HtmlModel=class extends r{constructor(t){super(t)}};e.NumberModel=class extends s{constructor(t,e){super(t),e&&(this.min=e.min,this.max=e.max,this.step=e.step)}};e.BooleanModel=class extends s{constructor(t){super(t)}};class l extends n{constructor(){super(),this._stringValue=""}set stringValue(t){this._stringValue!==t&&(this._stringValue=t,this.modified.trigger())}get stringValue(){return this._stringValue}isValidStringValue(t){return!1}}e.OptionModelBase=l;e.OptionModel=class extends l{constructor(){super(),this._map=new Map}add(t,e){this._map.set(t,e)}isValidStringValue(t){return this._map.has(t)}get value(){return this._map.get(this.stringValue)}}},"./src/signal.ts":
/*!***********************!*\
  !*** ./src/signal.ts ***!
  \***********************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class o{constructor(t,e){this.callback=t,this.id=e}}e.SignalLink=o;e.Signal=class{add(t,e){this.callbacks||(this.callbacks=new Array),this.callbacks.push(new o(t,e))}remove(t){if(this.callbacks)for(let e=this.callbacks.length-1;e>=0;--e)this.callbacks[e].id===t&&this.callbacks.splice(e,1)}count(){return this.callbacks?this.callbacks.length:0}lock(){this.locked=!0}unlock(){if(this.locked=void 0,this.triggered){let t=this.triggered.data;this.triggered=void 0,this.trigger(t)}}trigger(t){if(this.locked)this.triggered={data:t};else if(this.callbacks)for(let e=0;e<this.callbacks.length;++e)this.callbacks[e].callback(t)}}},"./src/toad.ts":
/*!*********************!*\
  !*** ./src/toad.ts ***!
  \*********************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ./view */"./src/view.ts");var n=i(/*! ./matrix */"./src/matrix.ts");e.Matrix=n.Matrix;var s=i(/*! ./signal */"./src/signal.ts");e.Signal=s.Signal;var r=i(/*! ./action */"./src/action.ts");e.Action=r.Action;var l=i(/*! ./model */"./src/model.ts");e.Model=l.Model,e.GenericModel=l.GenericModel,e.TextModel=l.TextModel,e.HtmlModel=l.HtmlModel,e.NumberModel=l.NumberModel,e.BooleanModel=l.BooleanModel,e.OptionModel=l.OptionModel,e.OptionModelBase=l.OptionModelBase;var d=i(/*! ./view */"./src/view.ts");e.View=d.View,e.GenericView=d.GenericView,e.ActionView=d.ActionView,e.SlotView=d.SlotView;var a=i(/*! ./view/button */"./src/view/button.ts");e.ButtonView=a.ButtonView;var h=i(/*! ./view/toolbutton */"./src/view/toolbutton.ts");e.ToolButton=h.ToolButton;var c=i(/*! ./view/checkbox */"./src/view/checkbox.ts");e.CheckboxView=c.CheckboxView;var u=i(/*! ./view/menu */"./src/view/menu.ts");e.MenuButton=u.MenuButton;var m=i(/*! ./view/slider */"./src/view/slider.ts");e.SliderView=m.SliderView;var p=i(/*! ./view/table */"./src/view/table.ts");e.TableView=p.TableView,e.TableModel=p.TableModel,e.TableEditMode=p.TableEditMode,e.SelectionModel=p.SelectionModel,e.registerTableModelLocator=p.registerTableModelLocator,e.createTableModel=p.createTableModel;var f=i(/*! ./view/text */"./src/view/text.ts");e.TextView=f.TextView;var b=i(/*! ./view/textarea */"./src/view/textarea.ts");e.TextArea=b.TextArea,e.TextTool=b.TextTool;var w=i(/*! ./controller */"./src/controller.ts");e.Controller=w.Controller,e.Template=w.Template,e.Dialog=w.Dialog,e.bind=w.bind,e.action=w.action,e.unbind=w.unbind,e.globalController=w.globalController,e.boolean=w.boolean;customElements.define("toad-if",class extends o.GenericView{updateModel(){}updateView(){this.model&&(this.style.display=this.model.value?"":"none")}})},"./src/view.ts":
/*!*********************!*\
  !*** ./src/view.ts ***!
  \*********************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ./model */"./src/model.ts"),n=i(/*! ./controller */"./src/controller.ts"),s=i(/*! ./action */"./src/action.ts");class r extends HTMLElement{getModelId(){if(!this.hasAttribute("model"))throw Error("no 'model' attribute");let t=this.getAttribute("model");if(!t)throw Error("no model id");return"M:"+t}getActionId(){if(!this.hasAttribute("action"))throw Error("no 'action' attribute");let t=this.getAttribute("action");if(!t)throw Error("no action id");return"A:"+t}}e.View=r;class l extends r{constructor(){super()}connectedCallback(){if(this.controller)return;let t="";try{t=this.getModelId()}catch(t){}""!=t&&n.globalController.registerView(t,this)}disconnectedCallback(){this.controller&&this.controller.unregisterView(this)}setModel(t){if(t===this.model)return;let e=this;this.model&&this.model.modified.remove(e),t&&t.modified.add(()=>{e.updateView()},e),this.model=t,this.updateView()}}e.GenericView=l;e.ActionView=class extends l{constructor(){super()}connectedCallback(){if(this.controller)this.updateView();else{try{n.globalController.registerView(this.getActionId(),this)}catch(t){}try{n.globalController.registerView(this.getModelId(),this)}catch(t){}this.updateView()}}disconnectedCallback(){super.disconnectedCallback(),this.controller&&this.controller.unregisterView(this)}setModel(t){if(!t)return this.model&&this.model.modified.remove(this),this.action&&this.action.modified.remove(this),this.model=void 0,this.action=void 0,void this.updateView();if(t instanceof s.Action)this.action=t,this.action.modified.add(()=>{this.updateView()},this);else{if(!(t instanceof o.TextModel))throw Error("unexpected model of type "+t.constructor.name);this.model=t,this.model.modified.add(()=>{this.updateView()},this)}this.updateView()}isEnabled(){return void 0!==this.action&&this.action.enabled}};class d extends l{constructor(){super()}updateModel(){}updateView(){if(!this.model)return;let t=void 0===this.model.value?"":this.model.value;this.model instanceof o.HtmlModel?this.innerHTML=t:this.innerText=t}}e.SlotView=d,window.customElements.define("toad-slot",d)},"./src/view/button.ts":
/*!****************************!*\
  !*** ./src/view/button.ts ***!
  \****************************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ../model */"./src/model.ts"),n=i(/*! ../view */"./src/view.ts");let s=document.createElement("style");s.textContent="\n  button {\n    border: none;\n    background-color: var(--toad-primary-color, #0052cc);\n    color: #ffffff;\n    border-radius: 3px;\n    font-size: 14px;\n    font-weight: bold;\n    height: 32px;\n    line-height: 32px;\n    min-width: 24px;\n    text-shadow: none;\n    padding: 0 10px;\n    margin-right: 4px;\n  }\n  \n  button:hover {\n    background-color: #0065ff;\n  }\n  \n  button:hover:active {\n    background-color: #0049b0;\n  }\n  \n  button:disabled, button:disabled:active {\n    background-color: #888;\n  }\n";class r extends n.ActionView{constructor(){super();this.button=document.createElement("button"),this.button.onclick=()=>{this.action&&this.action.trigger()},this.button.disabled=!0,this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(s,!0)),this.shadowRoot.appendChild(this.button)}connectedCallback(){super.connectedCallback(),0===this.children.length&&(this._observer=new MutationObserver((t,e)=>{void 0!==this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout(()=>{this._timer=void 0,this.updateView()},100)}),this._observer.observe(this,{childList:!0,subtree:!0,characterData:!0}))}updateModel(){}updateView(){this.model&&this.model.value?this.model instanceof o.HtmlModel?this.button.innerHTML=this.model.value:this.button.innerText=this.model.value:this.button.innerHTML=this.innerHTML,this.button.disabled=!this.isEnabled()}}e.ButtonView=r,window.customElements.define("toad-button",r)},"./src/view/checkbox.ts":
/*!******************************!*\
  !*** ./src/view/checkbox.ts ***!
  \******************************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ../view */"./src/view.ts");let n=document.createElement("style");n.textContent="\nsvg {\n  width: 12px;\n  height: 12px;\n  vertical-align: middle;\n  margin: 3px;              /* space for the outline */\n  background: none;\n}\nsvg:focus {\n  outline-offset: -2px;     /* bring outline in touch with the svg */\n  background: #9eccfb;      /* the rectangle is rounded, fill the corners */\n  outline-color: 9eccfb;    /* outline shall be the same color used to fill the corners */\n}\n@media(pointer: coarse) { /* works on Chrome but iOS is never coarse :( */\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n}\nsvg rect {\n  stroke: var(--border-color, var(--toad-neutral-color, #aaa));\n  fill: var(--background-color, #fff);\n  stroke-width: 1px;\n}\nsvg path {\n  stroke: var(--marker-color, none);\n  fill: none;\n  stroke-width: 2px;\n}\n:host([checked]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #0052cc));\n  fill: var(--checked-background-color, var(--toad-primary-color, #0052cc));\n}\n:host([checked]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #fff));\n}\n:host([disabled]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #bdbdbd));\n  fill: var(--checked-background-color, var(--toad-primary-color, #fff));\n}\n:host([disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, none));\n}\n:host([checked][disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #bdbdbd));\n}";class s extends o.GenericView{constructor(){super();let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttributeNS("","viewBox","0 0 18 18");let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttributeNS("","x","1"),e.setAttributeNS("","y","1"),e.setAttributeNS("","width","16"),e.setAttributeNS("","height","16"),e.setAttributeNS("","rx","3"),e.setAttributeNS("","ry","3");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS("","d","M4 9.5 L 7.5 13 L 14.5 4"),t.onclick=()=>{this.toggle()},t.setAttributeNS("","tabindex","0"),t.addEventListener("keydown",t=>{" "===t.key&&this.toggle()}),t.onmousedown=e=>{t.focus(),e.preventDefault()},t.appendChild(e),t.appendChild(i),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(n,!0)),this.shadowRoot.appendChild(t)}static get observedAttributes(){return["checked"]}attributeChangedCallback(t,e,i){switch(t){case"checked":this.updateModel()}}toggle(){this.hasAttribute("disabled")||(this.hasAttribute("checked")?this.removeAttribute("checked"):this.setAttribute("checked",""),this.updateModel())}updateModel(){this.model&&(this.model.value=this.hasAttribute("checked"))}updateView(){if(!this.model)return this.setAttribute("disabled",""),void this.removeAttribute("checked");this.removeAttribute("disabled"),this.model.value?this.setAttribute("checked",""):this.removeAttribute("checked")}}e.CheckboxView=s,window.customElements.define("toad-checkbox",s)},"./src/view/menu.ts":
/*!**************************!*\
  !*** ./src/view/menu.ts ***!
  \**************************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ../dom */"./src/dom.ts"),n=i(/*! ../action */"./src/action.ts"),s=i(/*! ../model */"./src/model.ts"),r=i(/*! ../view */"./src/view.ts"),l=i(/*! ../controller */"./src/controller.ts");let d=document.createElement("style");var a;d.textContent="\n  :host(.menu-button) {\n    font-family: var(--toad-font-family, sans-serif);\n    font-size: 14px;\n    font-weight: bold;\n    padding: 7px;\n    vertical-align: center;\n  \n    background: #fff;\n    color: #000;\n    cursor: default;\n  }\n  :host(.menu-button.active) {\n    background: #000;\n    color: #fff;\n  }\n  :host(.menu-button.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.active.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.menu-down) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-down) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.menu-side) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-side) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  .menu-bar {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .menu-popup {\n    position: fixed;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 2px 2px 5px #888;\n  }\n",function(t){t[t.WAIT=0]="WAIT",t[t.DOWN=1]="DOWN",t[t.UP_N_HOLD=2]="UP_N_HOLD",t[t.DOWN_N_HOLD=3]="DOWN_N_HOLD",t[t.DOWN_N_OUTSIDE=4]="DOWN_N_OUTSIDE",t[t.DOWN_N_INSIDE_AGAIN=5]="DOWN_N_INSIDE_AGAIN"}(a=e.MenuState||(e.MenuState={})),function(t){t[t.BUTTON=0]="BUTTON",t[t.RADIOBUTTON=1]="RADIOBUTTON",t[t.CHECKBUTTON=2]="CHECKBUTTON",t[t.SEPARATOR=3]="SEPARATOR"}(e.Type||(e.Type={}));class h{constructor(t,e,i,o,n){this.title=t,this.label=e,this.shortcut=i,this.type=o||"entry",this.modelId=n}isEnabled(){return!0}isAvailable(){return!0}createWindowAt(t,e){if("spacer"==this.type){let t=document.createElement("span");return t.style.flexGrow="1",void e.appendChild(t)}this.view=new p(t,this),e.appendChild(this.view)}deleteWindow(){}}e.Node=h;class c extends HTMLElement{constructor(){super(),this.vertical=!0,this.closeOnClose=!1,this.state=a.WAIT}}e.MenuHelper=c;class u extends c{constructor(){super(),this.vertical=!1,this.root=new h("","",void 0,void 0)}connectedCallback(){this.tabIndex=0,0===this.children.length?(this._observer=new MutationObserver((t,e)=>{void 0!==this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout(()=>{this._timer=void 0,this.layout2nodes(this.children,this.root),this.referenceActions(),this.createShadowDOM()},100)}),this._observer.observe(this,{childList:!0,subtree:!0})):(this.layout2nodes(this.children,this.root),this.referenceActions(),this.createShadowDOM())}disconnectedCallback(){}layout2nodes(t,e){let i=e.down;for(let n of t){let t=void 0;switch(n.nodeName){case"TOAD-MENUSPACER":t=new h("","","","spacer");break;case"TOAD-MENUENTRY":t=new h(o.attribute(n,"name"),o.attribute(n,"label"),o.attributeOrUndefined(n,"shortcut"),o.attributeOrUndefined(n,"type"),o.attributeOrUndefined(n,"model"))}if(t&&(t.parent=e,i?i.next=t:e.down=t,i=t),!i)throw Error("fuck");this.layout2nodes(n.children,i)}}referenceActions(){}findNode(t,e){let i=t.indexOf("|"),o=-1==i?t:t.substr(0,i),n=-1==i?"":t.substr(i+1);e||(e=this.root);for(let t=e.down;t;t=t.next)if(t.title==o)return t.down?this.findNode(n,t):t}createShadowDOM(){this.view=document.createElement("div"),this.view.classList.add("menu-bar");let t=this.root.down;for(;t;)t.isAvailable()?t.createWindowAt(this,this.view):t.deleteWindow(),t=t.next;this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(d,!0)),this.shadowRoot.appendChild(this.view)}}e.Menu=u,window.customElements.define("toad-menu",u);window.customElements.define("toad-menuentry",class extends HTMLElement{});window.customElements.define("toad-menuspacer",class extends HTMLElement{});class m extends c{constructor(t,e){super(),this.vertical=!0,this.root=t,this.parentButton=e,this.popup=document.createElement("div"),this.popup.classList.add("menu-popup");let i=t.down;for(;i;)i.isAvailable()?i.createWindowAt(this,this.popup):i.deleteWindow(),i=i.next;this.appendChild(this.popup),this.show()}show(){this.parentButton.master.vertical?function(t,e){let i=t.getBoundingClientRect();e.style.opacity="0",e.style.left=i.left+i.width+"px",e.style.top=i.top+"px",setTimeout(function(){let t=e.getBoundingClientRect();i.top+t.height>window.innerHeight&&(e.style.top=i.top+i.height-t.height+"px"),i.left+i.width+t.width>window.innerWidth&&(e.style.left=i.left-t.width+"px"),e.style.opacity="1"},0)}(this.parentButton,this.popup):function(t,e){let i=t.getBoundingClientRect();e.style.opacity="0",e.style.left=i.left+"px",e.style.top=i.top+i.height+"px",setTimeout(function(){let t=e.getBoundingClientRect();i.top+i.height+t.height>window.innerHeight&&(e.style.top=i.top-t.height+"px"),i.left+t.width>window.innerWidth&&(e.style.left=i.left+i.width-t.width+"px"),e.style.opacity="1"},0)}(this.parentButton,this.popup),this.style.display=""}hide(){this.style.display="none"}}e.PopupMenu=m,window.customElements.define("toad-popupmenu",m);class p extends r.GenericView{constructor(t,e){super(),this.master=t,this.node=e;let i=this;if(this.classList.add("menu-button"),e.down&&(t.vertical?this.classList.add("menu-side"):this.classList.add("menu-down")),this.updateView(),this.onmousedown=t=>{t.stopPropagation();let e=function(t){document.removeEventListener("mouseup",e,{capture:!0}),t.preventDefault(),setTimeout(()=>{p.buttonDown&&i.dispatchEvent(new MouseEvent("mouseup",t))},0)};if(document.addEventListener("mouseup",e,{capture:!0}),p.buttonDown=!0,!this.master)throw Error("fuck");switch(this.master.state){case a.WAIT:this.master.state=a.DOWN,this.activate();break;case a.UP_N_HOLD:this.master.active!==this?(this.master.state=a.DOWN,this.activate()):this.master.state=a.DOWN_N_HOLD;break;default:throw Error("unexpected state "+this.master.state)}return!1},this.onmouseup=t=>{if(t.stopPropagation(),p.buttonDown){if(p.buttonDown=!1,!this.master)throw Error("fuck");if(!this.node)throw Error("fuck");switch(this.master.state){case a.DOWN:this.node.isEnabled()&&!this.node.down?(this.trigger(),this.master.state=a.WAIT):(this.master.state=a.UP_N_HOLD,p.documentMouseDown&&document.removeEventListener("mousedown",p.documentMouseDown,{capture:!1}),p.documentMouseDown=function(t){p.documentMouseDown&&document.removeEventListener("mousedown",p.documentMouseDown,{capture:!1}),p.documentMouseDown=void 0,"TOAD-MENUBUTTON"!==t.target.tagName&&i.collapse()},document.addEventListener("mousedown",p.documentMouseDown,{capture:!1}));break;case a.DOWN_N_HOLD:case a.DOWN_N_OUTSIDE:this.master.state=a.WAIT,this.deactivate(),this.collapse(),this.master.closeOnClose;break;case a.DOWN_N_INSIDE_AGAIN:this.trigger();break;default:throw Error("unexpected state "+this.master.state)}return!1}},this.onmouseout=t=>{if(t.stopPropagation(),!this.master)throw Error("fuck");switch(p.inside=void 0,this.master.state){case a.WAIT:case a.DOWN_N_OUTSIDE:case a.UP_N_HOLD:case a.DOWN_N_HOLD:break;case a.DOWN:case a.DOWN_N_INSIDE_AGAIN:this.master.state=a.DOWN_N_OUTSIDE,this.updateView();break;default:throw Error("unexpected state")}return!1},this.onmouseover=t=>{if(t.stopPropagation(),!i.master)throw Error("fuck");switch(p.inside=i,i.master.state){case a.WAIT:case a.UP_N_HOLD:case a.DOWN_N_OUTSIDE:case a.DOWN_N_HOLD:case a.DOWN:case a.DOWN_N_INSIDE_AGAIN:if(!p.buttonDown)break;if(!this.master)throw Error("fuck");this.master.active&&this.master.active.deactivate(),this.master.state=a.DOWN_N_INSIDE_AGAIN,this.activate();break;default:throw Error("unexpected state "+i.master.state)}return!1},this.attachShadow({mode:"open"}),!this.shadowRoot)throw Error("fuck");this.shadowRoot.appendChild(document.importNode(d,!0)),this.node.modelId||this.shadowRoot.appendChild(document.createTextNode(e.label))}connectedCallback(){if(!this.controller){if(void 0===this.node.down){let t=this.node.title;for(let e=this.node.parent;e&&e.title.length;e=e.parent)t=e.title+"|"+t;t="A:"+t,l.globalController.registerView(t,this)}if(void 0!==this.node.modelId){let t="M:"+this.node.modelId;l.globalController.registerView(t,this)}}}disconnectedCallback(){this.controller&&this.controller.unregisterView(this)}setModel(t){if(!t)return this.action&&this.action.modified.remove(this),this.model=void 0,this.action=void 0,void this.updateView();if(t instanceof n.Action)this.action=t,this.action.modified.add(()=>{this.updateView()},this);else{if(!(t instanceof s.TextModel))throw Error("unexpected model of type "+t.constructor.name);this.model=t}this.updateView()}updateModel(){}updateView(){if(this.model&&this.model.value){if(!this.shadowRoot)throw Error("fuck");let t=document.createElement("span");this.model instanceof s.HtmlModel?t.innerHTML=this.model.value:t.innerText=this.model.value,this.shadowRoot.children.length>1&&this.shadowRoot.removeChild(this.shadowRoot.children[1]),this.shadowRoot.children.length>1?this.shadowRoot.insertBefore(t,this.shadowRoot.children[1]):this.shadowRoot.appendChild(t)}if(!this.master)throw Error("fuck");let t=!1;if(this.master.active==this)switch(this.master.state){case a.DOWN:case a.UP_N_HOLD:case a.DOWN_N_HOLD:case a.DOWN_N_INSIDE_AGAIN:t=!0;break;case a.DOWN_N_OUTSIDE:if(!this.node)throw Error("fuck");t=void 0!==this.node.down&&this.node.isEnabled()}this.classList.toggle("active",t),this.classList.toggle("disabled",!this.isEnabled())}isEnabled(){return void 0!==this.node.down||void 0!==this.action&&this.action.enabled}trigger(){this.collapse(),this.action&&this.action.trigger()}collapse(){if(!this.master)throw Error("fuck");this.master.parentButton?this.master.parentButton.collapse():this.deactivate()}openPopup(){if(this.node&&this.node.down){if(!this.shadowRoot)throw Error("fuck");this.popup?this.popup.show():(this.popup=new m(this.node,this),this.shadowRoot.appendChild(this.popup))}}closePopup(){this.popup&&(this.popup.active&&this.popup.active.deactivate(),this.popup.hide())}activate(){if(!this.master)throw Error("fuck");if(!this.node)throw Error("fuck");let t=this.master.active;this.master.active=this,t&&t!==this&&(t.closePopup(),t.updateView()),this.updateView(),this.openPopup()}deactivate(){if(!this.master)throw Error("fuck");this.master.active===this&&(this.master.active.closePopup(),this.master.active=void 0,this.master.state=a.WAIT,this.updateView())}}e.MenuButton=p,window.customElements.define("toad-menubutton",p)},"./src/view/slider.ts":
/*!****************************!*\
  !*** ./src/view/slider.ts ***!
  \****************************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ../view */"./src/view.ts");class n extends o.GenericView{constructor(){super(),this.input=document.createElement("input"),this.input.type="range";let t=this;this.input.oninput=()=>{t.updateModel()},this.attachShadow({mode:"open"}).appendChild(this.input)}updateModel(){this.model&&(this.model.value=Number.parseFloat(this.input.value))}updateView(){this.model&&(this.input.step=String(this.model.step),this.input.min=String(this.model.min),this.input.max=String(this.model.max),this.input.value=String(this.model.value))}}e.SliderView=n,window.customElements.define("toad-slider",n)},"./src/view/table.ts":
/*!***************************!*\
  !*** ./src/view/table.ts ***!
  \***************************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ../dom */"./src/dom.ts"),n=i(/*! ../model */"./src/model.ts"),s=i(/*! ../view */"./src/view.ts"),r=i(/*! ./text */"./src/view/text.ts");let l=document.createElement("style");function d(t,e){return function(t){if("px"!==t.substr(t.length-2))throw Error("expected 'px' suffix");return Number.parseFloat(t.substr(0,t.length-2))}(window.getComputedStyle(t,void 0).getPropertyValue(e))}function a(t){return d(t,"padding-left")+d(t,"padding-right")}var h;l.textContent="\n.t2 {\n  /* border: 1px inset; */\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  outline-offset: -2px;\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n}\n\n.t2h, .t2d {\n  border-color: #ccc #fff #fff #ccc;\n  border-width: 2px 0px 0px 2px;\n  border-style: solid none none solid;\n  border-collapse: collapse;\n  border-spacing: 0;\n}\n\n/* FIXME: there is no re-evaluation after the table view was resized */\n/*\nth:last-child, td:last-child {\n  width: 100%;\n}\n*/\n\n.t2h tr {\n  background: #e0e0e0;\n}\n\n.t2h * th {\n  border-color: #fff #ccc #ccc #fff;\n  border-style: none solid none none;\n  border-width: 0 1px 0 0;\n  z-index: 1;\n  letter-spacing: 0;  \n  overflow: hidden;   \n  padding: 2px;\n  margin: 0px; \n  white-space: nowrap;\n}\n \n.t2d * td {\n  border-color: #fff #ccc #ccc #fff;\n  border-style: none solid solid none;\n  border-width: 0 1px 1px 0;\n  letter-spacing: 0;\n  overflow: hidden; \n  padding: 2px;\n  margin: 0px; \n  white-space: nowrap;\n  /* background: #fff; */\n}\n\n.t2d tr:nth-child(even) {\n  background: var(--toad-table-even-row, #f5f5f5);\n}\n.t2d tr:nth-child(odd) {\n  background: var(--toad-table-odd-row, #ffffff);\n}\n\ndiv .t2d tr.selected,\ndiv .t2d tr td.selected {\n/*\n  background: #dcdcdc;\n  color: #000;\n*/\n  background: #808080;\n  color: #fff;\n}\n\n.t2:focus .t2d tr.selected,\n.t2:focus .t2d tr td.selected {\n  background: #0069d4;\n  color: #fff;\n}\n\n",function(t){t[t.EDIT_CELL=0]="EDIT_CELL",t[t.SELECT_CELL=1]="SELECT_CELL",t[t.SELECT_ROW=2]="SELECT_ROW"}(h=e.TableEditMode||(e.TableEditMode={}));class c{constructor(t,e){this.col=t,this.row=e}}e.TablePos=c;class u extends n.Model{constructor(){super(),this.mode=h.SELECT_ROW,this._value=new c(0,0)}set col(t){this._value.col!==t&&(this._value.col=t,this.modified.trigger())}get col(){return this._value.col}set row(t){this._value.row!==t&&(this._value.row=t,this.modified.trigger())}get row(){return this._value.row}set value(t){this._value.col===t.col&&this._value.row===t.row||(this._value=t,this.modified.trigger())}get value(){return this._value}}e.SelectionModel=u;class m extends n.Model{constructor(){super(),this.cols=0,this.rows=0}getColumnHead(t){}getFieldView(t,e){}}e.TableModel=m;let p=new Array;function f(t){p.push(t)}e.registerTableModelLocator=f,e.createTableModel=function(t){for(let e of p){let i=e(t);if(i)return i}throw new Error("findTableModel() failed to locate a table model")};class b extends m{constructor(t){super(),this.data=t,this.rows=this.data.length,this.cols=this.data[0].length}getColumnHead(t){switch(t){case 0:return new n.TextModel("Title");case 1:return new n.TextModel("Author");case 2:return new n.TextModel("Year")}throw Error("fuck")}getFieldModel(t,e){let i=new n.TextModel(this.data[e][t]);return i.modified.add(()=>{this.data[e][t]=i.value}),i}getFieldView(t,e){return new r.TextView}}f(function(t){if(t instanceof Array&&0!==t.length&&t[0]instanceof Array){for(let e of t[0])if("string"!=typeof e&&"number"!=typeof e)return;return new b(t)}});class w extends s.GenericView{constructor(){super(),this.insideGoTo=!1;let t=o.tag("div");t.className="t2",t.onkeydown=t=>{if(this.selectionModel)switch(this.selectionModel.mode){case h.SELECT_ROW:{let e=this.selectionModel.value.row;switch(t.key){case"ArrowDown":e+1<this.model.rows&&++e;break;case"ArrowUp":e>0&&--e}e!=this.selectionModel.value.row&&(this.toggleRowSelection(this.selectionModel.value.row,!1),this.selectionModel.row=e,this.toggleRowSelection(this.selectionModel.value.row,!0))}break;case h.SELECT_CELL:{let e={col:this.selectionModel.col,row:this.selectionModel.row};switch(t.key){case"ArrowRight":e.col+1<this.model.cols&&++e.col;break;case"ArrowLeft":e.col>0&&--e.col;break;case"ArrowDown":e.row+1<this.model.rows&&++e.row;break;case"ArrowUp":e.row>0&&--e.row}e.col==this.selectionModel.col&&e.row==this.selectionModel.row||(this.toggleCellSelection(this.selectionModel.value,!1),this.selectionModel.value=e,this.toggleCellSelection(this.selectionModel.value,!0))}}},this.rootElement=t;let e=o.tag("div");e.style.overflow="hidden";let i=o.tag("table");this.headTable=i,i.className="t2h";let n=o.tag("thead"),s=o.tag("tr");this.headRow=s,n.appendChild(s),i.appendChild(n),e.appendChild(i),t.appendChild(e);let r=o.tag("div");r.style.overflow="auto",r.onscroll=function(){e.scrollLeft=r.scrollLeft},this.bodyDiv=r;let d=o.tag("table");d.className="t2d",d.onmousedown=t=>{t.srcElement&&"TD"===t.srcElement.tagName&&(t.preventDefault(),this.goToField(t.srcElement))};let a=o.tag("tbody");this.bodyBody=a;let c=o.tag("tr");a.appendChild(c),this.bodyRow=c,d.appendChild(a),r.appendChild(d);let u=o.tag("div");u.style.width="0px",u.style.height="0px",u.style.margin="0",u.style.padding="0",u.style.border="none",this.input=o.tag("div"),this.input.style.position="relative",this.input.style.background="#fff",this.input.style.border="none",this.input.style.opacity="0",this.input.addEventListener("focusin",t=>{if(this.input.style.opacity="1",this.insideGoTo)return;if(!this.model)return;let e=t;e.target&&e.relatedTarget&&(o.order(e.relatedTarget,this)?this.goTo(0,0):this.goTo(this.model.cols-1,this.model.rows-1))}),this.input.addEventListener("focusout",()=>{this.input.style.opacity="0"}),u.appendChild(this.input),r.appendChild(u),t.appendChild(r),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(l,!0)),this.shadowRoot.appendChild(t)}connectedCallback(){super.connectedCallback(),this.bodyDiv.style.height=this.style.height}setModel(t){if(!t)return this.selectionModel&&this.selectionModel.modified.remove(this),this.model=void 0,this.selectionModel=new u,void this.updateView();if(t instanceof u)this.selectionModel=t,this.updateSelection(),this.selectionModel.modified.add(()=>{this.updateSelection()},this);else{if(!(t instanceof m))throw Error("unexpected model of type "+t.constructor.name);this.model=t,this.updateView()}}updateModel(){}updateView(){this.model&&(this.updateHeader(),this.updateBody(),this.updateSelection(),setTimeout(()=>{this.adjustInternalTables()}))}updateHeader(){if(!this.model)throw Error("fuck");let t,e=!1;for(;this.headRow.children.length>this.model.cols+1;)this.headRow.removeChild(this.headRow.children[this.headRow.children.length-1]);for(let t=0;t<this.model.cols;++t){let i;t>=this.headRow.children.length?(i=o.tag("th"),this.headRow.appendChild(i)):((i=this.headRow.children[t]).style.minWidth="",i.style.border="");let s=this.model.getColumnHead(t);void 0!==s?s instanceof n.HtmlModel?i.innerHTML=s.value:i.innerText=s.value:e=!0}this.headRow.children.length<this.model.cols+1?(t=o.tag("th"),this.headRow.appendChild(t)):t=this.headRow.children[this.headRow.children.length-1],t.innerText="",t.style.minWidth="777px",t.style.border="0px none",this.headTable.style.display=e?"none":""}updateBody(){if(!this.model)throw Error("fuck");for(;this.bodyRow.children.length>this.model.cols;)this.bodyRow.removeChild(this.bodyRow.children[this.bodyRow.children.length-1]);for(;this.bodyRow.children.length<this.model.cols;){let t=o.tag("td");t.style.paddingTop="0",t.style.paddingBottom="0",this.bodyRow.appendChild(t)}for(;this.bodyBody.children.length-1>this.model.rows;)this.bodyBody.removeChild(this.bodyBody.children[this.bodyBody.children.length-1]);for(let t=0;t<this.model.rows;++t){let e;for(t+1>=this.bodyBody.children.length?(e=o.tag("tr"),this.bodyBody.appendChild(e)):e=this.bodyBody.children[t+1];e.children.length>this.model.cols;)e.removeChild(e.children[e.children.length-1]);for(let i=0;i<this.model.cols;++i){let s;i>=e.children.length?(s=o.tag("td"),e.appendChild(s)):s=e.children[i],s.style.width="";let r=this.model.getFieldModel(i,t);s.innerText!=r.value&&(r instanceof n.HtmlModel?s.innerHTML=r.value:s.innerText=r.value)}if("100%"===this.style.width){e.children[e.children.length-1].style.width="100%"}}}updateSelection(){if(void 0!==this.selectionModel)switch(this.selectionModel.mode){case h.EDIT_CELL:this.prepareFieldAtPosition(this.selectionModel.col,this.selectionModel.row),delete this.rootElement.tabIndex;break;case h.SELECT_CELL:{let t=this.bodyBody.querySelectorAll("tbody > tr > td.selected");for(let e of t)e.classList.remove("selected");this.toggleCellSelection(this.selectionModel.value,!0),this.rootElement.tabIndex=0;break}case h.SELECT_ROW:{let t=this.bodyBody.querySelectorAll("tbody > tr.selected");for(let e of t)e.classList.remove("selected");this.toggleRowSelection(this.selectionModel.value.row,!0),this.rootElement.tabIndex=0;break}}}adjustInternalTables(){let t=this.headRow.children,e=this.bodyRow.children;for(let i=0;i<this.model.cols;++i){let o=t[i],n=e[i],s=o.clientWidth-a(o),r=n.clientWidth-a(n);o.style.width=o.style.minWidth=o.style.maxWidth=n.style.width=n.style.minWidth=n.style.maxWidth=(s>r?s:r)+"px"}"100%"!==this.style.width&&(this.rootElement.style.width=this.bodyRow.clientWidth+this.bodyDiv.offsetWidth-this.bodyDiv.clientWidth+2+"px")}unadjustInternalTables(t){let e=this.headRow.children,i=this.bodyRow.children,o=e[t.col],n=i[t.col];o.style.width=o.style.minWidth=o.style.maxWidth=n.style.width=n.style.minWidth=n.style.maxWidth=""}toggleCellSelection(t,e){if(t.col>=this.model.cols||t.row>=this.model.rows)return;let i=this.bodyBody.children[t.row+1].children[t.col];i.classList.toggle("selected",e),e&&(i.scrollIntoViewIfNeeded?i.scrollIntoViewIfNeeded():i.scrollIntoView())}toggleRowSelection(t,e){if(t>=this.model.rows)return;let i=this.bodyBody.children[1+this.selectionModel.value.row];i.classList.toggle("selected",e),e&&(i.scrollIntoViewIfNeeded?i.scrollIntoViewIfNeeded():i.scrollIntoView())}adjustInputToElement(t){let e=t.getBoundingClientRect(),i=t,o=i.parentElement.parentElement;navigator.userAgent.indexOf("Chrome")>-1?(this.input.style.left=i.offsetLeft+2+"px",this.input.style.top=i.offsetTop-o.clientHeight+"px"):(this.input.style.left=i.offsetLeft+1+"px",this.input.style.top=i.offsetTop-o.clientHeight-1+"px");let n=t.clientWidth-a(t)+"px";this.input.style.width=n,this.input.style.height=e.height+"px"}goTo(t,e){this.insideGoTo=!0,this.prepareFieldAtPosition(t,e),this.focus(),this.insideGoTo=!1}goToField(t){this.insideGoTo=!0,t&&(this.prepareFieldAtElement(t),this.focus(),this.insideGoTo=!1)}focus(){this.fieldView?this.fieldView.focus():this.rootElement.focus()}prepareFieldAtPosition(t,e){this.prepareFieldAtElement(this.getElementAt(t,e))}getElementAt(t,e){let i=this.bodyBody.children[e+1].children[t];if(!i)throw Error("fuck");return i}prepareFieldAtElement(t){if(void 0===t||"TD"!==t.tagName)return;let e=this.positionOfField(t);if(this.selectionModel)switch(this.selectionModel.mode){case h.EDIT_CELL:this.selectionModel.value=e;break;case h.SELECT_CELL:return this.toggleCellSelection(this.selectionModel.value,!1),this.selectionModel.value=e,void this.toggleCellSelection(this.selectionModel.value,!0);case h.SELECT_ROW:return this.toggleRowSelection(this.selectionModel.value.row,!1),this.selectionModel.value.row=e.row,void this.toggleRowSelection(this.selectionModel.value.row,!0)}let i=this.model.getFieldView(e.col,e.row);if(!i)return;this.fieldView=i,i.classList.add("embedded");let o=this.model.getFieldModel(e.col,e.row);i.setModel(o),i.onblur=()=>{t.innerText!=o.value&&(t.innerText=o.value,this.unadjustInternalTables(e),setTimeout(()=>{this.adjustInternalTables()},0))},i.onkeydown=t=>{switch(t.key){case"ArrowDown":if(e.row+1>=this.model.rows)break;t.preventDefault(),this.goTo(e.col,e.row+1);break;case"ArrowUp":if(0===e.row)break;t.preventDefault(),this.goTo(e.col,e.row-1);break;case"Tab":t.shiftKey?e.col>0?(t.preventDefault(),this.goTo(e.col-1,e.row)):e.row>0&&(t.preventDefault(),this.goTo(this.model.cols-1,e.row-1)):e.col+1<this.model.cols?(t.preventDefault(),this.goTo(e.col+1,e.row)):e.row+1<this.model.rows&&(t.preventDefault(),this.goTo(0,e.row+1))}},0===this.input.children.length?this.input.appendChild(i):(document.hasFocus()&&document.activeElement===this&&this.input.children[0].dispatchEvent(new FocusEvent("blur")),this.input.replaceChild(i,this.input.children[0])),this.adjustInputToElement(t)}positionOfField(t){let e,i;for(e=0;e<this.model.cols&&t.parentElement.children[e]!==t;++e);for(i=1;i<this.model.rows+1&&t.parentElement.parentElement.children[i]!==t.parentElement;++i);return new c(e,--i)}}e.TableView=w,window.customElements.define("toad-table",w)},"./src/view/text.ts":
/*!**************************!*\
  !*** ./src/view/text.ts ***!
  \**************************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ../view */"./src/view.ts");let n=document.createElement("style");n.textContent="\ninput {\n/*\n  height: 2.14285714em;\n  line-height: 1.4285714285714;\n  padding: 4px 5px;\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  box-sizing: border-box;\n  margin: 2px;\n  max-width: 250px;\n  vertical-align: baseline;\n  width: 100%;\n  background-color: #fff;\n  color: #333;\n  font-size: 14px;\n*/\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n}\n\n:host(.embedded) input {\n  border: none 0;\n  border-radius: 0;\n  padding: 0;\n  margin: 2px;\n  width: 100%;\n  background: #fff;\n}\n";class s extends o.GenericView{constructor(){super(),this.input=document.createElement("input"),this.input.oninput=()=>{this.updateModel()},this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(n,!0)),this.shadowRoot.appendChild(this.input)}focus(){this.input.focus()}blur(){this.input.blur()}static get observedAttributes(){return["value"]}attributeChangedCallback(t,e,i){switch(t){case"value":this.model&&void 0!==i&&(this.model.value=i)}}updateModel(){this.model&&(this.model.value=this.input.value),this.setAttribute("value",this.input.value)}updateView(){this.model&&this.input.value!=this.model.value&&(this.input.value=this.model.value),this.setAttribute("value",this.input.value)}get value(){return this.input.value}set value(t){this.input.value=t,this.updateModel()}}e.TextView=s,window.customElements.define("toad-text",s)},"./src/view/textarea.ts":
/*!******************************!*\
  !*** ./src/view/textarea.ts ***!
  \******************************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ../model */"./src/model.ts"),n=i(/*! ../view */"./src/view.ts");let s=document.createElement("style");s.textContent="\n.toolbar button {\n    background: #fff;\n    color: #000;\n    border: 1px #ccc;\n    border-style: solid solid solid none;\n    padding: 5;\n    margin: 0;\n}\n\n.toolbar button.left {\n    border-style: solid;\n    border-radius: 3px 0 0 3px;\n}\n\n.toolbar button.right {\n    border: 1px #ccc;\n    border-style: solid solid solid none;\n    border-radius: 0 3px 3px 0;\n}\n\n.toolbar button.active {\n    background: linear-gradient(to bottom, #7abcff 0%,#0052cc 100%,#4096ee 100%);\n    border: 1px #0052cc solid;\n    color: #fff;\n}\n\ndiv.textarea {\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n  outline-offset: -2px;\n}\n\ndiv.textarea h1 {\n  font-size: 22px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h2 {\n  font-size: 18px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h3 {\n  font-size: 16px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h4 {\n  font-size: 14px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea div {\n  padding: 2px 0 2px 0;\n}\n";class r extends n.GenericView{constructor(){super(),r.texttool=this;let t=document.createElement("div");t.classList.add("toolbar"),this.buttonH1=document.createElement("button"),this.buttonH1.classList.add("left"),this.buttonH1.innerHTML="H1",this.buttonH1.onclick=()=>{document.execCommand("formatBlock",!1,"<h1>"),this.update()},t.appendChild(this.buttonH1),this.buttonH2=document.createElement("button"),this.buttonH2.innerHTML="H2",this.buttonH2.onclick=()=>{document.execCommand("formatBlock",!1,"<h2>"),this.update()},t.appendChild(this.buttonH2),this.buttonH3=document.createElement("button"),this.buttonH3.innerHTML="H3",this.buttonH3.onclick=()=>{document.execCommand("formatBlock",!1,"<h3>"),this.update()},t.appendChild(this.buttonH3),this.buttonH4=document.createElement("button"),this.buttonH4.classList.add("right"),this.buttonH4.innerHTML="H4",this.buttonH4.onclick=()=>{document.execCommand("formatBlock",!1,"<h4>"),this.update()},t.appendChild(this.buttonH4),t.appendChild(document.createTextNode(" ")),this.buttonBold=document.createElement("button"),this.buttonBold.classList.add("left"),this.buttonBold.innerHTML="<b>B</b>",this.buttonBold.onclick=()=>{document.execCommand("bold",!1),this.update()},t.appendChild(this.buttonBold),this.buttonItalic=document.createElement("button"),this.buttonItalic.innerHTML="<i>I</i>",this.buttonItalic.onclick=()=>{document.execCommand("italic",!1),this.update()},t.appendChild(this.buttonItalic),this.buttonUnderline=document.createElement("button"),this.buttonUnderline.innerHTML="<u>U</u>",this.buttonUnderline.onclick=()=>{document.execCommand("underline",!1),this.update()},t.appendChild(this.buttonUnderline),this.buttonStrikeThrough=document.createElement("button"),this.buttonStrikeThrough.innerHTML="<strike>S</strike>",this.buttonStrikeThrough.onclick=()=>{document.execCommand("strikeThrough",!1),this.update()},t.appendChild(this.buttonStrikeThrough),this.buttonSubscript=document.createElement("button"),this.buttonSubscript.innerHTML="x₂",this.buttonSubscript.onclick=()=>{document.execCommand("subscript",!1),this.update()},t.appendChild(this.buttonSubscript),this.buttonSuperscript=document.createElement("button"),this.buttonSuperscript.classList.add("right"),this.buttonSuperscript.innerHTML="x²",this.buttonSuperscript.onclick=()=>{document.execCommand("superscript",!1),this.update()},t.appendChild(this.buttonSuperscript),t.appendChild(document.createTextNode(" ")),this.buttonJustifyLeft=document.createElement("button"),this.buttonJustifyLeft.classList.add("left"),this.buttonJustifyLeft.innerHTML='<svg viewBox="0 0 10 9" width="10" height="9">\n            <line x1="0" y1="0.5" x2="10" y2="0.5" stroke="#000" />\n            <line x1="0" y1="2.5" x2="6" y2="2.5" stroke="#000" />\n            <line x1="0" y1="4.5" x2="10" y2="4.5" stroke="#000" />\n            <line x1="0" y1="6.5" x2="6" y2="6.5" stroke="#000" />\n            <line x1="0" y1="8.5" x2="10" y2="8.5" stroke="#000" />\n            </svg>',this.buttonJustifyLeft.onclick=()=>{document.execCommand("justifyLeft",!1),this.update()},t.appendChild(this.buttonJustifyLeft),this.buttonJustifyCenter=document.createElement("button"),this.buttonJustifyCenter.innerHTML='<svg viewBox="0 0 10 9" width="10" height="9">\n            <line x1="0" y1="0.5" x2="10" y2="0.5" stroke="#000" />\n            <line x1="2" y1="2.5" x2="8" y2="2.5" stroke="#000" />\n            <line x1="0" y1="4.5" x2="10" y2="4.5" stroke="#000" />\n            <line x1="2" y1="6.5" x2="8" y2="6.5" stroke="#000" />\n            <line x1="0" y1="8.5" x2="10" y2="8.5" stroke="#000" />\n            </svg>',this.buttonJustifyCenter.onclick=()=>{document.execCommand("justifyCenter",!1),this.update()},t.appendChild(this.buttonJustifyCenter),this.buttonJustifyRight=document.createElement("button"),this.buttonJustifyRight.classList.add("right"),this.buttonJustifyRight.innerHTML='<svg viewBox="0 0 10 9" width="10" height="9">\n            <line x1="0" y1="0.5" x2="10" y2="0.5" stroke="#000" />\n            <line x1="4" y1="2.5" x2="10" y2="2.5" stroke="#000" />\n            <line x1="0" y1="4.5" x2="10" y2="4.5" stroke="#000" />\n            <line x1="4" y1="6.5" x2="10" y2="6.5" stroke="#000" />\n            <line x1="0" y1="8.5" x2="10" y2="8.5" stroke="#000" />\n            </svg>',this.buttonJustifyRight.onclick=()=>{document.execCommand("justifyRight",!1),this.update()},t.appendChild(this.buttonJustifyRight),t.appendChild(document.createTextNode(" ")),this.buttonUnorderedList=document.createElement("button"),this.buttonUnorderedList.classList.add("left"),this.buttonUnorderedList.innerHTML='<svg viewBox="0 0 17 10.5" width="17" height="10.5">\n            <circle cx="4.5" cy="1.5" r="0.8" stroke="#000" fill="#000"/>\n            <line x1="7" y1="1.5" x2="17" y2="1.5" stroke="#000"/>\n            <circle cx="4.5" cy="5.5" r="0.8" stroke="#000" fill="#000"/>\n            <line x1="7" y1="5.5" x2="17" y2="5.5" stroke="#000"/>\n            <circle cx="4.5" cy="9.5" r="0.8" stroke="#000" fill="#000"/>\n            <line x1="7" y1="9.5" x2="17" y2="9.5" stroke="#000"/>\n            </svg>',this.buttonUnorderedList.onclick=t=>{document.execCommand("insertUnorderedList",!1),this.update()},t.appendChild(this.buttonUnorderedList),this.buttonOrderedList=document.createElement("button"),this.buttonOrderedList.classList.add("right"),this.buttonOrderedList.innerHTML='<svg viewBox="0 0 17 10.5" width="17" height="10.5">\n            <line x1="4.5" y1="0" x2="4.5" y2="3" stroke="#000" />\n            <line x1="7" y1="1.5" x2="17" y2="1.5" stroke="#000"/>\n            <line x1="2.5" y1="4" x2="2.5" y2="7" stroke="#000" />\n            <line x1="4.5" y1="4" x2="4.5" y2="7" stroke="#000" />\n            <line x1="7" y1="5.5" x2="17" y2="5.5" stroke="#000"/>\n            <line x1="0.5" y1="8" x2="0.5" y2="11" stroke="#000" />\n            <line x1="2.5" y1="8" x2="2.5" y2="11" stroke="#000" />\n            <line x1="4.5" y1="8" x2="4.5" y2="11" stroke="#000" />\n            <line x1="7" y1="9.5" x2="17" y2="9.5" stroke="#000"/>\n            </svg>',this.buttonOrderedList.onclick=()=>{document.execCommand("insertOrderedList",!1),this.update()},t.appendChild(this.buttonOrderedList),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(s,!0)),this.shadowRoot.appendChild(t)}update(){this.buttonH1.classList.toggle("active","h1"===document.queryCommandValue("formatBlock")),this.buttonH2.classList.toggle("active","h2"===document.queryCommandValue("formatBlock")),this.buttonH3.classList.toggle("active","h3"===document.queryCommandValue("formatBlock")),this.buttonH4.classList.toggle("active","h4"===document.queryCommandValue("formatBlock")),this.buttonBold.classList.toggle("active",document.queryCommandState("bold")),this.buttonItalic.classList.toggle("active",document.queryCommandState("italic")),this.buttonUnderline.classList.toggle("active",document.queryCommandState("underline")),this.buttonStrikeThrough.classList.toggle("active",document.queryCommandState("strikeThrough")),this.buttonSubscript.classList.toggle("active",document.queryCommandState("subscript")),this.buttonSuperscript.classList.toggle("active",document.queryCommandState("superscript")),this.buttonJustifyLeft.classList.toggle("active",document.queryCommandState("justifyLeft")),this.buttonJustifyCenter.classList.toggle("active",document.queryCommandState("justifyCenter")),this.buttonJustifyRight.classList.toggle("active",document.queryCommandState("justifyRight"))}updateModel(){this.model}updateView(){this.model}}e.TextTool=r,window.customElements.define("toad-texttool",r);class l extends n.GenericView{constructor(){super();let t=document.createElement("div");this.content=t,t.classList.add("textarea"),t.contentEditable="true",t.oninput=e=>{let i=e.target.firstChild;i&&3===i.nodeType?document.execCommand("formatBlock",!1,"<div>"):"<br>"===t.innerHTML&&(t.innerHTML=""),this.updateModel()},t.onkeydown=t=>{!0===t.metaKey&&"b"===t.key?(t.preventDefault(),document.execCommand("bold",!1),this.updateTextTool()):!0===t.metaKey&&"i"===t.key?(t.preventDefault(),document.execCommand("italic",!1),this.updateTextTool()):!0===t.metaKey&&"u"===t.key?(t.preventDefault(),document.execCommand("underline",!1),this.updateTextTool()):"Tab"===t.key?t.preventDefault():"Enter"===t.key&&!0!==t.shiftKey&&"blockquote"===document.queryCommandValue("formatBlock")&&document.execCommand("formatBlock",!1,"<p>")},t.onkeyup=()=>{this.updateTextTool()},t.onmouseup=()=>{this.updateTextTool()},this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(s,!0)),this.shadowRoot.appendChild(t)}updateTextTool(){void 0!==r.texttool&&r.texttool.update()}updateModel(){this.model&&(this.model.promise=()=>this.content.innerHTML)}updateView(){this.model&&(this.model instanceof o.HtmlModel?this.content.innerHTML!==this.model.value&&(this.content.innerHTML=this.model.value):this.content.innerText!==this.model.value&&(this.content.innerText=this.model.value))}}e.TextArea=l,window.customElements.define("toad-textarea",l)},"./src/view/toolbutton.ts":
/*!********************************!*\
  !*** ./src/view/toolbutton.ts ***!
  \********************************/
/*! no static exports found */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=i(/*! ../view */"./src/view.ts");let n=document.createElement("style");n.textContent="\ndiv {\n    border: 1px solid #e3dbdb;\n    border-radius: 5px;\n    background: #e3dbdb;\n    width: 32px;\n    height: 32px;\n    padding: 3px;\n}\n\n:host([selected]) div {\n    background: #ac9393;\n}\n\n:host([disabled]) div {\n    opacity: 0.5;\n}\n\n:host([disabled]) div img {\n    opacity: 0.5;\n}\n\n:host([checked][disabled]) div {\n}\n";class s extends o.GenericView{constructor(){super();let t=document.createElement("div");t.onmousedown=e=>{this.hasAttribute("disabled")||(t.focus(),e.preventDefault(),void 0!==this.model&&(this.model.stringValue=this.getValue()))};let e=document.createElement("img");this.hasAttribute("img")&&(e.src=this.getAttribute("img")),t.appendChild(e),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(n,!0)),this.shadowRoot.appendChild(t)}getValue(){let t=this.getAttribute("value");if(null===t)throw Error("no value");return t}connectedCallback(){super.connectedCallback(),void 0===this.model&&this.setAttribute("disabled","")}updateModel(){}updateView(){if(void 0===this.model)return this.setAttribute("disabled",""),void this.removeAttribute("selected");let t=this.getValue();this.model.isValidStringValue(t)?this.removeAttribute("disabled"):this.setAttribute("disabled",""),this.model.stringValue===t?this.setAttribute("selected",""):this.removeAttribute("selected")}}e.ToolButton=s,window.customElements.define("toad-toolbutton",s)}});
//# sourceMappingURL=toad.min.js.map