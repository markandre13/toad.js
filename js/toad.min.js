var toad=function(t){var e={};function o(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s="./src/toad.ts")}({"./src/action.ts":
/*!***********************!*\
  !*** ./src/action.ts ***!
  \***********************/
/*! exports provided: Action */function(t,e,o){"use strict";o.r(e),o.d(e,"Action",function(){return s});var i=o(/*! ./model */"./src/model.ts"),n=o(/*! ./signal */"./src/signal.ts");class s extends i.Model{constructor(t,e){super(),this.signal=new n.Signal,this.title=e,this._enabled=!0}set value(t){throw Error("Action.value can not be assigned a value")}get value(){throw Error("Action.value can not return a value")}set enabled(t){this._enabled!=t&&(this._enabled=t,this.modified.trigger())}get enabled(){return this._enabled}trigger(){this._enabled&&this.signal.trigger()}}},"./src/controller.ts":
/*!***************************!*\
  !*** ./src/controller.ts ***!
  \***************************/
/*! exports provided: Controller, Template, Dialog, globalController, bind, action, unbind, text, boolean */function(t,e,o){"use strict";o.r(e),o.d(e,"Controller",function(){return l}),o.d(e,"Template",function(){return d}),o.d(e,"Dialog",function(){return a}),o.d(e,"globalController",function(){return c}),o.d(e,"bind",function(){return h}),o.d(e,"action",function(){return u}),o.d(e,"unbind",function(){return p}),o.d(e,"text",function(){return f}),o.d(e,"boolean",function(){return m});var i=o(/*! ./dom */"./src/dom.ts"),n=o(/*! ./model */"./src/model.ts"),s=o(/*! ./action */"./src/action.ts"),r=o(/*! ./signal */"./src/signal.ts");class l{constructor(){this.modelId2Models=new Map,this.modelId2Views=new Map,this.view2ModelIds=new Map,this.sigChanged=new r.Signal}registerAction(t,e){let o=new s.Action(void 0,t);return o.signal.add(e),this._registerModel("A:"+t,o),o}registerModel(t,e){this._registerModel("M:"+t,e)}_registerModel(t,e){let o=this.modelId2Models.get(t);o||(o=new Set,this.modelId2Models.set(t,o)),o.add(e);let i=this.modelId2Views.get(t);if(i)for(let t of i)t.setModel(e)}registerView(t,e){if(e.controller&&e.controller!==this)return void console.log("error: attempt to register view more than once at different controllers");e.controller=this;let o=this.view2ModelIds.get(e);o||(o=new Set,this.view2ModelIds.set(e,o)),o.add(t);let i=this.modelId2Views.get(t);i||(i=new Set,this.modelId2Views.set(t,i)),i.add(e);let n=this.modelId2Models.get(t);if(n)for(let t of n)e.setModel(t)}unregisterView(t){if(!t.controller)return;if(t.controller!==this)throw Error("attempt to unregister view from wrong controller");let e=this.view2ModelIds.get(t);if(e)for(let o of e){let e=this.modelId2Views.get(o);e&&(e.delete(t),0===e.size&&this.modelId2Views.delete(o),t.setModel(void 0))}}clear(){for(let t of this.view2ModelIds)t[0].setModel(void 0);this.modelId2Models.clear(),this.modelId2Views.clear(),this.view2ModelIds.clear()}bind(t,e){this.registerModel(t,e)}action(t,e){return this.registerAction(t,e)}text(t,e){let o=new n.TextModel(e);return this.bind(t,o),o}html(t,e){let o=new n.HtmlModel(e);return this.bind(t,o),o}boolean(t,e){let o=new n.BooleanModel(e);return this.bind(t,o),o}number(t,e,o){let i=new n.NumberModel(e,o);return this.bind(t,i),i}}class d extends l{constructor(t){super(),this.root=i.instantiateTemplate(t),this.registerViews()}registerViews(){let t=this.root.querySelectorAll("[model]");for(let e of t){let t=e;if(t)try{this.registerView(t.getModelId(),t)}catch(t){}}t=this.root.querySelectorAll("[action]");for(let e of t){let t=e;if(t)try{this.registerView(t.getActionId(),t)}catch(t){}}}openHref(t){}}class a extends l{constructor(){super()}open(t){let e=document.createElement("div");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.right="0",e.style.bottom="0",e.style.backgroundColor="#aaa",e.style.opacity="0.5",this.shadow=e,document.body.appendChild(e);let o,i=document.head.querySelectorAll("link[rel=import]");for(let e of i)if(e.href===t){o=e;break}if(o)o.dispatchEvent(new Event("load"));else{let e=document.createElement("link");e.rel="import",e.href=t,e.onload=(o=>{let i=e.import.querySelector("template");if(!i)throw Error("toad.openDialog: failed to find template in '"+t+"'");let n=document.importNode(i.content,!0);this.registerViews(n);let s=document.createElement("div");s.style.position="absolute",s.style.left="5%",s.style.top="5%",s.style.right="5%",s.style.bottom="5%",s.style.backgroundColor="#fff",s.style.border="solid 2px #000",s.appendChild(n),document.body.appendChild(s),this.frame=s}),document.head.appendChild(e)}}close(){this.frame&&document.body.removeChild(this.frame),this.shadow&&document.body.removeChild(this.shadow)}registerViews(t){let e=t.querySelectorAll("[model]");for(let t of e){let e=t;if(e)try{this.registerView(e.getModelId(),e)}catch(t){}}e=t.querySelectorAll("[action]");for(let t of e){let e=t;if(e)try{this.registerView(e.getActionId(),e)}catch(t){}}}}let c=new l;function h(t,e){c.bind(t,e)}function u(t,e){return c.registerAction(t,e)}function p(){c.clear()}function f(t,e){return c.text(t,e)}function m(t,e){return c.boolean(t,e)}},"./src/dom.ts":
/*!********************!*\
  !*** ./src/dom.ts ***!
  \********************/
/*! exports provided: instantiateTemplate, tmpl, find, tag, txt, img, add, remove, erase, grabMouse, attribute, attributeOrUndefined, order */function(t,e,o){"use strict";function i(t){return n(t)}function n(t){let e=document.querySelector('template[id="'+t+'"]');if(!e)throw new Error("failed to find template '"+t+"'");let o=e.content;return document.importNode(o,!0)}function s(t,e){return t.querySelector(e)}function r(t){return document.createElement(t)}function l(t){return document.createTextNode(t)}function d(t){let e=document.createElement("img");return e.src=t,e}function a(t,e){t.appendChild(e)}function c(t){if(!t.parentNode)throw Error("element has no parent");t.parentNode.removeChild(t)}function h(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function u(t){let e=t.target,o=t=>{e.dispatchEvent(new MouseEvent("mousemove",t)),t.stopPropagation()},i=t=>{e.dispatchEvent(new MouseEvent("mouseup",t)),document.removeEventListener("mousemove",o,{capture:!0}),document.removeEventListener("mouseup",i,{capture:!0}),document.body.style.pointerEvents="auto",t.stopPropagation()};document.addEventListener("mousemove",o,{capture:!0}),document.addEventListener("mouseup",i,{capture:!0}),document.body.style.pointerEvents="none",t.preventDefault(),t.stopPropagation()}function p(t,e){let o=t.getAttribute(e);if(null===o)throw console.log("missing attribute '"+e+"' in ",t),Error("missing attribute '"+e+"' in "+t.nodeName);return o}function f(t,e){let o=t.getAttribute(e);return null===o?void 0:o}function m(t,e){let o,i=new Map,n=t;for(o=t;n=o,o=o.parentNode;)i.set(o,n);let s=e;for(o=e;o;){if(s=o,!(o=o.parentNode))throw Error("fuck");let t=i.get(o);if(t){n=t;break}o=o.parentNode}if(!o)throw Error("fuck");for(let t of o.childNodes){if(t===n)return!0;if(t===s)return!1}throw Error("fuck")}o.r(e),o.d(e,"instantiateTemplate",function(){return i}),o.d(e,"tmpl",function(){return n}),o.d(e,"find",function(){return s}),o.d(e,"tag",function(){return r}),o.d(e,"txt",function(){return l}),o.d(e,"img",function(){return d}),o.d(e,"add",function(){return a}),o.d(e,"remove",function(){return c}),o.d(e,"erase",function(){return h}),o.d(e,"grabMouse",function(){return u}),o.d(e,"attribute",function(){return p}),o.d(e,"attributeOrUndefined",function(){return f}),o.d(e,"order",function(){return m})},"./src/model.ts":
/*!**********************!*\
  !*** ./src/model.ts ***!
  \**********************/
/*! exports provided: Model, GenericModel, TextModel, HtmlModel, NumberModel, BooleanModel, RadioStateModel */function(t,e,o){"use strict";o.r(e),o.d(e,"Model",function(){return n}),o.d(e,"GenericModel",function(){return s}),o.d(e,"TextModel",function(){return r}),o.d(e,"HtmlModel",function(){return l}),o.d(e,"NumberModel",function(){return d}),o.d(e,"BooleanModel",function(){return a}),o.d(e,"RadioStateModel",function(){return c});var i=o(/*! ./signal */"./src/signal.ts");class n{constructor(){this.modified=new i.Signal}}class s extends n{constructor(t){super(),this._value=t}set value(t){this._value!=t&&(this._value=t,this.modified.trigger())}get value(){return this._value}}class r extends s{constructor(t){super(t)}}class l extends r{constructor(t){super(t)}}class d extends s{constructor(t,e){super(t),e&&(this.min=e.min,this.max=e.max,this.step=e.step)}}class a extends s{constructor(t){super(t)}}class c extends n{constructor(){super()}set value(t){this.setValue(t)}get value(){return this.getValue()}hasValue(){return void 0!=this._value}setValue(t){this._value!=t&&(this._value=t,this.modified.trigger())}getValue(){if(void 0===this._value)throw Error("fuck");return this._value}}},"./src/signal.ts":
/*!***********************!*\
  !*** ./src/signal.ts ***!
  \***********************/
/*! exports provided: SignalLink, Signal */function(t,e,o){"use strict";o.r(e),o.d(e,"SignalLink",function(){return i}),o.d(e,"Signal",function(){return n});class i{constructor(t,e){this.callback=t,this.id=e}}class n{add(t,e){this.callbacks||(this.callbacks=new Array),this.callbacks.push(new i(t,e))}remove(t){if(this.callbacks)for(let e=this.callbacks.length-1;e>=0;--e)this.callbacks[e].id===t&&this.callbacks.splice(e,1)}count(){return this.callbacks?this.callbacks.length:0}trigger(){if(this.callbacks)for(let t=0;t<this.callbacks.length;++t)this.callbacks[t].callback()}}},"./src/toad.ts":
/*!*********************!*\
  !*** ./src/toad.ts ***!
  \*********************/
/*! exports provided: Signal, Action, Model, GenericModel, TextModel, HtmlModel, NumberModel, BooleanModel, RadioStateModel, View, GenericView, SlotView, ButtonView, CheckboxView, MenuButton, SliderView, TableView, TableModel, TableEditMode, SelectionModel, registerTableModelLocator, createTableModel, TextView, Controller, Template, Dialog, bind, action, unbind, globalController, boolean, Window, RadioButtonBase, FatRadioButton */function(t,e,o){"use strict";o.r(e),o.d(e,"Window",function(){return m}),o.d(e,"RadioButtonBase",function(){return w}),o.d(e,"FatRadioButton",function(){return g});var i=o(/*! ./dom */"./src/dom.ts"),n=o(/*! ./signal */"./src/signal.ts"),s=o(/*! ./view */"./src/view.ts");o.d(e,"Signal",function(){return n.Signal});var r=o(/*! ./action */"./src/action.ts");o.d(e,"Action",function(){return r.Action});var l=o(/*! ./model */"./src/model.ts");o.d(e,"Model",function(){return l.Model}),o.d(e,"GenericModel",function(){return l.GenericModel}),o.d(e,"TextModel",function(){return l.TextModel}),o.d(e,"HtmlModel",function(){return l.HtmlModel}),o.d(e,"NumberModel",function(){return l.NumberModel}),o.d(e,"BooleanModel",function(){return l.BooleanModel}),o.d(e,"RadioStateModel",function(){return l.RadioStateModel}),o.d(e,"View",function(){return s.View}),o.d(e,"GenericView",function(){return s.GenericView}),o.d(e,"SlotView",function(){return s.SlotView});var d=o(/*! ./view/button */"./src/view/button.ts");o.d(e,"ButtonView",function(){return d.ButtonView});var a=o(/*! ./view/checkbox */"./src/view/checkbox.ts");o.d(e,"CheckboxView",function(){return a.CheckboxView});var c=o(/*! ./view/menu */"./src/view/menu.ts");o.d(e,"MenuButton",function(){return c.MenuButton});var h=o(/*! ./view/slider */"./src/view/slider.ts");o.d(e,"SliderView",function(){return h.SliderView});var u=o(/*! ./view/table */"./src/view/table.ts");o.d(e,"TableView",function(){return u.TableView}),o.d(e,"TableModel",function(){return u.TableModel}),o.d(e,"TableEditMode",function(){return u.TableEditMode}),o.d(e,"SelectionModel",function(){return u.SelectionModel}),o.d(e,"registerTableModelLocator",function(){return u.registerTableModelLocator}),o.d(e,"createTableModel",function(){return u.createTableModel});var p=o(/*! ./view/text */"./src/view/text.ts");o.d(e,"TextView",function(){return p.TextView});var f=o(/*! ./controller */"./src/controller.ts");o.d(e,"Controller",function(){return f.Controller}),o.d(e,"Template",function(){return f.Template}),o.d(e,"Dialog",function(){return f.Dialog}),o.d(e,"bind",function(){return f.bind}),o.d(e,"action",function(){return f.action}),o.d(e,"unbind",function(){return f.unbind}),o.d(e,"globalController",function(){return f.globalController}),o.d(e,"boolean",function(){return f.boolean});customElements.define("toad-if",class extends s.GenericView{updateModel(){}updateView(){this.model&&(this.style.display=this.model.value?"":"none")}});class m{constructor(t,e){t instanceof m?(this.window=void 0,this.parent=t):(this.window=t,this.parent=void 0),this.title=e}}class w extends m{constructor(t,e){super(t,e),this.clicked=new n.Signal}}class g extends w{constructor(t,e,o,n){super(t,e);let s=this;this.model=o,this.value=n,s.window=i.tag("div"),s.window.classList.add("fatradiobutton"),o.hasValue()||o.setValue(n),o.getValue()==n&&s.window.classList.add("fatradiobutton-selected"),s.window.onmousedown=function(t){return s.model.setValue(n),!1},o.modified.add(function(){if(!s.window)throw Error("fuck");s.model.getValue()==n?s.window.classList.add("fatradiobutton-selected"):s.window.classList.remove("fatradiobutton-selected")});let r=i.img("img/"+e+".svg");i.add(s.window,r),i.add(t.window,s.window)}}},"./src/view.ts":
/*!*********************!*\
  !*** ./src/view.ts ***!
  \*********************/
/*! exports provided: View, GenericView, ActionView, SlotView */function(t,e,o){"use strict";o.r(e),o.d(e,"View",function(){return r}),o.d(e,"GenericView",function(){return l}),o.d(e,"ActionView",function(){return d}),o.d(e,"SlotView",function(){return a});var i=o(/*! ./model */"./src/model.ts"),n=o(/*! ./controller */"./src/controller.ts"),s=o(/*! ./action */"./src/action.ts");class r extends HTMLElement{getModelId(){if(!this.hasAttribute("model"))throw Error("no 'model' attribute");let t=this.getAttribute("model");if(!t)throw Error("no model id");return"M:"+t}getActionId(){if(!this.hasAttribute("action"))throw Error("no 'action' attribute");let t=this.getAttribute("action");if(!t)throw Error("no action id");return"A:"+t}}class l extends r{constructor(){super()}connectedCallback(){if(this.controller)return;let t="";try{t=this.getModelId()}catch(t){}""!=t&&n.globalController.registerView(t,this)}disconnectedCallback(){this.controller&&this.controller.unregisterView(this)}setModel(t){if(t===this.model)return;let e=this;this.model&&this.model.modified.remove(e),t&&t.modified.add(()=>{e.updateView()},e),this.model=t,this.updateView()}}class d extends l{constructor(){super()}connectedCallback(){if(this.controller)this.updateView();else{try{n.globalController.registerView(this.getActionId(),this)}catch(t){}try{n.globalController.registerView(this.getModelId(),this)}catch(t){}this.updateView()}}disconnectedCallback(){super.disconnectedCallback(),this.controller&&this.controller.unregisterView(this)}setModel(t){if(!t)return this.model&&this.model.modified.remove(this),this.action&&this.action.modified.remove(this),this.model=void 0,this.action=void 0,void this.updateView();if(t instanceof s.Action)this.action=t,this.action.modified.add(()=>{this.updateView()},this);else{if(!(t instanceof i.TextModel))throw Error("unexpected model of type "+t.constructor.name);this.model=t,this.model.modified.add(()=>{this.updateView()},this)}this.updateView()}isEnabled(){return void 0!==this.action&&this.action.enabled}}class a extends l{constructor(){super()}updateModel(){}updateView(){if(!this.model)return;let t=void 0===this.model.value?"":this.model.value;this.model instanceof i.HtmlModel?this.innerHTML=t:this.innerText=t}}window.customElements.define("toad-slot",a)},"./src/view/button.ts":
/*!****************************!*\
  !*** ./src/view/button.ts ***!
  \****************************/
/*! exports provided: ButtonView */function(t,e,o){"use strict";o.r(e),o.d(e,"ButtonView",function(){return r});var i=o(/*! ../model */"./src/model.ts"),n=o(/*! ../view */"./src/view.ts");let s=document.createElement("style");s.textContent="\n  button {\n    border: none;\n    background-color: var(--toad-primary-color, #0052cc);\n    color: #ffffff;\n    border-radius: 3px;\n    font-size: 14px;\n    font-weight: bold;\n    height: 32px;\n    line-height: 32px;\n    min-width: 24px;\n    text-shadow: none;\n    padding: 0 10px;\n    margin-right: 4px;\n  }\n  \n  button:hover {\n    background-color: #0065ff;\n  }\n  \n  button:hover:active {\n    background-color: #0049b0;\n  }\n  \n  button:disabled, button:disabled:active {\n    background-color: #888;\n  }\n";class r extends n.ActionView{constructor(){super();this.button=document.createElement("button"),this.button.onclick=(()=>{this.action&&this.action.trigger()}),this.button.disabled=!0,this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(s,!0)),this.shadowRoot.appendChild(this.button)}connectedCallback(){super.connectedCallback(),0===this.children.length&&(this._observer=new MutationObserver((t,e)=>{void 0!==this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{this._timer=void 0,this.updateView()},100)}),this._observer.observe(this,{childList:!0,subtree:!0,characterData:!0}))}updateModel(){}updateView(){this.model&&this.model.value?this.model instanceof i.HtmlModel?this.button.innerHTML=this.model.value:this.button.innerText=this.model.value:this.button.innerHTML=this.innerHTML,this.button.disabled=!this.isEnabled()}}window.customElements.define("toad-button",r)},"./src/view/checkbox.ts":
/*!******************************!*\
  !*** ./src/view/checkbox.ts ***!
  \******************************/
/*! exports provided: CheckboxView */function(t,e,o){"use strict";o.r(e),o.d(e,"CheckboxView",function(){return s});var i=o(/*! ../view */"./src/view.ts");let n=document.createElement("style");n.textContent="\nsvg {\n  width: 12px;\n  height: 12px;\n  vertical-align: middle;\n  margin: 3px;              /* space for the outline */\n  background: none;\n}\nsvg:focus {\n  outline-offset: -2px;     /* bring outline in touch with the svg */\n  background: #9eccfb;      /* the rectangle is rounded, fill the corners */\n  outline-color: 9eccfb;    /* outline shall be the same color used to fill the corners */\n}\n@media(pointer: coarse) { /* works on Chrome but iOS is never coarse :( */\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n}\nsvg rect {\n  stroke: var(--border-color, var(--toad-neutral-color, #aaa));\n  fill: var(--background-color, #fff);\n  stroke-width: 1px;\n}\nsvg path {\n  stroke: var(--marker-color, none);\n  fill: none;\n  stroke-width: 2px;\n}\n:host([checked]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #0052cc));\n  fill: var(--checked-background-color, var(--toad-primary-color, #0052cc));\n}\n:host([checked]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #fff));\n}\n:host([disabled]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #bdbdbd));\n  fill: var(--checked-background-color, var(--toad-primary-color, #fff));\n}\n:host([disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, none));\n}\n:host([checked][disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #bdbdbd));\n}";class s extends i.GenericView{constructor(){super();let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttributeNS("","viewBox","0 0 18 18");let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttributeNS("","x","1"),e.setAttributeNS("","y","1"),e.setAttributeNS("","width","16"),e.setAttributeNS("","height","16"),e.setAttributeNS("","rx","3"),e.setAttributeNS("","ry","3");let o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttributeNS("","d","M4 9.5 L 7.5 13 L 14.5 4"),t.onclick=(()=>{this.toggle()}),t.setAttributeNS("","tabindex","0"),t.addEventListener("keydown",t=>{" "===t.key&&this.toggle()}),t.onmousedown=(e=>{t.focus(),e.preventDefault()}),t.appendChild(e),t.appendChild(o),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(n,!0)),this.shadowRoot.appendChild(t)}static get observedAttributes(){return["checked"]}attributeChangedCallback(t,e,o){switch(t){case"checked":this.updateModel()}}toggle(){this.hasAttribute("disabled")||(this.hasAttribute("checked")?this.removeAttribute("checked"):this.setAttribute("checked",""),this.updateModel())}updateModel(){this.model&&(this.model.value=this.hasAttribute("checked"))}updateView(){if(!this.model)return this.setAttribute("disabled",""),void this.removeAttribute("checked");this.removeAttribute("disabled"),this.model.value?this.setAttribute("checked",""):this.removeAttribute("checked")}}window.customElements.define("toad-checkbox",s)},"./src/view/menu.ts":
/*!**************************!*\
  !*** ./src/view/menu.ts ***!
  \**************************/
/*! exports provided: MenuState, Type, Node, MenuHelper, Menu, PopupMenu, MenuButton */function(t,e,o){"use strict";o.r(e),o.d(e,"MenuState",function(){return a}),o.d(e,"Type",function(){return c}),o.d(e,"Node",function(){return h}),o.d(e,"MenuHelper",function(){return u}),o.d(e,"Menu",function(){return p}),o.d(e,"PopupMenu",function(){return f}),o.d(e,"MenuButton",function(){return m});var i=o(/*! ../dom */"./src/dom.ts"),n=o(/*! ../action */"./src/action.ts"),s=o(/*! ../model */"./src/model.ts"),r=o(/*! ../view */"./src/view.ts"),l=o(/*! ../controller */"./src/controller.ts");let d=document.createElement("style");var a,c;d.textContent="\n  :host(.menu-button) {\n    font-family: var(--toad-font-family, sans-serif);\n    font-size: 14px;\n    font-weight: bold;\n    padding: 7px;\n    vertical-align: center;\n  \n    background: #fff;\n    color: #000;\n    cursor: default;\n  }\n  :host(.menu-button.active) {\n    background: #000;\n    color: #fff;\n  }\n  :host(.menu-button.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.active.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.menu-down) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-down) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.menu-side) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-side) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  .menu-bar {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .menu-popup {\n    position: fixed;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 2px 2px 5px #888;\n  }\n",function(t){t[t.WAIT=0]="WAIT",t[t.DOWN=1]="DOWN",t[t.UP_N_HOLD=2]="UP_N_HOLD",t[t.DOWN_N_HOLD=3]="DOWN_N_HOLD",t[t.DOWN_N_OUTSIDE=4]="DOWN_N_OUTSIDE",t[t.DOWN_N_INSIDE_AGAIN=5]="DOWN_N_INSIDE_AGAIN"}(a||(a={})),function(t){t[t.BUTTON=0]="BUTTON",t[t.RADIOBUTTON=1]="RADIOBUTTON",t[t.CHECKBUTTON=2]="CHECKBUTTON",t[t.SEPARATOR=3]="SEPARATOR"}(c||(c={}));class h{constructor(t,e,o,i,n){this.title=t,this.label=e,this.shortcut=o,this.type=i||"entry",this.modelId=n}isEnabled(){return!0}isAvailable(){return!0}createWindowAt(t,e){if("spacer"==this.type){let t=document.createElement("span");return t.style.flexGrow="1",void e.appendChild(t)}this.view=new m(t,this),e.appendChild(this.view)}deleteWindow(){}}class u extends HTMLElement{constructor(){super(),this.vertical=!0,this.closeOnClose=!1,this.state=a.WAIT}}class p extends u{constructor(){super(),this.vertical=!1,this.root=new h("","",void 0,void 0)}connectedCallback(){this.tabIndex=0,0===this.children.length?(this._observer=new MutationObserver((t,e)=>{void 0!==this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{this._timer=void 0,this.layout2nodes(this.children,this.root),this.referenceActions(),this.createShadowDOM()},100)}),this._observer.observe(this,{childList:!0,subtree:!0})):(this.layout2nodes(this.children,this.root),this.referenceActions(),this.createShadowDOM())}disconnectedCallback(){}layout2nodes(t,e){let o=e.down;for(let n of t){let t=void 0;switch(n.nodeName){case"TOAD-MENUSPACER":t=new h("","","","spacer");break;case"TOAD-MENUENTRY":t=new h(i.attribute(n,"name"),i.attribute(n,"label"),i.attributeOrUndefined(n,"shortcut"),i.attributeOrUndefined(n,"type"),i.attributeOrUndefined(n,"model"))}if(t&&(t.parent=e,o?o.next=t:e.down=t,o=t),!o)throw Error("fuck");this.layout2nodes(n.children,o)}}referenceActions(){}findNode(t,e){let o=t.indexOf("|"),i=-1==o?t:t.substr(0,o),n=-1==o?"":t.substr(o+1);e||(e=this.root);for(let t=e.down;t;t=t.next)if(t.title==i)return t.down?this.findNode(n,t):t}createShadowDOM(){this.view=document.createElement("div"),this.view.classList.add("menu-bar");let t=this.root.down;for(;t;)t.isAvailable()?t.createWindowAt(this,this.view):t.deleteWindow(),t=t.next;this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(d,!0)),this.shadowRoot.appendChild(this.view)}}window.customElements.define("toad-menu",p);window.customElements.define("toad-menuentry",class extends HTMLElement{});window.customElements.define("toad-menuspacer",class extends HTMLElement{});class f extends u{constructor(t,e){super(),this.vertical=!0,this.root=t,this.parentButton=e,this.popup=document.createElement("div"),this.popup.classList.add("menu-popup");let o=t.down;for(;o;)o.isAvailable()?o.createWindowAt(this,this.popup):o.deleteWindow(),o=o.next;this.appendChild(this.popup),this.show()}show(){this.parentButton.master.vertical?function(t,e){let o=t.getBoundingClientRect();e.style.opacity="0",e.style.left=o.left+o.width+"px",e.style.top=o.top+"px",setTimeout(function(){let t=e.getBoundingClientRect(),i=o.top+t.height;i>window.innerHeight&&(e.style.top=o.top+o.height-t.height+"px");let n=o.left+o.width+t.width;n>window.innerWidth&&(e.style.left=o.left-t.width+"px"),e.style.opacity="1"},0)}(this.parentButton,this.popup):function(t,e){let o=t.getBoundingClientRect();e.style.opacity="0",e.style.left=o.left+"px",e.style.top=o.top+o.height+"px",setTimeout(function(){let t=e.getBoundingClientRect(),i=o.top+o.height+t.height;i>window.innerHeight&&(e.style.top=o.top-t.height+"px");let n=o.left+t.width;n>window.innerWidth&&(e.style.left=o.left+o.width-t.width+"px"),e.style.opacity="1"},0)}(this.parentButton,this.popup),this.style.display=""}hide(){this.style.display="none"}}window.customElements.define("toad-popupmenu",f);class m extends r.GenericView{constructor(t,e){super(),this.master=t,this.node=e;let o=this;if(this.classList.add("menu-button"),e.down&&(t.vertical?this.classList.add("menu-side"):this.classList.add("menu-down")),this.updateView(),this.onmousedown=(t=>{t.stopPropagation();let e=function(t){document.removeEventListener("mouseup",e,{capture:!0}),t.preventDefault(),setTimeout(()=>{m.buttonDown&&o.dispatchEvent(new MouseEvent("mouseup",t))},0)};if(document.addEventListener("mouseup",e,{capture:!0}),m.buttonDown=!0,!this.master)throw Error("fuck");switch(this.master.state){case a.WAIT:this.master.state=a.DOWN,this.activate();break;case a.UP_N_HOLD:this.master.active!==this?(this.master.state=a.DOWN,this.activate()):this.master.state=a.DOWN_N_HOLD;break;default:throw Error("unexpected state "+this.master.state)}return!1}),this.onmouseup=(t=>{if(t.stopPropagation(),m.buttonDown){if(m.buttonDown=!1,!this.master)throw Error("fuck");if(!this.node)throw Error("fuck");switch(this.master.state){case a.DOWN:this.node.isEnabled()&&!this.node.down?(this.trigger(),this.master.state=a.WAIT):(this.master.state=a.UP_N_HOLD,m.documentMouseDown&&document.removeEventListener("mousedown",m.documentMouseDown,{capture:!1}),m.documentMouseDown=function(t){m.documentMouseDown&&document.removeEventListener("mousedown",m.documentMouseDown,{capture:!1}),m.documentMouseDown=void 0,"TOAD-MENUBUTTON"!==t.target.tagName&&o.collapse()},document.addEventListener("mousedown",m.documentMouseDown,{capture:!1}));break;case a.DOWN_N_HOLD:case a.DOWN_N_OUTSIDE:this.master.state=a.WAIT,this.deactivate(),this.collapse(),this.master.closeOnClose;break;case a.DOWN_N_INSIDE_AGAIN:this.trigger();break;default:throw Error("unexpected state "+this.master.state)}return!1}}),this.onmouseout=(t=>{if(t.stopPropagation(),!this.master)throw Error("fuck");switch(m.inside=void 0,this.master.state){case a.WAIT:case a.DOWN_N_OUTSIDE:case a.UP_N_HOLD:case a.DOWN_N_HOLD:break;case a.DOWN:case a.DOWN_N_INSIDE_AGAIN:this.master.state=a.DOWN_N_OUTSIDE,this.updateView();break;default:throw Error("unexpected state")}return!1}),this.onmouseover=(t=>{if(t.stopPropagation(),!o.master)throw Error("fuck");switch(m.inside=o,o.master.state){case a.WAIT:case a.UP_N_HOLD:case a.DOWN_N_OUTSIDE:case a.DOWN_N_HOLD:case a.DOWN:case a.DOWN_N_INSIDE_AGAIN:if(!m.buttonDown)break;if(!this.master)throw Error("fuck");this.master.active&&this.master.active.deactivate(),this.master.state=a.DOWN_N_INSIDE_AGAIN,this.activate();break;default:throw Error("unexpected state "+o.master.state)}return!1}),this.attachShadow({mode:"open"}),!this.shadowRoot)throw Error("fuck");this.shadowRoot.appendChild(document.importNode(d,!0)),this.node.modelId||this.shadowRoot.appendChild(document.createTextNode(e.label))}connectedCallback(){if(!this.controller){if(void 0===this.node.down){let t=this.node.title;for(let e=this.node.parent;e&&e.title.length;e=e.parent)t=e.title+"|"+t;t="A:"+t,l.globalController.registerView(t,this)}if(void 0!==this.node.modelId){let t="M:"+this.node.modelId;l.globalController.registerView(t,this)}}}disconnectedCallback(){this.controller&&this.controller.unregisterView(this)}setModel(t){if(!t)return this.action&&this.action.modified.remove(this),this.model=void 0,this.action=void 0,void this.updateView();if(t instanceof n.Action)this.action=t,this.action.modified.add(()=>{this.updateView()},this);else{if(!(t instanceof s.TextModel))throw Error("unexpected model of type "+t.constructor.name);this.model=t}this.updateView()}updateModel(){}updateView(){if(this.model&&this.model.value){if(!this.shadowRoot)throw Error("fuck");let t=document.createElement("span");this.model instanceof s.HtmlModel?t.innerHTML=this.model.value:t.innerText=this.model.value,this.shadowRoot.children.length>1&&this.shadowRoot.removeChild(this.shadowRoot.children[1]),this.shadowRoot.children.length>1?this.shadowRoot.insertBefore(t,this.shadowRoot.children[1]):this.shadowRoot.appendChild(t)}if(!this.master)throw Error("fuck");let t=!1;if(this.master.active==this)switch(this.master.state){case a.DOWN:case a.UP_N_HOLD:case a.DOWN_N_HOLD:case a.DOWN_N_INSIDE_AGAIN:t=!0;break;case a.DOWN_N_OUTSIDE:if(!this.node)throw Error("fuck");t=void 0!==this.node.down&&this.node.isEnabled()}this.classList.toggle("active",t),this.classList.toggle("disabled",!this.isEnabled())}isEnabled(){return void 0!==this.node.down||void 0!==this.action&&this.action.enabled}trigger(){this.collapse(),this.action&&this.action.trigger()}collapse(){if(!this.master)throw Error("fuck");this.master.parentButton?this.master.parentButton.collapse():this.deactivate()}openPopup(){if(this.node&&this.node.down){if(!this.shadowRoot)throw Error("fuck");this.popup?this.popup.show():(this.popup=new f(this.node,this),this.shadowRoot.appendChild(this.popup))}}closePopup(){this.popup&&(this.popup.active&&this.popup.active.deactivate(),this.popup.hide())}activate(){if(!this.master)throw Error("fuck");if(!this.node)throw Error("fuck");let t=this.master.active;this.master.active=this,t&&t!==this&&(t.closePopup(),t.updateView()),this.updateView(),this.openPopup()}deactivate(){if(!this.master)throw Error("fuck");this.master.active===this&&(this.master.active.closePopup(),this.master.active=void 0,this.master.state=a.WAIT,this.updateView())}}window.customElements.define("toad-menubutton",m)},"./src/view/slider.ts":
/*!****************************!*\
  !*** ./src/view/slider.ts ***!
  \****************************/
/*! exports provided: SliderView */function(t,e,o){"use strict";o.r(e),o.d(e,"SliderView",function(){return n});var i=o(/*! ../view */"./src/view.ts");class n extends i.GenericView{constructor(){super(),this.input=document.createElement("input"),this.input.type="range";let t=this;this.input.oninput=(()=>{t.updateModel()}),this.attachShadow({mode:"open"}).appendChild(this.input)}updateModel(){this.model&&(this.model.value=Number.parseFloat(this.input.value))}updateView(){this.model&&(this.input.step=String(this.model.step),this.input.min=String(this.model.min),this.input.max=String(this.model.max),this.input.value=String(this.model.value))}}window.customElements.define("toad-slider",n)},"./src/view/table.ts":
/*!***************************!*\
  !*** ./src/view/table.ts ***!
  \***************************/
/*! exports provided: TableEditMode, TablePos, SelectionModel, TableModel, registerTableModelLocator, createTableModel, TableView */function(t,e,o){"use strict";o.r(e),o.d(e,"TableEditMode",function(){return c}),o.d(e,"TablePos",function(){return h}),o.d(e,"SelectionModel",function(){return u}),o.d(e,"TableModel",function(){return p}),o.d(e,"registerTableModelLocator",function(){return m}),o.d(e,"createTableModel",function(){return w}),o.d(e,"TableView",function(){return g});var i=o(/*! ../dom */"./src/dom.ts"),n=o(/*! ../model */"./src/model.ts"),s=o(/*! ../view */"./src/view.ts"),r=o(/*! ./text */"./src/view/text.ts");let l=document.createElement("style");function d(t,e){return function(t){if("px"!==t.substr(t.length-2))throw Error("expected 'px' suffix");return Number.parseFloat(t.substr(0,t.length-2))}(window.getComputedStyle(t,void 0).getPropertyValue(e))}function a(t){return d(t,"padding-left")+d(t,"padding-right")}var c;l.textContent="\n.t2 {\n  /* border: 1px inset; */\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  outline-offset: -2px;\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n}\n\n.t2h, .t2d {\n  border-color: #ccc #fff #fff #ccc;\n  border-width: 2px 0px 0px 2px;\n  border-style: solid none none solid;\n  border-collapse: collapse;\n  border-spacing: 0;\n}\n\n/* FIXME: there is no re-evaluation after the table view was resized */\n/*\nth:last-child, td:last-child {\n  width: 100%;\n}\n*/\n\n.t2h tr {\n  background: #e0e0e0;\n}\n\n.t2h * th {\n  border-color: #fff #ccc #ccc #fff;\n  border-style: none solid none none;\n  border-width: 0 1px 0 0;\n  z-index: 1;\n  letter-spacing: 0;  \n  overflow: hidden;   \n  padding: 2px;\n  margin: 0px; \n  white-space: nowrap;\n}\n \n.t2d * td {\n  border-color: #fff #ccc #ccc #fff;\n  border-style: none solid solid none;\n  border-width: 0 1px 1px 0;\n  letter-spacing: 0;\n  overflow: hidden; \n  padding: 2px;\n  margin: 0px; \n  white-space: nowrap;\n  /* background: #fff; */\n}\n\n.t2d tr:nth-child(even) {\n  background: var(--toad-table-even-row, #f5f5f5);\n}\n.t2d tr:nth-child(odd) {\n  background: var(--toad-table-odd-row, #ffffff);\n}\n\ndiv .t2d tr.selected,\ndiv .t2d tr td.selected {\n/*\n  background: #dcdcdc;\n  color: #000;\n*/\n  background: #808080;\n  color: #fff;\n}\n\n.t2:focus .t2d tr.selected,\n.t2:focus .t2d tr td.selected {\n  background: #0069d4;\n  color: #fff;\n}\n\n",function(t){t[t.EDIT_CELL=0]="EDIT_CELL",t[t.SELECT_CELL=1]="SELECT_CELL",t[t.SELECT_ROW=2]="SELECT_ROW"}(c||(c={}));class h{constructor(t,e){this.col=t,this.row=e}}class u extends n.Model{constructor(){super(),this.mode=c.SELECT_ROW,this._value=new h(0,0)}set col(t){this._value.col!==t&&(this._value.col=t,this.modified.trigger())}get col(){return this._value.col}set row(t){this._value.row!==t&&(this._value.row=t,this.modified.trigger())}get row(){return this._value.row}set value(t){this._value.col===t.col&&this._value.row===t.row||(this._value=t,this.modified.trigger())}get value(){return this._value}}class p extends n.Model{constructor(){super(),this.cols=0,this.rows=0}getColumnHead(t){}getFieldView(t,e){}}let f=new Array;function m(t){f.push(t)}function w(t){for(let e of f){let o=e(t);if(o)return o}throw new Error("findTableModel() failed to locate a table model")}m(function(t){if(t instanceof Array&&0!==t.length&&t[0]instanceof Array){for(let e of t[0])if("string"!=typeof e&&"number"!=typeof e)return;return new class extends p{constructor(t){super(),this.data=t,this.rows=this.data.length,this.cols=this.data[0].length}getColumnHead(t){switch(t){case 0:return new n.TextModel("Title");case 1:return new n.TextModel("Author");case 2:return new n.TextModel("Year")}throw Error("fuck")}getFieldModel(t,e){let o=new n.TextModel(this.data[e][t]);return o.modified.add(()=>{this.data[e][t]=o.value}),o}getFieldView(t,e){return new r.TextView}}(t)}});class g extends s.GenericView{constructor(){super(),this.insideGoTo=!1;let t=i.tag("div");t.className="t2",t.onkeydown=(t=>{if(this.selectionModel)switch(this.selectionModel.mode){case c.SELECT_ROW:{let e=this.selectionModel.value.row;switch(t.key){case"ArrowDown":e+1<this.model.rows&&++e;break;case"ArrowUp":e>0&&--e}e!=this.selectionModel.value.row&&(this.toggleRowSelection(this.selectionModel.value.row,!1),this.selectionModel.row=e,this.toggleRowSelection(this.selectionModel.value.row,!0))}break;case c.SELECT_CELL:{let e={col:this.selectionModel.col,row:this.selectionModel.row};switch(t.key){case"ArrowRight":e.col+1<this.model.cols&&++e.col;break;case"ArrowLeft":e.col>0&&--e.col;break;case"ArrowDown":e.row+1<this.model.rows&&++e.row;break;case"ArrowUp":e.row>0&&--e.row}e.col==this.selectionModel.col&&e.row==this.selectionModel.row||(this.toggleCellSelection(this.selectionModel.value,!1),this.selectionModel.value=e,this.toggleCellSelection(this.selectionModel.value,!0))}}}),this.rootElement=t;let e=i.tag("div");e.style.overflow="hidden";let o=i.tag("table");this.headTable=o,o.className="t2h";let n=i.tag("thead"),s=i.tag("tr");this.headRow=s,n.appendChild(s),o.appendChild(n),e.appendChild(o),t.appendChild(e);let r=i.tag("div");r.style.overflow="auto",r.onscroll=function(){e.scrollLeft=r.scrollLeft},this.bodyDiv=r;let d=i.tag("table");d.className="t2d",d.onmousedown=(t=>{t.srcElement&&"TD"===t.srcElement.tagName&&(t.preventDefault(),this.goToField(t.srcElement))});let a=i.tag("tbody");this.bodyBody=a;let h=i.tag("tr");a.appendChild(h),this.bodyRow=h,d.appendChild(a),r.appendChild(d);let u=i.tag("div");u.style.width="0px",u.style.height="0px",u.style.margin="0",u.style.padding="0",u.style.border="none",this.input=i.tag("div"),this.input.style.position="relative",this.input.style.background="#fff",this.input.style.border="none",this.input.style.opacity="0",this.input.addEventListener("focusin",t=>{if(this.input.style.opacity="1",this.insideGoTo)return;if(!this.model)return;let e=t;e.target&&e.relatedTarget&&(i.order(e.relatedTarget,this)?this.goTo(0,0):this.goTo(this.model.cols-1,this.model.rows-1))}),this.input.addEventListener("focusout",()=>{this.input.style.opacity="0"}),u.appendChild(this.input),r.appendChild(u),t.appendChild(r),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(l,!0)),this.shadowRoot.appendChild(t)}connectedCallback(){super.connectedCallback(),this.bodyDiv.style.height=this.style.height}setModel(t){if(!t)return this.selectionModel&&this.selectionModel.modified.remove(this),this.model=void 0,this.selectionModel=new u,void this.updateView();if(t instanceof u)this.selectionModel=t,this.updateSelection(),this.selectionModel.modified.add(()=>{this.updateSelection()},this);else{if(!(t instanceof p))throw Error("unexpected model of type "+t.constructor.name);this.model=t,this.updateView()}}updateModel(){}updateView(){this.model&&(this.updateHeader(),this.updateBody(),this.updateSelection(),setTimeout(()=>{this.adjustInternalTables()}))}updateHeader(){if(!this.model)throw Error("fuck");let t,e=!1;for(;this.headRow.children.length>this.model.cols+1;)this.headRow.removeChild(this.headRow.children[this.headRow.children.length-1]);for(let t=0;t<this.model.cols;++t){let o;t>=this.headRow.children.length?(o=i.tag("th"),this.headRow.appendChild(o)):((o=this.headRow.children[t]).style.minWidth="",o.style.border="");let s=this.model.getColumnHead(t);void 0!==s?s instanceof n.HtmlModel?o.innerHTML=s.value:o.innerText=s.value:e=!0}this.headRow.children.length<this.model.cols+1?(t=i.tag("th"),this.headRow.appendChild(t)):t=this.headRow.children[this.headRow.children.length-1],t.innerText="",t.style.minWidth="777px",t.style.border="0px none",this.headTable.style.display=e?"none":""}updateBody(){if(!this.model)throw Error("fuck");for(;this.bodyRow.children.length>this.model.cols;)this.bodyRow.removeChild(this.bodyRow.children[this.bodyRow.children.length-1]);for(;this.bodyRow.children.length<this.model.cols;){let t=i.tag("td");t.style.paddingTop="0",t.style.paddingBottom="0",this.bodyRow.appendChild(t)}for(;this.bodyBody.children.length-1>this.model.rows;)this.bodyBody.removeChild(this.bodyBody.children[this.bodyBody.children.length-1]);for(let t=0;t<this.model.rows;++t){let e;for(t+1>=this.bodyBody.children.length?(e=i.tag("tr"),this.bodyBody.appendChild(e)):e=this.bodyBody.children[t+1];e.children.length>this.model.cols;)e.removeChild(e.children[e.children.length-1]);for(let o=0;o<this.model.cols;++o){let s;o>=e.children.length?(s=i.tag("td"),e.appendChild(s)):s=e.children[o],s.style.width="";let r=this.model.getFieldModel(o,t);s.innerText!=r.value&&(r instanceof n.HtmlModel?s.innerHTML=r.value:s.innerText=r.value)}if("100%"===this.style.width){e.children[e.children.length-1].style.width="100%"}}}updateSelection(){if(void 0!==this.selectionModel)switch(this.selectionModel.mode){case c.EDIT_CELL:this.prepareFieldAtPosition(this.selectionModel.col,this.selectionModel.row),delete this.rootElement.tabIndex;break;case c.SELECT_CELL:{let t=this.bodyBody.querySelectorAll("tbody > tr > td.selected");for(let e of t)e.classList.remove("selected");this.toggleCellSelection(this.selectionModel.value,!0),this.rootElement.tabIndex=0;break}case c.SELECT_ROW:{let t=this.bodyBody.querySelectorAll("tbody > tr.selected");for(let e of t)e.classList.remove("selected");this.toggleRowSelection(this.selectionModel.value.row,!0),this.rootElement.tabIndex=0;break}}}adjustInternalTables(){let t=this.headRow.children,e=this.bodyRow.children;for(let o=0;o<this.model.cols;++o){let i=t[o],n=e[o],s=i.clientWidth-a(i),r=n.clientWidth-a(n);i.style.width=i.style.minWidth=i.style.maxWidth=n.style.width=n.style.minWidth=n.style.maxWidth=(s>r?s:r)+"px"}"100%"!==this.style.width&&(this.rootElement.style.width=this.bodyRow.clientWidth+this.bodyDiv.offsetWidth-this.bodyDiv.clientWidth+2+"px")}unadjustInternalTables(t){let e=this.headRow.children,o=this.bodyRow.children,i=e[t.col],n=o[t.col];i.style.width=i.style.minWidth=i.style.maxWidth=n.style.width=n.style.minWidth=n.style.maxWidth=""}toggleCellSelection(t,e){if(t.col>=this.model.cols||t.row>=this.model.rows)return;let o=this.bodyBody.children[t.row+1].children[t.col];o.classList.toggle("selected",e),e&&(o.scrollIntoViewIfNeeded?o.scrollIntoViewIfNeeded():o.scrollIntoView())}toggleRowSelection(t,e){if(t>=this.model.rows)return;let o=this.bodyBody.children[1+this.selectionModel.value.row];o.classList.toggle("selected",e),e&&(o.scrollIntoViewIfNeeded?o.scrollIntoViewIfNeeded():o.scrollIntoView())}adjustInputToElement(t){let e=t.getBoundingClientRect(),o=t,i=o.parentElement.parentElement;navigator.userAgent.indexOf("Chrome")>-1?(this.input.style.left=o.offsetLeft+2+"px",this.input.style.top=o.offsetTop-i.clientHeight+"px"):(this.input.style.left=o.offsetLeft+1+"px",this.input.style.top=o.offsetTop-i.clientHeight-1+"px");let n=t.clientWidth-a(t)+"px";this.input.style.width=n,this.input.style.height=e.height+"px"}goTo(t,e){this.insideGoTo=!0,this.prepareFieldAtPosition(t,e),this.focus(),this.insideGoTo=!1}goToField(t){this.insideGoTo=!0,t&&(this.prepareFieldAtElement(t),this.focus(),this.insideGoTo=!1)}focus(){this.fieldView?this.fieldView.focus():this.rootElement.focus()}prepareFieldAtPosition(t,e){this.prepareFieldAtElement(this.getElementAt(t,e))}getElementAt(t,e){let o=this.bodyBody.children[e+1].children[t];if(!o)throw Error("fuck");return o}prepareFieldAtElement(t){if(void 0===t||"TD"!==t.tagName)return;let e=this.positionOfField(t);if(this.selectionModel)switch(this.selectionModel.mode){case c.EDIT_CELL:this.selectionModel.value=e;break;case c.SELECT_CELL:return this.toggleCellSelection(this.selectionModel.value,!1),this.selectionModel.value=e,void this.toggleCellSelection(this.selectionModel.value,!0);case c.SELECT_ROW:return this.toggleRowSelection(this.selectionModel.value.row,!1),this.selectionModel.value.row=e.row,void this.toggleRowSelection(this.selectionModel.value.row,!0)}let o=this.model.getFieldView(e.col,e.row);if(!o)return;this.fieldView=o,o.classList.add("embedded");let i=this.model.getFieldModel(e.col,e.row);o.setModel(i),o.onblur=(()=>{t.innerText!=i.value&&(t.innerText=i.value,this.unadjustInternalTables(e),setTimeout(()=>{this.adjustInternalTables()},0))}),o.onkeydown=(t=>{switch(t.key){case"ArrowDown":if(e.row+1>=this.model.rows)break;t.preventDefault(),this.goTo(e.col,e.row+1);break;case"ArrowUp":if(0===e.row)break;t.preventDefault(),this.goTo(e.col,e.row-1);break;case"Tab":t.shiftKey?e.col>0?(t.preventDefault(),this.goTo(e.col-1,e.row)):e.row>0&&(t.preventDefault(),this.goTo(this.model.cols-1,e.row-1)):e.col+1<this.model.cols?(t.preventDefault(),this.goTo(e.col+1,e.row)):e.row+1<this.model.rows&&(t.preventDefault(),this.goTo(0,e.row+1))}}),0===this.input.children.length?this.input.appendChild(o):(document.hasFocus()&&document.activeElement===this&&this.input.children[0].dispatchEvent(new FocusEvent("blur")),this.input.replaceChild(o,this.input.children[0])),this.adjustInputToElement(t)}positionOfField(t){let e,o;for(e=0;e<this.model.cols&&t.parentElement.children[e]!==t;++e);for(o=1;o<this.model.rows+1&&t.parentElement.parentElement.children[o]!==t.parentElement;++o);return new h(e,--o)}}window.customElements.define("toad-table",g)},"./src/view/text.ts":
/*!**************************!*\
  !*** ./src/view/text.ts ***!
  \**************************/
/*! exports provided: TextView */function(t,e,o){"use strict";o.r(e),o.d(e,"TextView",function(){return s});var i=o(/*! ../view */"./src/view.ts");let n=document.createElement("style");n.textContent="\ninput {\n/*\n  height: 2.14285714em;\n  line-height: 1.4285714285714;\n  padding: 4px 5px;\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  box-sizing: border-box;\n  margin: 2px;\n  max-width: 250px;\n  vertical-align: baseline;\n  width: 100%;\n  background-color: #fff;\n  color: #333;\n  font-size: 14px;\n*/\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n}\n\n:host(.embedded) input {\n  border: none 0;\n  border-radius: 0;\n  padding: 0;\n  margin: 2px;\n  width: 100%;\n  background: #fff;\n}\n";class s extends i.GenericView{constructor(){super(),this.input=document.createElement("input"),this.input.oninput=(()=>{this.updateModel()}),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(n,!0)),this.shadowRoot.appendChild(this.input)}focus(){this.input.focus()}blur(){this.input.blur()}static get observedAttributes(){return["value"]}attributeChangedCallback(t,e,o){switch(t){case"value":this.model&&void 0!==o&&(this.model.value=o)}}updateModel(){this.model&&(this.model.value=this.input.value),this.setAttribute("value",this.input.value)}updateView(){this.model&&this.input.value!=this.model.value&&(this.input.value=this.model.value),this.setAttribute("value",this.input.value)}get value(){return this.input.value}set value(t){this.input.value=t,this.updateModel()}}window.customElements.define("toad-text",s)}});
//# sourceMappingURL=toad.min.js.map