import{M as t,h as e,A as i,T as s,c as o,N as l,a,j as n,H as h,i as r,d,B as c,k as p,f as u,p as g,m as b,e as x,n as m,s as y,V as f,o as v,q as w,u as C,t as H}from"./main.js";function k(t,e){let i=t.getAttribute(e);if(null===i)throw console.log("missing attribute '"+e+"' in ",t),Error("missing attribute '"+e+"' in "+t.nodeName);return i}function S(t,e){let i=t.getAttribute(e);return null===i?void 0:i}class E{constructor(){this._stop=!1,this._firstFrame=this._firstFrame.bind(this),this._animationFrame=this._animationFrame.bind(this)}start(){this.prepare(),!0!==this._stop&&this.requestAnimationFrame(this._firstFrame)}stop(){this._stop=!0,this.animator?.current===this&&this.animator.clearCurrent()}replace(t){this.next=t,this.animationFrame(1),this.lastFrame(),t.prepare()}prepare(){}firstFrame(){}animationFrame(t){}lastFrame(){}requestAnimationFrame(t){window.requestAnimationFrame(t)}_firstFrame(t){this.startTime=t,this.firstFrame(),this._stop||(this.animationFrame(0),this.requestAnimationFrame(this._animationFrame))}_animationFrame(t){if(this.next)return void this.next._firstFrame(t);let e=E.animationFrameCount>0?(t-this.startTime)/E.animationFrameCount:1;e=e>1?1:e;const i=this.ease(e);this.animationFrame(i),this._stop||(i<1?this.requestAnimationFrame(this._animationFrame.bind(this)):(this.lastFrame(),this.animator&&this.animator._current===this&&this.animator.clearCurrent()))}ease(t){return.5*(1-Math.cos(Math.PI*t))}}E.animationFrameCount=468;class T extends E{constructor(t){super(),this.animation=t}prepare(){this.animation.prepare()}firstFrame(){this.animation.firstFrame()}animationFrame(t){this.animation.animationFrame(t)}lastFrame(){this.animation.lastFrame()}}class A{get current(){if(void 0!==this._current)return this._current instanceof T?this._current.animation:this._current}clearCurrent(){this._current=void 0}run(t){let e;e=t instanceof E?t:new T(t);const i=this._current;if(this._current=e,e.animator=this,i)i.animator=void 0,i.replace(e);else{if(A.halt)return;e.start()}}}A.halt=!1;class B extends t{constructor(t){super(t)}connectedCallback(){if(this.controller)this.updateView();else{try{e.registerView(this.getActionId(),this)}catch(t){}try{e.registerView(this.getModelId(),this)}catch(t){}this.updateView()}}disconnectedCallback(){super.disconnectedCallback(),this.controller&&this.controller.unregisterView(this)}setModel(t){if(!t)return this.model&&this.model.modified.remove(this),this.action&&this.action.modified.remove(this),this.model=void 0,this.action=void 0,void this.updateView();if(t instanceof i)this.action=t,this.action.modified.add((()=>{this.updateView()}),this);else{if(!(t instanceof s))throw Error("unexpected model of type "+t.constructor.name);this.model=t,this.model.modified.add((()=>{this.updateView()}),this)}this.updateView()}setAction(t){if(t instanceof Function){const e=new i(void 0,"");e.signal.add(t),this.setModel(e)}else this.setModel(t)}isEnabled(){return void 0!==this.action&&this.action.enabled}}const R=new CSSStyleSheet;R.replaceSync(o`:host{display:inline-block}.tx-text{width:100%;box-shadow:none;box-sizing:border-box;color:var(--tx-edit-fg-color);background-color:var(--tx-edit-bg-color);outline:0;border-width:var(--tx-border-width);border-style:solid;border-color:var(--tx-border-color);border-radius:var(--tx-border-radius);font-weight:var(--tx-edit-font-weight);font-size:var(--tx-edit-font-size);line-height:18px;padding:4px 8px 4px 8px;text-indent:0;vertical-align:top;margin:0;overflow:visible;text-overflow:ellipsis}.tx-text:hover{border-color:var(--tx-border-color-hover)}.tx-text:disabled{color:var(--tx-fg-color-disabled);background-color:var(--tx-bg-color-disabled);border-color:var(--tx-bg-color-disabled)}.tx-text::placeholder{color:var(--tx-placeholder-fg-color);font-style:italic;font-weight:300}.tx-text:hover::placeholder{color:var(--tx-placeholder-fg-color-hover)}.tx-text:focus{border-color:var(--tx-outline-color)}.tx-text.tx-error{border-color:var(--tx-warning-color)}`);class M extends t{constructor(t){super(t),this.input=document.createElement("input"),this.input.classList.add("tx-text"),this.input.oninput=()=>{this.updateModel()},this.wheel=this.wheel.bind(this),this.input.onwheel=this.wheel,this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[R],this.shadowRoot.appendChild(this.input)}wheel(t){this.model instanceof l&&(t.deltaY>0&&(this.model.decrement(),t.preventDefault()),t.deltaY<0&&(this.model.increment(),t.preventDefault()))}focus(){this.input.focus()}blur(){this.input.blur()}static get observedAttributes(){return["value"]}attributeChangedCallback(t,e,i){if("value"===t)this.model&&void 0!==i&&(this.model.value=i)}updateModel(){this.model&&(this.model.value=this.input.value),this.setAttribute("value",this.input.value)}updateView(){if(!this.model)return;const t=`${this.model.value}`;this.input.value!==t&&(this.input.value=t,this.setAttribute("value",t)),void 0!==this.model.error?this.input.classList.add("tx-error"):this.input.classList.remove("tx-error")}get value(){return this.input.value}set value(t){this.input.value=t,this.updateModel()}}M.define("tx-text",M);const D=new CSSStyleSheet;D.replaceSync(o`svg .fill{fill:var(--tx-gray-700);stroke:var(--tx-gray-700)}svg .stroke{fill:none;stroke:var(--tx-gray-700)}svg .strokeFill{fill:var(--tx-gray-200);stroke:var(--tx-gray-700)}.toolbar button{background:var(--tx-gray-75);color:var(--tx-gray-800);border:1px var(--tx-gray-400);border-style:solid solid solid none;padding:5;margin:0;vertical-align:middle;height:22px}.toolbar button:active:hover{background:linear-gradient(to bottom,var(--tx-gray-600) 0,var(--tx-gray-50) 100%,var(--tx-gray-500) 100%)}.toolbar button.left{border-style:solid;border-radius:3px 0 0 3px}.toolbar button.right{border:1px var(--tx-gray-400);border-style:solid solid solid none;border-radius:0 3px 3px 0}.toolbar button.active{background:linear-gradient(to bottom,var(--tx-gray-600) 0,var(--tx-gray-50) 100%,var(--tx-gray-500) 100%);border:1px var(--tx-global-blue-500) solid;color:var(--tx-gray-900)}div.textarea{font-family:var(--tx-font-family);font-size:var(--tx-font-size);border:1px var(--tx-gray-400) solid;border-radius:3px;margin:2px;padding:4px 5px;outline-offset:-2px}div.textarea h1{font-size:22px;margin:0;padding:4px 0 4px 0}div.textarea h2{font-size:18px;margin:0;padding:4px 0 4px 0}div.textarea h3{font-size:16px;margin:0;padding:4px 0 4px 0}div.textarea h4{font-size:14px;margin:0;padding:4px 0 4px 0}div.textarea div{padding:2px 0 2px 0}`);class N extends t{constructor(){super(),N.texttool=this;let t=a("div",{class:"toolbar"});this.buttonH1=a("button",{class:"left",children:"H1"}),this.buttonH1.onclick=()=>{document.execCommand("formatBlock",!1,"<h1>"),this.update()},t.appendChild(this.buttonH1),this.buttonH2=a("button",{children:"H2"}),this.buttonH2.onclick=()=>{document.execCommand("formatBlock",!1,"<h2>"),this.update()},t.appendChild(this.buttonH2),this.buttonH3=a("button",{children:"H3"}),this.buttonH3.onclick=()=>{document.execCommand("formatBlock",!1,"<h3>"),this.update()},t.appendChild(this.buttonH3),this.buttonH4=a("button",{class:"right",children:"H4"}),this.buttonH4.onclick=()=>{document.execCommand("formatBlock",!1,"<h4>"),this.update()},t.appendChild(this.buttonH4),t.appendChild(document.createTextNode(" ")),this.buttonBold=a("button",{class:"left",children:a("b",{children:"B"})}),this.buttonBold.onclick=()=>{document.execCommand("bold",!1),this.update()},t.appendChild(this.buttonBold),this.buttonItalic=a("button",{children:a("i",{children:"I"})}),this.buttonItalic.onclick=()=>{document.execCommand("italic",!1),this.update()},t.appendChild(this.buttonItalic),this.buttonUnderline=a("button",{children:a("u",{children:"U"})}),this.buttonUnderline.onclick=()=>{document.execCommand("underline",!1),this.update()},t.appendChild(this.buttonUnderline),this.buttonStrikeThrough=a("button",{children:a("strike",{children:"S"})}),this.buttonStrikeThrough.onclick=()=>{document.execCommand("strikeThrough",!1),this.update()},t.appendChild(this.buttonStrikeThrough),this.buttonSubscript=a("button",{children:"x₂"}),this.buttonSubscript.onclick=()=>{document.execCommand("subscript",!1),this.update()},t.appendChild(this.buttonSubscript),this.buttonSuperscript=a("button",{class:"right",children:"x²"}),this.buttonSuperscript.onclick=()=>{document.execCommand("superscript",!1),this.update()},t.appendChild(this.buttonSuperscript),t.appendChild(document.createTextNode(" ")),this.buttonJustifyLeft=a("button",{class:"left",children:n("svg",{viewBox:"0 0 10 9",width:"10",height:"9",children:[a("line",{x1:"0",y1:"0.5",x2:"10",y2:"0.5",class:"stroke"}),a("line",{x1:"0",y1:"2.5",x2:"6",y2:"2.5",class:"stroke"}),a("line",{x1:"0",y1:"4.5",x2:"10",y2:"4.5",class:"stroke"}),a("line",{x1:"0",y1:"6.5",x2:"6",y2:"6.5",class:"stroke"}),a("line",{x1:"0",y1:"8.5",x2:"10",y2:"8.5",class:"stroke"})]})}),this.buttonJustifyLeft.onclick=()=>{document.execCommand("justifyLeft",!1),this.update()},t.appendChild(this.buttonJustifyLeft),this.buttonJustifyCenter=a("button",{children:n("svg",{viewBox:"0 0 10 9",width:"10",height:"9",children:[a("line",{x1:"0",y1:"0.5",x2:"10",y2:"0.5",class:"stroke"}),a("line",{x1:"2",y1:"2.5",x2:"8",y2:"2.5",class:"stroke"}),a("line",{x1:"0",y1:"4.5",x2:"10",y2:"4.5",class:"stroke"}),a("line",{x1:"2",y1:"6.5",x2:"8",y2:"6.5",class:"stroke"}),a("line",{x1:"0",y1:"8.5",x2:"10",y2:"8.5",class:"stroke"})]})}),this.buttonJustifyCenter.onclick=()=>{document.execCommand("justifyCenter",!1),this.update()},t.appendChild(this.buttonJustifyCenter),this.buttonJustifyRight=a("button",{class:"right",children:n("svg",{viewBox:"0 0 10 9",width:"10",height:"9",children:[a("line",{x1:"0",y1:"0.5",x2:"10",y2:"0.5",class:"stroke"}),a("line",{x1:"4",y1:"2.5",x2:"10",y2:"2.5",class:"stroke"}),a("line",{x1:"0",y1:"4.5",x2:"10",y2:"4.5",class:"stroke"}),a("line",{x1:"4",y1:"6.5",x2:"10",y2:"6.5",class:"stroke"}),a("line",{x1:"0",y1:"8.5",x2:"10",y2:"8.5",class:"stroke"})]})}),this.buttonJustifyRight.onclick=()=>{document.execCommand("justifyRight",!1),this.update()},t.appendChild(this.buttonJustifyRight),this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[D],this.shadowRoot.appendChild(t)}update(){this.buttonH1.classList.toggle("active","h1"===document.queryCommandValue("formatBlock")),this.buttonH2.classList.toggle("active","h2"===document.queryCommandValue("formatBlock")),this.buttonH3.classList.toggle("active","h3"===document.queryCommandValue("formatBlock")),this.buttonH4.classList.toggle("active","h4"===document.queryCommandValue("formatBlock")),this.buttonBold.classList.toggle("active",document.queryCommandState("bold")),this.buttonItalic.classList.toggle("active",document.queryCommandState("italic")),this.buttonUnderline.classList.toggle("active",document.queryCommandState("underline")),this.buttonStrikeThrough.classList.toggle("active",document.queryCommandState("strikeThrough")),this.buttonSubscript.classList.toggle("active",document.queryCommandState("subscript")),this.buttonSuperscript.classList.toggle("active",document.queryCommandState("superscript")),this.buttonJustifyLeft.classList.toggle("active",document.queryCommandState("justifyLeft")),this.buttonJustifyCenter.classList.toggle("active",document.queryCommandState("justifyCenter")),this.buttonJustifyRight.classList.toggle("active",document.queryCommandState("justifyRight"))}}N.define("tx-texttool",N);class z extends t{constructor(t){super(t);let e=document.createElement("div");this.content=e,e.classList.add("tx-text"),e.contentEditable="true",e.oninput=t=>{if(this.model instanceof h){let i=t.target.firstChild;i&&3===i.nodeType?document.execCommand("formatBlock",!1,"<div>"):"<br>"===e.innerHTML&&(e.innerHTML="")}this.updateModel()},e.onkeydown=t=>{this.model instanceof h&&(!0===t.metaKey&&"b"===t.key?(t.preventDefault(),document.execCommand("bold",!1),this.updateTextTool()):!0===t.metaKey&&"i"===t.key?(t.preventDefault(),document.execCommand("italic",!1),this.updateTextTool()):!0===t.metaKey&&"u"===t.key?(t.preventDefault(),document.execCommand("underline",!1),this.updateTextTool()):"Tab"===t.key?t.preventDefault():"Enter"===t.key&&!0!==t.shiftKey&&"blockquote"===document.queryCommandValue("formatBlock")&&document.execCommand("formatBlock",!1,"<p>"))},e.onkeyup=()=>{this.updateTextTool()},e.onmouseup=()=>{this.updateTextTool()},this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[R],this.shadowRoot.appendChild(e)}updateTextTool(){void 0!==N.texttool&&N.texttool.update()}updateModel(){this.model&&(this.model.promise=()=>this.model instanceof h?this.content.innerHTML:this.content.innerText)}updateView(){this.model&&(this.model instanceof h?this.content.innerHTML!==this.model.value&&(this.content.innerHTML=this.model.value):this.content.innerText!==this.model.value&&(this.content.innerText=this.model.value))}}z.define("tx-textarea",z);class _ extends t{constructor(t){super(t)}updateView(){void 0!==this.model?this.model instanceof s?this.innerText=this.model.value:this.model instanceof h?this.innerHTML=this.model.value:this.model instanceof l&&(this.innerText=`${this.model.value}`):this.innerText=""}}_.define("tx-display",_);const L=new CSSStyleSheet;var I;L.replaceSync(o`.tx-button{padding:2px 14px 2px 14px;margin:0;color:var(--tx-gray-800);transition:background-color 130ms ease-in-out;background-color:var(--tx-gray-300);border:0 none;height:28px;border-radius:16px;box-shadow:none;font-family:inherit}.tx-button:active,.tx-button:hover{color:var(--tx-gray-900);background-color:var(--tx-gray-400)}.tx-button:hover:active>span{transition:transform 130ms ease-in-out}:host>.tx-button:hover:active{transform:translate(1px,1px)}:host([disabled])>.tx-button:hover:active{transform:translate(0,0)}.tx-button.tx-accent{color:var(--tx-static-white);background-color:var(--tx-static-blue-600)}.tx-button.tx-accent:active,.tx-button.tx-accent:hover{color:var(--tx-static-white);background-color:var(--tx-static-blue-700)}.tx-button.tx-accent:hover:active{color:var(--tx-static-white);background-color:var(--tx-static-blue-500)}.tx-button.tx-negative{color:var(--tx-static-white);background-color:var(--tx-static-red-600)}.tx-button.tx-negative:active,.tx-button.tx-negative:hover{color:var(--tx-static-white);background-color:var(--tx-static-red-700)}.tx-button.tx-negative:hover:active{color:var(--tx-static-white);background-color:var(--tx-static-red-500)}.tx-button.tx-default{color:var(--tx-gray-50);background-color:var(--tx-gray-800)}.tx-button.tx-default:hover,.tx-button.tx-default:hover:active{color:var(--tx-gray-50);background-color:var(--tx-gray-900)}.tx-button.tx-default:active{color:var(--tx-gray-50);background-color:var(--tx-gray-900)}.tx-label{font-weight:700;padding:4px 0 6px 0;align-self:center;justify-self:center;text-align:center}:host([disabled])>.tx-button,:host([disabled])>.tx-button:active{color:var(--tx-fg-color-disabled);background-color:var(--tx-gray-200)}`),function(t){t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=1]="SECONDARY",t[t.ACCENT=2]="ACCENT",t[t.NEGATIVE=3]="NEGATIVE"}(I||(I={}));class $ extends B{constructor(t){switch(super(t),this.button=r(this.label=d()),this.button.classList.add("tx-button"),this.label.classList.add("tx-label"),this.button.onclick=()=>{this.action&&this.action.trigger()},this.getAttribute("variant")){case"primary":this.button.classList.add("tx-default");break;case"secondary":break;case"accent":this.button.classList.add("tx-accent");break;case"negative":this.button.classList.add("tx-negative")}switch(t?.variant){case I.PRIMARY:this.button.classList.add("tx-default");break;case I.SECONDARY:break;case I.ACCENT:this.button.classList.add("tx-accent");break;case I.NEGATIVE:this.button.classList.add("tx-negative")}this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[L],this.shadowRoot.appendChild(this.button)}connectedCallback(){super.connectedCallback(),0===this.children.length&&(this._observer=new MutationObserver(((t,e)=>{void 0!==this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout((()=>{this._timer=void 0,this.updateView()}),100)})),this._observer.observe(this,{childList:!0,subtree:!0,characterData:!0}))}updateView(){this.isConnected&&(this.model&&this.model.value?this.model instanceof h?this.label.innerHTML=this.model.value:this.label.innerText=this.model.value:this.label.innerHTML=this.innerHTML,this.isEnabled()?this.removeAttribute("disabled"):this.setAttribute("disabled","disabled"))}}$.define("tx-button",$);class O extends t{setModel(t){if(void 0!==t&&!(t instanceof c))throw Error("BooleanView.setModel(): model is not of type BooleanModel");super.setModel(t)}updateModel(){this.model&&(this.model.value=this.input.checked)}updateView(){this.model&&this.model.enabled?this.input.removeAttribute("disabled"):this.input.setAttribute("disabled",""),this.model&&(this.input.checked=this.model.value)}}const W=new CSSStyleSheet;W.replaceSync(o`:host(.tx-checkbox){display:inline-block;position:relative;box-shadow:none;box-sizing:border-box;padding:0;margin:2px;border:none 0;height:14px;width:14px}:host(.tx-checkbox)>input{box-sizing:border-box;width:14px;height:14px;outline:0;padding:0;margin:0;border:2px solid;border-radius:2px;border-color:var(--tx-gray-700);color:var(--tx-edit-fg-color);background-color:var(--tx-edit-bg-color);-webkit-appearance:none}:host(.tx-checkbox)>input:focus-visible{outline:2px solid;outline-color:var(--tx-outline-color);outline-offset:2px}:host(.tx-checkbox)>svg{position:absolute;left:2px;top:2px;stroke:none;fill:var(--tx-edit-bg-color);width:10px;height:10px;pointer-events:none}:host(.tx-checkbox)>input:hover{border-color:var(--tx-gray-800)}.tx-checkbox>input:focus{border-color:var(--tx-outline-color)}:host(.tx-checkbox)>input:checked{background-color:var(--tx-gray-700)}:host(.tx-checkbox)>input:hover:checked{background-color:var(--tx-gray-800)}:host(.tx-checkbox)>input:disabled{color:var(--tx-gray-400);border-color:var(--tx-gray-400)}:host(.tx-checkbox)>input:checked:disabled{background-color:var(--tx-gray-400)}`);class F extends O{constructor(t){super(t),this.classList.add("tx-checkbox"),this.input=p(),this.input.type="checkbox",this.updateModel=this.updateModel.bind(this),this.input.onchange=this.updateModel;const e=u(g("M3.5 9.5a.999.999 0 01-.774-.368l-2.45-3a1 1 0 111.548-1.264l1.657 2.028 4.68-6.01A1 1 0 019.74 2.114l-5.45 7a1 1 0 01-.777.386z"));this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.adoptedStyleSheets=[W],this.shadowRoot.replaceChildren(this.input,e)}}F.define("tx-checkbox",F);const V=new CSSStyleSheet;V.replaceSync(o`.tx-search{display:inline-block;position:relative}.tx-search>div{display:inline-flex;position:relative}.tx-search>div>svg{display:block;position:absolute;height:18px;width:18px;top:7px;left:10px;pointer-events:none;overflow:hidden;fill:var(--tx-gray-700)}.tx-search>div>input{box-sizing:border-box;padding:3px 12px 5px 35px;margin:0;border:1px solid var(--tx-gray-400);border-radius:4px;-webkit-appearance:none;outline-offset:-2px;outline:0;width:100%;height:32px;overflow:visible;background:var(--tx-gray-50);color:var(--tx-gray-900);font-weight:var(--tx-edit-font-weight);font-size:var(--tx-edit-font-size);line-height:18px}.tx-search>button{display:inline-flex;position:absolute;box-sizing:border-box;right:0;top:0;bottom:0;width:32px;padding:0;margin:1px;border:none;align-items:center;justify-content:center;overflow:visible;vertical-align:top;cursor:pointer;border-radius:0 4px 4px 0;text-align:center;outline:0;background-color:var(--tx-gray-50);border-radius:0 4px 4px 0}.tx-search>button>svg{display:inline-block;pointer-events:none;height:10px;width:10px;padding:0;margin:0;border:none;fill:var(--tx-gray-700)}.tx-search>div>input:hover{border-color:var(--tx-gray-500)}.tx-search>div>input:focus{border-color:var(--tx-outline-color)}.tx-search>button:focus>svg{fill:var(--tx-outline-color)}.tx-search>div>input:disabled{color:var(--tx-gray-700);background-color:var(--tx-gray-200);border-color:var(--tx-gray-200)}.tx-search>button:disabled{background-color:var(--tx-gray-200)}.tx-search>button:disabled>svg{fill:var(--tx-gray-400)}`);class U extends t{constructor(t){let e,i,s,o;super(t);const l=b(x(e=u(o=g("M33.173 30.215L25.4 22.443a12.826 12.826 0 10-2.957 2.957l7.772 7.772a2.1 2.1 0 002.958-2.958zM6 15a9 9 0 119 9 9 9 0 01-9-9z")),s=p()),r(i=u(g("M6.548 5L9.63 1.917A1.094 1.094 0 008.084.371L5.001 3.454 1.917.37A1.094 1.094 0 00.371 1.917L3.454 5 .37 8.085A1.094 1.094 0 101.917 9.63l3.084-3.083L8.084 9.63a1.094 1.094 0 101.547-1.546z"))));e.setAttributeNS(null,"width","100%"),e.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"transform","scale(0.5, 0.5)"),i.setAttributeNS(null,"width","100%"),i.setAttributeNS(null,"height","100%"),s.type="search",s.placeholder="Search",s.autocomplete="off",l.classList.add("tx-search"),this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[V],this.shadowRoot.appendChild(l)}}U.define("tx-search",U);const P=new CSSStyleSheet;P.replaceSync(o`:host(.tx-switch){display:inline-flex;align-items:flex-start;position:relative;vertical-align:top}:host(.tx-switch)>input{display:inline-block;position:absolute;left:0;top:0;width:100%;height:100%;box-sizing:absolute;margin:0;padding:0;opacity:0;z-index:1}:host(.tx-switch)>span{display:block;position:relative;left:0;top:0;box-sizing:border-box;flex-grow:0;flex-shrink:0;border:0 none;border-radius:7px;width:26px;height:14px;background:var(--tx-gray-300)}:host(.tx-switch)>input:focus-visible+span{outline:2px solid;outline-color:var(--tx-outline-color);outline-offset:2px}:host(.tx-switch)>span:before{display:block;position:absolute;left:0;top:0;width:14px;height:14px;background:var(--tx-gray-75);border:2px solid var(--tx-gray-700);border-radius:7px;content:"";box-sizing:border-box;transition:transform 130ms ease-in-out}:host(.tx-switch)>input:hover+span:before{border-color:var(--tx-gray-900)}:host(.tx-switch)>input:checked+span:before{transform:translateX(calc(100% - 2px))}:host(.tx-switch)>input:checked+span{background:var(--tx-gray-700)}:host(.tx-switch)>input:checked:hover+span{background:var(--tx-gray-900)}:host(.tx-switch)>input:hover+span+label{color:var(--tx-gray-900)}:host(.tx-switch)>input:checked:disabled+span{background:var(--tx-gray-400)}:host(.tx-switch)>input:disabled+span:before{border-color:var(--tx-gray-400)}:host(.tx-switch)>input:disabled+span+label{color:var(--tx-gray-400)}`);class G extends O{constructor(t){super(t),this.classList.add("tx-switch"),this.input=p(),this.input.type="checkbox",this.input.onchange=()=>{this.updateModel()},this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[P],this.shadowRoot.appendChild(this.input),this.shadowRoot.appendChild(d())}}G.define("tx-switch",G);const j=new CSSStyleSheet;j.replaceSync(o`:host(.tx-radio){display:inline-flex;align-items:flex-start;position:relative;vertical-align:top;padding:2px}:host(.tx-radio)>input{display:inline-block;position:absolute;left:0;top:0;width:100%;height:100%;box-sizing:absolute;margin:0;padding:0;opacity:0;z-index:1}:host(.tx-radio)>span{display:block;position:relative;left:0;top:2px;margin-right:3px;box-sizing:border-box;flex-grow:0;flex-shrink:0;border:2px solid var(--tx-gray-700);border-radius:7px;width:14px;height:14px;background:0 0}:host(.tx-radio)>input:focus-visible+span{outline:2px solid;outline-color:var(--tx-outline-color);outline-offset:2px}:host(.tx-radio)>span:before{display:block;position:absolute;left:0;top:0;width:10px;height:10px;background:var(--tx-gray-75);border:2px solid var(--tx-gray-75);border-radius:7px;content:"";box-sizing:border-box;transition:opacity 130ms ease-in-out}:host(.tx-radio)>input:checked+span:before{background:var(--tx-gray-700)}:host(.tx-radio)>input:checked:hover+span:before{background:var(--tx-gray-900)}:host(.tx-radio)>input:hover+span{border-color:var(--tx-gray-900)}:host(.tx-radio)>input:checked:disabled+span:before{background:var(--tx-gray-500)}:host(.tx-radio)>input:disabled+span{border-color:var(--tx-gray-500)}:host(.tx-radio)>input:disabled+span+label{color:var(--tx-gray-500)}`);class J extends t{constructor(t){super(t),this.value=t?.value,this.updateModel=this.updateModel.bind(this),this.updateView=this.updateView.bind(this),this.classList.add("tx-radio"),this.input=p(),this.input.type="radio",this.input.onchange=this.updateModel,this.input.disabled=!0,this.label=m(),this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.adoptedStyleSheets=[j],this.shadowRoot.replaceChildren(this.input,d(),this.label)}updateModel(){this.input.checked&&void 0!==this.model&&(this.model.value=this.value)}updateView(){if(void 0!==this.model){let t=J.radioGroups.get(this.model);void 0===t&&(t=++J.radioGroupCounter,J.radioGroups.set(this.model,t)),this.input.name=`tx-radio-group-${t}`,this.input.value=`${this.model.indexOf(this.value)}`,this.childNodes.length>0?this.label.replaceChildren(y()):this.label.replaceChildren(this.model.labelOf(this.value))}else this.input.name="";this.model&&this.model.enabled&&this.model.isEnabledOf(this.value)?this.input.removeAttribute("disabled"):this.input.setAttribute("disabled",""),this.model&&(this.input.checked=this.model.value===this.value)}}var Y;J.radioGroupCounter=0,J.radioGroups=new WeakMap,J.define("tx-radio",J),function(t){t[t.WAIT=0]="WAIT",t[t.DOWN=1]="DOWN",t[t.UP_N_HOLD=2]="UP_N_HOLD",t[t.DOWN_N_HOLD=3]="DOWN_N_HOLD",t[t.DOWN_N_OUTSIDE=4]="DOWN_N_OUTSIDE",t[t.DOWN_N_INSIDE_AGAIN=5]="DOWN_N_INSIDE_AGAIN"}(Y||(Y={}));class q extends f{constructor(t){super(t),this.vertical=!0,this.closeOnClose=!1,this.state=Y.WAIT}}class X extends q{constructor(t,e){super(),this.vertical=!0,this.root=t,this.parentButton=e,this.popup=document.createElement("div"),this.popup.classList.add("menu-popup");let i=t.down;for(;i;)i.isAvailable()?i.createWindowAt(this,this.popup):i.deleteWindow(),i=i.next;this.appendChild(this.popup),this.show()}show(){this.parentButton.master.vertical?function(t,e){let i=t.getBoundingClientRect();e.style.opacity="0",e.style.left=i.left+i.width+"px",e.style.top=i.top+"px",setTimeout((function(){let t=e.getBoundingClientRect();i.top+t.height>window.innerHeight&&(e.style.top=i.top+i.height-t.height+"px"),i.left+i.width+t.width>window.innerWidth&&(e.style.left=i.left-t.width+"px"),e.style.opacity="1"}),0)}(this.parentButton,this.popup):K(this.parentButton,this.popup),this.style.display=""}hide(){this.style.display="none"}}function K(t,e){let i=t.getBoundingClientRect();e.style.opacity="0",e.style.left=i.left+"px",e.style.top=i.top+i.height+"px",setTimeout((function(){let t=e.getBoundingClientRect();i.top+i.height+t.height>window.innerHeight&&(e.style.top=i.top-t.height+"px"),i.left+t.width>window.innerWidth&&(e.style.left=i.left+i.width-t.width+"px"),e.style.opacity="1"}),0)}f.define("tx-popupmenu",X);const Z=new CSSStyleSheet;Z.replaceSync(o`:host(.tx-combobox){display:inline-flex;align-items:flex-start;position:relative;vertical-align:top}:host(.tx-combobox)>:first-child{box-sizing:border-box;width:100%;height:32px;line-height:30px;overflow:hidden;margin:0;padding:0;vertical-align:top;text-align:left;outline:0;display:inline-block;border:1px solid var(--tx-gray-400);border-radius:4px;background-color:var(--tx-gray-50);color:var(--tx-gray-900);font-weight:var(--tx-edit-font-weight);font-size:var(--tx-edit-font-size)}:host(.tx-combobox)>input:first-child{padding:4px 32px 4px 11px}:host(.tx-combobox)>:first-child>:first-child{padding-left:7px}:host(.tx-combobox)>:first-child::placeholder{color:var(--tx-placeholder-fg-color);font-style:italic;font-weight:300}:host(.tx-combobox)>button{position:absolute;right:0;display:flex;justify-content:center;align-items:center;border-style:none;box-sizing:border-box;overflow:visible;margin:0;text-transform:none;width:32px;height:32px;background-color:var(--tx-gray-75);border-radius:0 4px 4px 0;border:1px solid var(--tx-gray-400)}:host(.tx-combobox)>button>svg{fill:var(--tx-gray-700);transform:rotate(90deg) translate(5px,8px)}:host(.tx-combobox)>:first-child:hover{border-color:var(--tx-gray-500)}:host(.tx-combobox)>button:hover{border-color:var(--tx-gray-500);background-color:var(--tx-gray-50)}:host(.tx-combobox)>button:hover>svg{fill:var(--tx-gray-900)}:host(.tx-combobox)>:first-child:focus{border-color:var(--tx-outline-color)}:host(.tx-combobox)>:first-child:focus+button{border-color:var(--tx-outline-color)}:host(.tx-combobox)>:first-child.tx-disabled{color:var(--tx-gray-700);background-color:var(--tx-gray-200);border-color:var(--tx-gray-200)}:host(.tx-combobox)>:first-child.tx-disabled>*{color:var(--tx-gray-500);background-color:var(--tx-gray-200);border-color:var(--tx-gray-200)}:host(.tx-combobox)>:first-child.tx-disabled+button{background-color:var(--tx-gray-200);border-color:var(--tx-gray-200)}:host(.tx-combobox)>:first-child.tx-disabled+button>svg{fill:var(--tx-gray-400)}:host(.tx-combobox)>:first-child.tx-error{color:var(--tx-warning-color);border-color:var(--tx-warning-color)}:host(.tx-combobox)>:first-child.tx-error+button{border-color:var(--tx-warning-color)}`);const Q=new CSSStyleSheet;Q.replaceSync(o`.tx-popover{background-color:var(--tx-gray-50);border:1px solid var(--tx-gray-400);border-radius:4px;display:inline-flex;flex-direction:column;filter:drop-shadow(rgba(0, 0, 0, .5) 0 1px 4px)}.tx-menu{display:inline-block;padding:0;margin:2px 0 2px 0}.tx-menu>li{cursor:pointer;display:flex;border:none;border-left:2px solid var(--tx-gray-50);margin-right:2px;padding:0;margin:0;font-weight:500;outline:0}.tx-menu>li:first-child{border-top-right-radius:4px;overflow:hidden}.tx-menu>li:last-child{border-bottom-right-radius:4px;overflow:hidden}.tx-menu>li>:first-child{padding:7px 11px 7px 10px}.tx-menu>li:hover{background-color:var(--tx-gray-100);border-color:var(--tx-gray-100)}.tx-menu>li.tx-hover{filter:brightness(1.2);backdrop-filter:brightness(1.2);border-color:var(--tx-gray-100)}.tx-menu>li:focus{border-left-color:var(--tx-outline-color)}.tx-menu>li[role=separator]{display:block;box-sizing:content-box;overflow:visible;cursor:default;height:2px;padding:0;margin:1.5px 7px 1.5px 7px;background-color:var(--tx-gray-100);white-space:pre;list-style-type:none}.tx-menu>li.tx-disabled{color:var(--tx-gray-500)}.tx-menu>li.tx-disabled:hover{background-color:var(--tx-gray-50)}`);class tt extends t{constructor(t){let e;super(t),this.pointerup=this.pointerup.bind(this),this.pointermove=this.pointermove.bind(this),this.pointerdown=this.pointerdown.bind(this),this.wheel=this.wheel.bind(this),this.keydown=this.keydown.bind(this);const i=r(e=u(g("M3 9.95a.875.875 0 01-.615-1.498L5.88 5 2.385 1.547A.875.875 0 013.615.302L7.74 4.377a.876.876 0 010 1.246L3.615 9.698A.872.872 0 013 9.95z")));this.button=i,i.tabIndex=-1,i.style.outline="none",e.style.width="100%",e.style.height="100%",i.onpointerdown=this.pointerdown,i.onpointermove=this.pointermove,i.onpointerup=this.pointerup,this.classList.add("tx-combobox"),this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[Z,Q]}finalize(){this.displayElement.onwheel=this.button.onwheel=this.wheel,this.shadowRoot.replaceChildren(this.displayElement,this.button)}keydown(t){if(t.preventDefault(),this.model)switch(t.key){case"ArrowUp":this.model.prev();break;case"ArrowDown":this.model.next();break;case"Enter":this.togglePopup();break;case"Escape":void 0!==this.popup&&this.close()}}wheel(t){t.preventDefault(),void 0!==this.model&&this.model.enabled&&(this.displayElement.focus(),t.deltaY>0&&this.model.next(),t.deltaY<0&&this.model.prev())}pointerdown(t){t.preventDefault(),void 0!==this.model&&this.model.enabled&&(this.popup?this.close():(this.displayElement.focus(),this.open(),this.button.setPointerCapture(t.pointerId)))}pointermove(t){if(void 0===this.popup)return;let e=this.findMenuItem(t);this.hover!==e&&(this.hover&&this.hover.classList.remove("tx-hover"),this.hover=e,this.hover&&this.hover.classList.add("tx-hover"))}findMenuItem(t){let e=this.shadowRoot.elementFromPoint(t.clientX,t.clientY);for(;e&&("LI"!==e.nodeName||!e.parentElement?.classList.contains("tx-menu")||!e.parentElement?.parentElement?.classList.contains("tx-popover"));)e=e?.parentElement;return e||void 0}pointerup(t){if(this.hover){const t=parseInt(this.hover.dataset.idx);return this.close(),void this.select(t)}const e=this.shadowRoot.elementFromPoint(t.clientX,t.clientY);this.displayElement.contains(e)||this.button.contains(e)||this.close()}togglePopup(){this.popup?this.close():this.open()}open(){this.popup=x(),this.model&&this.popup.replaceChildren(a("ul",{class:"tx-menu","aria-roledescription":"listbox",children:this.model.map(((t,e,i,s)=>{const o=v(i);return o.tabIndex=0,o.ariaRoleDescription="option",o.dataset.idx=`${s}`,o.onpointerdown=t=>{this.button.setPointerCapture(t.pointerId),this.hover=o,t.preventDefault()},o.onkeydown=this.keydown,o}))})),this.popup.classList.add("tx-popover"),this.popup.style.position="fixed",this.popup.style.zIndex="99",this.shadowRoot.appendChild(this.popup),K(this,this.popup),this.focusToItem()}focusToItem(){if(this.popup&&this.model){void 0!==this.model.index&&this.popup.children[0].children[this.model.index].focus()}}close(){this.hover=void 0,void 0!==this.popup&&(this.shadowRoot.removeChild(this.popup),this.popup=void 0,this.displayElement.focus())}select(t){this.model&&(this.model.index=t)}updateView(){this.model&&this.model.enabled?(this.displayElement.classList.remove("tx-disabled"),this.displayElement.removeAttribute("disabled"),this.button.removeAttribute("disabled")):(this.displayElement.classList.add("tx-disabled"),this.displayElement.setAttribute("disabled",""),this.button.setAttribute("disabled","")),void 0!==this.model?.error?this.displayElement.classList.add("tx-error"):this.displayElement.classList.remove("tx-error")}}class et extends tt{constructor(t){super(t),this.displayElement=x(),this.displayElement.tabIndex=0,this.displayElement.style.minWidth="200px",this.displayElement.onpointerdown=this.pointerdown,this.displayElement.onkeydown=this.keydown,this.finalize()}updateView(){super.updateView(),void 0!==this.model&&this.displayElement.replaceChildren(this.model.html),this.focusToItem()}}class it extends tt{constructor(t){super(t),this.textModel=t?.text,this.displayElement=p(),this.displayElement.type="text",this.displayElement.onkeydown=t=>{"Enter"!==t.key&&void 0===this.popup||this.keydown(t)},this.displayElement.oninput=()=>{this.updateModel()},this.finalize()}close(){super.close(),void 0===this.popup&&this.displayElement.focus()}updateModel(){this.model&&("number"==typeof this.model.value?this.model.value=Number.parseFloat(this.displayElement.value):this.model.value=this.displayElement.value),this.textModel&&(this.textModel.value=this.displayElement.value)}updateView(){super.updateView(),void 0!==this.model&&(this.displayElement.value=`${this.model.value}`),this.focusToItem()}}et.define("tx-select",et),it.define("tx-combobox",it);const st=new CSSStyleSheet;function ot(t,e,i){const s=(s,o=(s+t/60)%6)=>i-i*e*Math.max(Math.min(o,4-o,1),0);return{r:s(5),g:s(3),b:s(1)}}function lt(t,e,i){let s=Math.max(t,e,i),o=s-Math.min(t,e,i),l=o&&(s==t?(e-i)/o:s==e?2+(i-t)/o:4+(t-e)/o);return{h:60*(l<0?l+6:l),s:s&&o/s,v:s}}function at(t){const e=function(t,e,i){let s=Math.max(t,e,i),o=s-Math.min(t,e,i),l=1-Math.abs(s+s-o-1),a=o&&(s==t?(e-i)/o:s==e?2+(i-t)/o:4+(t-e)/o);return[60*(a<0?a+6:a),l?o/l:0,(s+s-o)/2]}(t.r/255,t.g/255,t.b/255);return{h:e[0],s:e[1],l:e[2]}}function nt(t){let e,i,s,o,l;return e=(t=t.trim()).match(/^#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/),null!==e?(i=parseInt(e[1],16),s=parseInt(e[2],16),o=parseInt(e[3],16),i=16*i+i,s=16*s+s,o=16*o+o,l=1,{r:i,g:s,b:o,a:l}):(e=t.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/),null!==e?(i=parseInt(e[1],16),s=parseInt(e[2],16),o=parseInt(e[3],16),l=1,{r:i,g:s,b:o,a:l}):(e=t.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/),null!==e?(i=parseInt(e[1]),s=parseInt(e[2]),o=parseInt(e[3]),l=1,{r:i,g:s,b:o,a:l}):(e=t.match(/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/),null!==e?(i=parseInt(e[1]),s=parseInt(e[2]),o=parseInt(e[3]),l=parseInt(e[4]),{r:i,g:s,b:o,a:l}):void 0)))}st.replaceSync(o`:host{position:relative;box-sizing:content-box;display:inline-block}:host(:not([orientation=vertical])){height:4px;width:100%;padding-top:8px;padding-bottom:8px}:host([orientation=vertical]){width:4px;height:100%;padding-left:8px;padding-right:8px}.tx-space{position:absolute;box-sizing:content-box;padding:0;margin:0;border:0}:host(:not([orientation=vertical])) .tx-space{left:8px;right:8px;top:0;bottom:0}:host([orientation=vertical]) .tx-space{left:0;right:0;top:8px;bottom:8px}.tx-rail{background-color:var(--tx-gray-300);position:absolute;display:block;border-radius:2px}:host(:not([orientation=vertical])) .tx-rail{top:50%;width:100%;height:2px;transform:translateY(-50%)}:host([orientation=vertical]) .tx-rail{left:50%;height:100%;width:2px;transform:translateX(-50%)}:host([disabled]) .tx-rail{background-color:var(--tx-gray-100)}:host([disabled]) .tx-track{background-color:var(--tx-gray-100)}:host([disabled]) .tx-thumb{border-color:var(--tx-gray-500)}.tx-track{background-color:var(--tx-gray-700);position:absolute;display:block;border-radius:2px}:host(:not([orientation=vertical])) .tx-track{top:50%;height:2px;transform:translateY(-50%)}:host([orientation=vertical]) .tx-track{left:50%;width:2px;transform:translateX(-50%)}.tx-thumb{border:2px solid var(--tx-gray-700);border-radius:50%;background:var(--tx-gray-75);cursor:pointer;position:absolute;display:flex;width:14px;height:14px;box-sizing:border-box;outline-width:0;border-radius:50%;transform:translate(-50%,-50%)}.tx-thumb:hover{border-color:var(--tx-gray-800)}:host(:not([orientation=vertical])) .tx-thumb{top:50%}:host([orientation=vertical]) .tx-thumb{left:50%}.tx-focus{outline:2px solid;outline-color:var(--tx-outline-color);outline-offset:1px}.tx-thumb>input{border:0;clip:rect(0,0,0,0);width:100%;height:100%;margin:-1px;overflow:hidden;position:absolute;white-space:nowrap;direction:ltr}`);class ht extends t{constructor(t){let e,i,s,o,l;super(t),this.vertical=t?"vertical"===t.orientation:"vertical"===this.getAttribute("orientation"),e=x(i=d(),s=d(),o=d(l=p())),e.classList.add("tx-space"),i.classList.add("tx-rail"),s.classList.add("tx-track"),o.classList.add("tx-thumb"),l.type="range",this.input=l,this.rail=i,this.track=s,this.thumb=o;const a=t?t.minColor:this.getAttribute("minColor"),n=t?t.maxColor:this.getAttribute("maxColor");let h;a&&(this.minColor=nt(a)),n&&(this.maxColor=nt(n)),this.setGradient(),this.updateView(),l.onfocus=()=>{o.classList.add("tx-focus")},l.onblur=()=>{o.classList.remove("tx-focus")},l.oninput=()=>{this.model&&(this.model.value=parseFloat(l.value))},o.onpointerdown=t=>{if(!0!==this.model?.enabled)return;o.setPointerCapture(t.pointerId);const e=parseFloat(l.value),i=this.getBoundingClientRect(),s=parseFloat(l.min),a=parseFloat(l.max);if(this.vertical){const o=a-(t.clientY-i.y)/i.height*(a-s);h=e-o}else{const o=(t.clientX-i.x)/i.width*(a-s)+s;h=e-o}},o.onpointermove=t=>{if(void 0===h)return;t.preventDefault();const e=this.getBoundingClientRect(),i=parseFloat(l.min),s=parseFloat(l.max);let o;o=this.vertical?s-(t.clientY-e.y)/e.height*(s-i):(t.clientX-e.x)/e.width*(s-i)+i+h,o<i&&(o=i),o>s&&(o=s),this.model&&(this.model.value=o)},o.onpointerup=t=>{void 0!==h&&(o.onpointermove(t),h=void 0)},this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.adoptedStyleSheets=[st],this.shadowRoot.replaceChildren(e)}setGradient(){if(this.minColor&&this.maxColor){if(!0===this.model?.enabled){const t=this.vertical?"0deg":"90deg",e=this.minColor,i=this.maxColor;this.rail.style.backgroundImage=`linear-gradient(${t}, rgb(${e.r},${e.g},${e.b}), rgb(${i.r},${i.g},${i.b}))`}else this.rail.style.backgroundImage="";this.track.style.display="none"}}updateModel(){this.model&&(this.model.value=Number.parseFloat(this.input.value))}updateView(){if(this.setGradient(),!this.model)return void this.setAttribute("disabled","disabled");this.model.enabled?this.removeAttribute("disabled"):this.setAttribute("disabled","disabled"),void 0===this.model.step&&void 0!==this.model.min&&void 0!==this.model.max?this.input.step=""+(this.model.max-this.model.min)/100:this.input.step=String(this.model.step),this.input.min=String(this.model.min),this.input.max=String(this.model.max),this.input.value=String(this.model.value);const t=this.model.min,e=this.model.max;let i=(this.model.value-t)/(e-t);if(this.minColor&&this.maxColor)if(!0!==this.model?.enabled)this.thumb.style.backgroundColor="";else{const t=`rgb(${(this.maxColor.r-this.minColor.r)*i+this.minColor.r},${(this.maxColor.g-this.minColor.g)*i+this.minColor.g},${(this.maxColor.b-this.minColor.b)*i+this.minColor.b})`;this.thumb.style.backgroundColor=t}i*=100,this.vertical?(this.track.style.top=100-i+"%",this.track.style.height=`${i}%`,this.thumb.style.top=100-i+"%"):(this.track.style.left="0%",this.track.style.width=`${i}%`,this.thumb.style.left=`${i}%`)}}ht.define("tx-slider",ht);class rt extends f{static focusIn(t){const e=new Map;for(let i=t.parentElement,s=0;null!==i;i=i.parentElement,++s)e.set(i,s);let i,s,o=Number.MAX_SAFE_INTEGER,l=new Array;for(const s of this.allTools.values())if(s.canHandle(t))for(let t=s.parentElement,a=0;null!==t;t=t.parentElement,++a){const a=e.get(t);void 0!==a&&(o<a||(o>a&&(l.length=0),o=a,i=t,l.push(s)))}if(!i)return;const a=rt.getIndex(t,i);let n=Number.MIN_SAFE_INTEGER;for(let t of l){const e=rt.getIndex(t,i);e<a&&e>n&&(n=e,s=t)}this.setActive(s,t)}static getIndex(t,e){void 0===e&&console.trace(`GenericTool.getIndex(${t}, ${e})`);let i=t;for(;i.parentElement!==e;)i=i.parentElement;return Array.from(e.childNodes).indexOf(i)}static setActive(t,e){this.activeTool&&this.activeTool.deactivate(),this.activeTool=t,this.activeView=e,t&&t.activate()}static focusOut(t){this.activeView===t&&this.setActive(void 0,void 0)}connectedCallback(){super.connectedCallback(),rt.allTools.add(this)}disconnectedCallback(){rt.activeTool===this&&rt.setActive(void 0,void 0),rt.allTools.delete(this),super.disconnectedCallback()}}rt.allTools=new Set,window.addEventListener("focusin",(t=>{t.target instanceof rt||(t.relatedTarget instanceof f&&rt.focusOut(t.relatedTarget),t.target instanceof f&&rt.focusIn(t.target))}));const dt=new CSSStyleSheet;dt.replaceSync(o`:host{display:inline-block;overflow:hidden;box-sizing:border-box;border:1px solid #e3dbdb;border-radius:3px;background:#e3dbdb;width:32px;height:32px;margin:0;padding:0}:host([selected]){background:#ac9393}:host([disabled]){opacity:.5}:host([disabled]) img{opacity:.5}`);class ct extends t{constructor(t){super(t),t?(this.setAttribute("value",`${t.value}`),this.setAttribute("img",t.img)):t={value:this.getAttribute("value"),img:this.getAttribute("img")},this.value=t?.value,this.onmousedown=t=>{this.hasAttribute("disabled")||(this.focus(),t.preventDefault(),void 0!==this.model&&(this.model.value=this.value))};let e=document.createElement("img");e.src=t.img,this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.adoptedStyleSheets=[dt],this.shadowRoot.appendChild(e)}connectedCallback(){super.connectedCallback(),void 0===this.model&&this.setAttribute("disabled","")}updateView(){if(void 0===this.model)return this.setAttribute("disabled",""),void this.removeAttribute("selected");this.model.enabled&&this.model.isEnabledOf(this.value)?this.setAttribute("disabled",""):this.removeAttribute("disabled"),this.model.value===this.value?this.setAttribute("selected",""):this.removeAttribute("selected")}}ct.define("tx-toolbutton",ct);class pt extends t{constructor(t){super(t)}updateView(){if(!this.model)return;let t=void 0===this.model.value?"":this.model.value;this.model instanceof h?this.innerHTML=t:this.innerText=t}}pt.define("tx-slot",pt);class ut extends t{constructor(t){super(t)}updateView(){this.model&&(this.style.display=this.model.value?"":"none")}}ut.define("tx-if",ut);const gt=new CSSStyleSheet;gt.replaceSync(o`:host(.menu-button){font-family:var(--tx-font-family);font-size:var(--tx-edit-font-size);font-weight:var(--tx-edit-font-weight);padding:7px;vertical-align:center;background:var(--tx-gray-200);color:var(--tx-gray-900);cursor:default}:host(.menu-button:hover){background:var(--tx-gray-300)}:host(.menu-button.active){background:var(--tx-gray-400);color:var(--tx-gray-900)}:host(.menu-button.disabled){color:var(--tx-gray-500)}:host(.menu-button.active.disabled){color:var(--tx-gray-700)}:host(.menu-button.menu-down){padding-right:20px;background-image:url("data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14"><path d="M 0 4 l 10 0 l -5 5 Z" fill="#fff" stroke="none"/></svg>')}");background-repeat:no-repeat;background-position:right center}:host(.menu-button.active.menu-down){background-image:url("data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14"><path d="M 0 4 l 10 0 l -5 5 Z" fill="#fff" stroke="none"/></svg>')}");background-repeat:no-repeat;background-position:right center}:host(.menu-button.menu-side){padding-right:20px;background-image:url("data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14"><path d="M 0 2 l 0 10 l 5 -5 Z" fill="#fff" stroke="none"/></svg>')}");background-repeat:no-repeat;background-position:right center}:host(.menu-button.active.menu-side){background-image:url("data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14"><path d="M 0 2 l 0 10 l 5 -5 Z" fill="#fff" stroke="none"/></svg>')}");background-repeat:no-repeat;background-position:right center}.menu-bar{display:flex;flex-direction:row;justify-content:flex-start;align-items:center;background-color:var(--tx-gray-200)}.menu-popup{position:fixed;display:flex;flex-direction:column;box-shadow:2px 2px 5px var(--tx-gray-50)}`);class bt extends t{constructor(t,e){super(),this.master=t,this.node=e;let i=this;if(this.classList.add("menu-button"),e.down&&(t.vertical?this.classList.add("menu-side"):this.classList.add("menu-down")),this.updateView(),this.onmousedown=t=>{t.stopPropagation();let e=function(t){document.removeEventListener("mouseup",e,{capture:!0}),t.preventDefault(),setTimeout((()=>{bt.buttonDown&&i.dispatchEvent(new MouseEvent("mouseup",t))}),0)};if(document.addEventListener("mouseup",e,{capture:!0}),bt.buttonDown=!0,!this.master)throw Error("yikes");switch(this.master.state){case Y.WAIT:this.master.state=Y.DOWN,this.activate();break;case Y.UP_N_HOLD:this.master.active!==this?(this.master.state=Y.DOWN,this.activate()):this.master.state=Y.DOWN_N_HOLD;break;default:throw Error("unexpected state "+this.master.state)}return!1},this.onmouseup=t=>{if(t.stopPropagation(),bt.buttonDown){if(bt.buttonDown=!1,!this.master)throw Error("yikes");if(!this.node)throw Error("yikes");switch(this.master.state){case Y.DOWN:this.node.isEnabled()&&!this.node.down?(this.trigger(),this.master.state=Y.WAIT):(this.master.state=Y.UP_N_HOLD,bt.documentMouseDown&&document.removeEventListener("mousedown",bt.documentMouseDown,{capture:!1}),bt.documentMouseDown=function(t){bt.documentMouseDown&&document.removeEventListener("mousedown",bt.documentMouseDown,{capture:!1}),bt.documentMouseDown=void 0,"TOAD-MENUBUTTON"!==t.target.tagName&&i.collapse()},document.addEventListener("mousedown",bt.documentMouseDown,{capture:!1}));break;case Y.DOWN_N_HOLD:case Y.DOWN_N_OUTSIDE:this.master.state=Y.WAIT,this.deactivate(),this.collapse(),this.master.closeOnClose;break;case Y.DOWN_N_INSIDE_AGAIN:this.trigger();break;default:throw Error("unexpected state "+this.master.state)}return!1}},this.onmouseout=t=>{if(t.stopPropagation(),!this.master)throw Error("yikes");switch(bt.inside=void 0,this.master.state){case Y.WAIT:case Y.DOWN_N_OUTSIDE:case Y.UP_N_HOLD:case Y.DOWN_N_HOLD:break;case Y.DOWN:case Y.DOWN_N_INSIDE_AGAIN:this.master.state=Y.DOWN_N_OUTSIDE,this.updateView();break;default:throw Error("unexpected state")}return!1},this.onmouseover=t=>{if(t.stopPropagation(),!i.master)throw Error("yikes");switch(bt.inside=i,i.master.state){case Y.WAIT:case Y.UP_N_HOLD:case Y.DOWN_N_OUTSIDE:case Y.DOWN_N_HOLD:case Y.DOWN:case Y.DOWN_N_INSIDE_AGAIN:if(!bt.buttonDown)break;if(!this.master)throw Error("yikes");this.master.active&&this.master.active.deactivate(),this.master.state=Y.DOWN_N_INSIDE_AGAIN,this.activate();break;default:throw Error("unexpected state "+i.master.state)}return!1},this.attachShadow({mode:"open"}),!this.shadowRoot)throw Error("yikes");this.shadowRoot.adoptedStyleSheets=[gt],this.node.modelId||this.shadowRoot.appendChild(document.createTextNode(e.label))}connectedCallback(){if(!this.controller){if(void 0===this.node.down){let t=this.node.title;for(let e=this.node.parent;e&&e.title.length;e=e.parent)t=e.title+"|"+t;t="A:"+t,e.registerView(t,this)}if(void 0!==this.node.modelId)if("string"==typeof this.node.modelId){let t="M:"+this.node.modelId;e.registerView(t,this)}else this.setModel(this.node.modelId)}}disconnectedCallback(){this.controller&&this.controller.unregisterView(this)}setModel(t){if(!t)return this.action&&this.action.modified.remove(this),this.model=void 0,this.action=void 0,void this.updateView();if(t instanceof i)this.action=t,this.action.modified.add((()=>{this.updateView()}),this);else{if(!(t instanceof s))throw Error("unexpected model of type "+t.constructor.name);this.model=t}this.updateView()}updateView(){if(this.model&&this.model.value){if(!this.shadowRoot)throw Error("yikes");let t=document.createElement("span");this.model instanceof h?t.innerHTML=this.model.value:t.innerText=this.model.value,this.shadowRoot.children.length>1&&this.shadowRoot.removeChild(this.shadowRoot.children[1]),this.shadowRoot.children.length>1?this.shadowRoot.insertBefore(t,this.shadowRoot.children[1]):this.shadowRoot.appendChild(t)}if(!this.master)throw Error("yikes");let t=!1;if(this.master.active==this)switch(this.master.state){case Y.DOWN:case Y.UP_N_HOLD:case Y.DOWN_N_HOLD:case Y.DOWN_N_INSIDE_AGAIN:t=!0;break;case Y.DOWN_N_OUTSIDE:if(!this.node)throw Error("yikes");t=void 0!==this.node.down&&this.node.isEnabled()}this.classList.toggle("active",t),this.classList.toggle("disabled",!this.isEnabled())}isEnabled(){return void 0!==this.node.down||void 0!==this.action&&this.action.enabled}trigger(){this.collapse(),this.action&&this.action.trigger()}collapse(){if(!this.master)throw Error("yikes");this.master.parentButton?this.master.parentButton.collapse():this.deactivate()}openPopup(){if(this.node&&this.node.down){if(!this.shadowRoot)throw Error("yikes");this.popup?this.popup.show():(this.popup=new X(this.node,this),this.shadowRoot.appendChild(this.popup))}}closePopup(){this.popup&&(this.popup.active&&this.popup.active.deactivate(),this.popup.hide())}activate(){if(!this.master)throw Error("yikes");if(!this.node)throw Error("yikes");let t=this.master.active;this.master.active=this,t&&t!==this&&(t.closePopup(),t.updateView()),this.updateView(),this.openPopup()}deactivate(){if(!this.master)throw Error("yikes");this.master.active===this&&(this.master.active.closePopup(),this.master.active=void 0,this.master.state=Y.WAIT,this.updateView())}}bt.define("tx-menubutton",bt);class xt{constructor(t,e,i,s,o){this.title=t,this.label=e,this.shortcut=i,this.type=s||"entry",this.modelId=o}isEnabled(){return!0}isAvailable(){return!0}createWindowAt(t,e){if("spacer"==this.type){let t=document.createElement("span");return t.style.flexGrow="1",void e.appendChild(t)}this.view=new bt(t,this),e.appendChild(this.view)}deleteWindow(){}}class mt extends q{constructor(t){super(t),this.config=t?.config,this.vertical=!1,this.root=new xt("","",void 0,void 0)}connectedCallback(){if(super.connectedCallback(),this.tabIndex=0,this.config)return this.config2nodes(this.config,this.root),this.referenceActions(),void this.createShadowDOM();0===this.children.length?(this._observer=new MutationObserver(((t,e)=>{void 0!==this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout((()=>{this._timer=void 0,this.layout2nodes(this.children,this.root),this.referenceActions(),this.createShadowDOM()}),100)})),this._observer.observe(this,{childList:!0,subtree:!0})):(this.layout2nodes(this.children,this.root),this.referenceActions(),this.createShadowDOM())}layout2nodes(t,e){let i=e.down;for(let s of t){let t;switch(s.nodeName){case"TX-MENUSPACER":t=new xt("","","","spacer");break;case"TX-MENUENTRY":t=new xt(k(s,"name"),k(s,"label"),S(s,"shortcut"),S(s,"type"),S(s,"model"))}if(t&&(t.parent=e,i?i.next=t:e.down=t,i=t),!i)throw Error("yikes");this.layout2nodes(s.children,i)}}config2nodes(t,e){let i=e.down;for(let s of t){let t;if(t=!0===s.space?new xt("","","","spacer"):new xt(s.name,s.label,s.shortcut,s.type,s.model),t&&(t.parent=e,i?i.next=t:e.down=t,i=t),!i)throw Error("yikes");s.sub&&this.config2nodes(s.sub,i)}}referenceActions(){}findNode(t,e){let i=t.indexOf("|"),s=-1==i?t:t.substr(0,i),o=-1==i?"":t.substr(i+1);e||(e=this.root);for(let t=e.down;t;t=t.next)if(t.title==s)return t.down?this.findNode(o,t):t}createShadowDOM(){this.view=document.createElement("div"),this.view.classList.add("menu-bar");let t=this.root.down;for(;t;)t.isAvailable()?t.createWindowAt(this,this.view):t.deleteWindow(),t=t.next;this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[gt],this.shadowRoot.appendChild(this.view)}}mt.define("tx-menu",mt);class yt extends HTMLElement{}f.define("tx-menuspacer",yt);class ft extends w{isEmpty(){return 0===this.colCount&&0===this.rowCount}}var vt,wt,Ct;!function(t){t[t.EDIT_CELL=0]="EDIT_CELL",t[t.SELECT_CELL=1]="SELECT_CELL",t[t.SELECT_ROW=2]="SELECT_ROW"}(vt||(vt={}));class Ht{constructor(t,e){this.col=t,this.row=e}toString(){return`TablePos { col:${this.col}, row:${this.row} }`}}class kt extends w{constructor(t=vt.EDIT_CELL){super(),this.mode=t,this._value=new Ht(0,0)}set col(t){this._value.col!==t&&(this._value.col=t,this.modified.trigger())}get col(){return this._value.col}set row(t){this._value.row!==t&&(this._value.row=t,this.modified.trigger())}get row(){return this._value.row}set value(t){this._value.col===t.col&&this._value.row===t.row||(this._value=t,this.modified.trigger())}get value(){return this._value}toString(){return`SelectionModel {enabled: ${this.enabled}, mode: ${vt[this.mode]}, value: ${this._value}}`}}class St extends ft{constructor(t,e){super(),this.nodeClass=t}}!function(t){t[t.EDIT_ON_FOCUS=0]="EDIT_ON_FOCUS",t[t.EDIT_ON_ENTER=1]="EDIT_ON_ENTER"}(wt||(wt={}));class Et{constructor(){this.editMode=wt.EDIT_ON_FOCUS,this.seamless=!1,this.expandColumn=!1,this.expandRow=!1}}class Tt{constructor(t){this.config=new Et,this.model=t}get colCount(){return void 0===this.model?0:this.model.colCount}get rowCount(){return void 0===this.model?0:this.model.rowCount}getColumnHead(t){}getRowHead(t){}showCell(t,e){}saveCell(t,e){}editCell(t,e){}isViewCompact(){return!1}static register(t,e,i){let s=Tt.modelToAdapter.get(e);if(void 0===s&&(s=new Map,Tt.modelToAdapter.set(e,s)),void 0!==i){if(s.has(i))throw Error("attempt to redefine existing table adapter");s.set(i,t)}else{if(s.has(null))throw Error("attempt to redefine existing table adapter");s.set(null,t)}}static unbind(){Tt.modelToAdapter.clear()}static lookup(t){let e;e=t instanceof St?t.nodeClass:null;const i=Tt.modelToAdapter.get(Object.getPrototypeOf(t).constructor);let s=i?.get(e);if(void 0===s)for(let i of Tt.modelToAdapter.keys())if(t instanceof i){s=Tt.modelToAdapter.get(i)?.get(e);break}if(void 0===s){let i=`TableAdapter.lookup(): Did not find an adapter for model of type ${t.constructor.name}`;if(i+=`\n    Requested adapter: model=${t.constructor.name}, type=${e?.name}\n    Available adapters:`,0===Tt.modelToAdapter.size)i+=" none.";else for(const[t,e]of Tt.modelToAdapter)for(const[s,o]of e)i+=`\n        model=${t.name}`,null!=s&&(i+=`, type=${s.name}`);throw Error(i)}return s}}Tt.modelToAdapter=new Map,function(t){t[t.INSERT_ROW=0]="INSERT_ROW",t[t.REMOVE_ROW=1]="REMOVE_ROW",t[t.INSERT_COL=2]="INSERT_COL",t[t.REMOVE_COL=3]="REMOVE_COL",t[t.CELL_CHANGED=4]="CELL_CHANGED",t[t.RESIZE_ROW=5]="RESIZE_ROW",t[t.RESIZE_COL=6]="RESIZE_COL",t[t.CHANGED=7]="CHANGED"}(Ct||(Ct={}));class At{constructor(t){this.table=t}get adapter(){return this.table.adapter}get root(){return this.table.root}get measure(){return this.table.measure}getStaging(){const t=this.table.animator;if(void 0===t.current)return;return t.current.bodyStaging}getHeadStaging(){const t=this.table.animator;if(void 0===t.current)return;return t.current.headStaging}get body(){return this.table.body}get splitBody(){return this.table.splitBody}get colHeads(){return this.table.colHeads}set colHeads(t){this.table.colHeads=t}get rowHeads(){return this.table.rowHeads}set rowHeads(t){this.table.rowHeads=t}get colResizeHandles(){return this.table.colResizeHandles}set colResizeHandles(t){this.table.colResizeHandles=t}get rowResizeHandles(){return this.table.rowResizeHandles}set rowResizeHandles(t){this.table.rowResizeHandles=t}set animationDone(t){this.table.animationDone=t}get selection(){return this.table.selection}get style(){return this.table.style}setCellSize(t,e,i,s,o){this.table.setCellSize(t,e,i,s,o)}clearAnimation(){this.table.animation=void 0}}class Bt extends At{constructor(t){super(t)}prepareStagingWithRows(){this.prepareBodyStaging(),this.prepareRowHeadStaging(),this.table.addStaging(this.bodyStaging,this.headStaging),this.scrollStaging()}prepareStagingWithColumns(){this.prepareBodyStaging(),this.prepareColHeadStaging(),this.table.addStaging(this.bodyStaging,this.headStaging),this.scrollStaging()}prepareBodyStaging(){this.bodyStaging=x(),this.bodyStaging.className="staging",this.bodyStaging.style.left=this.body.style.left,this.bodyStaging.style.top=this.body.style.top}prepareRowHeadStaging(){void 0!==this.rowHeads&&(this.headStaging=x(),this.headStaging.classList.add("staging"),this.headStaging.style.top=this.rowHeads.style.top,this.headStaging.style.width=this.rowHeads.style.width)}prepareColHeadStaging(){void 0!==this.colHeads&&(this.headStaging=x(),this.headStaging.classList.add("staging"),this.headStaging.classList.add("colHack"),this.headStaging.style.left=this.colHeads.style.left,this.headStaging.style.height=this.colHeads.style.height)}disposeStaging(){this.table.removeStaging(this.bodyStaging,this.headStaging)}scrollStaging(){}makeRowMask(t,e){const i=d();return i.style.boxSizing="content-box",i.style.top=`${t}px`,i.style.height=`${e}px`,i.style.left="0",i.style.right="0",i.style.border="none",i.style.backgroundColor=qt.maskColor,i}makeColumnMask(t,e){const i=d();return i.style.boxSizing="content-box",i.style.left=`${t}px`,i.style.width=`${e}px`,i.style.top="0",i.style.bottom="0",i.style.border="none",i.style.backgroundColor=qt.maskColor,i}}class Rt extends Bt{constructor(t,e){super(t),this.done=!1,this.event=e}prepare(){this.prepareCellsToBeMeasured(),this.prepareStaging()}firstFrame(){this.arrangeInStaging(),this.split()}animationFrame(t){this.animate(this.animationStart+t*this.totalSize)}lastFrame(){this.animate(this.animationStart+this.totalSize),this.join(),this.disposeStaging()}join(){this.done||(this.done=!0,this.joinHeader(),this.joinBody(),this.table.animationDone&&this.table.animationDone())}}class Mt extends Rt{constructor(t,e){super(t,e),this.join=this.join.bind(this),this.initialRowCount=this.adapter.rowCount-e.size,Mt.current=this}prepareStaging(){this.prepareStagingWithRows()}animate(t){this.splitBody.style.top=`${t}px`,this.mask.style.top=`${t}px`,void 0!==this.rowHeads&&(this.splitHead.style.top=`${t}px`,this.headMask.style.top=`${t}px`)}prepareCellsToBeMeasured(){this.table.prepareMinCellSize();let t=new Array(this.event.size);for(let e=this.event.index;e<this.event.index+this.event.size;++e){const i=this.adapter.getRowHead(e);void 0===this.rowHeads&&void 0!==i&&(this.rowHeads=x(),this.rowHeads.className="rows",this.root.appendChild(this.rowHeads),this.rowResizeHandles=x(),this.rowResizeHandles.className="rows",this.root.appendChild(this.rowResizeHandles)),t[e-this.event.index]=i}if(void 0!==this.rowHeads)for(let e=0;e<this.event.size;++e){const i=d(t[e]);i.className="head",this.measure.appendChild(i)}if(void 0===this.colHeads&&this.adapter.colCount===this.event.size){let t=new Array(this.adapter.colCount);for(let e=0;e<this.adapter.colCount;++e){const i=this.adapter.getColumnHead(e);void 0===this.colHeads&&void 0!==i&&(this.colHeads=x(),this.colHeads.className="cols",this.root.appendChild(this.colHeads),this.colResizeHandles=x(),this.colResizeHandles.className="cols",this.root.appendChild(this.colResizeHandles)),t[e]=i}if(void 0!==this.colHeads)for(let e=0;e<this.adapter.colCount;++e){const i=d(t[e]);i.className="head",this.measure.appendChild(i)}}for(let t=this.event.index;t<this.event.index+this.event.size;++t)for(let e=0;e<this.adapter.colCount;++e){const i=this.table.createCell();this.table.showCell(new Ht(e,t),i),this.measure.appendChild(i)}}arrangeInStaging(){this.table.calculateMinCellSize();const t=this.adapter.config.seamless?0:1;let e=0,i=this.event.index*this.adapter.colCount;if(0!==this.body.children.length)if(i<this.body.children.length){e=Jt(this.body.children[i].style.top)}else{let i=this.body.children[this.body.children.length-1],s=i.getBoundingClientRect();e=Jt(i.style.top)+s.height-t}let s=new Array(this.adapter.colCount);if(this.body.children.length>0)for(let t=0;t<this.adapter.colCount;++t){const e=this.body.children[t].getBoundingClientRect();s[t]=e.width,this.adapter.config.seamless&&(s[t]+=2)}else s.fill(this.table.minCellWidth);let o=this.table.minCellWidth;if(this.rowHeads&&this.rowHeads.children.length>0){const t=this.rowHeads.children[0].getBoundingClientRect();o=Math.max(o,t.width),this.adapter.config.seamless&&(o+=2)}let l=new Array(this.event.size);if(l.fill(this.table.minCellHeight),this.totalSize=0,i=0,void 0!==this.rowHeads)for(let t=0;t<this.event.size;++t){const e=this.measure.children[i++].getBoundingClientRect();l[t]=Math.max(l[t],e.height),o=Math.max(o,e.width)}o=Math.ceil(o);let a=0;if(void 0!==this.colHeads&&0===this.colHeads.children.length&&this.adapter.rowCount==this.event.size){a=this.table.minCellHeight;for(let t=0;t<this.adapter.colCount;++t){const e=this.measure.children[i++].getBoundingClientRect();s[t]=Math.max(s[t],e.width-this.table.WIDTH_ADJUST),a=Math.max(a,e.height-this.table.HEIGHT_ADJUST)}}else if(void 0!==this.colHeads){a=this.colHeads.children[0].getBoundingClientRect().height-this.table.HEIGHT_ADJUST}a=Math.ceil(a),this.rowHeads&&(this.rowHeads.style.top=0===a?"0px":a+this.table.HEIGHT_ADJUST-t+"px",this.rowHeads.style.bottom="0px",this.rowHeads.style.width=`${o}px`,this.body.style.left=o-t+"px",this.bodyStaging.style.left=o-t+"px");for(let e=0;e<this.event.size;++e){for(let t=0;t<this.adapter.colCount;++t){const o=this.measure.children[i++].getBoundingClientRect();l[e]=Math.max(l[e],o.height),this.adapter.config.expandColumn?s[t]=Math.ceil(Math.max(s[t],o.width)):0===e&&0===this.body.children.length&&(s[t]=Math.ceil(o.width))}this.totalSize+=l[e]-t}if(this.adapter.config.expandColumn){i=0;let e=0,o=0;for(;i<this.body.children.length;){const l=this.body.children[i];l.style.left=`${e}px`,l.style.width=s[o]-this.table.WIDTH_ADJUST+"px",e+=s[o]-t,this.adapter.config.seamless&&(e-=2),++o,++i,o>=this.adapter.colCount&&(e=0,o=0)}}this.totalSize+=t,this.adapter.config.seamless&&(this.totalSize-=2*this.event.size);let n=e;if(void 0!==this.rowHeads)for(let e=0;e<this.event.size;++e){const i=this.measure.children[0];this.setCellSize(i,0,n,o,l[e]),this.headStaging.appendChild(i),n+=l[e]-t,this.adapter.config.seamless&&(n-=2)}if(void 0!==this.colHeads&&0===this.colHeads.children.length&&this.adapter.rowCount==this.event.size){let e=0;for(let i=0;i<this.adapter.colCount;++i){const o=this.measure.children[0];o.style.left=`${e}px`,o.style.width=s[i]-this.table.WIDTH_ADJUST+"px",o.style.height=`${a}px`,this.colHeads.appendChild(o),e+=s[i]-t}a+=this.table.HEIGHT_ADJUST,this.body.style.top=a-t+"px",this.bodyStaging.style.top=a-t+"px",this.headStaging.style.top=a-t+"px",this.rowHeads.style.top=a-t+"px",this.colHeads.style.left=o-t+"px",this.colHeads.style.right="0px",this.colHeads.style.height=`${a}px`}n=e;for(let e=0;e<this.event.size;++e){let i=0;for(let o=0;o<this.adapter.colCount;++o){const a=this.measure.children[0];this.setCellSize(a,i,n,s[o],l[e]),this.bodyStaging.appendChild(a),i+=s[o]-t,this.adapter.config.seamless&&(i-=2)}n+=l[e]-t,this.adapter.config.seamless&&(n-=2)}if(this.mask=this.makeRowMask(e,this.totalSize),this.bodyStaging.appendChild(this.mask),void 0!==this.rowHeads&&(this.headMask=this.makeRowMask(e,this.totalSize),this.headStaging.appendChild(this.headMask)),0!==this.initialRowCount){const t=this.adapter.config.seamless?0:1;this.totalSize-=t}}split(){this.table.splitHorizontalNew(this.event.index),void 0!==this.rowHeads&&(this.splitHead=this.rowHeads.lastElementChild),this.animationStart=Jt(this.splitBody.style.top)}joinHeader(){if(void 0!==this.rowHeads){for(this.headStaging.removeChild(this.headMask),this.rowHeads.removeChild(this.splitHead);this.headStaging.children.length>0;)this.rowHeads.appendChild(this.headStaging.children[0]);if(this.splitHead.children.length>0){let t=Jt(this.splitHead.style.top);for(;this.splitHead.children.length>0;){const e=this.splitHead.children[0];e.style.top=`${Jt(e.style.top)+t}px`,this.rowHeads.appendChild(e)}}}}joinBody(){for(this.bodyStaging.removeChild(this.mask),this.body.removeChild(this.splitBody);this.bodyStaging.children.length>0;)this.body.appendChild(this.bodyStaging.children[0]);if(this.splitBody.children.length>0){let t=Jt(this.splitBody.style.top);for(;this.splitBody.children.length>0;){const e=this.splitBody.children[0];e.style.top=`${Jt(e.style.top)+t}px`,this.body.appendChild(e)}}}}class Dt extends Bt{constructor(t,e){if(super(t),this.event=e,this.joinHorizontal=this.joinHorizontal.bind(this),0===this.body.children.length)this.initialHeight=0;else{const t=this.body.children[this.body.children.length-1],e=Jt(t.style.top),i=t.getBoundingClientRect();this.initialHeight=e+i.height}this.overlap=this.adapter.config.seamless?0:1,this.removeAll=this.event.index>=this.adapter.rowCount,Dt.current=this}prepare(){this.prepareStagingWithRows(),this.arrangeRowsInStaging(),this.splitHorizontal()}firstFrame(){}animationFrame(t){this.splitBody.style.top=this.topSplitBody-t*this.animationHeight+"px",this.mask.style.top=this.topMask-t*this.animationHeight+"px",void 0!==this.rowHeads&&(this.splitHead.style.top=this.topSplitBody-t*this.animationHeight+"px",this.headMask.style.top=this.topMask-t*this.animationHeight+"px")}lastFrame(){this.joinHorizontal(),this.disposeStaging()}arrangeRowsInStaging(){const t=this.event.index*this.adapter.colCount,e=this.event.size*this.adapter.colCount,i=Jt(this.body.children[t].style.top);for(let i=0;i<e;++i)this.bodyStaging.appendChild(this.body.children[t]);let s;if(t<this.body.children.length)s=Jt(this.body.children[t].style.top);else{const t=this.bodyStaging.children[this.bodyStaging.children.length-1];s=Jt(t.style.top)+Jt(t.style.height)+this.table.HEIGHT_ADJUST}if(this.animationHeight=s-i,this.mask=this.makeRowMask(s,this.animationHeight),this.bodyStaging.appendChild(this.mask),void 0!==this.rowHeads){for(let t=0;t<this.event.size;++t)this.headStaging.appendChild(this.rowHeads.children[this.event.index]);this.headMask=this.makeRowMask(s,this.animationHeight),this.headStaging.appendChild(this.headMask)}}splitHorizontal(){this.table.splitHorizontalNew(this.event.index),void 0!==this.rowHeads&&(this.splitHead=this.rowHeads.lastElementChild),this.topSplitBody=Jt(this.splitBody.style.top),this.topMask=Jt(this.mask.style.top)}joinHorizontal(){this.bodyStaging.removeChild(this.mask),this.body.removeChild(this.splitBody),this.bodyStaging.replaceChildren(),this.moveSplitBodyToBody(),this.rowHeads&&(this.headStaging.removeChild(this.headMask),this.rowHeads.removeChild(this.splitHead),this.headStaging.replaceChildren(),this.moveSplitHeadToHead()),this.table.animationDone&&this.table.animationDone()}moveSplitHeadToHead(){if(0===this.splitHead.children.length)return;let t=Jt(this.splitHead.style.top);for(;this.splitHead.children.length>0;){const e=this.splitHead.children[0];e.style.top=`${Jt(e.style.top)+t}px`,this.rowHeads.appendChild(e)}}moveSplitBodyToBody(){if(0===this.splitBody.children.length)return;let t=Jt(this.splitBody.style.top);for(;this.splitBody.children.length>0;){const e=this.splitBody.children[0];e.style.top=`${Jt(e.style.top)+t}px`,this.body.appendChild(e)}}}class Nt extends Rt{constructor(t,e){super(t,e),this.event=e,this.join=this.join.bind(this),this.colCount=this.adapter.colCount,this.rowCount=this.adapter.rowCount,Nt.current=this}prepareStaging(){this.prepareStagingWithColumns()}animate(t){this.mask.style.left=`${t}px`,this.splitBody.style.left=`${t}px`,void 0!==this.colHeads&&(this.splitHead.style.left=`${t}px`,this.headMask.style.left=`${t}px`)}prepareCellsToBeMeasured(){this.table.prepareMinCellSize();let t=new Array(this.event.size);for(let e=this.event.index;e<this.event.index+this.event.size;++e){const i=this.adapter.getColumnHead(e);void 0===this.colHeads&&void 0!==i&&(this.colHeads=x(),this.colHeads.className="cols",this.root.appendChild(this.colHeads),this.colResizeHandles=x(),this.colResizeHandles.className="cols",this.root.appendChild(this.colResizeHandles)),t[e-this.event.index]=i}if(void 0!==this.colHeads)for(let e=0;e<this.event.size;++e){const i=d(t[e]);i.className="head",this.measure.appendChild(i)}if(void 0===this.rowHeads&&this.adapter.rowCount===this.event.size){let t=new Array(this.adapter.rowCount);for(let e=0;e<this.adapter.rowCount;++e){const i=this.adapter.getRowHead(e);void 0===this.rowHeads&&void 0!==i&&(this.rowHeads=x(),this.rowHeads.className="rows",this.root.appendChild(this.rowHeads),this.rowResizeHandles=x(),this.rowResizeHandles.className="rows",this.root.appendChild(this.rowResizeHandles)),t[e]=i}if(void 0!==this.rowHeads)for(let e=0;e<this.adapter.rowCount;++e){const i=d(t[e]);i.className="head",this.measure.appendChild(i)}}for(let t=this.event.index;t<this.event.index+this.event.size;++t)for(let e=0;e<this.rowCount;++e){const i=d();this.table.showCell(new Ht(t,e),i),this.measure.appendChild(i)}}arrangeInStaging(){this.table.calculateMinCellSize();const t=this.colCount-this.event.size,e=this.adapter.config.seamless?0:1;let i,s=this.event.index;if(s<t){i=jt(this.body.children[s].style.left)}else if(0===this.body.children.length)i=0;else{const s=this.body.children[t-1];i=jt(s.style.left)+jt(s.style.width)+this.table.WIDTH_ADJUST-e}this.animationStart=i;let o=new Array(this.adapter.rowCount);if(0!==this.body.children.length)for(let e=0;e<this.adapter.rowCount;++e){const i=this.body.children[e*t].getBoundingClientRect();o[e]=i.height,this.adapter.config.seamless&&(o[e]+=2)}else o.fill(this.table.minCellHeight);let l=this.table.minCellHeight;if(this.colHeads&&this.colHeads.children.length>0){l=this.colHeads.children[0].getBoundingClientRect().height,this.adapter.config.seamless&&(l+=2)}let a=new Array(this.event.size);if(a.fill(this.table.minCellWidth),this.totalSize=0,s=0,void 0!==this.colHeads)for(let t=0;t<this.event.size;++t){const e=this.measure.children[s++].getBoundingClientRect();a[t]=Math.max(a[t],e.width),l=Math.max(l,e.height)}l=Math.ceil(l);let n=0;if(void 0!==this.rowHeads&&0===this.rowHeads.children.length&&this.adapter.colCount==this.event.size){n=this.table.minCellWidth;for(let t=0;t<this.adapter.rowCount;++t){const e=this.measure.children[s++].getBoundingClientRect();o[t]=Math.max(o[t],e.height-this.table.HEIGHT_ADJUST),n=Math.max(n,e.width-this.table.WIDTH_ADJUST)}}else if(void 0!==this.rowHeads){n=this.rowHeads.children[0].getBoundingClientRect().width-this.table.WIDTH_ADJUST}n=Math.ceil(n),this.colHeads&&(this.colHeads.style.left=0===n?"0px":n+this.table.WIDTH_ADJUST+2-e+"px",this.colHeads.style.right="0px",this.colHeads.style.height=`${l}px`,this.body.style.top=l-1+"px",this.bodyStaging.style.top=l-1+"px");for(let t=0;t<this.event.size;++t){for(let e=0;e<this.adapter.rowCount;++e){const i=this.measure.children[s++].getBoundingClientRect();a[t]=Math.ceil(Math.max(a[t],i.width)-2),this.adapter.config.expandRow?o[t]=Math.ceil(Math.max(o[e],i.height)):0===t&&0===this.body.children.length&&(o[e]=Math.ceil(i.height))}this.totalSize+=a[t]-e}a.forEach(((t,e)=>a[e]=t+4)),this.totalSize+=e,this.adapter.config.seamless&&(this.totalSize-=2*this.event.size);let h=i;if(void 0!==this.colHeads)for(let t=0;t<this.event.size;++t){const i=this.measure.children[0];this.setCellSize(i,h,0,a[t],l),this.headStaging.appendChild(i),h+=a[t]-e,this.adapter.config.seamless&&(h-=2)}if(void 0!==this.rowHeads&&0===this.rowHeads.children.length&&this.adapter.colCount==this.event.size){let t=0;for(let i=0;i<this.adapter.rowCount;++i){const s=this.measure.children[0];s.style.top=`${t}px`,s.style.height=o[i]-this.table.HEIGHT_ADJUST+"px",s.style.width=`${n}px`,this.rowHeads.appendChild(s),t+=o[i]-e}n+=this.table.WIDTH_ADJUST,this.body.style.left=n-e+"px",this.bodyStaging.style.left=n-e+"px",this.headStaging.style.left=n-e+"px",this.colHeads.style.left=n-e+"px",this.rowHeads.style.top=l-e+"px",this.rowHeads.style.bottom="0px",this.rowHeads.style.width=`${n}px`}let r=0;h=i;for(let t=this.event.index;t<this.event.index+this.event.size;++t){let i=a[t-this.event.index],s=0;for(let t=0;t<this.rowCount;++t){const l=this.measure.children[0];this.setCellSize(l,h,s,i,o[t]),this.bodyStaging.appendChild(l),s+=o[t]-e,this.adapter.config.seamless&&(s-=2)}h+=i-e-2,this.adapter.config.seamless||(h+=2),r+=i-2}this.totalSize=r+2,this.mask=this.makeColumnMask(i,this.totalSize),this.bodyStaging.appendChild(this.mask),void 0!==this.colHeads&&(this.headMask=this.makeColumnMask(i,this.totalSize),this.headStaging.appendChild(this.headMask))}split(){this.table.splitVerticalNew(this.event.index),void 0!==this.colHeads&&(this.splitHead=this.colHeads.lastElementChild)}joinHeader(){if(void 0!==this.colHeads){for(this.headStaging.removeChild(this.headMask),this.colHeads.removeChild(this.splitHead);this.headStaging.children.length>0;)this.colHeads.appendChild(this.headStaging.children[0]);if(this.splitHead.children.length>0){let t=Jt(this.splitHead.style.left);for(;this.splitHead.children.length>0;){const e=this.splitHead.children[0];e.style.left=`${Jt(e.style.left)+t}px`,this.colHeads.appendChild(e)}}}}joinBody(){this.bodyStaging.removeChild(this.mask),this.body.removeChild(this.splitBody);const t=this.adapter.model.colCount,e=this.event.index,i=this.event.size,s=t-i-this.event.index;for(let t=0;t<i;++t)for(let s=0;s<this.rowCount;++s){const o=this.bodyStaging.children[0],l=s*(e+i)+e+t;this.bodyInsertAt(o,l)}let o=this.totalSize+this.animationStart;for(let l=0;l<this.rowCount;++l)for(let a=0;a<s;++a){const s=this.splitBody.children[0];s.style.left=`${Jt(s.style.left)+o}px`;const n=l*t+e+i+a;this.bodyInsertAt(s,n)}}bodyInsertAt(t,e){let i;i=e<this.body.children.length?this.body.children[e]:null,this.body.insertBefore(t,i)}}class zt extends Bt{constructor(t,e){if(super(t),this.done=!1,this.colCount=this.adapter.colCount,this.rowCount=this.adapter.rowCount,this.event=e,this.joinVertical=this.joinVertical.bind(this),0===this.body.children.length)this.initialWidth=0;else{const t=this.body.children[this.body.children.length-1],e=Jt(t.style.left),i=t.getBoundingClientRect();this.initialWidth=e+i.width}zt.current=this}prepare(){this.prepareStagingWithColumns(),this.arrangeColumnsInStaging(),this.splitVertical()}firstFrame(){}animationFrame(t){let e=0;this.adapter.config.seamless&&(e=1),this.splitBody.style.left=`${this.leftSplitBody-t*this.animationWidth+e}px`,this.mask.style.left=this.leftMask-t*this.animationWidth+"px",void 0!==this.colHeads&&(this.splitHead.style.left=`${this.leftSplitBody-t*this.animationWidth+e}px`,this.headMask.style.left=this.leftMask-t*this.animationWidth+"px")}lastFrame(){this.joinVertical(),this.disposeStaging()}arrangeColumnsInStaging(){let t=this.event.index;for(let e=0;e<this.adapter.rowCount;++e){for(let e=0;e<this.event.size;++e)this.bodyStaging.appendChild(this.body.children[t]);t+=this.colCount}const e=this.bodyStaging.children[0],i=this.bodyStaging.children[this.bodyStaging.children.length-1];let s=Jt(i.style.left)+Jt(i.style.width)+this.table.WIDTH_ADJUST;s-=1;let o=s-Jt(e.style.left);if(this.animationWidth=o,this.mask=this.makeColumnMask(s,o),this.bodyStaging.appendChild(this.mask),void 0!==this.colHeads){for(let t=0;t<this.event.size;++t)this.headStaging.appendChild(this.colHeads.children[this.event.index]);this.headMask=this.makeColumnMask(s,o),this.headStaging.appendChild(this.headMask)}}splitVertical(){this.table.splitVerticalNew(this.event.index),void 0!==this.colHeads&&(this.splitHead=this.colHeads.lastElementChild);const t=Jt(this.splitBody.style.left);this.splitBody.style.width=this.initialWidth-t-1+"px",this.leftSplitBody=t,this.leftMask=Jt(this.mask.style.left),void 0!==this.colHeads&&(this.splitHead.style.left=`${t}px`,this.splitHead.style.width=this.initialWidth-t-1+"px")}joinVertical(){this.bodyStaging.removeChild(this.mask),this.body.removeChild(this.splitBody),this.bodyStaging.replaceChildren(),this.moveSplitBodyToBody(),this.colHeads&&(this.headStaging.removeChild(this.headMask),this.colHeads.removeChild(this.splitHead),this.headStaging.replaceChildren(),this.moveSplitHeadToHead()),this.table.animationDone&&this.table.animationDone()}moveSplitHeadToHead(){if(0===this.splitHead.children.length)return;let t=Jt(this.splitHead.style.left);for(;this.splitHead.children.length>0;){const e=this.splitHead.children[0];e.style.left=`${Jt(e.style.left)+t}px`,this.colHeads.appendChild(e)}}moveSplitBodyToBody(){if(0===this.splitBody.children.length)return;let t=Jt(this.splitBody.style.left);for(let e=0;e<this.rowCount;++e)for(let i=0;i<this.colCount-this.event.index;++i){const s=this.splitBody.children[0];s.style.left=`${Jt(s.style.left)+t}px`;const o=e*this.adapter.colCount+this.event.index+i;this.bodyInsertAt(s,o)}}bodyInsertAt(t,e){let i;i=e<this.body.children.length?this.body.children[e]:null,this.body.insertBefore(t,i)}}let _t=468;function Lt(t){if(void 0===t)return;const e=function(t){for(;t!==document.body&&!1===Vt(t);){if(null===t.parentElement)return;t=t.parentElement}return t}(t);if(void 0===e)return;const i=e.getBoundingClientRect(),s=t.getBoundingClientRect();if(e!==document.body){const{x:t,y:o}=function(t,e,i){const s=16,o=i.left+t.scrollLeft-e.left-s,l=i.right+t.scrollLeft-e.left+s,a=i.top+t.scrollTop-e.top-s,n=i.bottom+t.scrollTop-e.top+s,h=t.clientWidth,r=t.clientHeight;var d=t.scrollLeft,c=t.scrollTop;l-o-2*s>h?d=o:l>t.scrollLeft+h?d=l-h:o<t.scrollLeft&&(d=o);n-a-2*s>r?c=a:n>t.scrollTop+r?c=n-r:a<t.scrollTop&&(c=a);return d=Math.max(0,d),c=Math.max(0,c),{x:d,y:c}}(e,i,s);!function(t,e,i){let s,o,l=It.get(t);void 0===l?(l={x:e,y:i},It.set(t,l)):(l.x=e,l.y=i);t===document.body?(s=window.scrollX||window.pageXOffset,o=window.scrollY||window.pageYOffset):(s=t.scrollLeft,o=t.scrollTop);const a=e-s,n=i-o;if(0===a&&0===n)return void It.delete(t);h=h=>{if(l.x!==e||l.y!==i)return!1;const r=s+h*a,d=o+h*n;return t===document.body?window.scrollTo(r,d):(t.scrollLeft=r,t.scrollTop=d),1===h&&It.delete(t),!0},setTimeout((()=>{window.requestAnimationFrame(Ot.bind(window,h,void 0,void 0))}),0);var h}(e,t,o),"fixed"!==window.getComputedStyle(e).position&&window.scrollBy({left:i.left,top:i.top,behavior:"smooth"})}else window.scrollBy({left:s.left,top:s.top,behavior:"smooth"})}const It=new Map;let $t=0;function Ot(t,e,i){void 0===e&&(e=Date.now(),i=++$t);let s=(Date.now()-e)/_t;s=s>1?1:s;const o=(l=s,.5*(1-Math.cos(Math.PI*l)));var l;!1!==t(o)&&o<1&&window.requestAnimationFrame(Ot.bind(window,t,e,i))}var Wt,Ft=(Wt=window.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(Wt)?1:0);function Vt(t){const e=Ut(t,"Y")&&Pt(t,"Y"),i=Ut(t,"X")&&Pt(t,"X");return e||i}function Ut(t,e){return"X"===e?t.clientWidth+Ft<t.scrollWidth:t.clientHeight+Ft<t.scrollHeight}function Pt(t,e){const i=window.getComputedStyle(t,null)["overflow"+e];return"auto"===i||"scroll"===i}const Gt=new CSSStyleSheet;function jt(t){return parseInt(t.substring(0,t.length-2))}function Jt(t){return parseFloat(t.substring(0,t.length-2))}function Yt(t){return!1!==t.isConnected&&("none"!==window.getComputedStyle(t).display&&(!t.parentElement||Yt(t.parentElement)))}Gt.replaceSync(o`:host{position:relative;display:inline-block;border:1px solid var(--tx-gray-300);border-radius:3px;outline:0;font-family:var(--tx-font-family);font-size:var(--tx-font-size);background:#1e1e1e;min-height:50px;min-width:50px}.body,.cols,.rows,.splitBody,.staging{position:absolute}.cols{right:0;top:0}.rows{left:0;bottom:0}.staging{overflow:hidden;inset:0}.body{overflow:auto;inset:0}.cols,.rows{overflow:hidden}.body::-webkit-scrollbar{width:10px;height:10px}.body::-webkit-scrollbar-thumb{border-radius:5px}.body::-webkit-scrollbar-track{background:#1e1e1e}.body::-webkit-scrollbar-corner{background:#1e1e1e}.body::-webkit-scrollbar-thumb{background:var(--tx-gray-500)}.body>span,.cols>span,.measure>span,.rows>span,.splitBody>span,.staging>span{position:absolute;box-sizing:content-box;white-space:nowrap;outline:0;border:solid 1px var(--tx-gray-200);padding:0 2px 0 2px;margin:0;background-color:#080808;font-weight:400;overflow:hidden;cursor:default;caret-color:transparent}.seamless>.body>.splitBody>span,.seamless>.body>span,.seamless>.cols>.splitBody>span,.seamless>.cols>span,.seamless>.measure>span,.seamless>.rows>.splitBody>span,.seamless>.rows>span,.seamless>.staging>span{border:none 0}.body>span:hover{background:#1a1a1a}.body>span.error,.splitBody>span.error{border-color:var(--tx-global-red-600);z-index:1}.body>span:focus,.splitBody>span:focus{background:#0e2035;border-color:#2680eb;z-index:2}.body>span:focus:hover{background:#112d4d}.body>span.error,.splitBody>span.error{background-color:#522426}.body>span.error:hover{background:#401111}.cols>span.handle,.rows>span.handle{padding:0;border:0 none;opacity:0;background-color:#08f}.fill{opacity:0}.cols>span.handle{cursor:col-resize}.rows>span.handle{cursor:row-resize}.cols span.head,.measure span.head,.rows span.head,.staging span.head{background:#1e1e1e;font-weight:600}.colHack>span,.cols>span{text-align:center}.measure{position:absolute;opacity:0}.body>span.edit,.body>span.edit:hover,.splitBody>span.edit,.splitBody>span.edit:hover{caret-color:currentcolor}`);class qt extends f{constructor(t){super(),this.WIDTH_ADJUST=6,this.HEIGHT_ADJUST=2,this.HANDLE_SIZE=5,this.HANDLE_SKEW=3,this.visible=!1,this.animator=new A,this.arrangeAllMeasuredInGrid=this.arrangeAllMeasuredInGrid.bind(this),this.hostKeyDown=this.hostKeyDown.bind(this),this.cellKeyDown=this.cellKeyDown.bind(this),this.cellFocus=this.cellFocus.bind(this),this.focusIn=this.focusIn.bind(this),this.focusOut=this.focusOut.bind(this),this.pointerDown=this.pointerDown.bind(this),this.handleDown=this.handleDown.bind(this),this.handleMove=this.handleMove.bind(this),this.handleUp=this.handleUp.bind(this),this.setHeadingFillerSizeToScrollbarSize=this.setHeadingFillerSizeToScrollbarSize.bind(this),this.selectionChanged=this.selectionChanged.bind(this),this.modelChanged=this.modelChanged.bind(this),this.root=x(this.body=x()),this.root.className="root",this.body.className="body",this.measure=x(),this.measure.classList.add("measure"),this.onkeydown=this.hostKeyDown,this.addEventListener("focusin",this.focusIn),this.addEventListener("focusout",this.focusOut),this.body.onresize=this.setHeadingFillerSizeToScrollbarSize,this.body.onscroll=()=>{this.animator.current&&this.animator.current instanceof Bt&&this.animator.current.scrollStaging(),this.setHeadingFillerSizeToScrollbarSize(),this.colHeads&&(this.colHeads.scrollLeft=this.body.scrollLeft,this.colResizeHandles.scrollLeft=this.body.scrollLeft),this.rowHeads&&(this.rowHeads.scrollTop=this.body.scrollTop,this.rowResizeHandles.scrollTop=this.body.scrollTop)},this.body.onpointerdown=this.pointerDown,this.attachShadow({mode:"open",delegatesFocus:!0}),this.shadowRoot.adoptedStyleSheets=[Gt],this.shadowRoot.appendChild(this.root),this.shadowRoot.appendChild(this.measure),t&&(C(this,t),t.selectionModel&&this.setModel(t.selectionModel)),void 0===qt.observer&&(qt.observer=new MutationObserver(((t,e)=>{qt.allTables.forEach((t=>{Yt(t)&&(qt.allTables.delete(t),t.prepareCells())}))})),qt.observer.observe(document.body,{attributes:!0,subtree:!0}))}connectedCallback(){setTimeout((()=>{Yt(this)?this.prepareCells():qt.allTables.add(this)}),0),super.connectedCallback(),void 0===this.selection&&(this.selection=new kt(vt.SELECT_CELL),this.selection.modified.add(this.selectionChanged,this))}disconnectedCallback(){qt.allTables.delete(this)}addStaging(...t){for(const e of t)void 0!==e&&this.root.insertBefore(e,this.root.children[0])}removeStaging(...t){for(const e of t)void 0!==e&&this.root.removeChild(e)}hostKeyDown(t){if(this.selection)switch(this.selection.mode){case vt.SELECT_ROW:{let e=this.selection.value.row;switch(t.key){case"ArrowDown":e+1<this.adapter.rowCount&&++e;break;case"ArrowUp":e>0&&--e}this.selection.row=e}break;case vt.SELECT_CELL:{let e={col:this.selection.col,row:this.selection.row};switch(t.key){case"ArrowRight":void 0===this.editing&&e.col+1<this.adapter.colCount&&(++e.col,t.preventDefault(),t.stopPropagation());break;case"ArrowLeft":void 0===this.editing&&e.col>0&&(--e.col,t.preventDefault(),t.stopPropagation());break;case"ArrowDown":e.row+1<this.adapter.rowCount&&(++e.row,t.preventDefault(),t.stopPropagation());break;case"ArrowUp":e.row>0&&(--e.row,t.preventDefault(),t.stopPropagation());break;case"Enter":void 0===this.editing?this.adapter?.config.editMode===wt.EDIT_ON_ENTER&&this.editCell():(this.saveCell(),e.row+1<this.adapter.rowCount&&(++e.row,this.selection.value=e,this.editCell())),t.preventDefault(),t.stopPropagation()}this.selection.value=e}}}cellKeyDown(t){const e=t.target;if("Enter"===t.key)return this.hostKeyDown(t),void t.preventDefault();if(!e.classList.contains("edit")&&void 0===this.editing)switch(t.key){case"ArrowDown":case"ArrowUp":case"ArrowRight":case"ArrowLeft":case"Tab":case"Enter":break;default:this.adapter?.config.editMode===wt.EDIT_ON_ENTER&&t.preventDefault()}}cellFocus(t){const e=t.target;if(e instanceof HTMLElement){const t=e.getBoundingClientRect(),i=this.clientPosToTablePos(t.x+t.width/2,t.y+t.height/2);void 0!==i&&(this.selection.value=i)}}focusIn(t){}focusOut(t){}editCell(){if(void 0!==this.editing){if(this.editing.col===this.selection.value.col&&this.editing.row===this.selection.value.row)return;console.log("WARN: Table.editCell(): already editing ANOTHER cell")}console.log("Table.editCell()");const t=this.selection.value.col,e=this.selection.value.row,i=this.body.children[t+e*this.adapter.colCount];this.editing=new Ht(t,e),i.classList.add("edit"),this.adapter.editCell(this.editing,i)}saveCell(){if(void 0===this.editing)return;console.log("Table.saveCell()");const t=this.editing.col,e=this.editing.row,i=this.body.children[t+e*this.adapter.colCount];i.classList.remove("edit"),this.adapter.saveCell(this.editing,i),this.editing=void 0,this.focus()}pointerDown(t){}getModel(){return this.model}setModel(t){if(void 0===t)return this.selection&&this.selection.modified.remove(this),this.model=void 0,this.selection=new kt,void this.selection.modified.add(this.selectionChanged,this);if(t instanceof kt)return this.selection&&this.selection.modified.remove(this),this.selection=t,void this.selection.modified.add(this.selectionChanged,this);if(t instanceof ft){this.model=t,this.model.modified.add(this.modelChanged,this);const e=Tt.lookup(t);try{this.adapter=new e(t)}catch(t){throw console.log(`Table.setModel(): failed to instantiate table adapter: ${t}`),console.log("setting TypeScript's target to 'es6' might help"),t}this.prepareCells()}else if(t instanceof Object)throw Error("Table.setModel(): unexpected model of type "+t.constructor.name)}selectionChanged(){if(void 0!==this.selection)switch(this.saveCell(),this.selection.mode){case vt.EDIT_CELL:if(document.activeElement===this){const t=this.body.children[this.selection.col+this.selection.row*this.adapter.colCount];(function(t){if(!document.hasFocus())return!1;let e=document.activeElement;for(;null!==e;){if(e===t)return!0;if(null===e.shadowRoot)break;e=e.shadowRoot.activeElement}return!1})(t)||t.focus(),Lt(t),this.adapter?.config.editMode===wt.EDIT_ON_FOCUS&&this.editCell()}break;case vt.SELECT_CELL:case vt.SELECT_ROW:if(document.activeElement===this){const t=this.body.children[this.selection.col+this.selection.row*this.adapter.colCount];t.focus(),Lt(t)}}}modelChanged(t){switch(t.type){case Ct.CELL_CHANGED:{const e=this.body.children[t.col+t.row*this.adapter.colCount];this.showCell(t,e)}break;case Ct.INSERT_ROW:this.animator.run(new Mt(this,t));break;case Ct.REMOVE_ROW:this.animator.run(new Dt(this,t));break;case Ct.INSERT_COL:this.animator.run(new Nt(this,t));break;case Ct.REMOVE_COL:this.animator.run(new zt(this,t));break;default:console.log(`Table.modelChanged(): ${t} is not implemented`)}}prepareCells(){this.adapter&&(this.visible=Yt(this),this.visible&&0!==this.adapter.colCount&&0!==this.adapter.rowCount&&(this.adapter.config.seamless&&this.root.classList.add("seamless"),this.prepareMinCellSize(),this.prepareColumnHeads(),this.prepareRowHeads(),this.prepareBody(),setTimeout(this.arrangeAllMeasuredInGrid,0)))}arrangeAllMeasuredInGrid(){this.calculateMinCellSize();let{colWidths:t,colHeadHeight:e}=this.calculateColumnWidths(),{rowHeights:i,rowHeadWidth:s}=this.calculateRowHeights();this.placeColumnHeads(t,e,s),this.placeRowHeads(i,e,s),this.placeBody(s,e),this.placeBodyCells(t,i,e,s),this.setHeadingFillerSizeToScrollbarSize()}prepareMinCellSize(){if(void 0!==this.minCellHeight)return;const t=d(H("Tg"));this.measure.appendChild(t)}calculateMinCellSize(){if(void 0!==this.minCellHeight)return;const t=this.measure.children[0],e=t.getBoundingClientRect();this.minCellWidth=Math.ceil(e.width-this.WIDTH_ADJUST),this.minCellHeight=Math.ceil(e.height-this.HEIGHT_ADJUST),this.measure.removeChild(t)}prepareColumnHeads(){const t=new Array(this.adapter.colCount);for(let e=0;e<this.adapter.colCount;++e){const i=this.adapter.getColumnHead(e);void 0===this.colHeads&&void 0!==i&&(this.colHeads=x(),this.colHeads.className="cols",this.root.appendChild(this.colHeads),this.colResizeHandles=x(),this.colResizeHandles.className="cols",this.root.appendChild(this.colResizeHandles)),t[e]=i}if(void 0!==this.colHeads)for(let e=0;e<this.adapter.colCount;++e){const i=d(t[e]);i.className="head",this.measure.appendChild(i)}}prepareRowHeads(){let t=new Array(this.adapter.rowCount);for(let e=0;e<this.adapter.rowCount;++e){const i=this.adapter.getRowHead(e);void 0===this.rowHeads&&void 0!==i&&(this.rowHeads=x(),this.rowHeads.className="rows",this.root.appendChild(this.rowHeads),this.rowResizeHandles=x(),this.rowResizeHandles.className="rows",this.root.appendChild(this.rowResizeHandles)),t[e]=i}if(this.rowHeads)for(let e=0;e<this.adapter.rowCount;++e){const i=d(t[e]);i.className="head",this.measure.appendChild(i)}}prepareBody(){for(let t=0;t<this.adapter.rowCount;++t)for(let e=0;e<this.adapter.colCount;++e){const i=this.createCell();this.showCell(new Ht(e,t),i),this.measure.appendChild(i)}}createCell(){const t=d();return t.onfocus=this.cellFocus,t.onkeydown=this.cellKeyDown,t.tabIndex=0,t.setAttribute("contenteditable",""),t}setCellSize(t,e,i,s,o){t.style.left=`${e}px`,t.style.top=`${i}px`,t.style.width=s-this.WIDTH_ADJUST+"px",t.style.height=o-this.HEIGHT_ADJUST+"px"}showCell(t,e){this.adapter.showCell(t,e),0!==e.children.length&&(e.style.caretColor="currentcolor")}calculateRowHeights(){let t=this.colHeads?this.adapter.colCount:0,e=0;const i=Array(this.adapter.rowCount);if(this.rowHeads)for(let s=0;s<this.adapter.rowCount;++s){const o=this.measure.children[t++].getBoundingClientRect();i[s]=Math.max(o.height,this.minCellHeight),e=Math.max(e,o.width)}else i.fill(this.minCellHeight);t=(this.colHeads?this.adapter.colCount:0)+(this.rowHeads?this.adapter.rowCount:0);for(let e=0;e<this.adapter.rowCount;++e){let s=i[e];for(let i=0;i<this.adapter.colCount;++i){const o=this.measure.children[t+i+e*this.adapter.colCount].getBoundingClientRect();s=Math.max(s,o.height)}i[e]=Math.ceil(s)}return e=Math.ceil(e),{rowHeights:i,rowHeadWidth:e}}calculateColumnWidths(t=!1){let e=0;const i=Array(this.adapter.colCount);if(this.colHeads)for(let t=0;t<this.adapter.colCount;++t){const s=this.measure.children[t].getBoundingClientRect();i[t]=Math.max(s.width,this.minCellWidth),e=Math.max(e,s.height)}else i.fill(this.minCellWidth);let s;e=Math.ceil(e),s=t?0:(this.colHeads?this.adapter.colCount:0)+(this.rowHeads?this.adapter.rowCount:0);for(let e=0;e<this.adapter.colCount;++e){let o=i[e];for(let i=0;i<this.adapter.rowCount;++i){let l,a=s+e+i*this.adapter.colCount;l=t?this.body.children[a]:this.measure.children[a];const n=l.getBoundingClientRect();o=Math.max(o,n.width)}i[e]=Math.ceil(o)}return{colWidths:i,colHeadHeight:e}}placeColumnHeads(t,e,i){if(void 0===this.colHeads)return;const s=this.adapter.config.seamless?0:1;let o=0;for(let i=0;i<this.adapter.colCount;++i){const l=this.measure.children[0];this.setCellSize(l,o,0,t[i],e),this.colHeads.appendChild(l),o+=t[i]-1-1+s}let l=d();l.classList.add("head"),l.classList.add("fill"),l.style.left=`${o}px`,l.style.top="0",l.style.width="256px",l.style.height=`${e}px`,this.colHeads.appendChild(l),this.colResizeHandles.style.left=`${i}px`,this.colResizeHandles.style.height=`${e}px`,o=-this.HANDLE_SKEW;for(let i=0;i<this.adapter.colCount;++i){o+=t[i]-1;const s=this.createHandle(i,o,0,this.HANDLE_SIZE,e);this.colResizeHandles.appendChild(s)}o+=this.HANDLE_SIZE,l=d(),l.classList.add("head"),l.classList.add("fill"),l.style.left=`${o}px`,l.style.top="0",l.style.width="256px",l.style.height=`${e}px`,this.colResizeHandles.appendChild(l)}placeRowHeads(t,e,i){if(void 0===this.rowHeads)return;const s=this.adapter.config.seamless?0:1;let o=0;for(let e=0;e<this.adapter.rowCount;++e){const l=this.measure.children[0];this.setCellSize(l,0,o,i,t[e]),this.rowHeads.appendChild(l),o+=t[e]-1-1+s}let l=d();l.classList.add("head"),l.classList.add("fill"),l.style.left="0",l.style.top=`${o}px`,l.style.width=`${i}px`,l.style.height="256px",this.rowHeads.appendChild(l),this.rowResizeHandles.style.top=`${e}px`,this.rowResizeHandles.style.width=`${i}px`,o=-this.HANDLE_SKEW;for(let e=0;e<this.adapter.rowCount;++e){o+=t[e]-1;const s=this.createHandle(e,0,o,i,this.HANDLE_SIZE);this.rowResizeHandles.appendChild(s)}o+=this.HANDLE_SIZE,l=d(),l.classList.add("head"),l.classList.add("fill"),l.style.left="0",l.style.top=`${o}0px`,l.style.width=`${i}px`,l.style.height="256px",this.rowResizeHandles.appendChild(l)}placeBody(t,e){return void 0!==this.colHeads&&(this.adapter?.config.seamless?(this.colHeads.style.height=e-2+"px",this.colHeads.style.left=t-(null==this.rowHeads?0:2)+"px"):(this.colHeads.style.height=`${e}px`,this.colHeads.style.left=t-(null==this.rowHeads?0:1)+"px")),void 0!==this.rowHeads&&(this.adapter?.config.seamless?(this.rowHeads.style.width=t-2+"px",this.rowHeads.style.top=e-(null==this.colHeads?0:2)+"px"):(this.rowHeads.style.width=`${t}px`,this.rowHeads.style.top=e-(null==this.colHeads?0:1)+"px")),--t,--e,this.adapter?.config.seamless&&(--t,--e),t<0&&(t=0),e<0&&(e=0),this.body.style.left=`${t}px`,this.body.style.top=`${e}px`,{rowHeadWidth:t,colHeadHeight:e}}placeBodyCells(t,e,i,s){const o=this.adapter.config.seamless?0:1;let l=0;for(let i=0;i<this.adapter.rowCount;++i){let s=0;for(let a=0;a<this.adapter.colCount;++a){const n=this.measure.children[0];this.setCellSize(n,s,l,t[a],e[i]),this.body.appendChild(n),s+=t[a]-2+o}l+=e[i]-2+o}}createHandle(t,e,i,s,o){const l=d();return l.className="handle",l.style.left=`${e}px`,l.style.top=`${i}px`,l.style.width=`${s}px`,l.style.height=`${o}px`,l.dataset.idx=`${t}`,l.onpointerdown=this.handleDown,l.onpointermove=this.handleMove,l.onpointerup=this.handleUp,l}handleDown(t){t.preventDefault(),this.handle=t.target,this.handleIndex=parseInt(this.handle.dataset.idx)+1,this.handle.setPointerCapture(t.pointerId);if(this.handle.parentElement===this.colResizeHandles){this.deltaHandle=t.clientX-jt(this.handle.style.left),this.deltaSplitBody=t.clientX,this.deltaSplitHead=t.clientX-Jt(this.body.style.left);const e=this.colHeads.children[this.handleIndex-1];this.deltaColumn=t.clientX-Jt(e.style.width),this.splitVertical(this.handleIndex)}else{this.deltaHandle=t.clientY-Jt(this.handle.style.top),this.deltaSplitBody=t.clientY,this.deltaSplitHead=t.clientY-Jt(this.body.style.top);const e=this.rowHeads.children[this.handleIndex-1];this.deltaColumn=t.clientY-Jt(e.style.height),this.splitHorizontal(this.handleIndex)}}handleMove(t){if(void 0===this.handle)return;if(this.handle.parentElement===this.colResizeHandles){let e=t.clientX;const i=this.deltaColumn+8;e<i&&(e=i),this.handle.style.left=e-this.deltaHandle+"px",this.splitHead.style.left=e-this.deltaSplitHead+"px",this.splitBody.style.left=e-this.deltaSplitBody+"px";const s=this.handleIndex;this.colHeads.children[s-1].style.width=e-this.deltaColumn+"px";for(let t=0;t<this.adapter.rowCount;++t)this.body.children[s-1+t*s].style.width=e-this.deltaColumn+"px"}else{let e=t.clientY;const i=this.deltaColumn+8;e<i&&(e=i),this.handle.style.top=e-this.deltaHandle+"px",this.splitHead.style.top=e-this.deltaSplitHead+"px",this.splitBody.style.top=e-this.deltaSplitBody+"px";const s=this.handleIndex;this.rowHeads.children[s-1].style.height=e-this.deltaColumn+"px";let o=(s-1)*this.adapter.colCount;for(let t=0;t<this.adapter.colCount;++t)this.body.children[o+t].style.height=e-this.deltaColumn+"px"}}handleUp(t){if(void 0===this.handle)return;this.handleMove(t);if(this.handle.parentElement===this.colResizeHandles){let e=t.clientX;const i=this.deltaColumn+8;e<i&&(e=i),this.joinVertical(this.handleIndex,e-this.deltaSplitBody)}else{let e=t.clientY;const i=this.deltaColumn+8;e<i&&(e=i),this.joinHorizontal(this.handleIndex,e-this.deltaSplitBody)}this.handle=void 0}splitVerticalNew(t){this.splitHeadVertical(t),this.splitBodyVertical(t)}splitHeadVertical(t){if(void 0===this.colHeads)return;const e=this.adapter.config.seamless?0:1;this.splitHead=x(),this.splitHead.className="splitBody colHack",this.splitHead.style.top="0",this.splitHead.style.bottom="0",this.splitHead.style.backgroundColor=qt.splitColor;const i=t;if(0===this.body.children.length)this.splitHead.style.left="0px",this.splitHead.style.width="1px";else if(i<this.colHeads.children.length){let t=this.colHeads.children[i],s=0;const o=Jt(t.style.left);for(;i<this.colHeads.children.length;){t=this.colHeads.children[i];s+=t.getBoundingClientRect().width-e;let l=Jt(t.style.left);t.style.left=l-o+"px",this.splitHead.appendChild(t)}this.adapter.config.seamless&&(s+=e),this.splitHead.style.left=`${o}px`,this.splitHead.style.width=`${s}px`}else{let t=this.colHeads.children[this.body.children.length-1],i=t.getBoundingClientRect(),s=Jt(t.style.left)+i.width-e;this.splitHead.style.left=`${s}px`,this.splitHead.style.width="1px"}this.colHeads.appendChild(this.splitHead)}splitBodyVertical(t){const e=this.adapter.config.seamless?0:1;if(this.splitBody=x(),this.splitBody.className="splitBody",this.splitBody.style.top="0",this.splitBody.style.bottom="0",this.splitBody.style.backgroundColor=qt.splitColor,0===this.body.children.length)this.splitBody.style.left="0px",this.splitBody.style.width="1px";else{if(t<this.body.children.length/this.adapter.rowCount){let i=this.body.children[t];const s=Jt(i.style.left);let o=0;const l=this.body.children.length/this.adapter.rowCount-t;let a=t;for(let n=0;n<this.adapter.rowCount;++n){for(let t=0;t<l;++t){if(i=this.body.children[a],0===n){o+=i.getBoundingClientRect().width-e}i.style.left=Jt(i.style.left)-s+"px",this.splitBody.appendChild(i)}a+=t}this.splitBody.style.left=`${s}px`,this.splitBody.style.width=`${o}px`}else{let t=this.body.children[this.body.children.length-1],i=t.getBoundingClientRect(),s=Jt(t.style.left)+i.width-e;this.splitBody.style.left=`${s}px`,this.splitBody.style.width="1px"}}this.body.appendChild(this.splitBody)}splitVertical(t,e=0){void 0!==this.colHeads&&(this.splitHead=x(),this.splitHead.className="cols",this.splitHead.style.left=this.colHeads.style.left,this.splitHead.style.height=this.colHeads.style.height,this.root.appendChild(this.splitHead),setTimeout((()=>{this.splitHead.scrollTop=this.colHeads.scrollTop,this.splitHead.scrollLeft=this.colHeads.scrollLeft}),0)),this.splitBody=x(),this.splitBody.className="splitBody";const i=this.body.getBoundingClientRect();this.splitBody.style.width=`${i.width}px`,this.splitBody.style.height=`${i.height}px`,this.body.appendChild(this.splitBody);const s=t,o=this.adapter.colCount-t+e;if(void 0!==this.splitHead){for(let e=0;e<o;++e)this.splitHead.appendChild(this.colHeads.children[t]);this.splitHead.appendChild(this.colHeads.children[this.colHeads.children.length-1].cloneNode())}let l=t;for(let t=0;t<this.adapter.rowCount;++t){for(let t=0;t<o;++t)this.splitBody.appendChild(this.body.children[l]);l+=s}}joinVertical(t,e,i=0,s,o){void 0===s&&(s=this.adapter.colCount),void 0===o&&(o=this.adapter.rowCount);const l=s-t+i;let a=t-i;if(void 0!==this.colHeads){const t=this.colHeads.children[this.colHeads.children.length-1];for(let i=0;i<l;++i){const i=this.splitHead.children[0],s=Jt(i.style.left);i.style.left=`${s+e}px`,this.colHeads.insertBefore(i,t)}const i=Jt(t.style.left);t.style.left=`${i+e}px`;for(let t=a;t<=s;++t){const i=this.colResizeHandles.children[t],s=Jt(i.style.left);i.style.left=`${s+e}px`}}for(let t=0;t<o;++t){let t=this.body.children[a];for(let i=0;i<l;++i){const i=this.splitBody.children[0],s=Jt(i.style.left);i.style.left=`${s+e}px`,this.body.insertBefore(i,t)}a+=s}void 0!==this.colHeads&&(this.root.removeChild(this.splitHead),this.splitHead=void 0),this.body.removeChild(this.splitBody),this.splitBody=void 0}splitHorizontalNew(t){this.splitHeadHorizontal(t),this.splitBodyHorizontal(t)}splitHeadHorizontal(t){if(void 0===this.rowHeads)return;const e=this.adapter.config.seamless?0:1;this.splitHead=x(),this.splitHead.className="splitBody",this.splitHead.style.left="0",this.splitHead.style.right="0",this.splitHead.style.backgroundColor=qt.splitColor;const i=t;if(0===this.body.children.length)this.splitHead.style.top="0px",this.splitHead.style.height="1px";else if(i<this.rowHeads.children.length){let t=this.rowHeads.children[i],s=0;const o=Jt(t.style.top);for(;i<this.rowHeads.children.length;){t=this.rowHeads.children[i];s+=t.getBoundingClientRect().height-e;let l=Jt(t.style.top);t.style.top=l-o+"px",this.splitHead.appendChild(t)}this.adapter.config.seamless&&(s+=e),this.splitHead.style.top=`${o}px`,this.splitHead.style.height=`${s}px`}else{let t=this.rowHeads.children[this.body.children.length-1],i=t.getBoundingClientRect(),s=Jt(t.style.top)+i.height-e;this.splitHead.style.top=`${s}px`,this.splitHead.style.height="1px"}this.rowHeads.appendChild(this.splitHead)}splitBodyHorizontal(t){const e=this.adapter.config.seamless?0:1;this.splitBody=x(),this.splitBody.className="splitBody",this.splitBody.style.left="0",this.splitBody.style.right="0",this.splitBody.style.backgroundColor=qt.splitColor;const i=t*this.adapter.colCount;if(0===this.body.children.length)this.splitBody.style.top="0px",this.splitBody.style.height="1px";else if(i<this.body.children.length){let t=this.body.children[i],s=this.adapter.colCount,o=0;const l=Jt(t.style.top);for(;i<this.body.children.length;){if(t=this.body.children[i],--s,0===s){o+=t.getBoundingClientRect().height-e,s=this.adapter.colCount}let a=Jt(t.style.top);t.style.top=a-l+"px",this.splitBody.appendChild(t)}o+=e,this.splitBody.style.top=`${l}px`,this.splitBody.style.height=`${o}px`}else{let t=this.body.children[this.body.children.length-1],i=t.getBoundingClientRect(),s=Jt(t.style.top)+i.height-e;this.splitBody.style.top=`${s}px`,this.splitBody.style.height="1px"}this.body.appendChild(this.splitBody)}splitHorizontal(t,e=0,i){void 0!==this.rowHeads&&(this.splitHead=x(),this.splitHead.className="rows",this.splitHead.style.top=this.rowHeads.style.top,this.splitHead.style.width=this.rowHeads.style.width,this.root.appendChild(this.splitHead),setTimeout((()=>{this.splitHead.scrollTop=this.rowHeads.scrollTop,this.splitHead.scrollLeft=this.rowHeads.scrollLeft}),0)),this.splitBody=x(),this.splitBody.className="splitBody",this.splitBody.style.backgroundColor="rgba(255,128,0,0.5)";const s=this.body.getBoundingClientRect();this.splitBody.style.width=`${s.width}px`,this.splitBody.style.height=`${s.height}px`,this.body.appendChild(this.splitBody);const o=this.adapter.rowCount-t+e;if(void 0!==this.splitHead){for(let e=0;e<o;++e)this.splitHead.appendChild(this.rowHeads.children[t]);this.splitHead.appendChild(this.rowHeads.children[this.rowHeads.children.length-1].cloneNode())}let l=this.adapter.colCount*t;for(let t=0;t<o;++t)for(let t=0;t<this.adapter.colCount;++t)this.splitBody.appendChild(this.body.children[l]);if(this.splitBody.children.length>0){l=this.splitBody.children.length-1;const t=jt(this.splitBody.children[l].style.top);for(let e=0;e<this.splitBody.children.length;++e){const i=this.splitBody.children[e],s=jt(i.style.top);i.style.top=s-t+"px"}this.splitBody.style.backgroundColor="#f80",this.splitBody.style.top=`${t}px`,this.splitBody.style.height=s.height-t+"px"}else if(void 0!==i&&this.body.children.length>0){l=i.index*this.adapter.colCount;const t=jt(this.body.children[l].style.top);this.splitBody.style.top=`${t}px`,this.splitBody.style.height=s.height-t+"px"}else if(this.body.children.length>0){const t=d();l=this.body.children.length-2;const e=this.body.children[l],i=this.body.children[l].getBoundingClientRect();t.style.border="none",t.style.backgroundColor="#1e1e1e";const o=jt(e.style.top)+i.height;t.style.top=`${o}px`,t.style.left="0px",t.style.width=s.width-2+"px",t.style.height=s.height-o+"px",this.splitBody.appendChild(t)}}joinHorizontal(t,e,i=0,s,o){void 0===s&&(s=this.adapter.colCount),void 0===o&&(o=this.adapter.rowCount);const l=o-t+i;if(void 0!==this.rowHeads){const i=this.rowHeads.children[this.rowHeads.children.length-1];for(let t=0;t<l;++t){const t=this.splitHead.children[0],s=Jt(t.style.top);t.style.top=`${s+e}px`,this.rowHeads.insertBefore(t,i)}const s=Jt(i.style.top);i.style.top=`${s+e}px`;for(let i=t;i<=o;++i){const t=this.rowResizeHandles.children[i],s=Jt(t.style.top);t.style.top=`${s+e}px`}}for(let t=0;t<l;++t)for(let t=0;t<s;++t){const t=this.splitBody.children[0],i=Jt(t.style.top);t.style.top=`${i+e}px`,this.body.appendChild(t)}void 0!==this.rowHeads&&(this.root.removeChild(this.splitHead),this.splitHead=void 0),this.body.removeChild(this.splitBody),this.splitBody=void 0}setHeadingFillerSizeToScrollbarSize(){const t=this.body.getBoundingClientRect();if(void 0!==this.colHeads){const e=Math.ceil(t.width-this.body.clientWidth);this.colHeads.children[this.colHeads.children.length-1].style.width=`${e}px`,this.colHeads.style.right=`${e}px`}if(void 0!==this.rowHeads){const e=Math.ceil(t.height-this.body.clientHeight);this.rowHeads.children[this.rowHeads.children.length-1].style.height=`${e}px`,this.rowHeads.style.bottom=`${e}px`}}clientPosToTablePos(t,e){let i,s;for(i=0;i<this.adapter.colCount;++i){const e=this.body.children[i].getBoundingClientRect();if(e.x<=t&&t<e.x+e.width)break}if(i>=this.adapter.colCount)return;let o=0;for(s=0;s<this.adapter.rowCount;++s){const t=this.body.children[o].getBoundingClientRect();if(t.y<=e&&e<t.y+t.height)break;o+=this.adapter.colCount}return s>=this.adapter.rowCount?void 0:new Ht(i,s)}}qt.maskColor="#1e1e1e",qt.splitColor="#1e1e1e",qt.allTables=new Set,qt.define("tx-table",qt);class Xt extends rt{constructor(){super(),this.toolbar=a("div",{class:"toolbar"}),this.buttonAddRowAbove=a("button",{class:"left",title:"add row above",children:n("svg",{style:{display:"block"},viewBox:"0 0 13 13",width:"13",height:"13",children:[a("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),a("line",{x1:"0.5",y1:"8.5",x2:"12.5",y2:"8.5",class:"stroke"}),a("line",{x1:"4.5",y1:"8.5",x2:"4.5",y2:"13.5",class:"stroke"}),a("line",{x1:"8.5",y1:"8.5",x2:"8.5",y2:"13.5",class:"stroke"}),a("line",{x1:"6.5",y1:"2",x2:"6.5",y2:"7",class:"stroke"}),a("line",{x1:"4",y1:"4.5",x2:"9",y2:"4.5",class:"stroke"})]})}),this.buttonAddRowAbove.onclick=()=>{this.lastActiveTable?.focus();const t=this.lastActiveTable?.model,e=this.lastActiveTable?.selection;e&&Kt(t)&&t.insertRow(e.row)},this.toolbar.appendChild(this.buttonAddRowAbove),this.buttonAddRowBelow=a("button",{title:"add row below",children:n("svg",{viewBox:"0 0 13 13",width:"13",height:"13",children:[a("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),a("line",{x1:"0.5",y1:"4.5",x2:"12.5",y2:"4.5",class:"stroke"}),a("line",{x1:"4.5",y1:"0.5",x2:"4.5",y2:"4.5",class:"stroke"}),a("line",{x1:"8.5",y1:"0.5",x2:"8.5",y2:"4.5",class:"stroke"}),a("line",{x1:"6.5",y1:"6",x2:"6.5",y2:"11",class:"stroke"}),a("line",{x1:"4",y1:"8.5",x2:"9",y2:"8.5",class:"stroke"})]})}),this.buttonAddRowBelow.onclick=()=>{this.lastActiveTable?.focus();const t=this.lastActiveTable?.model,e=this.lastActiveTable?.selection;e&&Kt(t)&&t.insertRow(e.row+1)},this.toolbar.appendChild(this.buttonAddRowBelow),this.buttonDeleteRow=a("button",{class:"right",title:"delete row",children:n("svg",{viewBox:"0 0 13 13",width:"13",height:"13",children:[a("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),a("line",{x1:"0.5",y1:"4.5",x2:"12.5",y2:"4.5",class:"stroke"}),a("line",{x1:"0.5",y1:"8.5",x2:"12.5",y2:"8.5",class:"stroke"}),a("line",{x1:"5.5",y1:"3.5",x2:"11.5",y2:"9.5",class:"stroke","stroke-width":"1.5"}),a("line",{x1:"11.5",y1:"3.5",x2:"5.5",y2:"9.5",class:"stroke","stroke-width":"1.5"})]})}),this.buttonDeleteRow.onclick=()=>{this.lastActiveTable?.focus();const t=this.lastActiveTable?.model,e=this.lastActiveTable?.selection;e&&Kt(t)&&t.removeRow(e.row,1)},this.toolbar.appendChild(this.buttonDeleteRow),this.toolbar.appendChild(document.createTextNode(" ")),this.buttonAddColumnLeft=a("button",{class:"left",title:"add column left",children:n("svg",{viewBox:"0 0 13 13",width:"13",height:"13",children:[a("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),a("line",{x1:"8.5",y1:"0.5",x2:"8.5",y2:"12.5",class:"stroke"}),a("line",{x1:"8.5",y1:"4.5",x2:"12.5",y2:"4.5",class:"stroke"}),a("line",{x1:"8.5",y1:"8.5",x2:"12.5",y2:"8.5",class:"stroke"}),a("line",{x1:"2",y1:"6.5",x2:"7",y2:"6.5",class:"stroke"}),a("line",{x1:"4.5",y1:"4",x2:"4.5",y2:"9",class:"stroke"})]})}),this.buttonAddColumnLeft.onclick=()=>{this.lastActiveTable?.focus();const t=this.lastActiveTable?.model,e=this.lastActiveTable?.selection;e&&Zt(t)&&t.insertColumn(e.col)},this.toolbar.appendChild(this.buttonAddColumnLeft),this.buttonAddColumnRight=a("button",{title:"add column right",children:n("svg",{viewBox:"0 0 13 13",width:"13",height:"13",children:[a("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),a("line",{x1:"4.5",y1:"0.5",x2:"4.5",y2:"12.5",class:"stroke"}),a("line",{x1:"0.5",y1:"4.5",x2:"4.5",y2:"4.5",class:"stroke"}),a("line",{x1:"0.5",y1:"8.5",x2:"4.5",y2:"8.5",class:"stroke"}),a("line",{x1:"6",y1:"6.5",x2:"11",y2:"6.5",class:"stroke"}),a("line",{x1:"8.5",y1:"4",x2:"8.5",y2:"9",class:"stroke"})]})}),this.buttonAddColumnRight.onclick=()=>{this.lastActiveTable?.focus();const t=this.lastActiveTable?.model,e=this.lastActiveTable?.selection;e&&Zt(t)&&t.insertColumn(e.col+1)},this.toolbar.appendChild(this.buttonAddColumnRight),this.buttonDeleteColumn=a("button",{class:"right",title:"delete column",children:n("svg",{viewBox:"0 0 13 13",width:"13",height:"13",children:[a("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),a("line",{x1:"4.5",y1:"0.5",x2:"4.5",y2:"12.5",class:"stroke"}),a("line",{x1:"8.5",y1:"0.5",x2:"8.5",y2:"12.5",class:"stroke"}),a("line",{x1:"3.5",y1:"5.5",x2:"9.5",y2:"11.5",class:"stroke","stroke-width":"1.5"}),a("line",{x1:"3.5",y1:"11.5",x2:"9.5",y2:"5.5",class:"stroke","stroke-width":"1.5"})]})}),this.buttonDeleteColumn.onclick=()=>{this.lastActiveTable?.focus();const t=this.lastActiveTable?.model,e=this.lastActiveTable?.selection;e&&Zt(t)&&t.removeColumn(e.col,1)},this.toolbar.appendChild(this.buttonDeleteColumn),this.toolbar.appendChild(document.createTextNode(" ")),this.buttonAddNodeAbove=a("button",{class:"left",title:"add node above",children:n("svg",{style:{display:"block",border:"none"},viewBox:"0 0 8 17",width:"8",height:"17",children:[a("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"strokeFill"}),a("rect",{x:"0.5",y:"9.5",width:"6",height:"6",class:"fill"}),a("line",{x1:"3.5",y1:"3",x2:"3.5",y2:"6",class:"stroke"}),a("line",{x1:"2",y1:"4.5",x2:"5",y2:"4.5",class:"stroke"}),a("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"1",class:"stroke"}),a("line",{x1:"3.5",y1:"8",x2:"3.5",y2:"17",class:"stroke"})]})}),this.toolbar.appendChild(this.buttonAddNodeAbove),this.buttonAddNodeBelow=a("button",{title:"add node below",children:n("svg",{style:{display:"block",border:"none"},viewBox:"0 0 8 17",width:"8",height:"17",children:[a("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"fill"}),a("rect",{x:"0.5",y:"9.5",width:"6",height:"6",class:"strokeFill"}),a("line",{x1:"3.5",y1:"11",x2:"3.5",y2:"14",class:"stroke"}),a("line",{x1:"2",y1:"12.5",x2:"5",y2:"12.5",class:"stroke"}),a("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"9",class:"stroke"}),a("line",{x1:"3.5",y1:"16",x2:"3.5",y2:"17",class:"stroke"})]})}),this.toolbar.appendChild(this.buttonAddNodeBelow),this.buttonAddNodeParent=a("button",{title:"add node parent",children:n("svg",{viewBox:"0 0 13 17",width:"13",height:"17",children:[a("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"strokeFill"}),a("rect",{x:"6.5",y:"9.5",width:"6",height:"6",class:"fill"}),a("line",{x1:"7",y1:"4.5",x2:"10",y2:"4.5",class:"stroke"}),a("line",{x1:"9.5",y1:"4",x2:"9.5",y2:"9",class:"stroke"}),a("line",{x1:"3.5",y1:"3",x2:"3.5",y2:"6",class:"stroke"}),a("line",{x1:"2",y1:"4.5",x2:"5",y2:"4.5",class:"stroke"}),a("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"1",class:"stroke"}),a("line",{x1:"3.5",y1:"8",x2:"3.5",y2:"17",class:"stroke"})]})}),this.buttonAddNodeParent.onclick=()=>{},this.toolbar.appendChild(this.buttonAddNodeParent),this.buttonAddNodeChild=a("button",{title:"add node child",children:n("svg",{viewBox:"0 0 13 17",width:"13",height:"17",children:[a("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"fill"}),a("rect",{x:"6.5",y:"9.5",width:"6",height:"6",class:"strokeFill"}),a("line",{x1:"7",y1:"4.5",x2:"10",y2:"4.5",class:"stroke"}),a("line",{x1:"9.5",y1:"4",x2:"9.5",y2:"9",class:"stroke"}),a("line",{x1:"9.5",y1:"11",x2:"9.5",y2:"14",class:"stroke"}),a("line",{x1:"8",y1:"12.5",x2:"11",y2:"12.5",class:"stroke"}),a("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"17",class:"stroke"})]})}),this.toolbar.appendChild(this.buttonAddNodeChild),this.buttonDeleteNode=a("button",{class:"right",title:"delete node",children:n("svg",{viewBox:"0 0 10 17",width:"10",height:"17",children:[a("rect",{x:"1.5",y:"5.5",width:"6",height:"6",class:"strokeFill"}),a("line",{x1:"4.5",y1:"2",x2:"4.5",y2:"5",class:"stroke"}),a("line",{x1:"4.5",y1:"12",x2:"4.5",y2:"15",class:"stroke"}),a("line",{x1:"0.5",y1:"4.5",x2:"8.5",y2:"12.5",class:"stroke","stroke-width":"1.5"}),a("line",{x1:"8.5",y1:"4.5",x2:"0.5",y2:"12.5",class:"stroke","stroke-width":"1.5"})]})}),this.toolbar.appendChild(this.buttonDeleteNode),this.attachShadow({mode:"open"}),this.shadowRoot.adoptedStyleSheets=[D],this.shadowRoot.appendChild(this.toolbar)}canHandle(t){return t instanceof qt}activate(){this.lastActiveTable=rt.activeView,this.toolbar.classList.add("active")}deactivate(){this.lastActiveTable=void 0,this.toolbar.classList.remove("active")}}function Kt(t){return void 0!==t&&"insertRow"in t&&"removeRow"in t}function Zt(t){return void 0!==t&&"insertColumn"in t&&"removeColumn"in t}f.define("tx-tabletool",Xt);export{I as B,F as C,wt as E,J as R,et as S,M as T,$ as a,z as b,N as c,ht as d,lt as e,G as f,ut as g,ot as h,it as i,U as j,Tt as k,Ct as l,St as m,ft as n,qt as o,nt as p,Xt as q,at as r};
