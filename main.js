var example=function(t){"use strict";class e{constructor(t,e){this.object=t,this.attribute=e.toString()}get(){return this.object[this.attribute]}set(t){Object.defineProperty(this.object,this.attribute,{value:t})}toString(){return`${this.object[this.attribute]}`}fromString(t){const e=typeof this.object[this.attribute];let i;switch(e){case"string":i=t;break;case"number":i=Number.parseFloat(t);break;default:throw Error(`Reference.fromString() isn't yet supported for type ${e}`)}Object.defineProperty(this.object,this.attribute,{value:i})}}function i(t,i){return new e(t,i)}class o extends Array{constructor(t){super(...t?.children);for(let t=0;t<this.length;++t){const e=this[t];"string"==typeof e&&(this[t]=document.createTextNode(e))}}replaceIn(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[t.childNodes.length-1]);this.appendTo(t)}appendTo(t){for(let e of this)t.appendChild(e)}}function s(t,e,i){return void 0!==e&&void 0!==e.children&&(e.children=[e.children]),n(t,e)}function n(t,e,i){let o;if("string"!=typeof t)return new t(e);const s=t;switch(s){case"svg":case"line":case"rect":case"circle":case"path":case"text":o="http://www.w3.org/2000/svg";break;default:o="http://www.w3.org/1999/xhtml"}const n=document.createElementNS(o,s);return l(n,e,o),n}function l(t,e,i){if(null!=e){for(let[o,s]of Object.entries(e))switch(o){case"children":break;case"action":t.setAction(s);break;case"model":t.setModel(s);break;case"class":t.classList.add(s);break;case"style":for(let[e,i]of Object.entries(s)){const o=/[A-Z]/g;e=e.replace(o,(t=>"-"+t.toLowerCase())),t.style.setProperty(e,i)}break;case"set":Object.defineProperty(e.set.object,e.set.attribute,{value:t});break;default:if("on"===o.substring(0,2))t.addEventListener(o.substr(2),s);else if("object"!=typeof s){if("http://www.w3.org/2000/svg"===i){const t=/[A-Z]/g;o=o.replace(t,(t=>"-"+t.toLowerCase()))}t.setAttributeNS(null,o,`${s}`)}}if(void 0!==e.children)for(let i of e.children)"string"==typeof i?t.appendChild(document.createTextNode(i)):t.appendChild(i)}}function r(t,e){const i=document.createElement(t);for(let t=0;t<e.length;++t){let o=e[t];o instanceof Array&&(e.splice(t,1,...o),o=e[t]),"string"!=typeof o?i.appendChild(o):i.appendChild(document.createTextNode(o))}return i}const d=(...t)=>r("span",t),h=(...t)=>r("input",t),a=(...t)=>r("button",t),c="http://www.w3.org/2000/svg";function u(t){const e=document.createElementNS(c,"svg");return e.appendChild(t),e}function p(t){const e=document.createElementNS(c,"path");return void 0!==t&&e.setAttributeNS(null,"d",t),e}class w{constructor(t,e){this.callback=t,this.id=e}}class m{add(t,e){this.callbacks||(this.callbacks=new Array),this.callbacks.push(new w(t,e))}remove(t){if(this.callbacks)for(let e=this.callbacks.length-1;e>=0;--e)this.callbacks[e].id===t&&this.callbacks.splice(e,1)}count(){return this.callbacks?this.callbacks.length:0}lock(){this.locked=!0}unlock(){if(this.locked=void 0,this.triggered){let t=this.triggered.data;this.triggered=void 0,this.trigger(t)}}trigger(t){if(this.locked)this.triggered={data:t};else if(this.callbacks)for(let e=0;e<this.callbacks.length;++e)this.callbacks[e].callback(t)}}class g{constructor(){this._enabled=!0,this.modified=new m}set enabled(t){this._enabled!=t&&(this._enabled=t,this.modified.trigger(void 0))}get enabled(){return this._enabled}}class f extends g{constructor(t){super(),this._value=t}set value(t){this._value!=t&&(this._value=t,this.modified.trigger())}get value(){return this._value}}class b extends f{constructor(t){super(t)}}class y extends f{constructor(t,e){super(t),e&&(this.min=e.min,this.max=e.max,this.step=e.step)}}class v extends g{constructor(t){super(),this._value=t}set promise(t){this._value=t,this.modified.trigger()}get promise(){return"string"==typeof this._value?()=>this._value:this._value}set value(t){this._value!==t&&("string"==typeof t?(this._value=t,this.modified.trigger()):console.trace(`TextModel.set value(value: string): ${typeof t} is not type string`))}get value(){switch(typeof this._value){case"number":case"string":this._value=`${this._value}`;break;case"function":this._value=this._value()}return this._value}}class x extends v{constructor(t){super(t)}}class C extends g{constructor(t,e){super(),this.signal=new m,this.title=e,this._enabled=!0}set value(t){throw Error("Action.value can not be assigned a value")}get value(){throw Error("Action.value can not return a value")}trigger(t){this._enabled&&this.signal.trigger(t)}}class E{constructor(){this.modelId2Models=new Map,this.modelId2Views=new Map,this.view2ModelIds=new Map,this.sigChanged=new m}registerAction(t,e){let i=new C(void 0,t);return i.signal.add(e),this._registerModel("A:"+t,i),i}registerModel(t,e){this._registerModel("M:"+t,e)}_registerModel(t,e){let i=this.modelId2Models.get(t);i||(i=new Set,this.modelId2Models.set(t,i)),i.add(e);let o=this.modelId2Views.get(t);if(o)for(let t of o)t.setModel(e)}registerView(t,e){if(e.controller&&e.controller!==this)return void console.log("error: attempt to register view more than once at different controllers");e.controller=this;let i=this.view2ModelIds.get(e);i||(i=new Set,this.view2ModelIds.set(e,i)),i.add(t);let o=this.modelId2Views.get(t);o||(o=new Set,this.modelId2Views.set(t,o)),o.add(e);let s=this.modelId2Models.get(t);if(s)for(let t of s)e.setModel(t)}unregisterView(t){if(!t.controller)return;if(t.controller!==this)throw Error("attempt to unregister view from wrong controller");let e=this.view2ModelIds.get(t);if(e)for(let i of e){let e=this.modelId2Views.get(i);e&&(e.delete(t),0===e.size&&this.modelId2Views.delete(i),t.setModel(void 0))}}clear(){for(let t of this.view2ModelIds)t[0].setModel(void 0);this.modelId2Models.clear(),this.modelId2Views.clear(),this.view2ModelIds.clear()}bind(t,e){this.registerModel(t,e)}action(t,e){return this.registerAction(t,e)}text(t,e){let i=new v(e);return this.bind(t,i),i}html(t,e){let i=new x(e);return this.bind(t,i),i}boolean(t,e){let i=new b(e);return this.bind(t,i),i}number(t,e,i){let o=new y(e,i);return this.bind(t,o),o}}function k(t){return function(t){let e=document.querySelector('template[id="'+t+'"]');if(!e)throw new Error("failed to find template '"+t+"'");let i=e.content;return document.importNode(i,!0)}(t)}function A(t,e){let i=t.getAttribute(e);if(null===i)throw console.log("missing attribute '"+e+"' in ",t),Error("missing attribute '"+e+"' in "+t.nodeName);return i}function R(t,e){let i=t.getAttribute(e);return null===i?void 0:i}function T(t,e){return function(t){if(""===t)return 0;if("px"!==t.substr(t.length-2))throw Error(`TableView.pixelToNumber('${t}') expected 'px' suffix`);return Number.parseFloat(t.substr(0,t.length-2))}(window.getComputedStyle(t,void 0).getPropertyValue(e))}function N(t){return T(t,"padding-left")+T(t,"padding-right")}function D(t){return T(t,"padding-top")+T(t,"padding-bottom")}class L extends E{constructor(t){super(),this.root=k(t),this.registerViews()}registerViews(){let t=this.root.querySelectorAll("[model]");for(let e of t){let t=e;if(t)try{this.registerView(t.getModelId(),t)}catch(t){}}t=this.root.querySelectorAll("[action]");for(let e of t){let t=e;if(t)try{this.registerView(t.getActionId(),t)}catch(t){}}}openHref(t){}}let M=new E;function _(t,e){M.bind(t,e)}function S(t,e){return M.registerAction(t,e)}class H{constructor(){this._stop=!1,this._firstFrame=this._firstFrame.bind(this),this._animationFrame=this._animationFrame.bind(this)}start(){this.prepare(),!0!==this._stop&&this.requestAnimationFrame(this._firstFrame)}stop(){this._stop=!0,this.animator?.current===this&&(this.animator.current=void 0)}replace(t){this.next=t,this.animationFrame(1),this.lastFrame(),t.prepare()}prepare(){}firstFrame(){}animationFrame(t){}lastFrame(){}requestAnimationFrame(t){window.requestAnimationFrame(t)}_firstFrame(t){this.startTime=t,this.firstFrame(),this._stop||(this.animationFrame(0),this.requestAnimationFrame(this._animationFrame))}_animationFrame(t){if(this.next)return void this.next._firstFrame(t);let e=H.animationFrameCount>0?(t-this.startTime)/H.animationFrameCount:1;e=e>1?1:e;const i=this.ease(e);this.animationFrame(i),this._stop||(i<1?this.requestAnimationFrame(this._animationFrame.bind(this)):(this.lastFrame(),this.animator?.current===this&&(this.animator.current=void 0)))}ease(t){return.5*(1-Math.cos(Math.PI*t))}}H.animationFrameCount=468;class O{run(t){const e=this.current;this.current=t,t.animator=this,e?(e.animator=void 0,e.replace(t)):t.start()}}class I extends g{constructor(){super(),this._stringValue=""}set stringValue(t){this._stringValue!==t&&(this._stringValue=t,this.modified.trigger())}get stringValue(){return this._stringValue}isValidStringValue(t){return!1}}class V extends I{constructor(t){super(),this.enumClass=t}get value(){return this._value}set value(t){this.setValue(t)}get stringValue(){return this.toString()}set stringValue(t){this.fromString(t)}getValue(){return this._value}setValue(t){this._value!==t&&(this._value=t,this.modified.trigger())}toString(){return this.enumClass[this._value]}fromString(t){const e=this.enumClass[t];if(void 0===e||"string"!=typeof this.enumClass[e]){let e="";return Object.keys(this.enumClass).forEach((t=>{const i=this.enumClass[t];"string"==typeof i&&(e=0!==e.length?`${e}, ${i}`:i)})),void console.trace(`EnumModel<T>.fromString('${t}'): invalid value, must be one of ${e}`)}this._value!==e&&(this._value=e,this.modified.trigger())}isValidStringValue(t){const e=this.enumClass[t];return void 0!==e&&"string"==typeof this.enumClass[e]}}class B extends HTMLElement{constructor(t){super(),l(this,t)}static define(t,e,i){const o=window.customElements.get(t);void 0===o?window.customElements.define(t,e,i):o!==e&&console.trace(`View::define(${t}, ...): attempt to redefine view with different constructor`)}attachStyle(t){if(null!==this.shadowRoot){for(let e=0;e<document.styleSheets.length;++e){const i=document.styleSheets.item(e);if(i.href&&i.href.endsWith(`/tx-${t}.css`))return void this.shadowRoot.appendChild(document.importNode(i.ownerNode,!0))}console.log(`failed to locate tx-${t}.css in document`)}else console.trace("this.shadowRoot === null")}setModel(t){console.trace("Please note that View.setModel(model) has no implementation.")}getModelId(){if(!this.hasAttribute("model"))throw Error("no 'model' attribute");let t=this.getAttribute("model");if(!t)throw Error("no model id");return"M:"+t}getActionId(){if(!this.hasAttribute("action"))throw Error("no 'action' attribute");let t=this.getAttribute("action");if(!t)throw Error("no action id");return"A:"+t}connectedCallback(){if(this.controller)return;let t="";try{t=this.getModelId()}catch(t){}""!=t&&M.registerView(t,this)}disconnectedCallback(){this.controller&&this.controller.unregisterView(this)}}class F extends B{constructor(t){super(t),void 0!==t?.model&&this.setModel(t.model)}updateModel(){}updateView(t){}setModel(t){if(t===this.model)return;const e=this;this.model&&this.model.modified.remove(e),t&&t.modified.add((t=>e.updateView(t)),e),this.model=t,this.isConnected&&this.updateView(void 0)}connectedCallback(){super.connectedCallback(),this.model&&this.updateView(void 0)}}class $ extends F{constructor(t){super(t)}connectedCallback(){if(this.controller)this.updateView();else{try{M.registerView(this.getActionId(),this)}catch(t){}try{M.registerView(this.getModelId(),this)}catch(t){}this.updateView()}}disconnectedCallback(){super.disconnectedCallback(),this.controller&&this.controller.unregisterView(this)}setModel(t){if(!t)return this.model&&this.model.modified.remove(this),this.action&&this.action.modified.remove(this),this.model=void 0,this.action=void 0,void this.updateView();if(t instanceof C)this.action=t,this.action.modified.add((()=>{this.updateView()}),this);else{if(!(t instanceof v))throw Error("unexpected model of type "+t.constructor.name);this.model=t,this.model.modified.add((()=>{this.updateView()}),this)}this.updateView()}setAction(t){if(t instanceof Function){const e=new C(void 0,"");e.signal.add(t),this.setModel(e)}else this.setModel(t)}isEnabled(){return void 0!==this.action&&this.action.enabled}}class W extends F{constructor(t){super(t),this.input=document.createElement("input"),this.input.classList.add("tx-text"),this.input.oninput=()=>{this.updateModel()},this.attachShadow({mode:"open"}),this.attachStyle("text"),this.shadowRoot.appendChild(this.input)}focus(){this.input.focus()}blur(){this.input.blur()}static get observedAttributes(){return["value"]}attributeChangedCallback(t,e,i){if("value"===t)this.model&&void 0!==i&&(this.model.value=i)}updateModel(){this.model&&(this.model.value=this.input.value),this.setAttribute("value",this.input.value)}updateView(){if(!this.model)return;const t=`${this.model.value}`;this.input.value!==t&&(this.input.value=t,this.setAttribute("value",this.input.value))}get value(){return this.input.value}set value(t){this.input.value=t,this.updateModel()}}W.define("tx-text",W);let U=document.createElement("style");U.textContent="\n\n/* try to follow material ui: when active render button labels in black, otherwise in gray */\nsvg .fill {\n  fill: #ccc;\n  stroke: #ccc;\n}\nsvg .stroke {\n  fill: none;\n  stroke: #ccc;\n}\nsvg .strokeFill {\n  fill: #fff;\n  stroke: #ccc;\n}\n\n.toolbar.active svg .fill {\n  fill: #000;\n  stroke: #000;\n}\n.toolbar.active svg .stroke {\n  fill: none;\n  stroke: #000;\n}\n.toolbar.active svg .strokeFill {\n  fill: #fff;\n  stroke: #000;\n}\n\n.toolbar button {\n    background: #fff;\n    color: #000;\n    border: 1px #ccc;\n    border-style: solid solid solid none;\n    padding: 5;\n    margin: 0;\n    vertical-align: middle;\n    height: 22px;\n}\n\n.toolbar button:active:hover {\n  background: linear-gradient(to bottom, #7abcff 0%,#0052cc 100%,#4096ee 100%);\n}\n\n.toolbar button.left {\n    border-style: solid;\n    border-radius: 3px 0 0 3px;\n}\n\n.toolbar button.right {\n    border: 1px #ccc;\n    border-style: solid solid solid none;\n    border-radius: 0 3px 3px 0;\n}\n\n.toolbar button.active {\n    background: linear-gradient(to bottom, #7abcff 0%,#0052cc 100%,#4096ee 100%);\n    border: 1px #0052cc solid;\n    color: #fff;\n}\n\ndiv.textarea {\n  font-family: var(--tx-font-family);\n  font-size: var(--tx-font-size);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n  outline-offset: -2px;\n}\n\ndiv.textarea h1 {\n  font-size: 22px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h2 {\n  font-size: 18px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h3 {\n  font-size: 16px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h4 {\n  font-size: 14px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea div {\n  padding: 2px 0 2px 0;\n}\n";class z extends F{constructor(){super(),z.texttool=this;let t=s("div",{class:"toolbar"});this.buttonH1=s("button",{class:"left",children:"H1"}),this.buttonH1.onclick=()=>{document.execCommand("formatBlock",!1,"<h1>"),this.update()},t.appendChild(this.buttonH1),this.buttonH2=s("button",{children:"H2"}),this.buttonH2.onclick=()=>{document.execCommand("formatBlock",!1,"<h2>"),this.update()},t.appendChild(this.buttonH2),this.buttonH3=s("button",{children:"H3"}),this.buttonH3.onclick=()=>{document.execCommand("formatBlock",!1,"<h3>"),this.update()},t.appendChild(this.buttonH3),this.buttonH4=s("button",{class:"right",children:"H4"}),this.buttonH4.onclick=()=>{document.execCommand("formatBlock",!1,"<h4>"),this.update()},t.appendChild(this.buttonH4),t.appendChild(document.createTextNode(" ")),this.buttonBold=s("button",{class:"left",children:s("b",{children:"B"})}),this.buttonBold.onclick=()=>{document.execCommand("bold",!1),this.update()},t.appendChild(this.buttonBold),this.buttonItalic=s("button",{children:s("i",{children:"I"})}),this.buttonItalic.onclick=()=>{document.execCommand("italic",!1),this.update()},t.appendChild(this.buttonItalic),this.buttonUnderline=s("button",{children:s("u",{children:"U"})}),this.buttonUnderline.onclick=()=>{document.execCommand("underline",!1),this.update()},t.appendChild(this.buttonUnderline),this.buttonStrikeThrough=s("button",{children:s("strike",{children:"S"})}),this.buttonStrikeThrough.onclick=()=>{document.execCommand("strikeThrough",!1),this.update()},t.appendChild(this.buttonStrikeThrough),this.buttonSubscript=s("button",{children:"x₂"}),this.buttonSubscript.onclick=()=>{document.execCommand("subscript",!1),this.update()},t.appendChild(this.buttonSubscript),this.buttonSuperscript=s("button",{class:"right",children:"x²"}),this.buttonSuperscript.onclick=()=>{document.execCommand("superscript",!1),this.update()},t.appendChild(this.buttonSuperscript),t.appendChild(document.createTextNode(" ")),this.buttonJustifyLeft=s("button",{class:"left",children:n("svg",{viewBox:"0 0 10 9",width:"10",height:"9",children:[s("line",{x1:"0",y1:"0.5",x2:"10",y2:"0.5",stroke:"#000"}),s("line",{x1:"0",y1:"2.5",x2:"6",y2:"2.5",stroke:"#000"}),s("line",{x1:"0",y1:"4.5",x2:"10",y2:"4.5",stroke:"#000"}),s("line",{x1:"0",y1:"6.5",x2:"6",y2:"6.5",stroke:"#000"}),s("line",{x1:"0",y1:"8.5",x2:"10",y2:"8.5",stroke:"#000"})]})}),this.buttonJustifyLeft.onclick=()=>{document.execCommand("justifyLeft",!1),this.update()},t.appendChild(this.buttonJustifyLeft),this.buttonJustifyCenter=s("button",{children:n("svg",{viewBox:"0 0 10 9",width:"10",height:"9",children:[s("line",{x1:"0",y1:"0.5",x2:"10",y2:"0.5",stroke:"#000"}),s("line",{x1:"2",y1:"2.5",x2:"8",y2:"2.5",stroke:"#000"}),s("line",{x1:"0",y1:"4.5",x2:"10",y2:"4.5",stroke:"#000"}),s("line",{x1:"2",y1:"6.5",x2:"8",y2:"6.5",stroke:"#000"}),s("line",{x1:"0",y1:"8.5",x2:"10",y2:"8.5",stroke:"#000"})]})}),this.buttonJustifyCenter.onclick=()=>{document.execCommand("justifyCenter",!1),this.update()},t.appendChild(this.buttonJustifyCenter),this.buttonJustifyRight=s("button",{class:"right",children:n("svg",{viewBox:"0 0 10 9",width:"10",height:"9",children:[s("line",{x1:"0",y1:"0.5",x2:"10",y2:"0.5",stroke:"#000"}),s("line",{x1:"4",y1:"2.5",x2:"10",y2:"2.5",stroke:"#000"}),s("line",{x1:"0",y1:"4.5",x2:"10",y2:"4.5",stroke:"#000"}),s("line",{x1:"4",y1:"6.5",x2:"10",y2:"6.5",stroke:"#000"}),s("line",{x1:"0",y1:"8.5",x2:"10",y2:"8.5",stroke:"#000"})]})}),this.buttonJustifyRight.onclick=()=>{document.execCommand("justifyRight",!1),this.update()},t.appendChild(this.buttonJustifyRight),this.buttonUnorderedList=s("button",{class:"left",children:n("svg",{style:{display:"block"},viewBox:"0 0 17 11.5",width:"17",height:"11.5",children:[s("circle",{cx:"4.5",cy:"1.5",r:"0.8",stroke:"#000",fill:"#000"}),s("line",{x1:"7",y1:"1.5",x2:"17",y2:"1.5",stroke:"#000"}),s("circle",{cx:"4.5",cy:"5.5",r:"0.8",stroke:"#000",fill:"#000"}),s("line",{x1:"7",y1:"5.5",x2:"17",y2:"5.5",stroke:"#000"}),s("circle",{cx:"4.5",cy:"9.5",r:"0.8",stroke:"#000",fill:"#000"}),s("line",{x1:"7",y1:"9.5",x2:"17",y2:"9.5",stroke:"#000"})]})}),this.buttonUnorderedList.onclick=t=>{document.execCommand("insertUnorderedList",!1),this.update()},t.appendChild(this.buttonUnorderedList),this.buttonOrderedList=s("button",{class:"right",children:n("svg",{style:{display:"block"},viewBox:"0 0 17 11.5",width:"17",height:"11.5",children:[s("line",{x1:"4.5",y1:"0",x2:"4.5",y2:"3",stroke:"#000"}),s("line",{x1:"7",y1:"1.5",x2:"17",y2:"1.5",stroke:"#000"}),s("line",{x1:"2.5",y1:"4",x2:"2.5",y2:"7",stroke:"#000"}),s("line",{x1:"4.5",y1:"4",x2:"4.5",y2:"7",stroke:"#000"}),s("line",{x1:"7",y1:"5.5",x2:"17",y2:"5.5",stroke:"#000"}),s("line",{x1:"0.5",y1:"8",x2:"0.5",y2:"11",stroke:"#000"}),s("line",{x1:"2.5",y1:"8",x2:"2.5",y2:"11",stroke:"#000"}),s("line",{x1:"4.5",y1:"8",x2:"4.5",y2:"11",stroke:"#000"}),s("line",{x1:"7",y1:"9.5",x2:"17",y2:"9.5",stroke:"#000"})]})}),this.buttonOrderedList.onclick=()=>{document.execCommand("insertOrderedList",!1),this.update()},t.appendChild(this.buttonOrderedList),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(U,!0)),this.shadowRoot.appendChild(t)}update(){this.buttonH1.classList.toggle("active","h1"===document.queryCommandValue("formatBlock")),this.buttonH2.classList.toggle("active","h2"===document.queryCommandValue("formatBlock")),this.buttonH3.classList.toggle("active","h3"===document.queryCommandValue("formatBlock")),this.buttonH4.classList.toggle("active","h4"===document.queryCommandValue("formatBlock")),this.buttonBold.classList.toggle("active",document.queryCommandState("bold")),this.buttonItalic.classList.toggle("active",document.queryCommandState("italic")),this.buttonUnderline.classList.toggle("active",document.queryCommandState("underline")),this.buttonStrikeThrough.classList.toggle("active",document.queryCommandState("strikeThrough")),this.buttonSubscript.classList.toggle("active",document.queryCommandState("subscript")),this.buttonSuperscript.classList.toggle("active",document.queryCommandState("superscript")),this.buttonJustifyLeft.classList.toggle("active",document.queryCommandState("justifyLeft")),this.buttonJustifyCenter.classList.toggle("active",document.queryCommandState("justifyCenter")),this.buttonJustifyRight.classList.toggle("active",document.queryCommandState("justifyRight"))}}z.define("tx-texttool",z);class P extends F{constructor(){super();let t=document.createElement("div");this.content=t,t.classList.add("tx-text"),t.contentEditable="true",t.oninput=e=>{if(this.model instanceof x){let i=e.target.firstChild;i&&3===i.nodeType?document.execCommand("formatBlock",!1,"<div>"):"<br>"===t.innerHTML&&(t.innerHTML="")}this.updateModel()},t.onkeydown=t=>{this.model instanceof x&&(!0===t.metaKey&&"b"===t.key?(t.preventDefault(),document.execCommand("bold",!1),this.updateTextTool()):!0===t.metaKey&&"i"===t.key?(t.preventDefault(),document.execCommand("italic",!1),this.updateTextTool()):!0===t.metaKey&&"u"===t.key?(t.preventDefault(),document.execCommand("underline",!1),this.updateTextTool()):"Tab"===t.key?t.preventDefault():"Enter"===t.key&&!0!==t.shiftKey&&"blockquote"===document.queryCommandValue("formatBlock")&&document.execCommand("formatBlock",!1,"<p>"))},t.onkeyup=()=>{this.updateTextTool()},t.onmouseup=()=>{this.updateTextTool()},this.attachShadow({mode:"open"}),this.attachStyle("text"),this.shadowRoot.appendChild(t)}updateTextTool(){void 0!==z.texttool&&z.texttool.update()}updateModel(){this.model&&(this.model.promise=()=>this.model instanceof x?this.content.innerHTML:this.content.innerText)}updateView(){this.model&&(this.model instanceof x?this.content.innerHTML!==this.model.value&&(this.content.innerHTML=this.model.value):this.content.innerText!==this.model.value&&(this.content.innerText=this.model.value))}}P.define("tx-textarea",P);class j extends ${constructor(t){super(t),this.button=a(this.label=d()),this.button.classList.add("tx-button"),this.label.classList.add("tx-label"),this.button.onclick=()=>{this.action&&this.action.trigger()},this.button.disabled=!0,this.attachShadow({mode:"open"}),this.attachStyle("button"),this.shadowRoot.appendChild(this.button)}connectedCallback(){super.connectedCallback(),0===this.children.length&&(this._observer=new MutationObserver(((t,e)=>{void 0!==this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout((()=>{this._timer=void 0,this.updateView()}),100)})),this._observer.observe(this,{childList:!0,subtree:!0,characterData:!0}))}updateView(){this.isConnected&&(this.model&&this.model.value?this.model instanceof x?this.label.innerHTML=this.model.value:this.label.innerText=this.model.value:this.label.innerHTML=this.innerHTML,this.button.disabled=!this.isEnabled())}}j.define("tx-button",j);class G extends F{setModel(t){if(void 0!==t&&!(t instanceof b))throw Error("BooleanView.setModel(): model is not of type BooleanModel");super.setModel(t)}updateModel(){this.model&&(this.model.value=this.input.checked)}updateView(){this.model&&this.model.enabled?this.input.removeAttribute("disabled"):this.input.setAttribute("disabled",""),this.model&&(this.input.checked=this.model.value)}}class Y extends G{constructor(){super(),this.classList.add("tx-checkbox"),this.input=h(),this.input.type="checkbox",this.input.onchange=()=>{this.updateModel()};const t=u(p("M3.5 9.5a.999.999 0 01-.774-.368l-2.45-3a1 1 0 111.548-1.264l1.657 2.028 4.68-6.01A1 1 0 019.74 2.114l-5.45 7a1 1 0 01-.777.386z"));this.attachShadow({mode:"open"}),this.attachStyle("checkbox"),this.shadowRoot.appendChild(this.input),this.shadowRoot.appendChild(t)}}Y.define("tx-checkbox",Y);class q extends G{constructor(){super(),this.classList.add("tx-switch"),this.input=h(),this.input.type="checkbox",this.input.onchange=()=>{this.updateModel()},this.attachShadow({mode:"open"}),this.attachStyle("switch"),this.shadowRoot.appendChild(this.input),this.shadowRoot.appendChild(d())}}q.define("tx-switch",q);class J extends F{constructor(t){super(t),this.classList.add("tx-radio"),this.input=h(),this.input.type="radio",this.input.value=this.getAttribute("value");let e=this;this.input.onchange=()=>{e.updateModel()},this.attachShadow({mode:"open"}),this.attachStyle("radio"),this.shadowRoot.appendChild(this.input),this.shadowRoot.appendChild(d())}updateModel(){this.model&&(this.model.stringValue=this.input.value)}updateView(){if(this.model){let t=J.radioGroups.get(this.model);void 0===t&&(t=++J.radioGroupCounter,J.radioGroups.set(this.model,t)),this.input.name=`radioGroup${t}`}else this.input.name="";this.model&&this.model.enabled?this.input.removeAttribute("disabled"):this.input.setAttribute("disabled",""),this.model&&(this.input.checked=this.model.stringValue===this.input.value)}}var K;J.radioGroupCounter=0,J.radioGroups=new WeakMap,J.define("tx-radiobutton",J),function(t){t[t.WAIT=0]="WAIT",t[t.DOWN=1]="DOWN",t[t.UP_N_HOLD=2]="UP_N_HOLD",t[t.DOWN_N_HOLD=3]="DOWN_N_HOLD",t[t.DOWN_N_OUTSIDE=4]="DOWN_N_OUTSIDE",t[t.DOWN_N_INSIDE_AGAIN=5]="DOWN_N_INSIDE_AGAIN"}(K||(K={}));class X extends B{constructor(t){super(t),this.vertical=!0,this.closeOnClose=!1,this.state=K.WAIT}}class Z extends X{constructor(t,e){super(),this.vertical=!0,this.root=t,this.parentButton=e,this.popup=document.createElement("div"),this.popup.classList.add("menu-popup");let i=t.down;for(;i;)i.isAvailable()?i.createWindowAt(this,this.popup):i.deleteWindow(),i=i.next;this.appendChild(this.popup),this.show()}show(){this.parentButton.master.vertical?function(t,e){let i=t.getBoundingClientRect();e.style.opacity="0",e.style.left=i.left+i.width+"px",e.style.top=i.top+"px",setTimeout((function(){let t=e.getBoundingClientRect();i.top+t.height>window.innerHeight&&(e.style.top=i.top+i.height-t.height+"px"),i.left+i.width+t.width>window.innerWidth&&(e.style.left=i.left-t.width+"px"),e.style.opacity="1"}),0)}(this.parentButton,this.popup):Q(this.parentButton,this.popup),this.style.display=""}hide(){this.style.display="none"}}function Q(t,e){let i=t.getBoundingClientRect();e.style.opacity="0",e.style.left=i.left+"px",e.style.top=i.top+i.height+"px",setTimeout((function(){let t=e.getBoundingClientRect();i.top+i.height+t.height>window.innerHeight&&(e.style.top=i.top-t.height+"px"),i.left+t.width>window.innerWidth&&(e.style.left=i.left+i.width-t.width+"px"),e.style.opacity="1"}),0)}B.define("tx-popupmenu",Z);class tt extends F{constructor(){super(),this.input=h(),this.input.type="text";let t,e=this;this.input.oninput=()=>{e.updateModel()};const i=a(t=u(p("M3 9.95a.875.875 0 01-.615-1.498L5.88 5 2.385 1.547A.875.875 0 013.615.302L7.74 4.377a.876.876 0 010 1.246L3.615 9.698A.872.872 0 013 9.95z")));i.tabIndex=-1,t.style.width="100%",t.style.height="100%",i.onpointerdown=t=>{t.preventDefault(),this.input.focus(),this.open(),i.setPointerCapture(t.pointerId)},i.onpointermove=t=>{if(void 0===this.popup)return;const e=this.shadowRoot.elementFromPoint(t.clientX,t.clientY);let i;i=e instanceof HTMLLIElement?e:void 0,this.hover!==i&&(this.hover&&this.hover.classList.remove("tx-hover"),this.hover=i,this.hover&&this.hover.classList.add("tx-hover"))},i.onpointerup=t=>{this.close(),this.hover&&this.select(parseInt(this.hover.dataset.idx))},this.classList.add("tx-combobox"),this.attachShadow({mode:"open"}),this.attachStyle("combobox"),this.attachStyle("menu"),this.shadowRoot.appendChild(this.input),this.shadowRoot.appendChild(i)}updateModel(){}updateView(){this.model&&(this.model&&this.model.enabled?this.input.removeAttribute("disabled"):this.input.setAttribute("disabled",""),void 0!==this.model&&(this.input.value=this.displayName(this.model.stringValue)))}displayName(t){for(let e=0;e<this.children.length;++e){const i=this.children[e];if("OPTION"===i.nodeName){const e=i;if(e.value===t)return e.text}}let e="";for(let t=0;t<this.children.length;++t){const i=this.children[t];if("OPTION"===i.nodeName){e=`${e} '${i.value}'`}}return console.log(`Select(model=${this.getAttribute("model")}).displayName('${t}'): not in${e} of`),console.trace(this),""}open(){let t,e=this;this.popup=((...t)=>r("div",t))(t=((...t)=>r("ul",t))(...function(t,e){let i=[];for(let o=0;o<t;++o){const t=e(o);t instanceof Array?i.push(...t):i.push(t)}return i}(this.children.length,(t=>{const i=((...t)=>r("li",t))(function(t){return document.createTextNode(t)}(this.children.item(t).innerText));return i.tabIndex=0,i.ariaRoleDescription="option",i.dataset.idx=`${t}`,i.onclick=()=>{e.select(t)},this.children[t],i})))),this.popup.classList.add("tx-popover"),this.popup.style.position="fixed",this.popup.style.zIndex="99",t.ariaRoleDescription="listbox",t.classList.add("tx-menu"),this.shadowRoot.appendChild(this.popup),Q(this,this.popup)}close(){this.popup&&(this.shadowRoot.removeChild(this.popup),this.popup=void 0)}select(t){this.close(),this.model.stringValue=this.children[t].value}}tt.define("tx-select",tt);class et extends F{constructor(t){super(t),this.input=document.createElement("input"),this.input.type="range";let e=this;this.input.oninput=()=>{e.updateModel()},this.classList.add("tx-slider"),this.attachShadow({mode:"open"}),this.attachStyle("slider"),this.shadowRoot.appendChild(this.input)}updateModel(){this.model&&(this.model.value=Number.parseFloat(this.input.value))}updateView(){this.model&&(void 0===this.model.step&&void 0!==this.model.min&&void 0!==this.model.max?this.input.step=""+(this.model.max-this.model.min)/100:this.input.step=String(this.model.step),this.input.min=String(this.model.min),this.input.max=String(this.model.max),this.input.value=String(this.model.value))}}et.define("tx-slider",et);class it extends B{static focusIn(t){const e=new Map;for(let i=t.parentElement,o=0;null!==i;i=i.parentElement,++o)e.set(i,o);let i,o,s=Number.MAX_SAFE_INTEGER,n=new Array;for(const o of this.allTools.values())if(o.canHandle(t))for(let t=o.parentElement,l=0;null!==t;t=t.parentElement,++l){const l=e.get(t);void 0!==l&&(s<l||(s>l&&(n.length=0),s=l,i=t,n.push(o)))}if(!i)return;const l=it.getIndex(t,i);let r=Number.MIN_SAFE_INTEGER;for(let t of n){const e=it.getIndex(t,i);e<l&&e>r&&(r=e,o=t)}this.setActive(o,t)}static getIndex(t,e){void 0===e&&console.trace(`GenericTool.getIndex(${t}, ${e})`);let i=t;for(;i.parentElement!==e;)i=i.parentElement;return Array.from(e.childNodes).indexOf(i)}static setActive(t,e){this.activeTool&&this.activeTool.deactivate(),this.activeTool=t,this.activeView=e,t&&t.activate()}static focusOut(t){this.activeView===t&&this.setActive(void 0,void 0)}connectedCallback(){super.connectedCallback(),it.allTools.add(this)}disconnectedCallback(){it.activeTool===this&&it.setActive(void 0,void 0),it.allTools.delete(this),super.disconnectedCallback()}}it.allTools=new Set,window.addEventListener("focusin",(t=>{t.target instanceof it||(t.relatedTarget instanceof B&&it.focusOut(t.relatedTarget),t.target instanceof B&&it.focusIn(t.target))}));let ot=document.createElement("style");ot.textContent="\n:host {\n    display: inline-block;\n    overflow: hidden;\n    box-sizing: border-box;\n    border: 1px solid #e3dbdb;\n    border-radius: 3px;\n    background: #e3dbdb;\n    width: 32px;\n    height: 32px;\n    margin: 0;\n    padding: 0;\n}\n\n:host([selected]) {\n    background: #ac9393;\n}\n\n:host([disabled]) {\n    opacity: 0.5;\n}\n\n:host([disabled]) img {\n    opacity: 0.5;\n}\n\n:host([checked][disabled]) {\n}\n";class st extends F{constructor(t){super(t),t?(this.setAttribute("value",t.value),this.setAttribute("img",t.img),!0===t.disabled&&this.setAttribute("disabled","disabled")):t={value:this.getAttribute("value"),img:this.getAttribute("img"),disabled:this.hasAttribute("disabled")},this.onmousedown=t=>{this.hasAttribute("disabled")||(this.focus(),t.preventDefault(),void 0!==this.model&&(this.model.stringValue=this.getValue()))};let e=document.createElement("img");e.src=t.img,this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(ot,!0)),this.shadowRoot.appendChild(e)}getValue(){let t=this.getAttribute("value");if(null===t)throw Error("no value");return t}connectedCallback(){super.connectedCallback(),void 0===this.model&&this.setAttribute("disabled","")}updateView(){if(void 0===this.model)return this.setAttribute("disabled",""),void this.removeAttribute("selected");let t=this.getValue();this.model.isValidStringValue(t)?this.removeAttribute("disabled"):this.setAttribute("disabled",""),this.model.stringValue===t?this.setAttribute("selected",""):this.removeAttribute("selected")}}st.define("tx-toolbutton",st);class nt extends F{constructor(){super()}updateView(){if(!this.model)return;let t=void 0===this.model.value?"":this.model.value;this.model instanceof x?this.innerHTML=t:this.innerText=t}}nt.define("tx-slot",nt);class lt extends F{updateView(){this.model&&(this.style.display=this.model.value?"":"none")}}lt.define("tx-if",lt);const rt=document.createElement("style");rt.textContent=`\n  :host(.menu-button) {\n    font-family: var(--tx-font-family);\n    font-size: var(--tx-edit-font-size);\n    font-weight: var(--tx-edit-font-weight);\n    padding: 7px;\n    vertical-align: center;\n  \n    background: var(--tx-gray-200);\n    color: var(--tx-gray-900);\n    cursor: default;\n  }\n  :host(.menu-button:hover) {\n    background: var(--tx-gray-300);\n  }\n  :host(.menu-button.active) {\n    background: var(--tx-gray-400);\n    color: var(--tx-gray-900);\n  }\n  :host(.menu-button.disabled) {\n    color: var(--tx-gray-500);\n  }\n  :host(.menu-button.active.disabled) {\n    color: var(--tx-gray-700);\n  }\n  :host(.menu-button.menu-down) {\n    padding-right: 20px;\n    background-image: url("data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14"><path d="M 0 4 l 10 0 l -5 5 Z" fill="#fff" stroke="none"/></svg>')}");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-down) {\n    background-image: url("data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14"><path d="M 0 4 l 10 0 l -5 5 Z" fill="#fff" stroke="none"/></svg>')}");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.menu-side) {\n    padding-right: 20px;\n    background-image: url("data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14"><path d="M 0 2 l 0 10 l 5 -5 Z" fill="#fff" stroke="none"/></svg>')}");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-side) {\n    background-image: url("data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14"><path d="M 0 2 l 0 10 l 5 -5 Z" fill="#fff" stroke="none"/></svg>')}");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  .menu-bar {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n    background-color: var(--tx-gray-200);\n  }\n  .menu-popup {\n    position: fixed;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 2px 2px 5px var(--tx-gray-50);\n  }\n`;class dt extends F{constructor(t,e){super(),this.master=t,this.node=e;let i=this;if(this.classList.add("menu-button"),e.down&&(t.vertical?this.classList.add("menu-side"):this.classList.add("menu-down")),this.updateView(),this.onmousedown=t=>{t.stopPropagation();let e=function(t){document.removeEventListener("mouseup",e,{capture:!0}),t.preventDefault(),setTimeout((()=>{dt.buttonDown&&i.dispatchEvent(new MouseEvent("mouseup",t))}),0)};if(document.addEventListener("mouseup",e,{capture:!0}),dt.buttonDown=!0,!this.master)throw Error("yikes");switch(this.master.state){case K.WAIT:this.master.state=K.DOWN,this.activate();break;case K.UP_N_HOLD:this.master.active!==this?(this.master.state=K.DOWN,this.activate()):this.master.state=K.DOWN_N_HOLD;break;default:throw Error("unexpected state "+this.master.state)}return!1},this.onmouseup=t=>{if(t.stopPropagation(),dt.buttonDown){if(dt.buttonDown=!1,!this.master)throw Error("yikes");if(!this.node)throw Error("yikes");switch(this.master.state){case K.DOWN:this.node.isEnabled()&&!this.node.down?(this.trigger(),this.master.state=K.WAIT):(this.master.state=K.UP_N_HOLD,dt.documentMouseDown&&document.removeEventListener("mousedown",dt.documentMouseDown,{capture:!1}),dt.documentMouseDown=function(t){dt.documentMouseDown&&document.removeEventListener("mousedown",dt.documentMouseDown,{capture:!1}),dt.documentMouseDown=void 0,"TOAD-MENUBUTTON"!==t.target.tagName&&i.collapse()},document.addEventListener("mousedown",dt.documentMouseDown,{capture:!1}));break;case K.DOWN_N_HOLD:case K.DOWN_N_OUTSIDE:this.master.state=K.WAIT,this.deactivate(),this.collapse(),this.master.closeOnClose;break;case K.DOWN_N_INSIDE_AGAIN:this.trigger();break;default:throw Error("unexpected state "+this.master.state)}return!1}},this.onmouseout=t=>{if(t.stopPropagation(),!this.master)throw Error("yikes");switch(dt.inside=void 0,this.master.state){case K.WAIT:case K.DOWN_N_OUTSIDE:case K.UP_N_HOLD:case K.DOWN_N_HOLD:break;case K.DOWN:case K.DOWN_N_INSIDE_AGAIN:this.master.state=K.DOWN_N_OUTSIDE,this.updateView();break;default:throw Error("unexpected state")}return!1},this.onmouseover=t=>{if(t.stopPropagation(),!i.master)throw Error("yikes");switch(dt.inside=i,i.master.state){case K.WAIT:case K.UP_N_HOLD:case K.DOWN_N_OUTSIDE:case K.DOWN_N_HOLD:case K.DOWN:case K.DOWN_N_INSIDE_AGAIN:if(!dt.buttonDown)break;if(!this.master)throw Error("yikes");this.master.active&&this.master.active.deactivate(),this.master.state=K.DOWN_N_INSIDE_AGAIN,this.activate();break;default:throw Error("unexpected state "+i.master.state)}return!1},this.attachShadow({mode:"open"}),!this.shadowRoot)throw Error("yikes");this.shadowRoot.appendChild(document.importNode(rt,!0)),this.node.modelId||this.shadowRoot.appendChild(document.createTextNode(e.label))}connectedCallback(){if(!this.controller){if(void 0===this.node.down){let t=this.node.title;for(let e=this.node.parent;e&&e.title.length;e=e.parent)t=e.title+"|"+t;t="A:"+t,M.registerView(t,this)}if(void 0!==this.node.modelId)if("string"==typeof this.node.modelId){let t="M:"+this.node.modelId;M.registerView(t,this)}else this.setModel(this.node.modelId)}}disconnectedCallback(){this.controller&&this.controller.unregisterView(this)}setModel(t){if(!t)return this.action&&this.action.modified.remove(this),this.model=void 0,this.action=void 0,void this.updateView();if(t instanceof C)this.action=t,this.action.modified.add((()=>{this.updateView()}),this);else{if(!(t instanceof v))throw Error("unexpected model of type "+t.constructor.name);this.model=t}this.updateView()}updateView(){if(this.model&&this.model.value){if(!this.shadowRoot)throw Error("yikes");let t=document.createElement("span");this.model instanceof x?t.innerHTML=this.model.value:t.innerText=this.model.value,this.shadowRoot.children.length>1&&this.shadowRoot.removeChild(this.shadowRoot.children[1]),this.shadowRoot.children.length>1?this.shadowRoot.insertBefore(t,this.shadowRoot.children[1]):this.shadowRoot.appendChild(t)}if(!this.master)throw Error("yikes");let t=!1;if(this.master.active==this)switch(this.master.state){case K.DOWN:case K.UP_N_HOLD:case K.DOWN_N_HOLD:case K.DOWN_N_INSIDE_AGAIN:t=!0;break;case K.DOWN_N_OUTSIDE:if(!this.node)throw Error("yikes");t=void 0!==this.node.down&&this.node.isEnabled()}this.classList.toggle("active",t),this.classList.toggle("disabled",!this.isEnabled())}isEnabled(){return void 0!==this.node.down||void 0!==this.action&&this.action.enabled}trigger(){this.collapse(),this.action&&this.action.trigger()}collapse(){if(!this.master)throw Error("yikes");this.master.parentButton?this.master.parentButton.collapse():this.deactivate()}openPopup(){if(this.node&&this.node.down){if(!this.shadowRoot)throw Error("yikes");this.popup?this.popup.show():(this.popup=new Z(this.node,this),this.shadowRoot.appendChild(this.popup))}}closePopup(){this.popup&&(this.popup.active&&this.popup.active.deactivate(),this.popup.hide())}activate(){if(!this.master)throw Error("yikes");if(!this.node)throw Error("yikes");let t=this.master.active;this.master.active=this,t&&t!==this&&(t.closePopup(),t.updateView()),this.updateView(),this.openPopup()}deactivate(){if(!this.master)throw Error("yikes");this.master.active===this&&(this.master.active.closePopup(),this.master.active=void 0,this.master.state=K.WAIT,this.updateView())}}dt.define("tx-menubutton",dt);class ht{constructor(t,e,i,o,s){this.title=t,this.label=e,this.shortcut=i,this.type=o||"entry",this.modelId=s}isEnabled(){return!0}isAvailable(){return!0}createWindowAt(t,e){if("spacer"==this.type){let t=document.createElement("span");return t.style.flexGrow="1",void e.appendChild(t)}this.view=new dt(t,this),e.appendChild(this.view)}deleteWindow(){}}class at extends X{constructor(t){super(t),this.config=t?.config,this.vertical=!1,this.root=new ht("","",void 0,void 0)}connectedCallback(){if(super.connectedCallback(),this.tabIndex=0,this.config)return this.config2nodes(this.config,this.root),this.referenceActions(),void this.createShadowDOM();0===this.children.length?(this._observer=new MutationObserver(((t,e)=>{void 0!==this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout((()=>{this._timer=void 0,this.layout2nodes(this.children,this.root),this.referenceActions(),this.createShadowDOM()}),100)})),this._observer.observe(this,{childList:!0,subtree:!0})):(this.layout2nodes(this.children,this.root),this.referenceActions(),this.createShadowDOM())}layout2nodes(t,e){let i=e.down;for(let o of t){let t;switch(o.nodeName){case"TX-MENUSPACER":t=new ht("","","","spacer");break;case"TX-MENUENTRY":t=new ht(A(o,"name"),A(o,"label"),R(o,"shortcut"),R(o,"type"),R(o,"model"))}if(t&&(t.parent=e,i?i.next=t:e.down=t,i=t),!i)throw Error("yikes");this.layout2nodes(o.children,i)}}config2nodes(t,e){let i=e.down;for(let o of t){let t;if(t=!0===o.space?new ht("","","","spacer"):new ht(o.name,o.label,o.shortcut,o.type,o.model),t&&(t.parent=e,i?i.next=t:e.down=t,i=t),!i)throw Error("yikes");o.sub&&this.config2nodes(o.sub,i)}}referenceActions(){}findNode(t,e){let i=t.indexOf("|"),o=-1==i?t:t.substr(0,i),s=-1==i?"":t.substr(i+1);e||(e=this.root);for(let t=e.down;t;t=t.next)if(t.title==o)return t.down?this.findNode(s,t):t}createShadowDOM(){this.view=document.createElement("div"),this.view.classList.add("menu-bar");let t=this.root.down;for(;t;)t.isAvailable()?t.createWindowAt(this,this.view):t.deleteWindow(),t=t.next;this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(rt,!0)),this.shadowRoot.appendChild(this.view)}}at.define("tx-menu",at);class ct extends HTMLElement{}B.define("tx-menuspacer",ct);function ut(t){if(void 0===t)return;const e=vt(t);if(void 0===e)return;const i=e.getBoundingClientRect(),o=t.getBoundingClientRect();if(e!==document.body){const{x:t,y:s}=function(t,e,i){const o=16,s=i.left+t.scrollLeft-e.left-o,n=i.right+t.scrollLeft-e.left+o,l=i.top+t.scrollTop-e.top-o,r=i.bottom+t.scrollTop-e.top+o,d=t.clientWidth,h=t.clientHeight;var a=t.scrollLeft,c=t.scrollTop;n-s-2*o>d?a=s:n>t.scrollLeft+d?a=n-d:s<t.scrollLeft&&(a=s);r-l-2*o>h?c=l:r>t.scrollTop+h?c=r-h:l<t.scrollTop&&(c=l);return a=Math.max(0,a),c=Math.max(0,c),{x:a,y:c}}(e,i,o);!function(t,e,i){let o,s,n=pt.get(t);void 0===n?(n={x:e,y:i},pt.set(t,n)):(n.x=e,n.y=i);t===document.body?(o=window.scrollX||window.pageXOffset,s=window.scrollY||window.pageYOffset):(o=t.scrollLeft,s=t.scrollTop);const l=e-o,r=i-s;if(0===l&&0===r)return void pt.delete(t);d=d=>{if(n.x!==e||n.y!==i)return!1;const h=o+d*l,a=s+d*r;return t===document.body?window.scrollTo(h,a):(t.scrollLeft=h,t.scrollTop=a),1===d&&pt.delete(t),!0},setTimeout((()=>{window.requestAnimationFrame(mt.bind(window,d,void 0,void 0))}),0);var d}(e,t,s),"fixed"!==window.getComputedStyle(e).position&&window.scrollBy({left:i.left,top:i.top,behavior:"smooth"})}else window.scrollBy({left:o.left,top:o.top,behavior:"smooth"})}const pt=new Map;let wt=0;function mt(t,e,i){void 0===e&&(e=Date.now(),i=++wt);let o=(Date.now()-e)/468;o=o>1?1:o;const s=(n=o,.5*(1-Math.cos(Math.PI*n)));var n;!1!==t(s)&&s<1&&window.requestAnimationFrame(mt.bind(window,t,e,i))}var gt,ft,bt,yt=(gt=window.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(gt)?1:0);function vt(t){for(;t!==document.body&&!1===xt(t);){if(null===t.parentElement)return;t=t.parentElement}return t}function xt(t){const e=Ct(t,"Y")&&Et(t,"Y"),i=Ct(t,"X")&&Et(t,"X");return e||i}function Ct(t,e){return"X"===e?t.clientWidth+yt<t.scrollWidth:t.clientHeight+yt<t.scrollHeight}function Et(t,e){const i=window.getComputedStyle(t,null)["overflow"+e];return"auto"===i||"scroll"===i}class kt extends g{isEmpty(){return 0===this.colCount&&0===this.rowCount}}!function(t){t[t.EDIT_CELL=0]="EDIT_CELL",t[t.SELECT_CELL=1]="SELECT_CELL",t[t.SELECT_ROW=2]="SELECT_ROW"}(ft||(ft={}));class At{constructor(t,e){this.col=t,this.row=e}}class Rt extends g{constructor(t=ft.EDIT_CELL){super(),this.mode=t,this._value=new At(0,0)}set col(t){this._value.col!==t&&(this._value.col=t,this.modified.trigger())}get col(){return this._value.col}set row(t){this._value.row!==t&&(this._value.row=t,this.modified.trigger())}get row(){return this._value.row}set value(t){this._value.col===t.col&&this._value.row===t.row||(this._value=t,this.modified.trigger())}get value(){return this._value}}class Tt extends kt{constructor(t,e){super(),this.nodeClass=t}}class Nt{get colCount(){return void 0===this.model?0:this.model.colCount}get rowCount(){return void 0===this.model?0:this.model.rowCount}setModel(t){this.model=t}getColumnHead(t){}getRowHead(t){}getDisplayCell(t,e){}getEditorCell(t,e){}isViewCompact(){return!1}static register(t,e,i){let o=Nt.modelToAdapter.get(e);if(void 0===o&&(o=new Map,Nt.modelToAdapter.set(e,o)),void 0!==o.get(i))throw Error("attempt to redefine existing table adapter");o.set(i,t)}static unbind(){Nt.modelToAdapter.clear()}static lookup(t){let e;e=t instanceof Tt?t.nodeClass:void 0;let i=Nt.modelToAdapter.get(Object.getPrototypeOf(t).constructor)?.get(e);if(void 0===i)for(let o of Nt.modelToAdapter.keys())if(t instanceof o){i=Nt.modelToAdapter.get(o)?.get(e);break}if(void 0===i){let i=`TableAdapter.lookup(): Did not find an adapter for model of type ${t.constructor.name}`;i+=`\n    Requested adapter: model=${t.constructor.name}, type=${e.name}\n    Available adapters:`;for(const[t,e]of Nt.modelToAdapter)for(const[o,s]of e)i+=`\n        model=${t.name}, type=${o}`;throw Error(i)}return i}}Nt.modelToAdapter=new Map,function(t){t[t.INSERT_ROW=0]="INSERT_ROW",t[t.REMOVE_ROW=1]="REMOVE_ROW",t[t.INSERT_COL=2]="INSERT_COL",t[t.REMOVE_COL=3]="REMOVE_COL",t[t.CELL_CHANGED=4]="CELL_CHANGED",t[t.RESIZE_ROW=5]="RESIZE_ROW",t[t.RESIZE_COL=6]="RESIZE_COL",t[t.CHANGED=7]="CHANGED"}(bt||(bt={}));let Dt=document.createElement("style");Dt.textContent="\n:host {\n  position: relative;\n  display: inline-block;\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  outline-offset: -2px;\n  font-family: var(--tx-font-family);\n  font-size: var(--tx-font-size);\n  background: #fff;\n}\n:host:focus .cells tr.selected,\n:host:focus .cells td.selected {\n  background: #0069d4;\n  color: #fff;\n}\n\n.colhead {\n  position: absolute;\n  top: 0;\n  overflow: hidden;\n}\n.rowhead {\n  position: absolute;\n  left: 0;\n  overflow: hidden;\n}\n.cells {\n  position: absolute;\n\n  bottom: 0;\n  right: 0;\n\n  overflow: auto;\n  /* resize: both; */\n  cursor: default;\n}\n\n:host > div > table, :host > table {\n  border-collapse: collapse;\n  border-spacing: 0;\n  border: none 0px;\n}\n.colhead > table, .rowhead > table {\n  background: #e0e0e0;\n}\n\n.colhead th,\n.rowhead th,\n.cells td,\n.hiddenSizeCheck td {\n  letter-spacing: 0;  \n  overflow: hidden;   \n  padding: 2px;\n  margin: 0px;\n\n  /* this might not be always desirable; */\n  white-space: nowrap; \n\n  border: solid 1px #ccc;\n}\n\n.colhead th, .rowhead th {\n  z-index: 1;\n}\n\n.bodyrow td {\n  padding-top: 0px;\n  padding-bottom: 0px;\n  border-top: none 0px;\n  border-bottom: none 0px;\n}\n\n.cells tr:nth-child(even) {\n  background: var(--tx-table-even-row, #f5f5f5);\n}\n.cells tr:nth-child(odd) {\n  background: var(--tx-table-odd-row, #ffffff);\n}\n\n.cells td:nth-child(1) {\n  border-left: none;\n}\n.cells tr:nth-child(2) td {\n  border-top: none;\n}\n\n.cells tr.selected,\n.cells tr td.selected {\n  background: #808080;\n  color: #fff;\n}\n\n.compact.colhead th,\n.compact.rowhead th,\n.compact.hiddenSizeCheck * th {\n  border-color: none;\n  border-style: none;\n  border-width: 0;\n  padding: 0px;\n}\n.compact.cells * td,\n.compact.hiddenSizeCheck * td {\n  border-color: none;\n  border-style: none;\n  border-width: 0;\n  padding: 0px;\n}\n\n.zeroSize {\n  width: 0;\n  height: 0;\n  margin: 0;\n  padding: 0;\n  border: none;\n}\n\n.inputDiv { \n  position: relative;\n  background: #fff;\n  border: none;\n  opacity: 0;\n}\n\n.hiddenSizeCheck {\n  position: absolute;\n  opacity: 0;\n}\n";class Lt extends HTMLDivElement{static init(t){t.addEventListener("focusin",(e=>{if(t.style.opacity="1",e.target&&e.relatedTarget)try{!function(t,e){let i,o=t;i=t;let s=new Map;for(;o=i,i=i.parentNode,i;)s.set(i,o);let n=e;for(i=e;i;){if(n=i,i=i.parentNode,!i)throw Error("isNodeBeforeNode(first, second): nodes have no common parent");let t=s.get(i);if(t){o=t;break}}for(let t of i.childNodes){if(t===o)return!0;if(t===n)return!1}throw Error("isNodeBeforeNode(first, second): couldn't determine order of nodes")}(e.relatedTarget,t)?t.focusInFromRight&&t.focusInFromRight():t.focusInFromLeft&&t.focusInFromLeft()}catch(t){}})),t.addEventListener("focusout",(e=>{t.style.opacity="0"})),t.style.display="none",t.setViewRect=Lt.prototype.setViewRect,t.unsetViewRect=Lt.prototype.unsetViewRect,t.setEditView=Lt.prototype.setEditView,t.adjustToCell=Lt.prototype.adjustToCell}setEditView(t){const e=vt(this);let i=0,o=0;void 0!==e&&([i,o]=[e.scrollLeft,e.scrollTop]),this.hasChildNodes()?(function(t){if(!document.hasFocus())return!1;let e=document.activeElement;for(;null!==e;){if(e===t)return!0;if(null===e.shadowRoot)break;e=e.shadowRoot.activeElement}return!1}(this.children[0])&&this.children[0].dispatchEvent(new FocusEvent("blur")),t?this.replaceChild(t,this.childNodes[0]):this.removeChild(this.childNodes[0])):t&&this.appendChild(t),this.style.display=t?"":"none",void 0!==e&&(e.scrollLeft=i,e.scrollTop=o)}adjustToCell(t){if(!this.hasChildNodes())return void this.unsetViewRect();if(void 0===t)return;let e=t.getBoundingClientRect(),i=t.parentElement;if(null===i)return;let o,s,n=i.parentElement;if(null===n)return;navigator.userAgent.indexOf("Chrome")>-1?(s=t.offsetLeft+2,o=t.offsetTop-n.clientHeight):(s=t.offsetLeft+.5,o=t.offsetTop-n.clientHeight);const l=t.clientWidth-N(t),r=e.height;this.setViewRect(o,s,l,r)}setViewRect(t,e,i,o){this.style.display="",this.style.opacity="1",this.style.top=`${t}px`,this.style.left=`${e}px`,this.style.width=`${i}px`,this.style.height=`${o}px`}unsetViewRect(){this.style.opacity="0",this.style.display="none",this.style.top="",this.style.left="",this.style.width="",this.style.height=""}}var Mt,_t;!function(t){t[t.BEFORE_REMOVED_AREA=0]="BEFORE_REMOVED_AREA",t[t.INSIDE_REMOVED_AREA=1]="INSIDE_REMOVED_AREA",t[t.INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS=2]="INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS",t[t.BEHIND_REMOVED_AREA=3]="BEHIND_REMOVED_AREA"}(Mt||(Mt={}));class St extends H{constructor(t,e){super(),this.rowAnimationHeight=0,this.hadFocus=!1,this.table=t,this.event=e}prepare(){this.hadFocus=this.table.hasFocus();let t=0;if(this.table.editView&&void 0!==this.table.selectionModel)if(this.table.selectionModel.row<this.event.index)this.selectionIs=Mt.BEFORE_REMOVED_AREA;else if(this.table.selectionModel.row<=this.event.index+this.event.size){const e=this.table.bodyBody.children.length-1;if(this.event.index+this.event.size>=e){this.selectionIs=Mt.INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS;for(let e=this.event.index;e<=this.table.selectionModel.row;++e){t-=this.table.bodyBody.children[e+1].clientHeight}0===this.event.index?this.table.selectionModel.row=0:this.table.selectionModel.row=this.event.index-1}else{this.selectionIs=Mt.INSIDE_REMOVED_AREA;for(let e=this.event.index+1;e<=this.table.selectionModel.row;++e){t-=this.table.bodyBody.children[e+1].clientHeight}this.table.selectionModel.row=this.event.index,this.table.prepareInputOverlayForPosition({col:this.table.selectionModel.value.col,row:this.table.selectionModel.value.row})}}else this.table.selectionModel.row-=this.event.size,this.selectionIs=Mt.BEHIND_REMOVED_AREA;this.rowAnimationHeight=0;for(let t=0;t<this.event.size;++t){const e=this.table.bodyBody.children[this.event.index+t+1];this.rowAnimationHeight+=e.clientHeight}this.table.rowAnimationHeight=this.rowAnimationHeight;for(let t=1;t<this.event.size;++t)this.table.rowHeadHead.deleteRow(this.event.index+1),this.table.bodyBody.deleteRow(this.event.index+2);this.trAnimationHead=this.table.rowHeadHead.children[this.event.index],this.trAnimationBody=this.table.bodyBody.children[this.event.index+1],this.trAnimationHead.style.minHeight=this.trAnimationHead.style.maxHeight="",this.trAnimationBody.style.minHeight=this.trAnimationBody.style.maxHeight="",this.trAnimationHead.style.height=`${this.rowAnimationHeight}px`,this.trAnimationBody.style.height=`${this.rowAnimationHeight}px`;const e="url(\"data:image/svg+xml;utf8,<svg width='3' height='3' xmlns='http://www.w3.org/2000/svg'><line shape-rendering='crispEdges' x1='-1' y1='-1' x2='5' y2='5' stroke='%23888' /></svg>\")";for(;this.trAnimationHead.childNodes.length>0;)this.trAnimationHead.removeChild(this.trAnimationHead.childNodes[0]);for(;this.trAnimationBody.childNodes.length>0;)this.trAnimationBody.removeChild(this.trAnimationBody.childNodes[0]);this.trAnimationHead.appendChild(s("th",{style:{padding:"0"}})),this.trAnimationHead.style.background=e;for(let t=0;t<this.table.adapter.colCount;++t)this.trAnimationBody.appendChild(s("td",{style:{padding:"0"}})),this.trAnimationBody.style.background=e;const i=this.table.inputOverlay.style.top;i.length>2&&(this.overlayTop=Number.parseFloat(i.substr(0,i.length-2))+t)}animationFrame(t){const e=1-t;if(this.trAnimationBody.style.height=this.trAnimationHead.style.height=e*this.rowAnimationHeight+"px",this.overlayTop)switch(this.selectionIs){case Mt.BEFORE_REMOVED_AREA:this.table.inputOverlay.style.top=`${this.overlayTop+t*this.rowAnimationHeight}px`;break;case Mt.INSIDE_REMOVED_AREA:this.table.inputOverlay.style.top=`${this.overlayTop+this.rowAnimationHeight}px`;break;case Mt.INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS:this.table.inputOverlay.style.top=`${this.overlayTop+t*this.rowAnimationHeight}px`;break;case Mt.BEHIND_REMOVED_AREA:this.table.inputOverlay.style.top=`${this.overlayTop}px`}}lastFrame(){this.table.rowHeadHead.deleteRow(this.event.index),this.table.bodyBody.deleteRow(this.event.index+1)}}class Ht extends H{constructor(t,e){super(),this.rowAnimationHeight=0,this.trHead=[],this.trBody=[],this.table=t,this.event=e}prepare(){for(let t=0;t<this.event.size;++t){const e=this.table.createDOMRowHeaderRow(this.event.index);this.table.hiddenSizeCheckRowHead.appendChild(e),this.trHead.push(e);const i=this.table.createDOMBodyRow(this.event.index+t);this.table.hiddenSizeCheckBody.appendChild(i),this.trBody.push(i)}const t="url(\"data:image/svg+xml;utf8,<svg width='3' height='3' xmlns='http://www.w3.org/2000/svg'><line shape-rendering='crispEdges' x1='-1' y1='-1' x2='5' y2='5' stroke='%23888' /></svg>\")";this.trAnimationHead=s("tr",{style:{height:"0px",background:t},children:s("th",{style:{padding:"0"}})}),this.table.rowHeadHead.insertBefore(this.trAnimationHead,this.table.rowHeadHead.children[this.event.index]),this.trAnimationBody=s("tr",{style:{height:"0px",background:t}});for(let e=0;e<this.table.adapter.colCount;++e)this.trAnimationBody.appendChild(s("td",{style:{padding:"0"}})),this.trAnimationBody.style.background=t;this.table.bodyBody.insertBefore(this.trAnimationBody,this.table.bodyBody.children[this.event.index+1])}firstFrame(){this.table.rowAnimationHeight=this.rowAnimationHeight=Math.max(this.table.hiddenSizeCheckBody.clientHeight,this.table.hiddenSizeCheckRowHead.clientHeight)}animationFrame(t){const e=`${Math.round(t*this.rowAnimationHeight)}px`;if(this.trAnimationHead.style.height=this.trAnimationBody.style.height=e,void 0!==this.table.selectionModel&&this.table.selectionModel.row<this.event.index){const t=this.table.getCellAt(this.table.selectionModel.value.col,this.table.selectionModel.value.row);this.table.inputOverlay.adjustToCell(t)}}lastFrame(){for(let t=0;t<this.event.size;++t){const e=`${Math.max(this.trHead[t].clientHeight,this.trBody[t].clientHeight)}px`,i=this.trHead[t].style;i.height=i.minHeight=i.maxHeight=e;const o=this.trHead[t].style;o.height=o.minHeight=o.maxHeight=e}this.table.rowHeadHead.replaceChild(this.trHead[0],this.trAnimationHead),this.table.bodyBody.replaceChild(this.trBody[0],this.trAnimationBody);for(let t=1;t<this.event.size;++t)this.table.rowHeadHead.insertBefore(this.trHead[t],this.trHead[t-1].nextSibling),this.table.bodyBody.insertBefore(this.trBody[t],this.trBody[t-1].nextSibling);if(void 0!==this.table.selectionModel&&this.table.selectionModel.row>=this.event.index&&(this.table.selectionModel.row+=this.event.size),this.table.editView&&void 0!==this.table.selectionModel&&this.table.selectionModel.row<this.event.index){const t=this.table.getCellAt(this.table.selectionModel.value.col,this.table.selectionModel.value.row);this.table.inputOverlay.adjustToCell(t)}this.table.adjustLayout(void 0)}}!function(t){t[t.LAYOUT=0]="LAYOUT",t[t.SELECTION=1]="SELECTION",t[t.USER=2]="USER"}(_t||(_t={}));class Ot extends B{constructor(t){super(),this.animator=new O,this.rowAnimationHeight=0,this.insideGoTo=!1,this.rootDiv=n(o,{children:[s("div",{set:i(this,"rowHeadDiv"),class:"rowhead",children:s("table",{set:i(this,"rowHeadTable"),children:s("thead",{set:i(this,"rowHeadHead")})})}),s("div",{set:i(this,"colHeadDiv"),class:"colhead",children:s("table",{set:i(this,"colHeadTable"),children:s("thead",{children:s("tr",{set:i(this,"colHeadRow")})})})}),n("div",{set:i(this,"scrollDiv"),class:"cells",children:[s("table",{set:i(this,"bodyTable"),children:s("tbody",{set:i(this,"bodyBody"),children:s("tr",{set:i(this,"bodyRow"),class:"bodyrow"})})}),s("div",{class:"zeroSize",children:s("div",{set:i(this,"inputOverlay"),class:"inputDiv"})})]}),n("table",{class:"hiddenSizeCheck",children:[s("thead",{set:i(this,"hiddenSizeCheckRowHead")}),s("tbody",{set:i(this,"hiddenSizeCheckBody")})]})]}),this.onkeydown=this.onRootDivKeyDown,this.scrollDiv.onscroll=()=>{this.rowHeadDiv.scrollTop=this.scrollDiv.scrollTop,this.colHeadDiv.scrollLeft=this.scrollDiv.scrollLeft},this.bodyTable.onmousedown=t=>{t.target?"TD"===t.target.tagName?(t.preventDefault(),this.log(_t.USER,"bodyTable.onmousedown() -> goToCell(event.target)"),this.goToCell(t.target)):console.log(`bodyTable.onmousedown() -> target is not TD but ${t.target.tagName}`):console.log("bodyTable.onmousedown() -> no target")},Lt.init(this.inputOverlay),this.inputOverlay.focusInFromLeft=()=>{this.insideGoTo||this.goToFirstCell()},this.inputOverlay.focusInFromRight=()=>{this.insideGoTo||this.goToLastCell()},this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(Dt,!0)),this.rootDiv.appendTo(this.shadowRoot),t&&(l(this,t),t.selectionModel&&this.setModel(t.selectionModel))}log(t,e){}setModel(t){if(!t)return this.selectionModel&&this.selectionModel.modified.remove(this),this.model=void 0,this.selectionModel=new Rt,this.selectionModel.modified.add((()=>{this.createSelection()}),this),void this.updateView();if(t instanceof Rt)return this.selectionModel&&this.selectionModel.modified.remove(this),this.selectionModel=t,this.createSelection(),void this.selectionModel.modified.add((()=>{this.createSelection()}),this);if(t instanceof kt){this.model=t,this.model.modified.add((t=>{this.modelChanged(t)}),this);const e=Nt.lookup(t);try{this.adapter=new e}catch(t){throw console.log(`TableView.setModel(): failed to instantiate table adapter: ${t}`),console.log("setting TypeScript's target to 'es6' might help"),t}return this.adapter.setModel(t),this.updateCompact(),void this.updateView()}if(t instanceof Object)throw Error("TableView.setModel(): unexpected model of type "+t.constructor.name)}updateCompact(){this.adapter?.isViewCompact()?this.rootDiv.forEach((t=>t.classList.add("compact"))):this.rootDiv.forEach((t=>t.classList.remove("compact")))}modelChanged(t){switch(t.type){case bt.INSERT_ROW:this.animator.run(new Ht(this,t));break;case bt.REMOVE_ROW:this.animator.run(new St(this,t));break;case bt.CELL_CHANGED:this.onFieldViewBlur(new At(t.col,t.row))}}updateView(){try{if(!this.model)return;this.createColumnHeader(),this.createRowHeader(),this.createBody(),this.createSelection(),setTimeout((()=>{this.model&&this.adjustLayoutAfterRender()}),0)}catch(t){throw console.log("caught exception in updateView"),t instanceof Error&&console.log(t.stack),t}}createColumnHeader(){this.updateHeader(!0)}createRowHeader(){this.updateHeader(!1)}updateHeader(t){if(!this.model)throw Error("TableView.updateHeader(): no model");if(!this.adapter)throw Error("TableView.updateHeader(): no adapter");let e,i,o;!0===t?(e=this.colHeadTable,i=this.colHeadRow,o=this.adapter.colCount):(e=this.rowHeadTable,i=this.rowHeadHead,o=this.adapter.rowCount);let n,l=!1;for(;i.children.length>o+1;)i.removeChild(i.children[i.children.length-1]);for(let e=0;e<o;++e){let o;if(e>=i.children.length)if(o=s("th",{}),t)i.appendChild(o);else{const t=s("tr",{});t.appendChild(o),i.appendChild(t)}else o=t?i.children[e]:i.children[e].children[0],o.style.minWidth="",o.style.border="";const n=t?this.adapter.getColumnHead(e):this.adapter.getRowHead(e);void 0!==n?o.appendChild(n):l=!0}if(i.children.length<o+1)if(n=s("th",{}),t)i.appendChild(n);else{const t=s("tr",{});t.appendChild(n),i.appendChild(t)}else n=t?i.children[i.children.length-1]:i.children[i.children.length-1].children[0];t?(n.innerText="",n.style.minWidth="777px"):n.parentElement.style.height="777px",n.style.border="0px none",e.style.display=l?"none":""}createBody(){if(!this.model)throw Error("TableView.updateBody(): no model");if(!this.adapter)throw Error("TableView.updateBody(): no adapter");for(;this.bodyRow.children.length>this.adapter.colCount;)this.bodyRow.removeChild(this.bodyRow.children[this.bodyRow.children.length-1]);for(;this.bodyRow.children.length<this.adapter.colCount;)this.bodyRow.appendChild(s("td",{}));for(;this.bodyBody.children.length-1>this.adapter.rowCount;)this.bodyBody.removeChild(this.bodyBody.children[this.bodyBody.children.length-1]);for(let t=0;t<this.adapter.rowCount;++t){let e;for(t+1>=this.bodyBody.children.length?(e=s("tr",{}),this.bodyBody.appendChild(e)):e=this.bodyBody.children[t+1];e.children.length>this.adapter.colCount;)e.removeChild(e.children[e.children.length-1]);for(let i=0;i<this.adapter.colCount;++i){let o;i>=e.children.length?(o=s("td",{}),e.appendChild(o)):o=e.children[i],o.style.width="";const n=this.adapter.getDisplayCell(i,t);n&&(Array.isArray(n)?n.forEach((t=>o.appendChild(t))):o.appendChild(n))}if("100%"===this.style.width){e.children[e.children.length-1].style.width="100%"}}}createDOMRowHeaderRow(t){if(!this.model||!this.adapter)throw Error();const e=this.adapter.getRowHead(t);return s("tr",void 0===e?{}:{children:s("th",{children:e})})}createDOMBodyRow(t){if(!this.model||!this.adapter)throw Error();const e=s("tr",{});for(let i=0;i<this.adapter.colCount;++i){let o;i>=e.children.length?(o=s("td",{}),e.appendChild(o)):o=e.children[i],o.style.width="";const n=this.adapter.getDisplayCell(i,t);n&&(Array.isArray(n)?n.forEach((t=>o.appendChild(t))):o.appendChild(n))}if("100%"===this.style.width){e.children[e.children.length-1].style.width="100%"}return e}createSelection(){if(void 0!==this.selectionModel)switch(this.selectionModel.mode){case ft.EDIT_CELL:this.log(_t.SELECTION,`TableView.createSelection(): mode=EDIT_CELL, selection=${this.selectionModel.col}, ${this.selectionModel.row}`),this.prepareInputOverlayForPosition(new At(this.selectionModel.col,this.selectionModel.row)),delete this.rootDiv.tabIndex;break;case ft.SELECT_CELL:{this.log(_t.SELECTION,`TableView.createSelection(): mode=SELECT_CELL, selection=${this.selectionModel.col}, ${this.selectionModel.row}`);let t=this.bodyBody.querySelectorAll("tbody > tr > td.selected");for(let e of t)e.classList.remove("selected");this.toggleCellSelection(this.selectionModel.value,!0),this.tabIndex=0;break}case ft.SELECT_ROW:{this.log(_t.SELECTION,`TableView.createSelection(): mode=SELECT_ROW, selection=${this.selectionModel.col}, ${this.selectionModel.row}`);let t=this.bodyBody.querySelectorAll("tbody > tr.selected");for(let e of t)e.classList.remove("selected");this.toggleRowSelection(this.selectionModel.value.row,!0),this.tabIndex=0;break}}}adjustLayout(t){this.unadjustLayoutBeforeRender(t),setTimeout((()=>{this.adjustLayoutAfterRender()}),0)}unadjustLayoutBeforeRender(t){if(void 0===t)for(let t=0;t<this.adapter.colCount;++t)this.unadjustLayoutColumnBeforeRender(t);else this.unadjustLayoutColumnBeforeRender(t.col)}unadjustLayoutColumnBeforeRender(t){const e=this.colHeadRow.children[t],i=this.bodyRow.children[t];e.style.width=e.style.minWidth=e.style.maxWidth=i.style.width=i.style.minWidth=i.style.maxWidth=""}adjustLayoutAfterRender(){if(!this.model)throw Error("TableView.adjustLayoutAfterRender(): no model");if(!this.adapter)throw Error("TableView.adjustLayoutAfterRender(): no adapter");this.log(_t.LAYOUT,"TableView.adjustLayoutAfterRender()");const t=this.colHeadRow.children,e=this.rowHeadHead.children,i=this.bodyRow.children;for(let e=0;e<this.adapter.colCount;++e){const o=t[e],s=i[e];if(""===o.style.width){const t=o.getBoundingClientRect().width-N(o),e=s.getBoundingClientRect().width-N(s),i=Math.max(t,e);o.style.width=o.style.minWidth=o.style.maxWidth=`${i}px`,s.style.width=s.style.minWidth=s.style.maxWidth=`${i}px`}}this.adapter.rowCount!=this.bodyBody.children.length-1&&this.log(_t.LAYOUT,`adjustLayoutAfterRender(): bodyBody has ${this.bodyBody.children.length-1} rows while model has ${this.adapter.rowCount} rows`);for(let t=0;t<this.bodyBody.children.length-1;++t){const i=e[t],o=this.bodyBody.children[t+1];let s=i.clientHeight-D(i),n=o.clientHeight-D(o),l=Math.max(s,n);i.style.height=i.style.minHeight=i.style.maxHeight=o.style.height=o.style.minHeight=o.style.maxHeight=`${l}px`}const o=this.colHeadDiv.getBoundingClientRect(),s=this.rowHeadDiv.getBoundingClientRect();let n=this.scrollDiv.getBoundingClientRect(),l=this.bodyTable.getBoundingClientRect();const r=window.getComputedStyle(this),d=r.width,h=r.height;this.style.overflowX="",this.style.overflowY="";let a=!1,c=!1;if("0px"===d){this.log(_t.LAYOUT,"  TableView has no width specified");const t=this.parentElement;if(t){const e=s.width+l.width;e<t.clientWidth?(this.log(_t.LAYOUT,`    parent is wide enough for content, set TableView width to ${e}px`),this.style.width=e+"px",this.scrollDiv.style.overflowX="hidden",a=!0):(this.log(_t.LAYOUT,`    parent isn't wide enough for content, set TableView width to parent's width of ${t.clientWidth-2}px`),this.style.width=t.clientWidth-2+"px")}}if("0px"===h){this.log(_t.LAYOUT,"  TableView has no height specified");if(this.parentElement){let t=o.height+l.height;a||(t+=15);const e=window.innerHeight;t<e?(this.log(_t.LAYOUT,`    parent IS high enough for content, set TableView height to ${t}px`),this.style.height=t+"px",this.scrollDiv.style.overflowY="hidden",c=!0):(this.log(_t.LAYOUT,`    parent is NOT high enough for content, default TableView height to ${e}px`),this.style.height=e+"px")}}let u=this.getBoundingClientRect();this.clientLeft,u.x,this.clientTop,u.y;const p=this.clientWidth,w=this.clientHeight;this.log(_t.LAYOUT,"  adjust the bodyDiv to setup the scrollbars"),a?(this.log(_t.LAYOUT,"    table IS wide enough for content, do not set scrollDiv's width"),this.scrollDiv.style.width=""):(this.log(_t.LAYOUT,`    table is NOT wide enough for content, set scroll width to ${p-s.width}px`),this.scrollDiv.style.width=p-s.width+"px"),c?(this.log(_t.LAYOUT,"    table IS heigh enough for content, do not set scrollDiv's height"),this.scrollDiv.style.height=""):(this.log(_t.LAYOUT,`    table is NOT high enough for content, set scroll height to ${w-o.height}px`),this.scrollDiv.style.height=w-o.height+"px"),this.log(_t.LAYOUT,"  figure out how much space the scrollbars take"),n=this.scrollDiv.getBoundingClientRect();let m=c?0:n.width-this.scrollDiv.clientWidth,g=a?0:n.height-this.scrollDiv.clientHeight;this.log(_t.LAYOUT,`    width ${m}, height ${g}`),this.scrollDiv.style.top=o.height+"px",this.scrollDiv.style.left=s.width+"px",this.colHeadDiv.style.top="0",this.colHeadDiv.style.left=s.width-1+"px",this.log(_t.LAYOUT,`  set colHeadDiv = ${p} (host width) - ${s.width} (rowHeadDiv width) - ${m} (vertical scrollbar width) = ${p-s.width-m+1}`),this.colHeadDiv.style.width=p-s.width-m+1+"px",this.rowHeadDiv.style.top=o.height+"px",this.rowHeadDiv.style.left="0",this.rowHeadDiv.style.height=w-o.height-g+"px"}prepareInputOverlayForCell(t){void 0!==t&&"TD"===t.tagName&&this.prepareInputOverlayForPosition(this.getCellPosition(t))}prepareInputOverlayForPosition(t){if(!this.adapter)return;let e=this.hasFocus();this.log(_t.USER,`TableView.prepareInputOverlayForPosition(${t.col}, ${t.row})`),this.setSelectionTo(t);let i=this.adapter.getEditorCell(t.col,t.row);if(this.log(_t.SELECTION,`prepareInputOverlayForPosition() got editView=${i}`),!i)return void this.inputOverlay.setEditView(void 0);this.editView=i,i.classList.add("embedded"),i.onkeydown=e=>{this.onFieldViewKeyDown(e,t)},this.inputOverlay.setEditView(i);const o=this.getCellAt(t.col,t.row);setTimeout((()=>{this.inputOverlay.adjustToCell(o),e&&this.focus()}),0)}setSelectionTo(t){if(this.selectionModel)switch(this.selectionModel.mode){case ft.EDIT_CELL:this.selectionModel.value=t;break;case ft.SELECT_CELL:return this.toggleCellSelection(this.selectionModel.value,!1),this.selectionModel.value=t,void this.toggleCellSelection(this.selectionModel.value,!0);case ft.SELECT_ROW:return this.toggleRowSelection(this.selectionModel.value.row,!1),this.selectionModel.value.row=t.row,void this.toggleRowSelection(this.selectionModel.value.row,!0)}}focus(){const{x:t,y:e}={x:this.scrollDiv.scrollLeft,y:this.scrollDiv.scrollTop};this.editView?this.editView.focus({preventScroll:!0}):super.focus({preventScroll:!0}),this.scrollDiv.scrollLeft=t,this.scrollDiv.scrollTop=e}hasFocus(){return null!==document.activeElement&&document.activeElement===this}toggleCellSelection(t,e){if(t.col>=this.adapter.colCount||t.row>=this.adapter.rowCount)return;let i=this.bodyBody.children[t.row+1].children[t.col];i.classList.toggle("selected",e),e&&ut(i)}toggleRowSelection(t,e){if(t>=this.adapter.rowCount)return;let i=this.bodyBody.children[1+this.selectionModel.value.row];i.classList.toggle("selected",e),e&&ut(i)}goTo(t,e){this.insideGoTo=!0,this.prepareInputOverlayForPosition(new At(t,e)),this.focus(),ut(this.getCellAt(t,e)),this.insideGoTo=!1}goToCell(t){t&&(this.insideGoTo=!0,this.prepareInputOverlayForCell(t),this.focus(),ut(t),this.insideGoTo=!1)}goToFirstCell(){this.goTo(0,0)}goToLastCell(){this.adapter&&this.goTo(this.adapter.colCount-1,this.adapter.rowCount-1)}getCellAt(t,e){return this.bodyBody.children[e+1].children[t]}getCellPosition(t){let e,i;for(e=0;e<this.adapter.colCount&&t.parentElement.children[e]!==t;++e);for(i=1;i<this.adapter.rowCount+1&&t.parentElement.parentElement.children[i]!==t.parentElement;++i);return--i,new At(e,i)}onRootDivKeyDown(t){if(this.selectionModel)switch(this.selectionModel.mode){case ft.SELECT_ROW:{let e=this.selectionModel.value.row;switch(t.key){case"ArrowDown":e+1<this.adapter.rowCount&&++e;break;case"ArrowUp":e>0&&--e}e!=this.selectionModel.value.row&&(this.toggleRowSelection(this.selectionModel.value.row,!1),this.selectionModel.row=e,this.toggleRowSelection(this.selectionModel.value.row,!0))}break;case ft.SELECT_CELL:{let e={col:this.selectionModel.col,row:this.selectionModel.row};switch(t.key){case"ArrowRight":e.col+1<this.adapter.colCount&&++e.col;break;case"ArrowLeft":e.col>0&&--e.col;break;case"ArrowDown":e.row+1<this.adapter.rowCount&&++e.row;break;case"ArrowUp":e.row>0&&--e.row}e.col==this.selectionModel.col&&e.row==this.selectionModel.row||(this.toggleCellSelection(this.selectionModel.value,!1),this.selectionModel.value=e,this.toggleCellSelection(this.selectionModel.value,!0))}}}onFieldViewKeyDown(t,e){switch(t.key){case"ArrowDown":if(e.row+1>=this.adapter.rowCount)break;t.preventDefault(),this.goTo(e.col,e.row+1);break;case"ArrowUp":if(0===e.row)break;t.preventDefault(),this.goTo(e.col,e.row-1);break;case"Tab":t.shiftKey?e.col>0?(t.preventDefault(),this.goTo(e.col-1,e.row)):e.row>0&&(t.preventDefault(),this.goTo(this.adapter.colCount-1,e.row-1)):e.col+1<this.adapter.colCount?(t.preventDefault(),this.goTo(e.col+1,e.row)):e.row+1<this.adapter.rowCount&&(t.preventDefault(),this.goTo(0,e.row+1))}}onFieldViewBlur(t){const e=this.getCellAt(t.col,t.row);if(void 0===e)return;const i=this.adapter.getDisplayCell(t.col,t.row),o=document.createElement("div");if(Array.isArray(i)?i.forEach((t=>o.appendChild(t))):o.appendChild(i),this.log(_t.USER,`TableView.onFieldViewBlur(${t.col}, ${t.row}): change "${e.innerHTML}" to "${o.innerHTML}"`),o.innerHTML!=e.innerHTML){for(this.log(_t.USER,`TableView.onFieldViewBlur(${t.col}, ${t.row})"): cell is now "${e.innerHTML}"`);e.childNodes.length>0;)e.removeChild(e.childNodes[e.childNodes.length-1]);this.log(_t.USER,`TableView.onFieldViewBlur(${t.col}, ${t.row})"): cleared cell, it's now "${e.innerHTML}"`),Array.isArray(i)?i.forEach((t=>e.appendChild(t))):e.appendChild(i),this.log(_t.USER,`TableView.onFieldViewBlur(${t.col}, ${t.row})"): cell is now "${e.innerHTML}"`),this.unadjustLayoutBeforeRender(t),setTimeout((()=>{this.adjustLayoutAfterRender()}),0)}}connectedCallback(){super.connectedCallback(),this.resizeEventListener=()=>{try{this.adjustLayoutAfterRender()}catch(t){throw console.log("resizeEventListener caught exception in adjustLayoutAfterRender()"),t}},window.addEventListener("resize",this.resizeEventListener),void 0===this.selectionModel&&(this.selectionModel=new Rt,this.selectionModel.modified.add((()=>{this.createSelection()}),this))}disconnectedCallback(){window.removeEventListener("resize",this.resizeEventListener)}}Ot.define("tx-table",Ot);class It{constructor(t,e,i){this.type=t,this.index=e,this.size=i}get col(){return this.index}get row(){return this.size}}class Vt extends Tt{constructor(t,e){super(e),this.data=t}get rowCount(){return this.data?this.data.length:0}createRow(){return new this.nodeClass}insert(t,e){if(t>this.rowCount)throw Error(`ArrayTableModel.insert(${t}) is out of range, model size is ${this.colCount}, ${this.rowCount}`);let i;return void 0===e&&(e=this.createRow()),i=e instanceof Array?e:[e],this.data.splice(t,0,...i),this.modified.trigger(new It(bt.INSERT_ROW,t,i.length)),t}remove(t,e=1){if(t>=this.rowCount||t+e>this.rowCount)throw Error(`ArrayTableModel.remove(${t}, ${e}) is out of range, model size is ${this.colCount}, ${this.rowCount}`);return this.data.splice(t,e),this.modified.trigger(new It(bt.REMOVE_ROW,t,e)),t}}B.define("tx-tabletool",class extends it{constructor(){super(),this.toolbar=s("div",{class:"toolbar"}),this.buttonAddRowAbove=s("button",{class:"left",title:"add row above",children:n("svg",{style:{display:"block"},viewBox:"0 0 13 13",width:"13",height:"13",children:[s("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),s("line",{x1:"0.5",y1:"8.5",x2:"12.5",y2:"8.5",class:"stroke"}),s("line",{x1:"4.5",y1:"8.5",x2:"4.5",y2:"13.5",class:"stroke"}),s("line",{x1:"8.5",y1:"8.5",x2:"8.5",y2:"13.5",class:"stroke"}),s("line",{x1:"6.5",y1:"2",x2:"6.5",y2:"7",class:"stroke"}),s("line",{x1:"4",y1:"4.5",x2:"9",y2:"4.5",class:"stroke"})]})}),this.buttonAddRowAbove.onclick=()=>{this.lastActiveTable?.focus();const t=this.lastActiveTable?.model,e=this.lastActiveTable?.selectionModel;e&&t&&t instanceof Vt&&t.insert(e.row)},this.toolbar.appendChild(this.buttonAddRowAbove),this.buttonAddRowBelow=s("button",{title:"add row below",children:n("svg",{viewBox:"0 0 13 13",width:"13",height:"13",children:[s("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),s("line",{x1:"0.5",y1:"4.5",x2:"12.5",y2:"4.5",class:"stroke"}),s("line",{x1:"4.5",y1:"0.5",x2:"4.5",y2:"4.5",class:"stroke"}),s("line",{x1:"8.5",y1:"0.5",x2:"8.5",y2:"4.5",class:"stroke"}),s("line",{x1:"6.5",y1:"6",x2:"6.5",y2:"11",class:"stroke"}),s("line",{x1:"4",y1:"8.5",x2:"9",y2:"8.5",class:"stroke"})]})}),this.buttonAddRowBelow.onclick=()=>{this.lastActiveTable?.focus();const t=this.lastActiveTable?.model,e=this.lastActiveTable?.selectionModel;e&&t&&t instanceof Vt&&t.insert(e.row+1)},this.toolbar.appendChild(this.buttonAddRowBelow),this.buttonDeleteRow=s("button",{class:"right",title:"delete row",children:n("svg",{viewBox:"0 0 13 13",width:"13",height:"13",children:[s("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),s("line",{x1:"0.5",y1:"4.5",x2:"12.5",y2:"4.5",class:"stroke"}),s("line",{x1:"0.5",y1:"8.5",x2:"12.5",y2:"8.5",class:"stroke"}),s("line",{x1:"5.5",y1:"3.5",x2:"11.5",y2:"9.5",class:"stroke","stroke-width":"1.5"}),s("line",{x1:"11.5",y1:"3.5",x2:"5.5",y2:"9.5",class:"stroke","stroke-width":"1.5"})]})}),this.buttonDeleteRow.onclick=()=>{this.lastActiveTable?.focus();const t=this.lastActiveTable?.model,e=this.lastActiveTable?.selectionModel;e&&t&&t instanceof Vt&&t.remove(e.row)},this.toolbar.appendChild(this.buttonDeleteRow),this.toolbar.appendChild(document.createTextNode(" ")),this.buttonAddColumnLeft=s("button",{class:"left",title:"add column left",children:n("svg",{viewBox:"0 0 13 13",width:"13",height:"13",children:[s("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),s("line",{x1:"8.5",y1:"0.5",x2:"8.5",y2:"12.5",class:"stroke"}),s("line",{x1:"8.5",y1:"4.5",x2:"12.5",y2:"4.5",class:"stroke"}),s("line",{x1:"8.5",y1:"8.5",x2:"12.5",y2:"8.5",class:"stroke"}),s("line",{x1:"2",y1:"6.5",x2:"7",y2:"6.5",class:"stroke"}),s("line",{x1:"4.5",y1:"4",x2:"4.5",y2:"9",class:"stroke"})]})}),this.toolbar.appendChild(this.buttonAddColumnLeft),this.buttonAddColumnRight=s("button",{title:"add column right",children:n("svg",{viewBox:"0 0 13 13",width:"13",height:"13",children:[s("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),s("line",{x1:"4.5",y1:"0.5",x2:"4.5",y2:"12.5",class:"stroke"}),s("line",{x1:"0.5",y1:"4.5",x2:"4.5",y2:"4.5",class:"stroke"}),s("line",{x1:"0.5",y1:"8.5",x2:"4.5",y2:"8.5",class:"stroke"}),s("line",{x1:"6",y1:"6.5",x2:"11",y2:"6.5",class:"stroke"}),s("line",{x1:"8.5",y1:"4",x2:"8.5",y2:"9",class:"stroke"})]})}),this.toolbar.appendChild(this.buttonAddColumnRight),this.buttonDeleteColumn=s("button",{class:"right",title:"delete column",children:n("svg",{viewBox:"0 0 13 13",width:"13",height:"13",children:[s("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),s("line",{x1:"4.5",y1:"0.5",x2:"4.5",y2:"12.5",class:"stroke"}),s("line",{x1:"8.5",y1:"0.5",x2:"8.5",y2:"12.5",class:"stroke"}),s("line",{x1:"3.5",y1:"5.5",x2:"9.5",y2:"11.5",class:"stroke","stroke-width":"1.5"}),s("line",{x1:"3.5",y1:"11.5",x2:"9.5",y2:"5.5",class:"stroke","stroke-width":"1.5"})]})}),this.toolbar.appendChild(this.buttonDeleteColumn),this.toolbar.appendChild(document.createTextNode(" ")),this.buttonAddNodeAbove=s("button",{class:"left",title:"add node above",children:n("svg",{style:{display:"block",border:"none"},viewBox:"0 0 8 17",width:"8",height:"17",children:[s("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"strokeFill"}),s("rect",{x:"0.5",y:"9.5",width:"6",height:"6",class:"fill"}),s("line",{x1:"3.5",y1:"3",x2:"3.5",y2:"6",class:"stroke"}),s("line",{x1:"2",y1:"4.5",x2:"5",y2:"4.5",class:"stroke"}),s("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"1",class:"stroke"}),s("line",{x1:"3.5",y1:"8",x2:"3.5",y2:"17",class:"stroke"})]})}),this.toolbar.appendChild(this.buttonAddNodeAbove),this.buttonAddNodeBelow=s("button",{title:"add node below",children:n("svg",{style:{display:"block",border:"none"},viewBox:"0 0 8 17",width:"8",height:"17",children:[s("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"fill"}),s("rect",{x:"0.5",y:"9.5",width:"6",height:"6",class:"strokeFill"}),s("line",{x1:"3.5",y1:"11",x2:"3.5",y2:"14",class:"stroke"}),s("line",{x1:"2",y1:"12.5",x2:"5",y2:"12.5",class:"stroke"}),s("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"9",class:"stroke"}),s("line",{x1:"3.5",y1:"16",x2:"3.5",y2:"17",class:"stroke"})]})}),this.toolbar.appendChild(this.buttonAddNodeBelow),this.buttonAddNodeParent=s("button",{title:"add node parent",children:n("svg",{viewBox:"0 0 13 17",width:"13",height:"17",children:[s("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"strokeFill"}),s("rect",{x:"6.5",y:"9.5",width:"6",height:"6",class:"fill"}),s("line",{x1:"7",y1:"4.5",x2:"10",y2:"4.5",class:"stroke"}),s("line",{x1:"9.5",y1:"4",x2:"9.5",y2:"9",class:"stroke"}),s("line",{x1:"3.5",y1:"3",x2:"3.5",y2:"6",class:"stroke"}),s("line",{x1:"2",y1:"4.5",x2:"5",y2:"4.5",class:"stroke"}),s("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"1",class:"stroke"}),s("line",{x1:"3.5",y1:"8",x2:"3.5",y2:"17",class:"stroke"})]})}),this.buttonAddNodeParent.onclick=()=>{},this.toolbar.appendChild(this.buttonAddNodeParent),this.buttonAddNodeChild=s("button",{title:"add node child",children:n("svg",{viewBox:"0 0 13 17",width:"13",height:"17",children:[s("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"fill"}),s("rect",{x:"6.5",y:"9.5",width:"6",height:"6",class:"strokeFill"}),s("line",{x1:"7",y1:"4.5",x2:"10",y2:"4.5",class:"stroke"}),s("line",{x1:"9.5",y1:"4",x2:"9.5",y2:"9",class:"stroke"}),s("line",{x1:"9.5",y1:"11",x2:"9.5",y2:"14",class:"stroke"}),s("line",{x1:"8",y1:"12.5",x2:"11",y2:"12.5",class:"stroke"}),s("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"17",class:"stroke"})]})}),this.toolbar.appendChild(this.buttonAddNodeChild),this.buttonDeleteNode=s("button",{class:"right",title:"delete node",children:n("svg",{viewBox:"0 0 10 17",width:"10",height:"17",children:[s("rect",{x:"1.5",y:"5.5",width:"6",height:"6",class:"strokeFill"}),s("line",{x1:"4.5",y1:"2",x2:"4.5",y2:"5",class:"stroke"}),s("line",{x1:"4.5",y1:"12",x2:"4.5",y2:"15",class:"stroke"}),s("line",{x1:"0.5",y1:"4.5",x2:"8.5",y2:"12.5",class:"stroke","stroke-width":"1.5"}),s("line",{x1:"8.5",y1:"4.5",x2:"0.5",y2:"12.5",class:"stroke","stroke-width":"1.5"})]})}),this.toolbar.appendChild(this.buttonDeleteNode),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(U,!0)),this.shadowRoot.appendChild(this.toolbar)}canHandle(t){return t instanceof Ot}activate(){this.lastActiveTable=it.activeView,this.toolbar.classList.add("active")}deactivate(){this.lastActiveTable=void 0,this.toolbar.classList.remove("active")}});class Bt extends Nt{}class Ft extends Bt{}class $t{constructor(t,e,i=!0){this.node=t,this.depth=e,this.open=i}}class Wt extends Tt{constructor(t,e){super(t),this.rows=new Array,void 0!==e&&this.createRowInfoHelper(this.rows,e,0)}get colCount(){return 1}get rowCount(){return this.rows.length}getRow(t){for(let e=0;e<this.rows.length;++e)if(this.rows[e].node===t)return e}addSiblingBefore(t){const e=this.createNode();return 0===this.rows.length?(t=0,this.setRoot(e),this.rows.push(new $t(e,0))):0===t?(this.setNext(e,this.getRoot()),this.setRoot(e),this.rows.unshift(new $t(e,0))):(this.setNext(e,this.rows[t].node),this.getNext(this.rows[t-1].node)===this.rows[t].node?this.setNext(this.rows[t-1].node,e):this.setDown(this.rows[t-1].node,e),this.rows.splice(t,0,new $t(e,this.rows[t].depth))),this.modified.trigger(new It(bt.INSERT_ROW,t,1)),t}addSiblingAfter(t){const e=this.createNode();if(0===this.rows.length)t=0,this.setRoot(e),this.rows.push(new $t(e,0));else{this.setNext(e,this.getNext(this.rows[t].node)),this.setNext(this.rows[t].node,e);const i=this.nodeCount(this.getDown(this.rows[t].node)),o=this.rows[t].depth;t+=i+1,this.rows.splice(t,0,new $t(e,o))}return this.modified.trigger(new It(bt.INSERT_ROW,t,1)),t}addChildAfter(t){const e=this.createNode();if(0===this.rows.length)this.setRoot(e),this.rows.push(new $t(e,0)),this.modified.trigger(new It(bt.INSERT_ROW,0,1));else{const i=this.getDown(this.rows[t].node),o=this.nodeCount(i);for(let e=0;e<o;++e)++this.rows[t+1+e].depth;this.setDown(e,i),this.setDown(this.rows[t].node,e),this.rows.splice(t+1,0,new $t(e,this.rows[t].depth+1)),this.modified.trigger(new It(bt.INSERT_ROW,t+1,1))}return t}addParentBefore(t){const e=this.createNode();if(0===t){for(let e=0;e<this.rows.length;++e)++this.rows[t+e].depth;this.setDown(e,this.getRoot()),this.setRoot(e),this.rows.unshift(new $t(e,0))}else{const i=this.rows[t].depth,o=this.nodeCount(this.getDown(this.rows[t].node))+1;for(let e=0;e<o;++e)++this.rows[t+e].depth;this.setDown(e,this.rows[t].node),this.setNext(e,this.getNext(this.rows[t].node)),this.setNext(this.rows[t].node,void 0),this.getNext(this.rows[t-1].node)===this.rows[t].node?this.setNext(this.rows[t-1].node,e):this.setDown(this.rows[t-1].node,e),this.rows.splice(t,0,new $t(e,i))}return this.modified.trigger(new It(bt.INSERT_ROW,t,1)),t}deleteAt(t){let e=this.getDown(this.rows[t].node);if(void 0!==e){const i=this.nodeCount(e)+1;for(let e=0;e<i;++e)--this.rows[t+e].depth;this.append(e,this.getNext(this.rows[t].node)),this.setNext(this.rows[t].node,void 0),0===t?this.setRoot(e):this.setNext(this.rows[t-1].node,e)}else if(0===t){const e=this.getNext(this.rows[t].node);this.setNext(this.rows[t].node,void 0),this.setRoot(e)}else{const e=this.getNext(this.rows[t].node);this.setNext(this.rows[t].node,void 0),this.getNext(this.rows[t-1].node)===this.rows[t].node?this.setNext(this.rows[t-1].node,e):this.setDown(this.rows[t-1].node,e)}return this.rows.splice(t,1),this.modified.trigger(new It(bt.REMOVE_ROW,t,1)),t}init(){}toggleAt(t){this.rows[t].open?this.closeAt(t):this.openAt(t)}isOpen(t){return this.rows[t].open}openAt(t){let e=this.rows[t];if(e.open||void 0===this.getDown(e.node))return;e.open=!0;const i=this.createRowInfo(t);this.rows.splice(t+1,0,...i),this.modified.trigger(new It(bt.INSERT_ROW,t+1,i.length))}closeAt(t){let e=this.rows[t];if(!e.open||void 0===this.getDown(e.node))return;const i=this.getVisibleChildCount(t);e.open=!1,this.rows.splice(t+1,i),this.modified.trigger(new It(bt.REMOVE_ROW,t+1,i))}createRowInfo(t){const e=new Array;let i=this.rows[t];return i.open&&this.getDown(i.node)&&this.createRowInfoHelper(e,this.getDown(i.node),i.depth+1),e}createRowInfoHelper(t,e,i){const o=new $t(e,i,!1);t.push(o),o.open&&this.getDown(e)&&this.createRowInfoHelper(t,this.getDown(e),o.depth+1),this.getNext(e)&&this.createRowInfoHelper(t,this.getNext(e),o.depth)}getVisibleChildCount(t){let e=this.rows[t],i=1;if(e.open&&this.getDown(e.node)){const e=this.getVisibleChildCountHelper(t+1);t+=e,i+=e}return i-1}getVisibleChildCountHelper(t){let e=this.rows[t],i=1;if(e.open&&this.getDown(e.node)){const e=this.getVisibleChildCountHelper(t+1);t+=e,i+=e}if(this.getNext(e.node)){const e=this.getVisibleChildCountHelper(t+1);t+=e,i+=e}return i}append(t,e){if(void 0===e)return;let i,o=t;for(;i=this.getNext(o),void 0!==i;)o=i;this.setNext(o,e)}nodeCount(t){return void 0===t?0:1+this.nodeCount(this.getDown(t))+this.nodeCount(this.getNext(t))}}class Ut extends B{constructor(t,e,i){super(),this.model=t,this.rowinfo=e,this.label=i,this.attachShadow({mode:"open"})}connectedCallback(){super.connectedCallback(),this.paint()}disconnectedCallback(){super.disconnectedCallback()}paint(){if(!this.shadowRoot)return;if(!this.parentElement)return;const t=this.model.getRow(this.rowinfo.node);if(void 0===t)return;const e=12,i=3.5,l=Math.round(2)-.5,r=this.rowinfo.depth*e+e+i,d=n(o,{children:[s("svg",{width:r,height:e,style:{verticalAlign:"middle",background:"none"}}),s("span",{style:{verticalAlign:"middle",padding:"2px"},children:this.label})]}),h=d[0];{const o=this.rowinfo,n=o.depth;if(this.model.getDown(o.node)){const t=n*e+i,r=s("rect",{x:t,y:l,width:8,height:8,stroke:"#000",fill:"#fff",cursor:"pointer"});h.appendChild(r),h.appendChild(s("line",{x1:t+2,y1:l+4,x2:t+8-2,y2:l+4,stroke:"#000",cursor:"pointer"}));const d=s("line",{x1:t+4,y1:l+2,x2:t+4,y2:l+8-2,stroke:"#000",cursor:"pointer"});d.style.display=o.open?"none":"",h.appendChild(d),h.appendChild(s("line",{x1:t+8,y1:l+4,x2:t+8+3,y2:l+4,stroke:"#000"})),h.onmousedown=e=>{e.preventDefault(),e.stopPropagation();const i=this.model.getRow(o.node);if(void 0===i)return void console.log("  ==> couldn't find row number for node");const s=h.getBoundingClientRect(),n=e.clientX-s.left,r=e.clientY-s.top;t<=n&&n<=t+8&&l<=r&&r<=l+8&&(this.model?.toggleAt(i),d.style.display=this.model.isOpen(i)?"none":"")}}else h.appendChild(s("line",{x1:n*e+i+4,y1:"0",x2:n*e+i+4,y2:l+4,stroke:"#000"})),h.appendChild(s("line",{x1:n*e+i+4,y1:l+4,x2:n*e+i+8+3,y2:l+4,stroke:"#000"}));let r="";for(let s=0;s<=n;++s){const l=s*e+i+4;for(let e=t+1;e<this.model.rowCount&&!(this.model.rows[e].depth<s);++e)if(s===this.model.rows[e].depth){(s!==n||void 0!==this.model.getNext(o.node))&&(r+=`<line x1='${l}' y1='0' x2='${l}' y2='100%' stroke='%23000' />`);break}}if(void 0===this.model.getDown(o.node)||void 0===this.model.getNext(o.node)){const t=n*e+i+4;r+=`<line x1='${t}' y1='0' x2='${t}' y2='50%' stroke='%23000' />`}this.parentElement.style.background=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'>${r}</svg>")`,this.parentElement.style.backgroundRepeat="repeat-y"}d.replaceIn(this.shadowRoot)}}class zt extends Ft{isViewCompact(){return!0}treeCell(t,e){if(this.model)return new Ut(this.model,this.model.rows[t],e)}}B.define("tx-treenodecell",Ut);class Pt extends Wt{constructor(t,e){super(t,e),this.root=e}createNode(){return new this.nodeClass}deleteNode(t){}getRoot(){return this.root}setRoot(t){this.root=t}getDown(t){return t.down}setDown(t,e){t.down=e}getNext(t){return t.next}setNext(t,e){t.next=e}}class jt extends Vt{constructor(t,e){super(t,e)}get colCount(){return 10}}class Gt extends Ft{getColumnHead(t){const e=this.getColumnHeads();return document.createTextNode(e[t])}get colCount(){return this.getRow(this.model?.data[0]).length}getRowHead(t){}getDisplayCell(t,e){const i=this.getField(t,e);if(void 0!==i)return document.createTextNode(i)}getEditorCell(t,e){const i=this.getField(t,e);if(void 0===i)return;const o=new v(i);o.modified.add((()=>{this.setField(t,e,o.value)}));const s=new W;return s.setModel(o),s}getField(t,e){if(this.model)return this.getRow(this.model.data[e])[t].toString()}setField(t,e,i){this.model&&(this.getRow(this.model.data[e])[t].fromString(i),this.model.modified.trigger(new It(bt.CELL_CHANGED,t,e)))}}window.onload=()=>{ce()};var Yt;!function(t){t[t.CLASSIC=0]="CLASSIC",t[t.CHERRY=1]="CHERRY",t[t.VANILLA=2]="VANILLA"}(Yt||(Yt={}));const qt=new V(Yt);qt.value=Yt.CLASSIC,_("flavour",qt);const Jt=new y(.33,{min:0,max:1500});_("quantity",Jt),S("fill",(()=>{alert(`filling bottle with ${Jt.value}ml of ${Yt[qt.value]} soda.`),Jt.value=.33}));let Kt=new v("");_("hello",Kt);let Xt=new x("");Xt.modified.add((()=>{document.getElementById("rawhtml").innerText=Xt.value})),_("markup",Xt),S("hitMe",(()=>{Kt.value="Hit me too!",Zt.enabled=!0}));var Zt=S("hitMeMore",(()=>{Kt.value="You hit me!",Zt.enabled=!1}));const Qt=new b(!1),te=new b(!0),ee=new b(!1);ee.enabled=!1;const ie=new b(!0);var oe;ie.enabled=!1,_("off",Qt),_("on",te),_("offDisabled",ee),_("onDisabled",ie),function(t){t[t.BLUEBERRY=0]="BLUEBERRY",t[t.GRAPE=1]="GRAPE",t[t.TANGERINE=2]="TANGERINE",t[t.LIME=3]="LIME",t[t.STRAWBERRY=4]="STRAWBERRY",t[t.BONDIBLUE=5]="BONDIBLUE"}(oe||(oe={}));const se=new V(oe);se.value=oe.GRAPE,_("flavourEnabled",se);const ne=new V(oe);ne.enabled=!1,ne.value=oe.TANGERINE,_("flavourDisabled",ne),_("size",new y(42,{min:0,max:99})),S("file|logout",(()=>{alert("You are about to logout")})),S("help",(()=>{alert("Please.")}));class le{constructor(){this.title="",this.author="",this.year=1970}}const re=[{title:"The Moon Is A Harsh Mistress",author:"Robert A. Heinlein",year:1966},{title:"Stranger In A Strange Land",author:"Robert A. Heinlein",year:1961},{title:"The Fountains of Paradise",author:"Arthur C. Clarke",year:1979},{title:"Rendezvous with Rama",author:"Arthur C. Clarke",year:1973},{title:"2001: A Space Odyssey",author:"Arthur C. Clarke",year:1968},{title:"Do Androids Dream of Electric Sheep?",author:"Philip K. Dick",year:1968},{title:"A Scanner Darkly",author:"Philip K. Dick",year:1977},{title:"Second Variety",author:"Philip K. Dick",year:1953}];class de extends Gt{getColumnHeads(){return["Title","Author","Year"]}getRow(t){return function(t,...i){return i.map((i=>new e(t,i)))}(t,"title","author","year")}}class he{constructor(){this.label="#"+he.counter++}}he.counter=0;class ae extends zt{getDisplayCell(t,e){return this.model&&this.treeCell(e,this.model.rows[e].node.label)}}function ce(){Nt.register(de,jt,le),_("books",new jt(re,le)),function(){zt.register(ae,Pt,he);let t=new Pt(he);t.addSiblingAfter(0),t.addChildAfter(0),t.addChildAfter(1),t.addSiblingAfter(2),t.addSiblingAfter(1),t.addChildAfter(4),t.addSiblingAfter(0),_("tree",t)}()}class ue extends HTMLElement{constructor(){super(),this.condition=new b(!1);let t=new L("my-code-button"),e=t.text("label","Show Code");t.action("action",(()=>{this.condition.value?(this.condition.value=!1,e.value="Show Code"):(this.condition.value=!0,e.value="Hide Code")})),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t.root)}connectedCallback(){_(this.getAttribute("condition"),this.condition)}}return window.customElements.define("my-code-button",ue),t.main=ce,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
