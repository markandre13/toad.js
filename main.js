var example=function(t){"use strict";class e{constructor(t,e){this.callback=t,this.id=e}}class i{add(t,i){this.callbacks||(this.callbacks=new Array),this.callbacks.push(new e(t,i))}remove(t){if(this.callbacks)for(let e=this.callbacks.length-1;e>=0;--e)this.callbacks[e].id===t&&this.callbacks.splice(e,1)}count(){return this.callbacks?this.callbacks.length:0}lock(){this.locked=!0}unlock(){if(this.locked=void 0,this.triggered){let t=this.triggered.data;this.triggered=void 0,this.trigger(t)}}trigger(t){if(this.locked)this.triggered={data:t};else if(this.callbacks)for(let e=0;e<this.callbacks.length;++e)this.callbacks[e].callback(t)}}class o{constructor(){this.modified=new i}}class s extends o{constructor(t){super(),this._value=t}set value(t){this._value!=t&&(this._value=t,this.modified.trigger())}get value(){return this._value}}class n extends s{constructor(t){super(t)}}class l extends s{constructor(t,e){super(t),e&&(this.min=e.min,this.max=e.max,this.step=e.step)}}class r extends o{constructor(t){super(),this._value=t}set promise(t){this._value=t,this.modified.trigger()}get promise(){return"string"==typeof this._value?()=>this._value:this._value}set value(t){this._value!==t&&("string"==typeof t?(this._value=t,this.modified.trigger()):console.trace(`TextModel.set value(value: string): ${typeof t} is not type string`))}get value(){switch(typeof this._value){case"number":case"string":this._value=`${this._value}`;break;case"function":this._value=this._value()}return this._value}}class d extends r{constructor(t){super(t)}}class a extends o{constructor(t,e){super(),this.signal=new i,this.title=e,this._enabled=!0}set value(t){throw Error("Action.value can not be assigned a value")}get value(){throw Error("Action.value can not return a value")}set enabled(t){this._enabled!=t&&(this._enabled=t,this.modified.trigger())}get enabled(){return this._enabled}trigger(t){this._enabled&&this.signal.trigger(t)}}class h{constructor(){this.modelId2Models=new Map,this.modelId2Views=new Map,this.view2ModelIds=new Map,this.sigChanged=new i}registerAction(t,e){let i=new a(void 0,t);return i.signal.add(e),this._registerModel("A:"+t,i),i}registerModel(t,e){this._registerModel("M:"+t,e)}_registerModel(t,e){let i=this.modelId2Models.get(t);i||(i=new Set,this.modelId2Models.set(t,i)),i.add(e);let o=this.modelId2Views.get(t);if(o)for(let t of o)t.setModel(e)}registerView(t,e){if(e.controller&&e.controller!==this)return void console.log("error: attempt to register view more than once at different controllers");e.controller=this;let i=this.view2ModelIds.get(e);i||(i=new Set,this.view2ModelIds.set(e,i)),i.add(t);let o=this.modelId2Views.get(t);o||(o=new Set,this.modelId2Views.set(t,o)),o.add(e);let s=this.modelId2Models.get(t);if(s)for(let t of s)e.setModel(t)}unregisterView(t){if(!t.controller)return;if(t.controller!==this)throw Error("attempt to unregister view from wrong controller");let e=this.view2ModelIds.get(t);if(e)for(let i of e){let e=this.modelId2Views.get(i);e&&(e.delete(t),0===e.size&&this.modelId2Views.delete(i),t.setModel(void 0))}}clear(){for(let t of this.view2ModelIds)t[0].setModel(void 0);this.modelId2Models.clear(),this.modelId2Views.clear(),this.view2ModelIds.clear()}bind(t,e){this.registerModel(t,e)}action(t,e){return this.registerAction(t,e)}text(t,e){let i=new r(e);return this.bind(t,i),i}html(t,e){let i=new d(e);return this.bind(t,i),i}boolean(t,e){let i=new n(e);return this.bind(t,i),i}number(t,e,i){let o=new l(e,i);return this.bind(t,o),o}}function c(t){return function(t){let e=document.querySelector('template[id="'+t+'"]');if(!e)throw new Error("failed to find template '"+t+"'");let i=e.content;return document.importNode(i,!0)}(t)}function u(t,e){let i=t.getAttribute(e);if(null===i)throw console.log("missing attribute '"+e+"' in ",t),Error("missing attribute '"+e+"' in "+t.nodeName);return i}function p(t,e){let i=t.getAttribute(e);return null===i?void 0:i}function w(t,e){return function(t){if(""===t)return 0;if("px"!==t.substr(t.length-2))throw Error(`TableView.pixelToNumber('${t}') expected 'px' suffix`);return Number.parseFloat(t.substr(0,t.length-2))}(window.getComputedStyle(t,void 0).getPropertyValue(e))}function g(t){return w(t,"padding-left")+w(t,"padding-right")}function m(t){return w(t,"padding-top")+w(t,"padding-bottom")}class b extends h{constructor(t){super(),this.root=c(t),this.registerViews()}registerViews(){let t=this.root.querySelectorAll("[model]");for(let e of t){let t=e;if(t)try{this.registerView(t.getModelId(),t)}catch(t){}}t=this.root.querySelectorAll("[action]");for(let e of t){let t=e;if(t)try{this.registerView(t.getActionId(),t)}catch(t){}}}openHref(t){}}let f=new h;function v(t,e){f.bind(t,e)}function y(t,e){return f.registerAction(t,e)}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */function x(t,e,i,o){var s,n=arguments.length,l=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(l=(n<3?s(l):n>3?s(e,i,l):s(e,i))||l);return n>3&&l&&Object.defineProperty(e,i,l),l}var C,k={};function E(t,e,i){if(!i||typeof i.value!==C.typeOfFunction)throw new TypeError("Only methods can be decorated with @bind. <"+e+"> is not a method!");return{configurable:C.boolTrue,get:function(){var t=i.value.bind(this);return Object.defineProperty(this,e,{value:t,configurable:C.boolTrue,writable:C.boolTrue}),t}}}Object.defineProperty(k,"__esModule",{value:!0}),function(t){t.typeOfFunction="function",t.boolTrue=!0}(C||(C={})),k.bind=E;var A=k.default=E;class T{constructor(){this._stop=!1}start(){this.prepare(),!0!==this._stop&&this.requestAnimationFrame(this._firstFrame)}stop(){var t;this._stop=!0,(null===(t=this.animator)||void 0===t?void 0:t.current)===this&&(this.animator.current=void 0)}replace(t){this.next=t,this.animationFrame(1),this.lastFrame(),t.prepare()}prepare(){}firstFrame(){}animationFrame(t){}lastFrame(){}requestAnimationFrame(t){window.requestAnimationFrame(t)}_firstFrame(t){this.startTime=t,this.firstFrame(),this._stop||(this.animationFrame(0),this.requestAnimationFrame(this._animationFrame))}_animationFrame(t){var e;if(this.next)return void this.next._firstFrame(t);let i=T.animationFrameCount>0?(t-this.startTime)/T.animationFrameCount:1;i=i>1?1:i;const o=this.ease(i);this.animationFrame(o),this._stop||(o<1?this.requestAnimationFrame(this._animationFrame.bind(this)):(this.lastFrame(),(null===(e=this.animator)||void 0===e?void 0:e.current)===this&&(this.animator.current=void 0)))}ease(t){return.5*(1-Math.cos(Math.PI*t))}}T.animationFrameCount=468,x([A],T.prototype,"_firstFrame",null),x([A],T.prototype,"_animationFrame",null);class R{run(t){const e=this.current;this.current=t,t.animator=this,e?(e.animator=void 0,e.replace(t)):t.start()}}class O{constructor(t,e){this.object=t,this.attribute=e.toString()}get(){return this.object[this.attribute]}set(t){Object.defineProperty(this.object,this.attribute,{value:t})}toString(){return`${this.object[this.attribute]}`}fromString(t){const e=typeof this.object[this.attribute];let i;switch(e){case"string":i=t;break;case"number":i=Number.parseFloat(t);break;default:throw Error(`Reference.fromString() isn't yet supported for type ${e}`)}Object.defineProperty(this.object,this.attribute,{value:i})}}function N(t,e){return new O(t,e)}class D extends Array{constructor(t){super(...null==t?void 0:t.children)}replaceIn(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[t.childNodes.length-1]);this.appendTo(t)}appendTo(t){for(let e of this)t.appendChild(e)}}function M(t,e,i){return void 0!==e&&void 0!==e.children&&(e.children=[e.children]),_(t,e)}function _(t,e,i){let o;if("string"!=typeof t)return new t(e);const s=t;switch(s){case"svg":case"line":case"rect":case"text":o="http://www.w3.org/2000/svg";break;default:o="http://www.w3.org/1999/xhtml"}const n=document.createElementNS(o,s);if(null!==e){for(let[t,i]of Object.entries(e))switch(t){case"model":case"action":n.setModel(i);break;case"class":n.classList.add(i);break;case"style":for(let[t,e]of Object.entries(i)){const i=/[A-Z]/g;t=t.replace(i,(t=>"-"+t.toLowerCase())),n.style.setProperty(t,e)}break;case"set":Object.defineProperty(e.set.object,e.set.attribute,{value:n});break;default:if("http://www.w3.org/2000/svg"===o){const e=/[A-Z]/g;t=t.replace(e,(t=>"-"+t.toLowerCase()))}n.setAttributeNS(null,t,i)}if(void 0!==e.children)for(let t of e.children)"string"==typeof t?n.appendChild(document.createTextNode(t)):n.appendChild(t)}return n}class H extends HTMLElement{getModelId(){if(!this.hasAttribute("model"))throw Error("no 'model' attribute");let t=this.getAttribute("model");if(!t)throw Error("no model id");return"M:"+t}getActionId(){if(!this.hasAttribute("action"))throw Error("no 'action' attribute");let t=this.getAttribute("action");if(!t)throw Error("no action id");return"A:"+t}connectedCallback(){if(this.controller)return;let t="";try{t=this.getModelId()}catch(t){}""!=t&&f.registerView(t,this)}disconnectedCallback(){this.controller&&this.controller.unregisterView(this)}}class L extends H{constructor(){super()}setModel(t){if(t===this.model)return;const e=this;this.model&&this.model.modified.remove(e),t&&t.modified.add((()=>e.updateView()),e),this.model=t,this.updateView()}}class S extends H{setModel(t){}static focusIn(t){const e=new Map;for(let i=t.parentElement,o=0;null!==i;i=i.parentElement,++o)e.set(i,o);let i,o,s=Number.MAX_SAFE_INTEGER,n=new Array;for(const o of this.allTools.values())if(o.canHandle(t))for(let t=o.parentElement,l=0;null!==t;t=t.parentElement,++l){const l=e.get(t);void 0!==l&&(s<l||(s>l&&(n.length=0),s=l,i=t,n.push(o)))}if(!i)return void console.log(`GenericView.focusIn(${t.nodeName}): couldn't find a parent with GenericTool children`);const l=S.getIndex(t,i);let r=Number.MIN_SAFE_INTEGER;for(let t of n){const e=S.getIndex(t,i);e<l&&e>r&&(r=e,o=t)}this.setActive(o,t)}static getIndex(t,e){void 0===e&&console.trace(`GenericTool.getIndex(${t}, ${e})`);let i=t;for(;i.parentElement!==e;)i=i.parentElement;return Array.from(e.childNodes).indexOf(i)}static setActive(t,e){this.activeTool&&this.activeTool.deactivate(),this.activeTool=t,this.activeView=e,t&&t.activate()}static focusOut(t){this.activeView===t&&this.setActive(void 0,void 0)}connectedCallback(){super.connectedCallback(),S.allTools.add(this)}disconnectedCallback(){S.activeTool===this&&S.setActive(void 0,void 0),S.allTools.delete(this),super.disconnectedCallback()}}S.allTools=new Set,window.addEventListener("focusin",(t=>{t.target instanceof S||(t.relatedTarget instanceof H&&S.focusOut(t.relatedTarget),t.target instanceof H&&S.focusIn(t.target))}));class I extends L{constructor(){super()}connectedCallback(){if(this.controller)this.updateView();else{try{f.registerView(this.getActionId(),this)}catch(t){}try{f.registerView(this.getModelId(),this)}catch(t){}this.updateView()}}disconnectedCallback(){super.disconnectedCallback(),this.controller&&this.controller.unregisterView(this)}setModel(t){if(!t)return this.model&&this.model.modified.remove(this),this.action&&this.action.modified.remove(this),this.model=void 0,this.action=void 0,void this.updateView();if(t instanceof a)this.action=t,this.action.modified.add((()=>{this.updateView()}),this);else{if(!(t instanceof r))throw Error("unexpected model of type "+t.constructor.name);this.model=t,this.model.modified.add((()=>{this.updateView()}),this)}this.updateView()}isEnabled(){return void 0!==this.action&&this.action.enabled}}window.customElements.define("toad-slot",class extends L{constructor(){super()}updateModel(){}updateView(){if(!this.model)return;let t=void 0===this.model.value?"":this.model.value;this.model instanceof d?this.innerHTML=t:this.innerText=t}});let B=document.createElement("style");B.textContent="\n  button {\n    border: none;\n    background-color: var(--toad-primary-color, #0052cc);\n    color: #ffffff;\n    border-radius: 3px;\n    font-size: 14px;\n    font-weight: bold;\n    height: 32px;\n    line-height: 32px;\n    min-width: 24px;\n    text-shadow: none;\n    padding: 0 10px;\n    margin-right: 4px;\n  }\n  \n  button:hover {\n    background-color: #0065ff;\n  }\n  \n  button:hover:active {\n    background-color: #0049b0;\n  }\n  \n  button:disabled, button:disabled:active {\n    background-color: #888;\n  }\n";window.customElements.define("toad-button",class extends I{constructor(){super(),this.button=document.createElement("button"),this.button.onclick=()=>{this.action&&this.action.trigger()},this.button.disabled=!0,this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(B,!0)),this.shadowRoot.appendChild(this.button)}connectedCallback(){super.connectedCallback(),0===this.children.length&&(this._observer=new MutationObserver(((t,e)=>{void 0!==this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout((()=>{this._timer=void 0,this.updateView()}),100)})),this._observer.observe(this,{childList:!0,subtree:!0,characterData:!0}))}updateModel(){}updateView(){this.model&&this.model.value?this.model instanceof d?this.button.innerHTML=this.model.value:this.button.innerText=this.model.value:this.button.innerHTML=this.innerHTML,this.button.disabled=!this.isEnabled()}});let V=document.createElement("style");V.textContent="\ndiv {\n    border: 1px solid #e3dbdb;\n    border-radius: 5px;\n    background: #e3dbdb;\n    width: 32px;\n    height: 32px;\n    padding: 3px;\n}\n\n:host([selected]) div {\n    background: #ac9393;\n}\n\n:host([disabled]) div {\n    opacity: 0.5;\n}\n\n:host([disabled]) div img {\n    opacity: 0.5;\n}\n\n:host([checked][disabled]) div {\n}\n";window.customElements.define("toad-toolbutton",class extends L{constructor(){super();let t=document.createElement("div");t.onmousedown=e=>{this.hasAttribute("disabled")||(t.focus(),e.preventDefault(),void 0!==this.model&&(this.model.stringValue=this.getValue()))};let e=document.createElement("img");this.hasAttribute("img")&&(e.src=this.getAttribute("img")),t.appendChild(e),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(V,!0)),this.shadowRoot.appendChild(t)}getValue(){let t=this.getAttribute("value");if(null===t)throw Error("no value");return t}connectedCallback(){super.connectedCallback(),void 0===this.model&&this.setAttribute("disabled","")}updateModel(){}updateView(){if(void 0===this.model)return this.setAttribute("disabled",""),void this.removeAttribute("selected");let t=this.getValue();this.model.isValidStringValue(t)?this.removeAttribute("disabled"):this.setAttribute("disabled",""),this.model.stringValue===t?this.setAttribute("selected",""):this.removeAttribute("selected")}});let F=document.createElement("style");F.textContent="\nsvg {\n  width: 12px;\n  height: 12px;\n  vertical-align: middle;\n  margin: 3px;              /* space for the outline */\n  background: none;\n}\nsvg:focus {\n  outline-offset: -2px;     /* bring outline in touch with the svg */\n  background: #9eccfb;      /* the rectangle is rounded, fill the corners */\n  outline-color: 9eccfb;    /* outline shall be the same color used to fill the corners */\n}\n@media(pointer: coarse) { /* works on Chrome but iOS is never coarse :( */\n  svg {\n    width: 18px;\n    height: 18px;\n  }\n}\nsvg rect {\n  stroke: var(--border-color, var(--toad-neutral-color, #aaa));\n  fill: var(--background-color, #fff);\n  stroke-width: 1px;\n}\nsvg path {\n  stroke: var(--marker-color, none);\n  fill: none;\n  stroke-width: 2px;\n}\n:host([checked]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #0052cc));\n  fill: var(--checked-background-color, var(--toad-primary-color, #0052cc));\n}\n:host([checked]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #fff));\n}\n:host([disabled]) svg rect {\n  stroke: var(--checked-border-color, var(--toad-primary-color, #bdbdbd));\n  fill: var(--checked-background-color, var(--toad-primary-color, #fff));\n}\n:host([disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, none));\n}\n:host([checked][disabled]) svg path {\n  stroke: var(--checked-marker-color, var(--toad-light-color, #bdbdbd));\n}";window.customElements.define("toad-checkbox",class extends L{constructor(){super();let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttributeNS("","viewBox","0 0 18 18");let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttributeNS("","x","1"),e.setAttributeNS("","y","1"),e.setAttributeNS("","width","16"),e.setAttributeNS("","height","16"),e.setAttributeNS("","rx","3"),e.setAttributeNS("","ry","3");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS("","d","M4 9.5 L 7.5 13 L 14.5 4"),t.onclick=()=>{this.toggle()},t.setAttributeNS("","tabindex","0"),t.addEventListener("keydown",(t=>{" "===t.key&&this.toggle()})),t.onmousedown=e=>{t.focus(),e.preventDefault()},t.appendChild(e),t.appendChild(i),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(F,!0)),this.shadowRoot.appendChild(t)}setModel(t){if(void 0!==t&&!(t instanceof n))throw Error("CheckBoxView.setModel(): model is not of type BooleanModel");super.setModel(t)}static get observedAttributes(){return["checked"]}attributeChangedCallback(t,e,i){switch(t){case"checked":this.updateModel()}}toggle(){this.hasAttribute("disabled")||(this.hasAttribute("checked")?this.removeAttribute("checked"):this.setAttribute("checked",""),this.updateModel())}updateModel(){this.model&&(this.model.value=this.hasAttribute("checked"))}updateView(){if(!this.model)return this.setAttribute("disabled",""),void this.removeAttribute("checked");this.removeAttribute("disabled"),this.model.value?this.setAttribute("checked",""):this.removeAttribute("checked")}});window.customElements.define("toad-slider",class extends L{constructor(){super(),this.input=document.createElement("input"),this.input.type="range";let t=this;this.input.oninput=()=>{t.updateModel()},this.attachShadow({mode:"open"}).appendChild(this.input)}updateModel(){this.model&&(this.model.value=Number.parseFloat(this.input.value))}updateView(){this.model&&(void 0===this.model.step&&void 0!==this.model.min&&void 0!==this.model.max?this.input.step=""+(this.model.max-this.model.min)/100:this.input.step=String(this.model.step),this.input.min=String(this.model.min),this.input.max=String(this.model.max),this.input.value=String(this.model.value))}});let j=document.createElement("style");j.textContent="\ninput {\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n}\n\n:host(.embedded) input {\n  border: none 0;\n  border-radius: 0;\n  padding: 0;\n  margin: 2px;\n  width: 100%;\n  background: #fff;\n}\n";class W extends L{constructor(){super(),this.input=document.createElement("input"),this.input.oninput=()=>{this.updateModel()},this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(j,!0)),this.shadowRoot.appendChild(this.input)}focus(){this.input.focus()}blur(){this.input.blur()}static get observedAttributes(){return["value"]}attributeChangedCallback(t,e,i){switch(t){case"value":this.model&&void 0!==i&&(this.model.value=i)}}updateModel(){this.model&&(this.model.value=this.input.value),this.setAttribute("value",this.input.value)}updateView(){if(!this.model)return;const t=`${this.model.value}`;this.input.value!==t&&(this.input.value=t,this.setAttribute("value",this.input.value))}get value(){return this.input.value}set value(t){this.input.value=t,this.updateModel()}}window.customElements.define("toad-text",W);let $=document.createElement("style");$.textContent="\n\n/* try to follow material ui: when active render button labels in black, otherwise in gray */\nsvg .fill {\n  fill: #ccc;\n  stroke: #ccc;\n}\nsvg .stroke {\n  fill: none;\n  stroke: #ccc;\n}\nsvg .strokeFill {\n  fill: #fff;\n  stroke: #ccc;\n}\n\n.toolbar.active svg .fill {\n  fill: #000;\n  stroke: #000;\n}\n.toolbar.active svg .stroke {\n  fill: none;\n  stroke: #000;\n}\n.toolbar.active svg .strokeFill {\n  fill: #fff;\n  stroke: #000;\n}\n\n.toolbar button {\n    background: #fff;\n    color: #000;\n    border: 1px #ccc;\n    border-style: solid solid solid none;\n    padding: 5;\n    margin: 0;\n    vertical-align: middle;\n    height: 22px;\n}\n\n.toolbar button:active:hover {\n  background: linear-gradient(to bottom, #7abcff 0%,#0052cc 100%,#4096ee 100%);\n}\n\n.toolbar button.left {\n    border-style: solid;\n    border-radius: 3px 0 0 3px;\n}\n\n.toolbar button.right {\n    border: 1px #ccc;\n    border-style: solid solid solid none;\n    border-radius: 0 3px 3px 0;\n}\n\n.toolbar button.active {\n    background: linear-gradient(to bottom, #7abcff 0%,#0052cc 100%,#4096ee 100%);\n    border: 1px #0052cc solid;\n    color: #fff;\n}\n\ndiv.textarea {\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  margin: 2px;\n  padding: 4px 5px;\n  outline-offset: -2px;\n}\n\ndiv.textarea h1 {\n  font-size: 22px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h2 {\n  font-size: 18px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h3 {\n  font-size: 16px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea h4 {\n  font-size: 14px;\n  margin: 0;\n  padding: 4px 0 4px 0;\n}\n\ndiv.textarea div {\n  padding: 2px 0 2px 0;\n}\n";class U extends L{constructor(){super(),U.texttool=this;let t=M("div",{class:"toolbar"});this.buttonH1=M("button",Object.assign({class:"left"},{children:"H1"})),this.buttonH1.onclick=()=>{document.execCommand("formatBlock",!1,"<h1>"),this.update()},t.appendChild(this.buttonH1),this.buttonH2=M("button",{children:"H2"}),this.buttonH2.onclick=()=>{document.execCommand("formatBlock",!1,"<h2>"),this.update()},t.appendChild(this.buttonH2),this.buttonH3=M("button",{children:"H3"}),this.buttonH3.onclick=()=>{document.execCommand("formatBlock",!1,"<h3>"),this.update()},t.appendChild(this.buttonH3),this.buttonH4=M("button",Object.assign({class:"right"},{children:"H4"})),this.buttonH4.onclick=()=>{document.execCommand("formatBlock",!1,"<h4>"),this.update()},t.appendChild(this.buttonH4),t.appendChild(document.createTextNode(" ")),this.buttonBold=M("button",Object.assign({class:"left"},{children:M("b",{children:"B"})})),this.buttonBold.onclick=()=>{document.execCommand("bold",!1),this.update()},t.appendChild(this.buttonBold),this.buttonItalic=M("button",{children:M("i",{children:"I"})}),this.buttonItalic.onclick=()=>{document.execCommand("italic",!1),this.update()},t.appendChild(this.buttonItalic),this.buttonUnderline=M("button",{children:M("u",{children:"U"})}),this.buttonUnderline.onclick=()=>{document.execCommand("underline",!1),this.update()},t.appendChild(this.buttonUnderline),this.buttonStrikeThrough=M("button",{children:M("strike",{children:"S"})}),this.buttonStrikeThrough.onclick=()=>{document.execCommand("strikeThrough",!1),this.update()},t.appendChild(this.buttonStrikeThrough),this.buttonSubscript=M("button",{children:"x₂"}),this.buttonSubscript.onclick=()=>{document.execCommand("subscript",!1),this.update()},t.appendChild(this.buttonSubscript),this.buttonSuperscript=M("button",Object.assign({class:"right"},{children:"x²"})),this.buttonSuperscript.onclick=()=>{document.execCommand("superscript",!1),this.update()},t.appendChild(this.buttonSuperscript),t.appendChild(document.createTextNode(" ")),this.buttonJustifyLeft=M("button",Object.assign({class:"left"},{children:_("svg",Object.assign({viewBox:"0 0 10 9",width:"10",height:"9"},{children:[M("line",{x1:"0",y1:"0.5",x2:"10",y2:"0.5",stroke:"#000"}),M("line",{x1:"0",y1:"2.5",x2:"6",y2:"2.5",stroke:"#000"}),M("line",{x1:"0",y1:"4.5",x2:"10",y2:"4.5",stroke:"#000"}),M("line",{x1:"0",y1:"6.5",x2:"6",y2:"6.5",stroke:"#000"}),M("line",{x1:"0",y1:"8.5",x2:"10",y2:"8.5",stroke:"#000"})]}))})),this.buttonJustifyLeft.onclick=()=>{document.execCommand("justifyLeft",!1),this.update()},t.appendChild(this.buttonJustifyLeft),this.buttonJustifyCenter=M("button",{children:_("svg",Object.assign({viewBox:"0 0 10 9",width:"10",height:"9"},{children:[M("line",{x1:"0",y1:"0.5",x2:"10",y2:"0.5",stroke:"#000"}),M("line",{x1:"2",y1:"2.5",x2:"8",y2:"2.5",stroke:"#000"}),M("line",{x1:"0",y1:"4.5",x2:"10",y2:"4.5",stroke:"#000"}),M("line",{x1:"2",y1:"6.5",x2:"8",y2:"6.5",stroke:"#000"}),M("line",{x1:"0",y1:"8.5",x2:"10",y2:"8.5",stroke:"#000"})]}))}),this.buttonJustifyCenter.onclick=()=>{document.execCommand("justifyCenter",!1),this.update()},t.appendChild(this.buttonJustifyCenter),this.buttonJustifyRight=M("button",Object.assign({class:"right"},{children:_("svg",Object.assign({viewBox:"0 0 10 9",width:"10",height:"9"},{children:[M("line",{x1:"0",y1:"0.5",x2:"10",y2:"0.5",stroke:"#000"}),M("line",{x1:"4",y1:"2.5",x2:"10",y2:"2.5",stroke:"#000"}),M("line",{x1:"0",y1:"4.5",x2:"10",y2:"4.5",stroke:"#000"}),M("line",{x1:"4",y1:"6.5",x2:"10",y2:"6.5",stroke:"#000"}),M("line",{x1:"0",y1:"8.5",x2:"10",y2:"8.5",stroke:"#000"})]}))})),this.buttonJustifyRight.onclick=()=>{document.execCommand("justifyRight",!1),this.update()},t.appendChild(this.buttonJustifyRight),this.buttonUnorderedList=M("button",Object.assign({class:"left"},{children:_("svg",Object.assign({style:{display:"block"},viewBox:"0 0 17 11.5",width:"17",height:"11.5"},{children:[M("circle",{cx:"4.5",cy:"1.5",r:"0.8",stroke:"#000",fill:"#000"}),M("line",{x1:"7",y1:"1.5",x2:"17",y2:"1.5",stroke:"#000"}),M("circle",{cx:"4.5",cy:"5.5",r:"0.8",stroke:"#000",fill:"#000"}),M("line",{x1:"7",y1:"5.5",x2:"17",y2:"5.5",stroke:"#000"}),M("circle",{cx:"4.5",cy:"9.5",r:"0.8",stroke:"#000",fill:"#000"}),M("line",{x1:"7",y1:"9.5",x2:"17",y2:"9.5",stroke:"#000"})]}))})),this.buttonUnorderedList.onclick=t=>{document.execCommand("insertUnorderedList",!1),this.update()},t.appendChild(this.buttonUnorderedList),this.buttonOrderedList=M("button",Object.assign({class:"right"},{children:_("svg",Object.assign({style:{display:"block"},viewBox:"0 0 17 11.5",width:"17",height:"11.5"},{children:[M("line",{x1:"4.5",y1:"0",x2:"4.5",y2:"3",stroke:"#000"}),M("line",{x1:"7",y1:"1.5",x2:"17",y2:"1.5",stroke:"#000"}),M("line",{x1:"2.5",y1:"4",x2:"2.5",y2:"7",stroke:"#000"}),M("line",{x1:"4.5",y1:"4",x2:"4.5",y2:"7",stroke:"#000"}),M("line",{x1:"7",y1:"5.5",x2:"17",y2:"5.5",stroke:"#000"}),M("line",{x1:"0.5",y1:"8",x2:"0.5",y2:"11",stroke:"#000"}),M("line",{x1:"2.5",y1:"8",x2:"2.5",y2:"11",stroke:"#000"}),M("line",{x1:"4.5",y1:"8",x2:"4.5",y2:"11",stroke:"#000"}),M("line",{x1:"7",y1:"9.5",x2:"17",y2:"9.5",stroke:"#000"})]}))})),this.buttonOrderedList.onclick=()=>{document.execCommand("insertOrderedList",!1),this.update()},t.appendChild(this.buttonOrderedList),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode($,!0)),this.shadowRoot.appendChild(t)}update(){this.buttonH1.classList.toggle("active","h1"===document.queryCommandValue("formatBlock")),this.buttonH2.classList.toggle("active","h2"===document.queryCommandValue("formatBlock")),this.buttonH3.classList.toggle("active","h3"===document.queryCommandValue("formatBlock")),this.buttonH4.classList.toggle("active","h4"===document.queryCommandValue("formatBlock")),this.buttonBold.classList.toggle("active",document.queryCommandState("bold")),this.buttonItalic.classList.toggle("active",document.queryCommandState("italic")),this.buttonUnderline.classList.toggle("active",document.queryCommandState("underline")),this.buttonStrikeThrough.classList.toggle("active",document.queryCommandState("strikeThrough")),this.buttonSubscript.classList.toggle("active",document.queryCommandState("subscript")),this.buttonSuperscript.classList.toggle("active",document.queryCommandState("superscript")),this.buttonJustifyLeft.classList.toggle("active",document.queryCommandState("justifyLeft")),this.buttonJustifyCenter.classList.toggle("active",document.queryCommandState("justifyCenter")),this.buttonJustifyRight.classList.toggle("active",document.queryCommandState("justifyRight"))}updateModel(){this.model}updateView(){this.model}}window.customElements.define("toad-texttool",U);window.customElements.define("toad-textarea",class extends L{constructor(){super();let t=document.createElement("div");this.content=t,t.classList.add("textarea"),t.contentEditable="true",t.oninput=e=>{let i=e.target.firstChild;i&&3===i.nodeType?document.execCommand("formatBlock",!1,"<div>"):"<br>"===t.innerHTML&&(t.innerHTML=""),this.updateModel()},t.onkeydown=t=>{!0===t.metaKey&&"b"===t.key?(t.preventDefault(),document.execCommand("bold",!1),this.updateTextTool()):!0===t.metaKey&&"i"===t.key?(t.preventDefault(),document.execCommand("italic",!1),this.updateTextTool()):!0===t.metaKey&&"u"===t.key?(t.preventDefault(),document.execCommand("underline",!1),this.updateTextTool()):"Tab"===t.key?t.preventDefault():"Enter"===t.key&&!0!==t.shiftKey&&"blockquote"===document.queryCommandValue("formatBlock")&&document.execCommand("formatBlock",!1,"<p>")},t.onkeyup=()=>{this.updateTextTool()},t.onmouseup=()=>{this.updateTextTool()},this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode($,!0)),this.shadowRoot.appendChild(t)}updateTextTool(){void 0!==U.texttool&&U.texttool.update()}updateModel(){this.model&&(this.model.promise=()=>this.content.innerHTML)}updateView(){this.model&&(this.model instanceof d?this.content.innerHTML!==this.model.value&&(this.content.innerHTML=this.model.value):this.content.innerText!==this.model.value&&(this.content.innerText=this.model.value))}});customElements.define("toad-if",class extends L{updateModel(){}updateView(){this.model&&(this.style.display=this.model.value?"":"none")}});const z=document.createElement("style");var P;z.textContent="\n  :host(.menu-button) {\n    font-family: var(--toad-font-family, sans-serif);\n    font-size: 14px;\n    font-weight: bold;\n    padding: 7px;\n    vertical-align: center;\n  \n    background: #fff;\n    color: #000;\n    cursor: default;\n  }\n  :host(.menu-button.active) {\n    background: #000;\n    color: #fff;\n  }\n  :host(.menu-button.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.active.disabled) {\n    color: #888;\n  }\n  :host(.menu-button.menu-down) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-down) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 4 l 10 0 l -5 5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.menu-side) {\n    padding-right: 20px;\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#000' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  :host(.menu-button.active.menu-side) {\n    background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='15' height='14'><path d='M 0 2 l 0 10 l 5 -5 Z' fill='#fff' stroke='none'/></svg>\");\n    background-repeat: no-repeat;\n    background-position: right center;\n  }\n  .menu-bar {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: center;\n  }\n  .menu-popup {\n    position: fixed;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 2px 2px 5px #888;\n  }\n",function(t){t[t.WAIT=0]="WAIT",t[t.DOWN=1]="DOWN",t[t.UP_N_HOLD=2]="UP_N_HOLD",t[t.DOWN_N_HOLD=3]="DOWN_N_HOLD",t[t.DOWN_N_OUTSIDE=4]="DOWN_N_OUTSIDE",t[t.DOWN_N_INSIDE_AGAIN=5]="DOWN_N_INSIDE_AGAIN"}(P||(P={}));class Y extends HTMLElement{constructor(){super(),this.vertical=!0,this.closeOnClose=!1,this.state=P.WAIT}}class q extends Y{constructor(t,e){super(),this.vertical=!0,this.root=t,this.parentButton=e,this.popup=document.createElement("div"),this.popup.classList.add("menu-popup");let i=t.down;for(;i;)i.isAvailable()?i.createWindowAt(this,this.popup):i.deleteWindow(),i=i.next;this.appendChild(this.popup),this.show()}show(){this.parentButton.master.vertical?function(t,e){let i=t.getBoundingClientRect();e.style.opacity="0",e.style.left=i.left+i.width+"px",e.style.top=i.top+"px",setTimeout((function(){let t=e.getBoundingClientRect();i.top+t.height>window.innerHeight&&(e.style.top=i.top+i.height-t.height+"px"),i.left+i.width+t.width>window.innerWidth&&(e.style.left=i.left-t.width+"px"),e.style.opacity="1"}),0)}(this.parentButton,this.popup):function(t,e){let i=t.getBoundingClientRect();e.style.opacity="0",e.style.left=i.left+"px",e.style.top=i.top+i.height+"px",setTimeout((function(){let t=e.getBoundingClientRect();i.top+i.height+t.height>window.innerHeight&&(e.style.top=i.top-t.height+"px"),i.left+t.width>window.innerWidth&&(e.style.left=i.left+i.width-t.width+"px"),e.style.opacity="1"}),0)}(this.parentButton,this.popup),this.style.display=""}hide(){this.style.display="none"}}window.customElements.define("toad-popupmenu",q);class G extends L{constructor(t,e){super(),this.master=t,this.node=e;let i=this;if(this.classList.add("menu-button"),e.down&&(t.vertical?this.classList.add("menu-side"):this.classList.add("menu-down")),this.updateView(),this.onmousedown=t=>{t.stopPropagation();let e=function(t){document.removeEventListener("mouseup",e,{capture:!0}),t.preventDefault(),setTimeout((()=>{G.buttonDown&&i.dispatchEvent(new MouseEvent("mouseup",t))}),0)};if(document.addEventListener("mouseup",e,{capture:!0}),G.buttonDown=!0,!this.master)throw Error("fuck");switch(this.master.state){case P.WAIT:this.master.state=P.DOWN,this.activate();break;case P.UP_N_HOLD:this.master.active!==this?(this.master.state=P.DOWN,this.activate()):this.master.state=P.DOWN_N_HOLD;break;default:throw Error("unexpected state "+this.master.state)}return!1},this.onmouseup=t=>{if(t.stopPropagation(),G.buttonDown){if(G.buttonDown=!1,!this.master)throw Error("fuck");if(!this.node)throw Error("fuck");switch(this.master.state){case P.DOWN:this.node.isEnabled()&&!this.node.down?(this.trigger(),this.master.state=P.WAIT):(this.master.state=P.UP_N_HOLD,G.documentMouseDown&&document.removeEventListener("mousedown",G.documentMouseDown,{capture:!1}),G.documentMouseDown=function(t){G.documentMouseDown&&document.removeEventListener("mousedown",G.documentMouseDown,{capture:!1}),G.documentMouseDown=void 0,"TOAD-MENUBUTTON"!==t.target.tagName&&i.collapse()},document.addEventListener("mousedown",G.documentMouseDown,{capture:!1}));break;case P.DOWN_N_HOLD:case P.DOWN_N_OUTSIDE:this.master.state=P.WAIT,this.deactivate(),this.collapse(),this.master.closeOnClose;break;case P.DOWN_N_INSIDE_AGAIN:this.trigger();break;default:throw Error("unexpected state "+this.master.state)}return!1}},this.onmouseout=t=>{if(t.stopPropagation(),!this.master)throw Error("fuck");switch(G.inside=void 0,this.master.state){case P.WAIT:case P.DOWN_N_OUTSIDE:case P.UP_N_HOLD:case P.DOWN_N_HOLD:break;case P.DOWN:case P.DOWN_N_INSIDE_AGAIN:this.master.state=P.DOWN_N_OUTSIDE,this.updateView();break;default:throw Error("unexpected state")}return!1},this.onmouseover=t=>{if(t.stopPropagation(),!i.master)throw Error("fuck");switch(G.inside=i,i.master.state){case P.WAIT:case P.UP_N_HOLD:case P.DOWN_N_OUTSIDE:case P.DOWN_N_HOLD:case P.DOWN:case P.DOWN_N_INSIDE_AGAIN:if(!G.buttonDown)break;if(!this.master)throw Error("fuck");this.master.active&&this.master.active.deactivate(),this.master.state=P.DOWN_N_INSIDE_AGAIN,this.activate();break;default:throw Error("unexpected state "+i.master.state)}return!1},this.attachShadow({mode:"open"}),!this.shadowRoot)throw Error("fuck");this.shadowRoot.appendChild(document.importNode(z,!0)),this.node.modelId||this.shadowRoot.appendChild(document.createTextNode(e.label))}connectedCallback(){if(!this.controller){if(void 0===this.node.down){let t=this.node.title;for(let e=this.node.parent;e&&e.title.length;e=e.parent)t=e.title+"|"+t;t="A:"+t,f.registerView(t,this)}if(void 0!==this.node.modelId){let t="M:"+this.node.modelId;f.registerView(t,this)}}}disconnectedCallback(){this.controller&&this.controller.unregisterView(this)}setModel(t){if(!t)return this.action&&this.action.modified.remove(this),this.model=void 0,this.action=void 0,void this.updateView();if(t instanceof a)this.action=t,this.action.modified.add((()=>{this.updateView()}),this);else{if(!(t instanceof r))throw Error("unexpected model of type "+t.constructor.name);this.model=t}this.updateView()}updateModel(){}updateView(){if(this.model&&this.model.value){if(!this.shadowRoot)throw Error("fuck");let t=document.createElement("span");this.model instanceof d?t.innerHTML=this.model.value:t.innerText=this.model.value,this.shadowRoot.children.length>1&&this.shadowRoot.removeChild(this.shadowRoot.children[1]),this.shadowRoot.children.length>1?this.shadowRoot.insertBefore(t,this.shadowRoot.children[1]):this.shadowRoot.appendChild(t)}if(!this.master)throw Error("fuck");let t=!1;if(this.master.active==this)switch(this.master.state){case P.DOWN:case P.UP_N_HOLD:case P.DOWN_N_HOLD:case P.DOWN_N_INSIDE_AGAIN:t=!0;break;case P.DOWN_N_OUTSIDE:if(!this.node)throw Error("fuck");t=void 0!==this.node.down&&this.node.isEnabled()}this.classList.toggle("active",t),this.classList.toggle("disabled",!this.isEnabled())}isEnabled(){return void 0!==this.node.down||void 0!==this.action&&this.action.enabled}trigger(){this.collapse(),this.action&&this.action.trigger()}collapse(){if(!this.master)throw Error("fuck");this.master.parentButton?this.master.parentButton.collapse():this.deactivate()}openPopup(){if(this.node&&this.node.down){if(!this.shadowRoot)throw Error("fuck");this.popup?this.popup.show():(this.popup=new q(this.node,this),this.shadowRoot.appendChild(this.popup))}}closePopup(){this.popup&&(this.popup.active&&this.popup.active.deactivate(),this.popup.hide())}activate(){if(!this.master)throw Error("fuck");if(!this.node)throw Error("fuck");let t=this.master.active;this.master.active=this,t&&t!==this&&(t.closePopup(),t.updateView()),this.updateView(),this.openPopup()}deactivate(){if(!this.master)throw Error("fuck");this.master.active===this&&(this.master.active.closePopup(),this.master.active=void 0,this.master.state=P.WAIT,this.updateView())}}window.customElements.define("toad-menubutton",G);class J{constructor(t,e,i,o,s){this.title=t,this.label=e,this.shortcut=i,this.type=o||"entry",this.modelId=s}isEnabled(){return!0}isAvailable(){return!0}createWindowAt(t,e){if("spacer"==this.type){let t=document.createElement("span");return t.style.flexGrow="1",void e.appendChild(t)}this.view=new G(t,this),e.appendChild(this.view)}deleteWindow(){}}class K extends HTMLElement{constructor(){super(),this.vertical=!0,this.closeOnClose=!1,this.state=P.WAIT}}window.customElements.define("toad-menu",class extends K{constructor(){super(),this.vertical=!1,this.root=new J("","",void 0,void 0)}connectedCallback(){this.tabIndex=0,0===this.children.length?(this._observer=new MutationObserver(((t,e)=>{void 0!==this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout((()=>{this._timer=void 0,this.layout2nodes(this.children,this.root),this.referenceActions(),this.createShadowDOM()}),100)})),this._observer.observe(this,{childList:!0,subtree:!0})):(this.layout2nodes(this.children,this.root),this.referenceActions(),this.createShadowDOM())}disconnectedCallback(){}layout2nodes(t,e){let i=e.down;for(let o of t){let t;switch(o.nodeName){case"TOAD-MENUSPACER":t=new J("","","","spacer");break;case"TOAD-MENUENTRY":t=new J(u(o,"name"),u(o,"label"),p(o,"shortcut"),p(o,"type"),p(o,"model"))}if(t&&(t.parent=e,i?i.next=t:e.down=t,i=t),!i)throw Error("fuck");this.layout2nodes(o.children,i)}}referenceActions(){}findNode(t,e){let i=t.indexOf("|"),o=-1==i?t:t.substr(0,i),s=-1==i?"":t.substr(i+1);e||(e=this.root);for(let t=e.down;t;t=t.next)if(t.title==o)return t.down?this.findNode(s,t):t}createShadowDOM(){this.view=document.createElement("div"),this.view.classList.add("menu-bar");let t=this.root.down;for(;t;)t.isAvailable()?t.createWindowAt(this,this.view):t.deleteWindow(),t=t.next;this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(z,!0)),this.shadowRoot.appendChild(this.view)}});class Z extends HTMLElement{}window.customElements.define("toad-menuspacer",Z);function X(t){if(void 0===t)return;const e=lt(t);if(void 0===e)return;const i=e.getBoundingClientRect(),o=t.getBoundingClientRect();if(e!==document.body){const{x:t,y:s}=function(t,e,i){const o=16,s=i.left+t.scrollLeft-e.left-o,n=i.right+t.scrollLeft-e.left+o,l=i.top+t.scrollTop-e.top-o,r=i.bottom+t.scrollTop-e.top+o,d=t.clientWidth,a=t.clientHeight;var h=t.scrollLeft,c=t.scrollTop;n-s-2*o>d?h=s:n>t.scrollLeft+d?h=n-d:s<t.scrollLeft&&(h=s);r-l-2*o>a?c=l:r>t.scrollTop+a?c=r-a:l<t.scrollTop&&(c=l);return h=Math.max(0,h),c=Math.max(0,c),{x:h,y:c}}(e,i,o);!function(t,e,i){let o,s,n=Q.get(t);void 0===n?(n={x:e,y:i},Q.set(t,n)):(n.x=e,n.y=i);t===document.body?(o=window.scrollX||window.pageXOffset,s=window.scrollY||window.pageYOffset):(o=t.scrollLeft,s=t.scrollTop);const l=e-o,r=i-s;if(0===l&&0===r)return void Q.delete(t);d=d=>{if(n.x!==e||n.y!==i)return!1;const a=o+d*l,h=s+d*r;return t===document.body?window.scrollTo(a,h):(t.scrollLeft=a,t.scrollTop=h),1===d&&Q.delete(t),!0},setTimeout((()=>{window.requestAnimationFrame(et.bind(window,d,void 0,void 0))}),0);var d}(e,t,s),"fixed"!==window.getComputedStyle(e).position&&window.scrollBy({left:i.left,top:i.top,behavior:"smooth"})}else window.scrollBy({left:o.left,top:o.top,behavior:"smooth"})}const Q=new Map;let tt=0;function et(t,e,i){void 0===e&&(e=Date.now(),i=++tt);let o=(Date.now()-e)/468;o=o>1?1:o;const s=(n=o,.5*(1-Math.cos(Math.PI*n)));var n;!1!==t(s)&&s<1&&window.requestAnimationFrame(et.bind(window,t,e,i))}var it,ot,st,nt=(it=window.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(it)?1:0);function lt(t){for(;t!==document.body&&!1===rt(t);){if(null===t.parentElement)return;t=t.parentElement}return t}function rt(t){const e=dt(t,"Y")&&at(t,"Y"),i=dt(t,"X")&&at(t,"X");return e||i}function dt(t,e){return"X"===e?t.clientWidth+nt<t.scrollWidth:t.clientHeight+nt<t.scrollHeight}function at(t,e){const i=window.getComputedStyle(t,null)["overflow"+e];return"auto"===i||"scroll"===i}class ht extends o{isEmpty(){return 0===this.colCount&&0===this.rowCount}}!function(t){t[t.EDIT_CELL=0]="EDIT_CELL",t[t.SELECT_CELL=1]="SELECT_CELL",t[t.SELECT_ROW=2]="SELECT_ROW"}(ot||(ot={}));class ct{constructor(t,e){this.col=t,this.row=e}}class ut extends o{constructor(t=ot.EDIT_CELL){super(),this.mode=t,this._value=new ct(0,0)}set col(t){this._value.col!==t&&(this._value.col=t,this.modified.trigger())}get col(){return this._value.col}set row(t){this._value.row!==t&&(this._value.row=t,this.modified.trigger())}get row(){return this._value.row}set value(t){this._value.col===t.col&&this._value.row===t.row||(this._value=t,this.modified.trigger())}get value(){return this._value}}class pt extends ht{constructor(t,e){super(),this.nodeClass=t}}class wt{get colCount(){return void 0===this.model?0:this.model.colCount}get rowCount(){return void 0===this.model?0:this.model.rowCount}setModel(t){this.model=t}getColumnHead(t){}getRowHead(t){}getDisplayCell(t,e){}getEditorCell(t,e){}isViewCompact(){return!1}static register(t,e,i){let o=wt.modelToAdapter.get(e);if(void 0===o&&(o=new Map,wt.modelToAdapter.set(e,o)),void 0!==o.get(i))throw Error("attempt to redefine existing table adapter");o.set(i,t)}static unbind(){wt.modelToAdapter.clear()}static lookup(t){var e,i;let o;o=t instanceof pt?t.nodeClass:void 0;let s=null===(e=wt.modelToAdapter.get(Object.getPrototypeOf(t).constructor))||void 0===e?void 0:e.get(o);if(void 0===s)for(let e of wt.modelToAdapter.keys())if(t instanceof e){s=null===(i=wt.modelToAdapter.get(e))||void 0===i?void 0:i.get(o);break}if(void 0===s){let e=`TableAdapter.lookup(): Did not find an adapter for model of type ${t.constructor.name}`;e+=`\n    Requested adapter: model=${t.constructor.name}, type=${o.name}\n    Available adapters:`;for(const[t,i]of wt.modelToAdapter)for(const[o,s]of i)e+=`\n        model=${t.name}, type=${o}`;throw Error(e)}return s}}wt.modelToAdapter=new Map,function(t){t[t.INSERT_ROW=0]="INSERT_ROW",t[t.REMOVE_ROW=1]="REMOVE_ROW",t[t.INSERT_COL=2]="INSERT_COL",t[t.REMOVE_COL=3]="REMOVE_COL",t[t.CELL_CHANGED=4]="CELL_CHANGED",t[t.RESIZE_ROW=5]="RESIZE_ROW",t[t.RESIZE_COL=6]="RESIZE_COL",t[t.CHANGED=7]="CHANGED"}(st||(st={}));let gt=document.createElement("style");gt.textContent="\n:host {\n  position: relative;\n  display: inline-block;\n  border: 1px #ccc solid;\n  border-radius: 3px;\n  outline-offset: -2px;\n  font-family: var(--toad-font-family, sans-serif);\n  font-size: var(--toad-font-size, 12px);\n  background: #fff;\n}\n:host:focus .cells tr.selected,\n:host:focus .cells td.selected {\n  background: #0069d4;\n  color: #fff;\n}\n\n.colhead {\n  position: absolute;\n  top: 0;\n  overflow: hidden;\n}\n.rowhead {\n  position: absolute;\n  left: 0;\n  overflow: hidden;\n}\n.cells {\n  position: absolute;\n\n  bottom: 0;\n  right: 0;\n\n  overflow: auto;\n  /* resize: both; */\n  cursor: default;\n}\n\n:host > div > table, :host > table {\n  border-collapse: collapse;\n  border-spacing: 0;\n  border: none 0px;\n}\n.colhead > table, .rowhead > table {\n  background: #e0e0e0;\n}\n\n.colhead th,\n.rowhead th,\n.cells td,\n.hiddenSizeCheck td {\n  letter-spacing: 0;  \n  overflow: hidden;   \n  padding: 2px;\n  margin: 0px;\n\n  /* this might not be always desirable; */\n  white-space: nowrap; \n\n  border: solid 1px #ccc;\n}\n\n.colhead th, .rowhead th {\n  z-index: 1;\n}\n\n.bodyrow td {\n  padding-top: 0px;\n  padding-bottom: 0px;\n  border-top: none 0px;\n  border-bottom: none 0px;\n}\n\n.cells tr:nth-child(even) {\n  background: var(--toad-table-even-row, #f5f5f5);\n}\n.cells tr:nth-child(odd) {\n  background: var(--toad-table-odd-row, #ffffff);\n}\n\n.cells td:nth-child(1) {\n  border-left: none;\n}\n.cells tr:nth-child(2) td {\n  border-top: none;\n}\n\n.cells tr.selected,\n.cells tr td.selected {\n  background: #808080;\n  color: #fff;\n}\n\n// .compact.colhead th,\n// .compact.rowhead th,\n// .compact.hiddenSizeCheck * th,\n// .compact.cells * td,\n// .compact.hiddenSizeCheck * td {\n//   /* for some reason, without this, the cells have a distance... */\n//   display: flex;\n// }\n\n.compact.colhead th,\n.compact.rowhead th,\n.compact.hiddenSizeCheck * th {\n  border-color: none;\n  border-style: none;\n  border-width: 0;\n  padding: 0px;\n}\n.compact.cells * td,\n.compact.hiddenSizeCheck * td {\n  border-color: none;\n  border-style: none;\n  border-width: 0;\n  padding: 0px;\n}\n\n.zeroSize {\n  width: 0;\n  height: 0;\n  margin: 0;\n  padding: 0;\n  border: none;\n}\n\n.inputDiv { \n  position: relative;\n  background: #fff;\n  border: none;\n  opacity: 0;\n}\n\n.hiddenSizeCheck {\n  position: absolute;\n  opacity: 0;\n}\n";class mt extends HTMLDivElement{static init(t){t.addEventListener("focusin",(e=>{if(t.style.opacity="1",e.target&&e.relatedTarget)try{!function(t,e){let i,o=t;i=t;let s=new Map;for(;o=i,i=i.parentNode,i;)s.set(i,o);let n=e;for(i=e;i;){if(n=i,i=i.parentNode,!i)throw Error("isNodeBeforeNode(first, second): nodes have no common parent");let t=s.get(i);if(t){o=t;break}}for(let t of i.childNodes){if(t===o)return!0;if(t===n)return!1}throw Error("isNodeBeforeNode(first, second): couldn't determine order of nodes")}(e.relatedTarget,t)?t.focusInFromRight&&t.focusInFromRight():t.focusInFromLeft&&t.focusInFromLeft()}catch(t){}})),t.addEventListener("focusout",(e=>{t.style.opacity="0"})),t.style.display="none",t.setViewRect=mt.prototype.setViewRect,t.unsetViewRect=mt.prototype.unsetViewRect,t.setEditView=mt.prototype.setEditView,t.adjustToCell=mt.prototype.adjustToCell}setEditView(t){const e=lt(this);let i=0,o=0;void 0!==e&&([i,o]=[e.scrollLeft,e.scrollTop]),this.hasChildNodes()?(function(t){if(!document.hasFocus())return!1;let e=document.activeElement;for(;null!==e;){if(e===t)return!0;if(null===e.shadowRoot)break;e=e.shadowRoot.activeElement}return!1}(this.children[0])&&this.children[0].dispatchEvent(new FocusEvent("blur")),t?this.replaceChild(t,this.childNodes[0]):this.removeChild(this.childNodes[0])):t&&this.appendChild(t),this.style.display=t?"":"none",void 0!==e&&(e.scrollLeft=i,e.scrollTop=o)}adjustToCell(t){if(!this.hasChildNodes())return void this.unsetViewRect();if(void 0===t)return;let e=t.getBoundingClientRect(),i=t.parentElement;if(null===i)return;let o,s,n=i.parentElement;if(null===n)return;navigator.userAgent.indexOf("Chrome")>-1?(s=t.offsetLeft+2,o=t.offsetTop-n.clientHeight):(s=t.offsetLeft+.5,o=t.offsetTop-n.clientHeight);const l=t.clientWidth-g(t),r=e.height;this.setViewRect(o,s,l,r)}setViewRect(t,e,i,o){this.style.display="",this.style.opacity="1",this.style.top=`${t}px`,this.style.left=`${e}px`,this.style.width=`${i}px`,this.style.height=`${o}px`}unsetViewRect(){this.style.opacity="0",this.style.display="none",this.style.top="",this.style.left="",this.style.width="",this.style.height=""}}var bt,ft;!function(t){t[t.BEFORE_REMOVED_AREA=0]="BEFORE_REMOVED_AREA",t[t.INSIDE_REMOVED_AREA=1]="INSIDE_REMOVED_AREA",t[t.INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS=2]="INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS",t[t.BEHIND_REMOVED_AREA=3]="BEHIND_REMOVED_AREA"}(bt||(bt={}));class vt extends T{constructor(t,e){super(),this.rowAnimationHeight=0,this.hadFocus=!1,this.table=t,this.event=e}prepare(){this.hadFocus=this.table.hasFocus();let t=0;if(this.table.editView&&void 0!==this.table.selectionModel)if(this.table.selectionModel.row<this.event.index)this.selectionIs=bt.BEFORE_REMOVED_AREA;else if(this.table.selectionModel.row<=this.event.index+this.event.size){const e=this.table.bodyBody.children.length-1;if(this.event.index+this.event.size>=e){this.selectionIs=bt.INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS;for(let e=this.event.index;e<=this.table.selectionModel.row;++e){t-=this.table.bodyBody.children[e+1].clientHeight}0===this.event.index?this.table.selectionModel.row=0:this.table.selectionModel.row=this.event.index-1}else{this.selectionIs=bt.INSIDE_REMOVED_AREA;for(let e=this.event.index+1;e<=this.table.selectionModel.row;++e){t-=this.table.bodyBody.children[e+1].clientHeight}this.table.selectionModel.row=this.event.index,this.table.prepareInputOverlayForPosition({col:this.table.selectionModel.value.col,row:this.table.selectionModel.value.row})}}else this.table.selectionModel.row-=this.event.size,this.selectionIs=bt.BEHIND_REMOVED_AREA;this.rowAnimationHeight=0;for(let t=0;t<this.event.size;++t){const e=this.table.bodyBody.children[this.event.index+t+1];this.rowAnimationHeight+=e.clientHeight}this.table.rowAnimationHeight=this.rowAnimationHeight;for(let t=1;t<this.event.size;++t)this.table.rowHeadHead.deleteRow(this.event.index+1),this.table.bodyBody.deleteRow(this.event.index+2);this.trAnimationHead=this.table.rowHeadHead.children[this.event.index],this.trAnimationBody=this.table.bodyBody.children[this.event.index+1],this.trAnimationHead.style.minHeight=this.trAnimationHead.style.maxHeight="",this.trAnimationBody.style.minHeight=this.trAnimationBody.style.maxHeight="",this.trAnimationHead.style.height=`${this.rowAnimationHeight}px`,this.trAnimationBody.style.height=`${this.rowAnimationHeight}px`;const e="url(\"data:image/svg+xml;utf8,<svg width='3' height='3' xmlns='http://www.w3.org/2000/svg'><line shape-rendering='crispEdges' x1='-1' y1='-1' x2='5' y2='5' stroke='%23888' /></svg>\")";for(;this.trAnimationHead.childNodes.length>0;)this.trAnimationHead.removeChild(this.trAnimationHead.childNodes[0]);for(;this.trAnimationBody.childNodes.length>0;)this.trAnimationBody.removeChild(this.trAnimationBody.childNodes[0]);this.trAnimationHead.appendChild(M("th",{style:{padding:"0"}})),this.trAnimationHead.style.background=e;for(let t=0;t<this.table.adapter.colCount;++t)this.trAnimationBody.appendChild(M("td",{style:{padding:"0"}})),this.trAnimationBody.style.background=e;const i=this.table.inputOverlay.style.top;i.length>2&&(this.overlayTop=Number.parseFloat(i.substr(0,i.length-2))+t)}animationFrame(t){const e=1-t;if(this.trAnimationBody.style.height=this.trAnimationHead.style.height=e*this.rowAnimationHeight+"px",this.overlayTop)switch(this.selectionIs){case bt.BEFORE_REMOVED_AREA:this.table.inputOverlay.style.top=`${this.overlayTop+t*this.rowAnimationHeight}px`;break;case bt.INSIDE_REMOVED_AREA:this.table.inputOverlay.style.top=`${this.overlayTop+this.rowAnimationHeight}px`;break;case bt.INSIDE_REMOVED_AREA_AND_NO_FURTHER_ROWS:this.table.inputOverlay.style.top=`${this.overlayTop+t*this.rowAnimationHeight}px`;break;case bt.BEHIND_REMOVED_AREA:this.table.inputOverlay.style.top=`${this.overlayTop}px`}}lastFrame(){this.table.rowHeadHead.deleteRow(this.event.index),this.table.bodyBody.deleteRow(this.event.index+1)}}class yt extends T{constructor(t,e){super(),this.rowAnimationHeight=0,this.trHead=[],this.trBody=[],this.table=t,this.event=e}prepare(){for(let t=0;t<this.event.size;++t){const e=this.table.createDOMRowHeaderRow(this.event.index);this.table.hiddenSizeCheckRowHead.appendChild(e),this.trHead.push(e);const i=this.table.createDOMBodyRow(this.event.index+t);this.table.hiddenSizeCheckBody.appendChild(i),this.trBody.push(i)}const t="url(\"data:image/svg+xml;utf8,<svg width='3' height='3' xmlns='http://www.w3.org/2000/svg'><line shape-rendering='crispEdges' x1='-1' y1='-1' x2='5' y2='5' stroke='%23888' /></svg>\")";this.trAnimationHead=M("tr",Object.assign({style:{height:"0px",background:t}},{children:M("th",{style:{padding:"0"}})})),this.table.rowHeadHead.insertBefore(this.trAnimationHead,this.table.rowHeadHead.children[this.event.index]),this.trAnimationBody=M("tr",{style:{height:"0px",background:t}});for(let e=0;e<this.table.adapter.colCount;++e)this.trAnimationBody.appendChild(M("td",{style:{padding:"0"}})),this.trAnimationBody.style.background=t;this.table.bodyBody.insertBefore(this.trAnimationBody,this.table.bodyBody.children[this.event.index+1])}firstFrame(){this.table.rowAnimationHeight=this.rowAnimationHeight=Math.max(this.table.hiddenSizeCheckBody.clientHeight,this.table.hiddenSizeCheckRowHead.clientHeight)}animationFrame(t){const e=`${Math.round(t*this.rowAnimationHeight)}px`;if(this.trAnimationHead.style.height=this.trAnimationBody.style.height=e,void 0!==this.table.selectionModel&&this.table.selectionModel.row<this.event.index){const t=this.table.getCellAt(this.table.selectionModel.value.col,this.table.selectionModel.value.row);this.table.inputOverlay.adjustToCell(t)}}lastFrame(){for(let t=0;t<this.event.size;++t){const e=`${Math.max(this.trHead[t].clientHeight,this.trBody[t].clientHeight)}px`,i=this.trHead[t].style;i.height=i.minHeight=i.maxHeight=e;const o=this.trHead[t].style;o.height=o.minHeight=o.maxHeight=e}this.table.rowHeadHead.replaceChild(this.trHead[0],this.trAnimationHead),this.table.bodyBody.replaceChild(this.trBody[0],this.trAnimationBody);for(let t=1;t<this.event.size;++t)this.table.rowHeadHead.insertBefore(this.trHead[t],this.trHead[t-1].nextSibling),this.table.bodyBody.insertBefore(this.trBody[t],this.trBody[t-1].nextSibling);if(void 0!==this.table.selectionModel&&this.table.selectionModel.row>=this.event.index&&(this.table.selectionModel.row+=this.event.size),this.table.editView&&void 0!==this.table.selectionModel&&this.table.selectionModel.row<this.event.index){const t=this.table.getCellAt(this.table.selectionModel.value.col,this.table.selectionModel.value.row);this.table.inputOverlay.adjustToCell(t)}this.table.adjustLayout(void 0)}}!function(t){t[t.LAYOUT=0]="LAYOUT",t[t.SELECTION=1]="SELECTION",t[t.USER=2]="USER"}(ft||(ft={}));class xt extends H{constructor(){super(),this.animator=new R,this.rowAnimationHeight=0,this.insideGoTo=!1,this.rootDiv=_(D,{children:[M("div",Object.assign({set:N(this,"rowHeadDiv"),class:"rowhead"},{children:M("table",Object.assign({set:N(this,"rowHeadTable")},{children:M("thead",{set:N(this,"rowHeadHead")})}))})),M("div",Object.assign({set:N(this,"colHeadDiv"),class:"colhead"},{children:M("table",Object.assign({set:N(this,"colHeadTable")},{children:M("thead",{children:M("tr",{set:N(this,"colHeadRow")})})}))})),_("div",Object.assign({set:N(this,"scrollDiv"),class:"cells"},{children:[M("table",Object.assign({set:N(this,"bodyTable")},{children:M("tbody",Object.assign({set:N(this,"bodyBody")},{children:M("tr",{set:N(this,"bodyRow"),class:"bodyrow"})}))})),M("div",Object.assign({class:"zeroSize"},{children:M("div",{set:N(this,"inputOverlay"),class:"inputDiv"})}))]})),_("table",Object.assign({class:"hiddenSizeCheck"},{children:[M("thead",{set:N(this,"hiddenSizeCheckRowHead")}),M("tbody",{set:N(this,"hiddenSizeCheckBody")})]}))]}),this.onkeydown=this.onRootDivKeyDown,this.scrollDiv.onscroll=()=>{this.rowHeadDiv.scrollTop=this.scrollDiv.scrollTop,this.colHeadDiv.scrollLeft=this.scrollDiv.scrollLeft},this.bodyTable.onmousedown=t=>{t.target?"TD"===t.target.tagName?(t.preventDefault(),this.log(ft.USER,"bodyTable.onmousedown() -> goToCell(event.target)"),this.goToCell(t.target)):console.log(`bodyTable.onmousedown() -> target is not TD but ${t.target.tagName}`):console.log("bodyTable.onmousedown() -> no target")},mt.init(this.inputOverlay),this.inputOverlay.focusInFromLeft=()=>{this.insideGoTo||this.goToFirstCell()},this.inputOverlay.focusInFromRight=()=>{this.insideGoTo||this.goToLastCell()},this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(gt,!0)),this.rootDiv.appendTo(this.shadowRoot)}log(t,e){}updateModel(){}setModel(t){if(!t)return this.selectionModel&&this.selectionModel.modified.remove(this),this.model=void 0,this.selectionModel=new ut,this.selectionModel.modified.add((()=>{this.createSelection()}),this),void this.updateView();if(t instanceof ut)return this.selectionModel&&this.selectionModel.modified.remove(this),this.selectionModel=t,this.createSelection(),void this.selectionModel.modified.add((()=>{this.createSelection()}),this);if(t instanceof ht){this.model=t,this.model.modified.add((t=>{this.modelChanged(t)}),this);const e=wt.lookup(t);try{this.adapter=new e}catch(t){throw console.log(`TableView.setModel(): failed to instantiate table adapter: ${t}`),console.log("setting TypeScript's target to 'es6' might help"),t}return this.adapter.setModel(t),this.updateCompact(),void this.updateView()}throw Error("TableView.setModel(): unexpected model of type "+t.constructor.name)}updateCompact(){var t;(null===(t=this.adapter)||void 0===t?void 0:t.isViewCompact())?this.rootDiv.forEach((t=>t.classList.add("compact"))):this.rootDiv.forEach((t=>t.classList.remove("compact")))}modelChanged(t){switch(t.type){case st.INSERT_ROW:this.animator.run(new yt(this,t));break;case st.REMOVE_ROW:this.animator.run(new vt(this,t));break;case st.CELL_CHANGED:this.onFieldViewBlur(new ct(t.col,t.row))}}updateView(){try{if(!this.model)return;this.createColumnHeader(),this.createRowHeader(),this.createBody(),this.createSelection(),setTimeout((()=>{this.model&&this.adjustLayoutAfterRender()}),0)}catch(t){throw console.log("caught exception in updateView"),console.log(t.stack),t}}createColumnHeader(){this.updateHeader(!0)}createRowHeader(){this.updateHeader(!1)}updateHeader(t){if(!this.model)throw Error("TableView.updateHeader(): no model");if(!this.adapter)throw Error("TableView.updateHeader(): no adapter");let e,i,o;!0===t?(e=this.colHeadTable,i=this.colHeadRow,o=this.adapter.colCount):(e=this.rowHeadTable,i=this.rowHeadHead,o=this.adapter.rowCount);let s,n=!1;for(;i.children.length>o+1;)i.removeChild(i.children[i.children.length-1]);for(let e=0;e<o;++e){let o;if(e>=i.children.length)if(o=M("th",{}),t)i.appendChild(o);else{const t=M("tr",{});t.appendChild(o),i.appendChild(t)}else o=t?i.children[e]:i.children[e].children[0],o.style.minWidth="",o.style.border="";const s=t?this.adapter.getColumnHead(e):this.adapter.getRowHead(e);void 0!==s?o.appendChild(s):n=!0}if(i.children.length<o+1)if(s=M("th",{}),t)i.appendChild(s);else{const t=M("tr",{});t.appendChild(s),i.appendChild(t)}else s=t?i.children[i.children.length-1]:i.children[i.children.length-1].children[0];t?(s.innerText="",s.style.minWidth="777px"):s.parentElement.style.height="777px",s.style.border="0px none",e.style.display=n?"none":""}createBody(){if(!this.model)throw Error("TableView.updateBody(): no model");if(!this.adapter)throw Error("TableView.updateBody(): no adapter");for(;this.bodyRow.children.length>this.adapter.colCount;)this.bodyRow.removeChild(this.bodyRow.children[this.bodyRow.children.length-1]);for(;this.bodyRow.children.length<this.adapter.colCount;)this.bodyRow.appendChild(M("td",{}));for(;this.bodyBody.children.length-1>this.adapter.rowCount;)this.bodyBody.removeChild(this.bodyBody.children[this.bodyBody.children.length-1]);for(let t=0;t<this.adapter.rowCount;++t){let e;for(t+1>=this.bodyBody.children.length?(e=M("tr",{}),this.bodyBody.appendChild(e)):e=this.bodyBody.children[t+1];e.children.length>this.adapter.colCount;)e.removeChild(e.children[e.children.length-1]);for(let i=0;i<this.adapter.colCount;++i){let o;i>=e.children.length?(o=M("td",{}),e.appendChild(o)):o=e.children[i],o.style.width="";const s=this.adapter.getDisplayCell(i,t);s&&(Array.isArray(s)?s.forEach((t=>o.appendChild(t))):o.appendChild(s))}if("100%"===this.style.width){e.children[e.children.length-1].style.width="100%"}}}createDOMRowHeaderRow(t){if(!this.model||!this.adapter)throw Error();const e=this.adapter.getRowHead(t);return M("tr",void 0===e?{}:{children:M("th",{children:e})})}createDOMBodyRow(t){if(!this.model||!this.adapter)throw Error();const e=M("tr",{});for(let i=0;i<this.adapter.colCount;++i){let o;i>=e.children.length?(o=M("td",{}),e.appendChild(o)):o=e.children[i],o.style.width="";const s=this.adapter.getDisplayCell(i,t);s&&(Array.isArray(s)?s.forEach((t=>o.appendChild(t))):o.appendChild(s))}if("100%"===this.style.width){e.children[e.children.length-1].style.width="100%"}return e}createSelection(){if(void 0!==this.selectionModel)switch(this.selectionModel.mode){case ot.EDIT_CELL:this.log(ft.SELECTION,`TableView.createSelection(): mode=EDIT_CELL, selection=${this.selectionModel.col}, ${this.selectionModel.row}`),this.prepareInputOverlayForPosition(new ct(this.selectionModel.col,this.selectionModel.row)),delete this.rootDiv.tabIndex;break;case ot.SELECT_CELL:{this.log(ft.SELECTION,`TableView.createSelection(): mode=SELECT_CELL, selection=${this.selectionModel.col}, ${this.selectionModel.row}`);let t=this.bodyBody.querySelectorAll("tbody > tr > td.selected");for(let e of t)e.classList.remove("selected");this.toggleCellSelection(this.selectionModel.value,!0),this.tabIndex=0;break}case ot.SELECT_ROW:{this.log(ft.SELECTION,`TableView.createSelection(): mode=SELECT_ROW, selection=${this.selectionModel.col}, ${this.selectionModel.row}`);let t=this.bodyBody.querySelectorAll("tbody > tr.selected");for(let e of t)e.classList.remove("selected");this.toggleRowSelection(this.selectionModel.value.row,!0),this.tabIndex=0;break}}}adjustLayout(t){this.unadjustLayoutBeforeRender(t),setTimeout((()=>{this.adjustLayoutAfterRender()}),0)}unadjustLayoutBeforeRender(t){if(void 0===t)for(let t=0;t<this.adapter.colCount;++t)this.unadjustLayoutColumnBeforeRender(t);else this.unadjustLayoutColumnBeforeRender(t.col)}unadjustLayoutColumnBeforeRender(t){const e=this.colHeadRow.children[t],i=this.bodyRow.children[t];e.style.width=e.style.minWidth=e.style.maxWidth=i.style.width=i.style.minWidth=i.style.maxWidth=""}adjustLayoutAfterRender(){if(!this.model)throw Error("TableView.adjustLayoutAfterRender(): no model");if(!this.adapter)throw Error("TableView.adjustLayoutAfterRender(): no adapter");this.log(ft.LAYOUT,"TableView.adjustLayoutAfterRender()");const t=this.colHeadRow.children,e=this.rowHeadHead.children,i=this.bodyRow.children;for(let e=0;e<this.adapter.colCount;++e){const o=t[e],s=i[e];if(""===o.style.width){const t=o.getBoundingClientRect().width-g(o),e=s.getBoundingClientRect().width-g(s),i=Math.max(t,e);o.style.width=o.style.minWidth=o.style.maxWidth=`${i}px`,s.style.width=s.style.minWidth=s.style.maxWidth=`${i}px`}}this.adapter.rowCount!=this.bodyBody.children.length-1&&this.log(ft.LAYOUT,`adjustLayoutAfterRender(): bodyBody has ${this.bodyBody.children.length-1} rows while model has ${this.adapter.rowCount} rows`);for(let t=0;t<this.bodyBody.children.length-1;++t){const i=e[t],o=this.bodyBody.children[t+1];let s=i.clientHeight-m(i),n=o.clientHeight-m(o),l=Math.max(s,n);i.style.height=i.style.minHeight=i.style.maxHeight=o.style.height=o.style.minHeight=o.style.maxHeight=`${l}px`}const o=this.colHeadDiv.getBoundingClientRect(),s=this.rowHeadDiv.getBoundingClientRect();let n=this.scrollDiv.getBoundingClientRect(),l=this.bodyTable.getBoundingClientRect();const r=window.getComputedStyle(this),d=r.width,a=r.height;this.style.overflowX="",this.style.overflowY="";let h=!1,c=!1;if("0px"===d){this.log(ft.LAYOUT,"  TableView has no width specified");const t=this.parentElement;if(t){const e=s.width+l.width;e<t.clientWidth?(this.log(ft.LAYOUT,`    parent is wide enough for content, set TableView width to ${e}px`),this.style.width=e+"px",this.scrollDiv.style.overflowX="hidden",h=!0):(this.log(ft.LAYOUT,`    parent isn't wide enough for content, set TableView width to parent's width of ${t.clientWidth-2}px`),this.style.width=t.clientWidth-2+"px")}}if("0px"===a){this.log(ft.LAYOUT,"  TableView has no height specified");if(this.parentElement){let t=o.height+l.height;h||(t+=15);const e=window.innerHeight;t<e?(this.log(ft.LAYOUT,`    parent IS high enough for content, set TableView height to ${t}px`),this.style.height=t+"px",this.scrollDiv.style.overflowY="hidden",c=!0):(this.log(ft.LAYOUT,`    parent is NOT high enough for content, default TableView height to ${e}px`),this.style.height=e+"px")}}let u=this.getBoundingClientRect();this.clientLeft,u.x,this.clientTop,u.y;const p=this.clientWidth,w=this.clientHeight;this.log(ft.LAYOUT,"  adjust the bodyDiv to setup the scrollbars"),h?(this.log(ft.LAYOUT,"    table IS wide enough for content, do not set scrollDiv's width"),this.scrollDiv.style.width=""):(this.log(ft.LAYOUT,`    table is NOT wide enough for content, set scroll width to ${p-s.width}px`),this.scrollDiv.style.width=p-s.width+"px"),c?(this.log(ft.LAYOUT,"    table IS heigh enough for content, do not set scrollDiv's height"),this.scrollDiv.style.height=""):(this.log(ft.LAYOUT,`    table is NOT high enough for content, set scroll height to ${w-o.height}px`),this.scrollDiv.style.height=w-o.height+"px"),this.log(ft.LAYOUT,"  figure out how much space the scrollbars take"),n=this.scrollDiv.getBoundingClientRect();let b=c?0:n.width-this.scrollDiv.clientWidth,f=h?0:n.height-this.scrollDiv.clientHeight;this.log(ft.LAYOUT,`    width ${b}, height ${f}`),this.scrollDiv.style.top=o.height+"px",this.scrollDiv.style.left=s.width+"px",this.colHeadDiv.style.top="0",this.colHeadDiv.style.left=s.width-1+"px",this.log(ft.LAYOUT,`  set colHeadDiv = ${p} (host width) - ${s.width} (rowHeadDiv width) - ${b} (vertical scrollbar width) = ${p-s.width-b+1}`),this.colHeadDiv.style.width=p-s.width-b+1+"px",this.rowHeadDiv.style.top=o.height+"px",this.rowHeadDiv.style.left="0",this.rowHeadDiv.style.height=w-o.height-f+"px"}prepareInputOverlayForCell(t){void 0!==t&&"TD"===t.tagName&&this.prepareInputOverlayForPosition(this.getCellPosition(t))}prepareInputOverlayForPosition(t){if(!this.adapter)return;let e=this.hasFocus();this.log(ft.USER,`TableView.prepareInputOverlayForPosition(${t.col}, ${t.row})`),this.setSelectionTo(t);let i=this.adapter.getEditorCell(t.col,t.row);if(this.log(ft.SELECTION,`prepareInputOverlayForPosition() got editView=${i}`),!i)return void this.inputOverlay.setEditView(void 0);this.editView=i,i.classList.add("embedded"),i.onkeydown=e=>{this.onFieldViewKeyDown(e,t)},this.inputOverlay.setEditView(i);const o=this.getCellAt(t.col,t.row);setTimeout((()=>{this.inputOverlay.adjustToCell(o),e&&this.focus()}),0)}setSelectionTo(t){if(this.selectionModel)switch(this.selectionModel.mode){case ot.EDIT_CELL:this.selectionModel.value=t;break;case ot.SELECT_CELL:return this.toggleCellSelection(this.selectionModel.value,!1),this.selectionModel.value=t,void this.toggleCellSelection(this.selectionModel.value,!0);case ot.SELECT_ROW:return this.toggleRowSelection(this.selectionModel.value.row,!1),this.selectionModel.value.row=t.row,void this.toggleRowSelection(this.selectionModel.value.row,!0)}}focus(){const{x:t,y:e}={x:this.scrollDiv.scrollLeft,y:this.scrollDiv.scrollTop};this.editView?this.editView.focus({preventScroll:!0}):super.focus({preventScroll:!0}),this.scrollDiv.scrollLeft=t,this.scrollDiv.scrollTop=e}hasFocus(){return null!==document.activeElement&&document.activeElement===this}toggleCellSelection(t,e){if(t.col>=this.adapter.colCount||t.row>=this.adapter.rowCount)return;let i=this.bodyBody.children[t.row+1].children[t.col];i.classList.toggle("selected",e),e&&X(i)}toggleRowSelection(t,e){if(t>=this.adapter.rowCount)return;let i=this.bodyBody.children[1+this.selectionModel.value.row];i.classList.toggle("selected",e),e&&X(i)}goTo(t,e){this.insideGoTo=!0,this.prepareInputOverlayForPosition(new ct(t,e)),this.focus(),X(this.getCellAt(t,e)),this.insideGoTo=!1}goToCell(t){t&&(this.insideGoTo=!0,this.prepareInputOverlayForCell(t),this.focus(),X(t),this.insideGoTo=!1)}goToFirstCell(){this.goTo(0,0)}goToLastCell(){this.adapter&&this.goTo(this.adapter.colCount-1,this.adapter.rowCount-1)}getCellAt(t,e){return this.bodyBody.children[e+1].children[t]}getCellPosition(t){let e,i;for(e=0;e<this.adapter.colCount&&t.parentElement.children[e]!==t;++e);for(i=1;i<this.adapter.rowCount+1&&t.parentElement.parentElement.children[i]!==t.parentElement;++i);return--i,new ct(e,i)}onRootDivKeyDown(t){if(this.selectionModel)switch(this.selectionModel.mode){case ot.SELECT_ROW:{let e=this.selectionModel.value.row;switch(t.key){case"ArrowDown":e+1<this.adapter.rowCount&&++e;break;case"ArrowUp":e>0&&--e}e!=this.selectionModel.value.row&&(this.toggleRowSelection(this.selectionModel.value.row,!1),this.selectionModel.row=e,this.toggleRowSelection(this.selectionModel.value.row,!0))}break;case ot.SELECT_CELL:{let e={col:this.selectionModel.col,row:this.selectionModel.row};switch(t.key){case"ArrowRight":e.col+1<this.adapter.colCount&&++e.col;break;case"ArrowLeft":e.col>0&&--e.col;break;case"ArrowDown":e.row+1<this.adapter.rowCount&&++e.row;break;case"ArrowUp":e.row>0&&--e.row}e.col==this.selectionModel.col&&e.row==this.selectionModel.row||(this.toggleCellSelection(this.selectionModel.value,!1),this.selectionModel.value=e,this.toggleCellSelection(this.selectionModel.value,!0))}}}onFieldViewKeyDown(t,e){switch(t.key){case"ArrowDown":if(e.row+1>=this.adapter.rowCount)break;t.preventDefault(),this.goTo(e.col,e.row+1);break;case"ArrowUp":if(0===e.row)break;t.preventDefault(),this.goTo(e.col,e.row-1);break;case"Tab":t.shiftKey?e.col>0?(t.preventDefault(),this.goTo(e.col-1,e.row)):e.row>0&&(t.preventDefault(),this.goTo(this.adapter.colCount-1,e.row-1)):e.col+1<this.adapter.colCount?(t.preventDefault(),this.goTo(e.col+1,e.row)):e.row+1<this.adapter.rowCount&&(t.preventDefault(),this.goTo(0,e.row+1))}}onFieldViewBlur(t){const e=this.getCellAt(t.col,t.row);if(void 0===e)return;const i=this.adapter.getDisplayCell(t.col,t.row),o=document.createElement("div");if(Array.isArray(i)?i.forEach((t=>o.appendChild(t))):o.appendChild(i),this.log(ft.USER,`TableView.onFieldViewBlur(${t.col}, ${t.row}): change "${e.innerHTML}" to "${o.innerHTML}"`),o.innerHTML!=e.innerHTML){for(this.log(ft.USER,`TableView.onFieldViewBlur(${t.col}, ${t.row})"): cell is now "${e.innerHTML}"`);e.childNodes.length>0;)e.removeChild(e.childNodes[e.childNodes.length-1]);this.log(ft.USER,`TableView.onFieldViewBlur(${t.col}, ${t.row})"): cleared cell, it's now "${e.innerHTML}"`),Array.isArray(i)?i.forEach((t=>e.appendChild(t))):e.appendChild(i),this.log(ft.USER,`TableView.onFieldViewBlur(${t.col}, ${t.row})"): cell is now "${e.innerHTML}"`),this.unadjustLayoutBeforeRender(t),setTimeout((()=>{this.adjustLayoutAfterRender()}),0)}}connectedCallback(){super.connectedCallback(),this.resizeEventListener=()=>{try{this.adjustLayoutAfterRender()}catch(t){throw console.log("resizeEventListener caught exception in adjustLayoutAfterRender()"),t}},window.addEventListener("resize",this.resizeEventListener),void 0===this.selectionModel&&(this.selectionModel=new ut,this.selectionModel.modified.add((()=>{this.createSelection()}),this))}disconnectedCallback(){window.removeEventListener("resize",this.resizeEventListener)}}window.customElements.define("toad-table",xt);class Ct{constructor(t,e,i){this.type=t,this.index=e,this.size=i}get col(){return this.index}get row(){return this.size}}class kt extends pt{constructor(t,e){super(e),this.data=t}get rowCount(){return this.data?this.data.length:0}createRow(){return new this.nodeClass}insert(t,e){if(t>this.rowCount)throw Error(`ArrayTableModel.insert(${t}) is out of range, model size is ${this.colCount}, ${this.rowCount}`);let i;return void 0===e&&(e=this.createRow()),i=e instanceof Array?e:[e],this.data.splice(t,0,...i),this.modified.trigger(new Ct(st.INSERT_ROW,t,i.length)),t}remove(t,e=1){if(t>=this.rowCount||t+e>this.rowCount)throw Error(`ArrayTableModel.remove(${t}, ${e}) is out of range, model size is ${this.colCount}, ${this.rowCount}`);return this.data.splice(t,e),this.modified.trigger(new Ct(st.REMOVE_ROW,t,e)),t}}window.customElements.define("toad-tabletool",class extends S{constructor(){super(),this.toolbar=M("div",{class:"toolbar"}),this.buttonAddRowAbove=M("button",Object.assign({class:"left",title:"add row above"},{children:_("svg",Object.assign({style:{display:"block"},viewBox:"0 0 13 13",width:"13",height:"13"},{children:[M("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),M("line",{x1:"0.5",y1:"8.5",x2:"12.5",y2:"8.5",class:"stroke"}),M("line",{x1:"4.5",y1:"8.5",x2:"4.5",y2:"13.5",class:"stroke"}),M("line",{x1:"8.5",y1:"8.5",x2:"8.5",y2:"13.5",class:"stroke"}),M("line",{x1:"6.5",y1:"2",x2:"6.5",y2:"7",class:"stroke"}),M("line",{x1:"4",y1:"4.5",x2:"9",y2:"4.5",class:"stroke"})]}))})),this.buttonAddRowAbove.onclick=()=>{var t,e,i;null===(t=this.lastActiveTable)||void 0===t||t.focus();const o=null===(e=this.lastActiveTable)||void 0===e?void 0:e.model,s=null===(i=this.lastActiveTable)||void 0===i?void 0:i.selectionModel;s&&o&&o instanceof kt&&o.insert(s.row)},this.toolbar.appendChild(this.buttonAddRowAbove),this.buttonAddRowBelow=M("button",Object.assign({title:"add row below"},{children:_("svg",Object.assign({viewBox:"0 0 13 13",width:"13",height:"13"},{children:[M("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),M("line",{x1:"0.5",y1:"4.5",x2:"12.5",y2:"4.5",class:"stroke"}),M("line",{x1:"4.5",y1:"0.5",x2:"4.5",y2:"4.5",class:"stroke"}),M("line",{x1:"8.5",y1:"0.5",x2:"8.5",y2:"4.5",class:"stroke"}),M("line",{x1:"6.5",y1:"6",x2:"6.5",y2:"11",class:"stroke"}),M("line",{x1:"4",y1:"8.5",x2:"9",y2:"8.5",class:"stroke"})]}))})),this.buttonAddRowBelow.onclick=()=>{var t,e,i;null===(t=this.lastActiveTable)||void 0===t||t.focus();const o=null===(e=this.lastActiveTable)||void 0===e?void 0:e.model,s=null===(i=this.lastActiveTable)||void 0===i?void 0:i.selectionModel;s&&o&&o instanceof kt&&o.insert(s.row+1)},this.toolbar.appendChild(this.buttonAddRowBelow),this.buttonDeleteRow=M("button",Object.assign({class:"right",title:"delete row"},{children:_("svg",Object.assign({viewBox:"0 0 13 13",width:"13",height:"13"},{children:[M("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),M("line",{x1:"0.5",y1:"4.5",x2:"12.5",y2:"4.5",class:"stroke"}),M("line",{x1:"0.5",y1:"8.5",x2:"12.5",y2:"8.5",class:"stroke"}),M("line",{x1:"5.5",y1:"3.5",x2:"11.5",y2:"9.5",class:"stroke","stroke-width":"1.5"}),M("line",{x1:"11.5",y1:"3.5",x2:"5.5",y2:"9.5",class:"stroke","stroke-width":"1.5"})]}))})),this.buttonDeleteRow.onclick=()=>{var t,e,i;null===(t=this.lastActiveTable)||void 0===t||t.focus();const o=null===(e=this.lastActiveTable)||void 0===e?void 0:e.model,s=null===(i=this.lastActiveTable)||void 0===i?void 0:i.selectionModel;s&&o&&o instanceof kt&&o.remove(s.row)},this.toolbar.appendChild(this.buttonDeleteRow),this.toolbar.appendChild(document.createTextNode(" ")),this.buttonAddColumnLeft=M("button",Object.assign({class:"left",title:"add column left"},{children:_("svg",Object.assign({viewBox:"0 0 13 13",width:"13",height:"13"},{children:[M("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),M("line",{x1:"8.5",y1:"0.5",x2:"8.5",y2:"12.5",class:"stroke"}),M("line",{x1:"8.5",y1:"4.5",x2:"12.5",y2:"4.5",class:"stroke"}),M("line",{x1:"8.5",y1:"8.5",x2:"12.5",y2:"8.5",class:"stroke"}),M("line",{x1:"2",y1:"6.5",x2:"7",y2:"6.5",class:"stroke"}),M("line",{x1:"4.5",y1:"4",x2:"4.5",y2:"9",class:"stroke"})]}))})),this.toolbar.appendChild(this.buttonAddColumnLeft),this.buttonAddColumnRight=M("button",Object.assign({title:"add column right"},{children:_("svg",Object.assign({viewBox:"0 0 13 13",width:"13",height:"13"},{children:[M("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),M("line",{x1:"4.5",y1:"0.5",x2:"4.5",y2:"12.5",class:"stroke"}),M("line",{x1:"0.5",y1:"4.5",x2:"4.5",y2:"4.5",class:"stroke"}),M("line",{x1:"0.5",y1:"8.5",x2:"4.5",y2:"8.5",class:"stroke"}),M("line",{x1:"6",y1:"6.5",x2:"11",y2:"6.5",class:"stroke"}),M("line",{x1:"8.5",y1:"4",x2:"8.5",y2:"9",class:"stroke"})]}))})),this.toolbar.appendChild(this.buttonAddColumnRight),this.buttonDeleteColumn=M("button",Object.assign({class:"right",title:"delete column"},{children:_("svg",Object.assign({viewBox:"0 0 13 13",width:"13",height:"13"},{children:[M("rect",{x:"0.5",y:"0.5",width:"12",height:"12",class:"strokeFill"}),M("line",{x1:"4.5",y1:"0.5",x2:"4.5",y2:"12.5",class:"stroke"}),M("line",{x1:"8.5",y1:"0.5",x2:"8.5",y2:"12.5",class:"stroke"}),M("line",{x1:"3.5",y1:"5.5",x2:"9.5",y2:"11.5",class:"stroke","stroke-width":"1.5"}),M("line",{x1:"3.5",y1:"11.5",x2:"9.5",y2:"5.5",class:"stroke","stroke-width":"1.5"})]}))})),this.toolbar.appendChild(this.buttonDeleteColumn),this.toolbar.appendChild(document.createTextNode(" ")),this.buttonAddNodeAbove=M("button",Object.assign({class:"left",title:"add node above"},{children:_("svg",Object.assign({style:{display:"block",border:"none"},viewBox:"0 0 8 17",width:"8",height:"17"},{children:[M("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"strokeFill"}),M("rect",{x:"0.5",y:"9.5",width:"6",height:"6",class:"fill"}),M("line",{x1:"3.5",y1:"3",x2:"3.5",y2:"6",class:"stroke"}),M("line",{x1:"2",y1:"4.5",x2:"5",y2:"4.5",class:"stroke"}),M("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"1",class:"stroke"}),M("line",{x1:"3.5",y1:"8",x2:"3.5",y2:"17",class:"stroke"})]}))})),this.toolbar.appendChild(this.buttonAddNodeAbove),this.buttonAddNodeBelow=M("button",Object.assign({title:"add node below"},{children:_("svg",Object.assign({style:{display:"block",border:"none"},viewBox:"0 0 8 17",width:"8",height:"17"},{children:[M("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"fill"}),M("rect",{x:"0.5",y:"9.5",width:"6",height:"6",class:"strokeFill"}),M("line",{x1:"3.5",y1:"11",x2:"3.5",y2:"14",class:"stroke"}),M("line",{x1:"2",y1:"12.5",x2:"5",y2:"12.5",class:"stroke"}),M("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"9",class:"stroke"}),M("line",{x1:"3.5",y1:"16",x2:"3.5",y2:"17",class:"stroke"})]}))})),this.toolbar.appendChild(this.buttonAddNodeBelow),this.buttonAddNodeParent=M("button",Object.assign({title:"add node parent"},{children:_("svg",Object.assign({viewBox:"0 0 13 17",width:"13",height:"17"},{children:[M("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"strokeFill"}),M("rect",{x:"6.5",y:"9.5",width:"6",height:"6",class:"fill"}),M("line",{x1:"7",y1:"4.5",x2:"10",y2:"4.5",class:"stroke"}),M("line",{x1:"9.5",y1:"4",x2:"9.5",y2:"9",class:"stroke"}),M("line",{x1:"3.5",y1:"3",x2:"3.5",y2:"6",class:"stroke"}),M("line",{x1:"2",y1:"4.5",x2:"5",y2:"4.5",class:"stroke"}),M("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"1",class:"stroke"}),M("line",{x1:"3.5",y1:"8",x2:"3.5",y2:"17",class:"stroke"})]}))})),this.buttonAddNodeParent.onclick=()=>{},this.toolbar.appendChild(this.buttonAddNodeParent),this.buttonAddNodeChild=M("button",Object.assign({title:"add node child"},{children:_("svg",Object.assign({viewBox:"0 0 13 17",width:"13",height:"17"},{children:[M("rect",{x:"0.5",y:"1.5",width:"6",height:"6",class:"fill"}),M("rect",{x:"6.5",y:"9.5",width:"6",height:"6",class:"strokeFill"}),M("line",{x1:"7",y1:"4.5",x2:"10",y2:"4.5",class:"stroke"}),M("line",{x1:"9.5",y1:"4",x2:"9.5",y2:"9",class:"stroke"}),M("line",{x1:"9.5",y1:"11",x2:"9.5",y2:"14",class:"stroke"}),M("line",{x1:"8",y1:"12.5",x2:"11",y2:"12.5",class:"stroke"}),M("line",{x1:"3.5",y1:"0",x2:"3.5",y2:"17",class:"stroke"})]}))})),this.toolbar.appendChild(this.buttonAddNodeChild),this.buttonDeleteNode=M("button",Object.assign({class:"right",title:"delete node"},{children:_("svg",Object.assign({viewBox:"0 0 10 17",width:"10",height:"17"},{children:[M("rect",{x:"1.5",y:"5.5",width:"6",height:"6",class:"strokeFill"}),M("line",{x1:"4.5",y1:"2",x2:"4.5",y2:"5",class:"stroke"}),M("line",{x1:"4.5",y1:"12",x2:"4.5",y2:"15",class:"stroke"}),M("line",{x1:"0.5",y1:"4.5",x2:"8.5",y2:"12.5",class:"stroke","stroke-width":"1.5"}),M("line",{x1:"8.5",y1:"4.5",x2:"0.5",y2:"12.5",class:"stroke","stroke-width":"1.5"})]}))})),this.toolbar.appendChild(this.buttonDeleteNode),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode($,!0)),this.shadowRoot.appendChild(this.toolbar)}canHandle(t){return t instanceof xt}activate(){this.lastActiveTable=S.activeView,this.toolbar.classList.add("active")}deactivate(){this.lastActiveTable=void 0,this.toolbar.classList.remove("active")}});class Et extends wt{}class At extends Et{}class Tt{constructor(t,e,i=!0){this.node=t,this.depth=e,this.open=i}}class Rt extends pt{constructor(t,e){super(t),this.rows=new Array,void 0!==e&&this.createRowInfoHelper(this.rows,e,0)}get colCount(){return 1}get rowCount(){return this.rows.length}getRow(t){for(let e=0;e<this.rows.length;++e)if(this.rows[e].node===t)return e}addSiblingBefore(t){const e=this.createNode();return 0===this.rows.length?(t=0,this.setRoot(e),this.rows.push(new Tt(e,0))):0===t?(this.setNext(e,this.getRoot()),this.setRoot(e),this.rows.unshift(new Tt(e,0))):(this.setNext(e,this.rows[t].node),this.getNext(this.rows[t-1].node)===this.rows[t].node?this.setNext(this.rows[t-1].node,e):this.setDown(this.rows[t-1].node,e),this.rows.splice(t,0,new Tt(e,this.rows[t].depth))),this.modified.trigger(new Ct(st.INSERT_ROW,t,1)),t}addSiblingAfter(t){const e=this.createNode();if(0===this.rows.length)t=0,this.setRoot(e),this.rows.push(new Tt(e,0));else{this.setNext(e,this.getNext(this.rows[t].node)),this.setNext(this.rows[t].node,e);const i=this.nodeCount(this.getDown(this.rows[t].node)),o=this.rows[t].depth;t+=i+1,this.rows.splice(t,0,new Tt(e,o))}return this.modified.trigger(new Ct(st.INSERT_ROW,t,1)),t}addChildAfter(t){const e=this.createNode();if(0===this.rows.length)this.setRoot(e),this.rows.push(new Tt(e,0)),this.modified.trigger(new Ct(st.INSERT_ROW,0,1));else{const i=this.getDown(this.rows[t].node),o=this.nodeCount(i);for(let e=0;e<o;++e)++this.rows[t+1+e].depth;this.setDown(e,i),this.setDown(this.rows[t].node,e),this.rows.splice(t+1,0,new Tt(e,this.rows[t].depth+1)),this.modified.trigger(new Ct(st.INSERT_ROW,t+1,1))}return t}addParentBefore(t){const e=this.createNode();if(0===t){for(let e=0;e<this.rows.length;++e)++this.rows[t+e].depth;this.setDown(e,this.getRoot()),this.setRoot(e),this.rows.unshift(new Tt(e,0))}else{const i=this.rows[t].depth,o=this.nodeCount(this.getDown(this.rows[t].node))+1;for(let e=0;e<o;++e)++this.rows[t+e].depth;this.setDown(e,this.rows[t].node),this.setNext(e,this.getNext(this.rows[t].node)),this.setNext(this.rows[t].node,void 0),this.getNext(this.rows[t-1].node)===this.rows[t].node?this.setNext(this.rows[t-1].node,e):this.setDown(this.rows[t-1].node,e),this.rows.splice(t,0,new Tt(e,i))}return this.modified.trigger(new Ct(st.INSERT_ROW,t,1)),t}deleteAt(t){let e=this.getDown(this.rows[t].node);if(void 0!==e){const i=this.nodeCount(e)+1;for(let e=0;e<i;++e)--this.rows[t+e].depth;this.append(e,this.getNext(this.rows[t].node)),this.setNext(this.rows[t].node,void 0),0===t?this.setRoot(e):this.setNext(this.rows[t-1].node,e)}else if(0===t){const e=this.getNext(this.rows[t].node);this.setNext(this.rows[t].node,void 0),this.setRoot(e)}else{const e=this.getNext(this.rows[t].node);this.setNext(this.rows[t].node,void 0),this.getNext(this.rows[t-1].node)===this.rows[t].node?this.setNext(this.rows[t-1].node,e):this.setDown(this.rows[t-1].node,e)}return this.rows.splice(t,1),this.modified.trigger(new Ct(st.REMOVE_ROW,t,1)),t}init(){}toggleAt(t){this.rows[t].open?this.closeAt(t):this.openAt(t)}isOpen(t){return this.rows[t].open}openAt(t){let e=this.rows[t];if(e.open||void 0===this.getDown(e.node))return;e.open=!0;const i=this.createRowInfo(t);this.rows.splice(t+1,0,...i),this.modified.trigger(new Ct(st.INSERT_ROW,t+1,i.length))}closeAt(t){let e=this.rows[t];if(!e.open||void 0===this.getDown(e.node))return;const i=this.getVisibleChildCount(t);e.open=!1,this.rows.splice(t+1,i),this.modified.trigger(new Ct(st.REMOVE_ROW,t+1,i))}createRowInfo(t){const e=new Array;let i=this.rows[t];return i.open&&this.getDown(i.node)&&this.createRowInfoHelper(e,this.getDown(i.node),i.depth+1),e}createRowInfoHelper(t,e,i){const o=new Tt(e,i,!1);t.push(o),o.open&&this.getDown(e)&&this.createRowInfoHelper(t,this.getDown(e),o.depth+1),this.getNext(e)&&this.createRowInfoHelper(t,this.getNext(e),o.depth)}getVisibleChildCount(t){let e=this.rows[t],i=1;if(e.open&&this.getDown(e.node)){const e=this.getVisibleChildCountHelper(t+1);t+=e,i+=e}return i-1}getVisibleChildCountHelper(t){let e=this.rows[t],i=1;if(e.open&&this.getDown(e.node)){const e=this.getVisibleChildCountHelper(t+1);t+=e,i+=e}if(this.getNext(e.node)){const e=this.getVisibleChildCountHelper(t+1);t+=e,i+=e}return i}append(t,e){if(void 0===e)return;let i,o=t;for(;i=this.getNext(o),void 0!==i;)o=i;this.setNext(o,e)}nodeCount(t){return void 0===t?0:1+this.nodeCount(this.getDown(t))+this.nodeCount(this.getNext(t))}}class Ot extends H{constructor(t,e,i){super(),this.model=t,this.rowinfo=e,this.label=i,this.attachShadow({mode:"open"})}setModel(t){}connectedCallback(){super.connectedCallback(),this.paint()}disconnectedCallback(){super.disconnectedCallback()}paint(){if(!this.shadowRoot)return;if(!this.parentElement)return;const t=this.model.getRow(this.rowinfo.node);if(void 0===t)return;const e=12,i=3.5,o=Math.round(2)-.5,s=this.rowinfo.depth*e+e+i,n=_(D,{children:[M("svg",{width:s,height:e,style:{verticalAlign:"middle",background:"none"}}),M("span",Object.assign({style:{verticalAlign:"middle",padding:"2px"}},{children:this.label}))]}),l=n[0];{const s=this.rowinfo,n=s.depth;if(this.model.getDown(s.node)){const t=n*e+i,r=M("rect",{x:t,y:o,width:8,height:8,stroke:"#000",fill:"#fff",cursor:"pointer"});l.appendChild(r),l.appendChild(M("line",{x1:t+2,y1:o+4,x2:t+8-2,y2:o+4,stroke:"#000",cursor:"pointer"}));const d=M("line",{x1:t+4,y1:o+2,x2:t+4,y2:o+8-2,stroke:"#000",cursor:"pointer"});d.style.display=s.open?"none":"",l.appendChild(d),l.appendChild(M("line",{x1:t+8,y1:o+4,x2:t+8+3,y2:o+4,stroke:"#000"})),l.onmousedown=e=>{var i;e.preventDefault(),e.stopPropagation();const n=this.model.getRow(s.node);if(void 0===n)return void console.log("  ==> couldn't find row number for node");const r=l.getBoundingClientRect(),a=e.clientX-r.left,h=e.clientY-r.top;t<=a&&a<=t+8&&o<=h&&h<=o+8&&(null===(i=this.model)||void 0===i||i.toggleAt(n),d.style.display=this.model.isOpen(n)?"none":"")}}else l.appendChild(M("line",{x1:n*e+i+4,y1:"0",x2:n*e+i+4,y2:o+4,stroke:"#000"})),l.appendChild(M("line",{x1:n*e+i+4,y1:o+4,x2:n*e+i+8+3,y2:o+4,stroke:"#000"}));let r="";for(let o=0;o<=n;++o){const l=o*e+i+4;for(let e=t+1;e<this.model.rowCount&&!(this.model.rows[e].depth<o);++e)if(o===this.model.rows[e].depth){(o!==n||void 0!==this.model.getNext(s.node))&&(r+=`<line x1='${l}' y1='0' x2='${l}' y2='100%' stroke='%23000' />`);break}}if(void 0===this.model.getDown(s.node)||void 0===this.model.getNext(s.node)){const t=n*e+i+4;r+=`<line x1='${t}' y1='0' x2='${t}' y2='50%' stroke='%23000' />`}this.parentElement.style.background=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg'>${r}</svg>")`,this.parentElement.style.backgroundRepeat="repeat-y"}n.replaceIn(this.shadowRoot)}}window.customElements.define("toad-treenodecell",Ot);class Nt extends At{isViewCompact(){return!0}treeCell(t,e){if(this.model)return new Ot(this.model,this.model.rows[t],e)}}class Dt extends Rt{constructor(t,e){super(t,e),this.root=e}createNode(){return new this.nodeClass}deleteNode(t){}getRoot(){return this.root}setRoot(t){this.root=t}getDown(t){return t.down}setDown(t,e){t.down=e}getNext(t){return t.next}setNext(t,e){t.next=e}}class Mt extends kt{constructor(t,e){super(t,e)}get colCount(){return 10}}class _t extends At{getColumnHead(t){const e=this.getColumnHeads();return document.createTextNode(e[t])}get colCount(){var t;return this.getRow(null===(t=this.model)||void 0===t?void 0:t.data[0]).length}getRowHead(t){}getDisplayCell(t,e){const i=this.getField(t,e);if(void 0!==i)return document.createTextNode(i)}getEditorCell(t,e){const i=this.getField(t,e);if(void 0===i)return;const o=new r(i);o.modified.add((()=>{this.setField(t,e,o.value)}));const s=new W;return s.setModel(o),s}getField(t,e){if(this.model)return this.getRow(this.model.data[e])[t].toString()}setField(t,e,i){this.model&&(this.getRow(this.model.data[e])[t].fromString(i),this.model.modified.trigger(new Ct(st.CELL_CHANGED,t,e)))}}let Ht=new r("");v("hello",Ht);let Lt=new d("");Lt.modified.add((()=>{document.getElementById("rawhtml").innerText=Lt.value})),v("markup",Lt),y("hitMe",(()=>{Ht.value="Hit me too!",St.enabled=!0}));var St=y("hitMeMore",(()=>{Ht.value="You hit me!",St.enabled=!1}));v("onoff",new n(!1)),v("size",new l(42,{min:0,max:99})),y("file|logout",(()=>{alert("You are about to logout")})),y("help",(()=>{alert("Please.")}));class It{constructor(){this.title="",this.author="",this.year=1970}}const Bt=[{title:"The Moon Is A Harsh Mistress",author:"Robert A. Heinlein",year:1966},{title:"Stranger In A Strange Land",author:"Robert A. Heinlein",year:1961},{title:"The Fountains of Paradise",author:"Arthur C. Clarke",year:1979},{title:"Rendezvous with Rama",author:"Arthur C. Clarke",year:1973},{title:"2001: A Space Odyssey",author:"Arthur C. Clarke",year:1968},{title:"Do Androids Dream of Electric Sheep?",author:"Philip K. Dick",year:1968},{title:"A Scanner Darkly",author:"Philip K. Dick",year:1977},{title:"Second Variety",author:"Philip K. Dick",year:1953}];class Vt extends _t{getColumnHeads(){return["Title","Author","Year"]}getRow(t){return function(t,...e){return e.map((e=>new O(t,e)))}(t,"title","author","year")}}class Ft{constructor(){this.label="#"+Ft.counter++}}Ft.counter=0;class jt extends Nt{getDisplayCell(t,e){return this.model&&this.treeCell(e,this.model.rows[e].node.label)}}class Wt extends HTMLElement{constructor(){super(),this.condition=new n(!1);let t=new b("my-code-button"),e=t.text("label","Show Code");t.action("action",(()=>{this.condition.value?(this.condition.value=!1,e.value="Show Code"):(this.condition.value=!0,e.value="Hide Code")})),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t.root)}connectedCallback(){v(this.getAttribute("condition"),this.condition)}}return window.customElements.define("my-code-button",Wt),t.main=function(){wt.register(Vt,Mt,It),v("books",new Mt(Bt,It)),function(){Nt.register(jt,Dt,Ft);let t=new Dt(Ft);t.addSiblingAfter(0),t.addChildAfter(0),t.addChildAfter(1),t.addSiblingAfter(2),t.addSiblingAfter(1),t.addChildAfter(4),t.addSiblingAfter(0),v("tree",t)}()},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=main.js.map
